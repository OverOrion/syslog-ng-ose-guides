<!DOCTYPE topic
[  <!ENTITY % entities SYSTEM "../shared/syslog-ng-entities.ent">
  %entities;]>
<procedure xml:id="proc-conf-relay" xmlns="http://docbook.org/ns/docbook">
    <title>syslog-ng PE as a relay</title>
    <formalpara>
        <title>Purpose:</title>
        <para/>
    </formalpara>
    <para>As mentioned earlier, &abbrev; can be turned into a relay. This functionality is often used on larger networks, or when logs are collected from network devices using UDP and forwarded to a central location using the more reliable TCP or RLTP protocols. When used as a relay, &abbrev; does not store the logs locally, but forwards them immediately to the central &abbrev; server.</para>
    <para>In this example, a &abbrev; Linux client is reconfigured as a relay.</para>
    <formalpara>
        <title>Steps:</title>
        <para/>
    </formalpara>
    <step>
        <para>Open <filename>/opt/syslog-ng/etc/syslog-ng.conf</filename> in a text editor</para>
    </step>
    <step>
        <para>Remove the current log statement: starting with line <command>log {</command>, delete everything until the end of the file</para>
    </step>
    <step>
        <para>Add a new UDP source for router logs:</para>
        <synopsis>source s_udp {udp();}; </synopsis>
    </step>
    <step>
        <para>Add a new log path for storing local logs locally:</para>
        <synopsis>log { source(s_local); destination(d_messages); };</synopsis>
    </step>
    <step>
        <para>Add a new log path for sending both local messages and logs collected from the UDP source to the central server:</para>
        <synopsis>log {
    source(s_local);
    source(s_udp);
    destination(d_logserver);
};</synopsis>
    </step>
    <step>
        <para><emphasis>Validating the changes</emphasis></para>
        <para>Test the relay by executing the following command on the relay machine:</para>
        <para><command>/opt/syslog-ng/bin/loggen -i -D localhost 514</command></para>
        <para>It generates about a thousand messages a second and sends to the UDP port of the local &abbrev; relay. Executing <command>tail /var/log/messages</command> should not show any of the generated messages on the relay, but doing the same on the server machine should show a large number of similar lines:</para>
        <synopsis>Sep 20 21:18:09 relayhost prg00000[1234]: seq: 0000009458, thread: 0000, runid: 1379704679, stamp: 2013-09-20T21:18:09 PADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADDPADD</synopsis>
    </step>
</procedure>
