<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-configuration" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Configuring &agent;</title>
    <section xml:id="windows-configuring">
        <title>How to configure the &agentabbrev;</title>
        <para>This section describes how to configure the &agentabbrev; application. The exact method depends on the installation scenario and also on the configuration method (regular or XML-based) you want to use. The &agent; application is configured usually using its MMC snap-in (when managed globally from the domain controller or when configuring it in standalone mode). However, it is also possible to use an XML-based configuration file. </para>
        <itemizedlist>
            <listitem>
                <para>For details on how to configure a &agentabbrev; that was installed in standalone mode, see <xref linkend="windows-configure-standalone"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows-configure-domain-hosts"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows-configure-domain-controllers"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure &agentabbrev; from file, see <xref linkend="windows-xml-config"/>.</para>
            </listitem>
        </itemizedlist>
        <section xml:id="windows-configure-standalone">
            <title>Configuring a standalone &agentabbrev;</title>
            <indexterm>
                <primary>configuring syslog-ng</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <para>In standalone mode, to configure an already installed &agentabbrev;, select <guimenu>Start Menu > Programs > syslog-ng Agent for Windows > Configure syslog-ng Agent</guimenu>. Alternatively, select <guimenu>Start Menu > Run</guimenu>, enter <parameter>gpedit.msc</parameter>, then select <guimenu>Computer configuration > syslog-ng Agent Settings</guimenu></para>
            <warning>
                <para>After modifying its configuration, you have to restart the <parameter>syslog-ng Agent</parameter> service for the changes to take effect. To restart the &agentabbrev; service, select <guimenu>Start Menu > Run</guimenu> enter <parameter>services.msc</parameter> and restart the <guimenu>syslog-ng Agent</guimenu> service.</para>
            </warning>
        </section>
        <section xml:id="windows-configure-domain">
            <title>Configuring the &agentabbrev;s of a domain</title>
            <para>This section describes how to configure the &agent; application in domain mode.</para>
            <itemizedlist>
                <listitem>
                    <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows-configure-domain-hosts"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows-configure-domain-controllers"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on the relationship of different group-policy levels, see <xref linkend="windows-inheritance"/>.</para>
                </listitem>
            </itemizedlist>
            <note>
                <para>Managing &agentabbrev; from a Windows 2000 domain controller is not supported.</para>
            </note>
            <procedure xml:id="windows-configure-domain-hosts">
                <title>Configuring the &agentabbrev;s of the domain hosts</title>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>configuring domain hosts</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To configure an already installed &agentabbrev; from the domain controller, perform the following steps.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>On the domain controller, select <guimenu>Start > Control Panel > Administrative Tools > Active Directory Users and Computers</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click on the Organizational Unit, then select <guimenu>Properties > syslog-ng Agent Settings</guimenu>.</para>
                </step>
                <step>
                    <para>Configure the &agentabbrev; as needed for the domain hosts. The changes will take affect when the domain hosts update their settings from the domain controller. By default, this happens every 90 minutes, depending on your domain settings. To download the configuration earlier, execute the <command>gpupdate</command> command on the members of the domain.</para>
                    <note>
                        <para>When the domain hosts update their settings, the &agentabbrev; will be automatically restarted to load the new settings, except when there is no difference between the old and the new settings.</para>
                    </note>
                </step>
            </procedure>
            <procedure xml:id="windows-configure-domain-controllers">
                <title>Configuring the &agentabbrev;s of the domain controllers</title>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>configuring domain controllers</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To configure the &agentabbrev; running on the domain controllers, perform the following steps.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>On the domain controller, select <guimenu>Start > Control Panel > Administrative Tools > Active Directory Users and Computers</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click on the Organizational Unit of the domain whose domain controllers you want to configure, then select <guimenu>Properties</guimenu>. By default, the domain controllers are in the Domain Controllers organizational unit.</para>
                </step>
                <step>
                    <para>Select <guimenu>Group Policy</guimenu>, and edit the Group Policy object you want to add the &agentabbrev; configuration to. Alternatively, you can create a new group policy object as well.</para>
                </step>
                <step>
                    <para>Select <guimenu>Computer Configuration > syslog-ng Agent Settings</guimenu> and configure the &agentabbrev;. The domain controllers of the domain will use this configuration.</para>
                </step>
                <step>
                    <para>Configure the &agentabbrev; as needed for the domain controllers. If you have multiple domain controllers, the changes will take affect when the other domain controllers update their settings from this domain controller. By default, this happens every 5 minutes, depending on your domain settings. To download the configuration earlier, execute the <command>gpupdate</command> command on the domain controllers.</para>
                    <note>
                        <para>When the domain controllers receive the new settings, the &agentabbrev; will be automatically restarted to load the new settings, except when there is no difference between the old and the new settings.</para>
                    </note>
                </step>
            </procedure>
            <section xml:id="windows-inheritance">
                <title>Domain versus local settings</title>
                <indexterm>
                    <primary>inheriting settings on Windows</primary>
                </indexterm>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>inheriting settings</secondary>
                </indexterm>
                <para>The &agentabbrev; follows the standard policy-inheritance methods of Windows:</para>
                <para>GPOs (Group Policy Objects) from parent containers are inherited by default. When multiple GPOs apply to these computers, the settings in the GPOs are aggregated. The final value of a given policy setting is set only by the highest precedent GPO that contains the setting. (However, the final value for a few settings will actually be the combination of values across GPOs.) In this processing order, sites are applied first, but have the least precedence. OUs (Organization Units) are processed last, but have the highest precedence.</para>
                <para>When multiple group policy objects are assigned, the group policies are applied in the following order:</para>
                <orderedlist>
                    <listitem>
                        <para>The local group policy object is applied.</para>
                    </listitem>
                    <listitem>
                        <para>The group policy objects linked to sites are applied. If multiple GPOs exist for a site, they are applied in the order specified by the administrator.</para>
                    </listitem>
                    <listitem>
                        <para>GPOs linked to the domains are applied in the specified order.</para>
                    </listitem>
                    <listitem>
                        <para>GPOs linked to OUs are applied. The OU group policy objects are set from the largest to the smallest organizational unit; that is, first the parent OU and then the child OU. By default, a policy applied later overwrites a policy that was applied earlier. Hence, the settings in a child OU can override the settings in the parent OU.</para>
                    </listitem>
                    <listitem>
                        <para>If any group policy is not configured, the &agentabbrev; checks its local policy settings, and uses the local setting if available.</para>
                    </listitem>
                </orderedlist>
                <para>The following are the rules regarding group policy settings inheritance:</para>
                <itemizedlist>
                    <listitem>
                        <para>A policy setting is configured (<guimenu>Enabled</guimenu> or <guimenu>Disabled</guimenu>) for a parent OU, and the same policy setting is not configured for its child OUs. The child OUs inherit the parent’s policy.</para>
                    </listitem>
                    <listitem>
                        <para>A policy setting is configured (<guimenu>Enabled</guimenu> or <guimenu>Disabled</guimenu>) for a parent OU, and the same policy setting is configured for its child OUs. The child OUs settings override the settings inherited from the parent’s OU. There is a specific case, when the type of this setting is list:</para>
                        <itemizedlist>
                            <listitem>
                                <para>The &agentabbrev; will aggregate the contents of these lists and will use the same elements only once.</para>
                            </listitem>
                            <listitem>
                                <para>If any policy is not configured (<guimenu>Not Configured</guimenu>), no inheritance takes place.</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>Do not use setting <guimenu>Not Configured</guimenu> in local settings, because in that case, it can still use previously configred values. Use settings <guimenu>Enabled</guimenu> or <guimenu>Disabled</guimenu> instead.</para>
                </note>
            </section>
        </section>
        <section xml:id="windows-xml-config">
            <title>Using an XML-based configuration file</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>configuration file</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>XML</secondary>
            </indexterm>
            <para>Starting from &agent; version 3.2, it is possible to export the configuration of &agentabbrev; into an XML file. This configuration file can be used as the default configuration when installing the &agentabbrev; to another host, or can be imported to an existing installation using a command-line utility.</para>
            <warning>
                <para>Do not manually edit or modify the exported XML file.</para>
                <para>In case you want to validate the XML file, use the <filename>syslog-ng-agent-conf.xsd</filename> file located in the installation directory of &agent;.</para>
            </warning>
            <procedure xml:id="windows-xml-config-create">
                <title>Creating an XML configuration file for the &agentabbrev;</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To create an XML configuration file that can be used by other &agentabbrev; configurations, perform the following steps.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Install the &agent; application on a host.</para>
                </step>
                <step>
                    <para>Create the configuration you want to use on other hosts using the graphical interface. The &agent; application will store this configuration in the registry.</para>
                </step>
                <step>
                    <para>Right-click on <guimenu>syslog-ng Agent Settings</guimenu> and select <guimenu>Export</guimenu> to export the configuration of &agentabbrev; from the registry to an XML file. Select where to save the XML file.</para>
                    <para>Alternatively, you can export the configuration of &agentabbrev; from the command line using the <command>configmanager.exe -export &lt;source&gt; "destination xml file"</command> command. The &lt;source&gt; parameter determines which configuration is exported:</para>
                    <itemizedlist>
                        <listitem>
                            <para><parameter>{GPO ID}</parameter>: Export the configuration related to the specified Group Policy Object ID (for example, <parameter>{99AF1185-AB80-40B2-B4B8-41A1E907F329}</parameter>).</para>
                        </listitem>
                        <listitem>
                            <para><parameter>localsettings</parameter>: Export the local settings of the host.</para>
                        </listitem>
                        <listitem>
                            <para><parameter>domainsettings</parameter>: Export the settings the host received from the domain controller.</para>
                        </listitem>
                    </itemizedlist>
                    <note>
                        <para>To overwrite the XML configuration file, use the /F option. This will force export even if the file already exists.</para>
                    </note>
                </step>
                <step>
                    <para>Use the configuration file on other hosts. For details on the different options, see <xref linkend="windows-xml-config-import"/>.</para>
                </step>
            </procedure>
            <section xml:id="windows-xml-config-import">
                <title>Configuring &agentabbrev; from an XML file</title>
                <!-- FIXME ezt meglinkelni az install reszekbol, vagy atrakni oket oda -->
                <para>How you configure the &agentabbrev; application to use an XML configuration file depends on your environment. See the following list for details.</para>
                <warning>
                    <itemizedlist>
                        <listitem>
                            <para>Do not manually edit or modify the exported XML file.</para>
                        </listitem>
                        <listitem>
                            <para>Do not delete the XML configuration file: &agent; will look for the file every time it is started or restarted. If you need to change the location of the file, edit the <parameter>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\syslog-ng Agent\ImagePath</parameter> registry key.</para>
                        </listitem>
                    </itemizedlist>
                </warning>
                <itemizedlist>
                    <listitem>
                        <para>To start an already installed, standalone &agentabbrev; using an XML configuration file, execute the following steps in a command line:</para>
                        <orderedlist>
                            <listitem>
                                <para><command>cd &lt;syslog-ng agent installation directory&gt;</command></para>
                            </listitem>
                            <listitem>
                                <para><command>net stop "syslog-ng agent"</command></para>
                            </listitem>
                            <listitem>
                                <para><command>syslog-ng-agent.exe -i &lt;PATH&gt;\configuration.xml</command></para>
                            </listitem>
                            <listitem>
                                <para><command>net start "syslog-ng agent"</command></para>
                            </listitem>
                        </orderedlist>
                    </listitem>
                    <listitem>
                        <para>To use the XML file during the installation of the &agentabbrev; application, navigate to <guimenu>Setup &agent; operating mode</guimenu> window and select <guimenu>XML mode</guimenu>. In the next window, browse your XML configuration. Note that the XML schema file will be installed in the &agentabbrev; directory.</para>
                    </listitem>
                    <listitem>
                        <para>If you want to use the .msi installer with an xml file, use the <command>syslog-ng-agent-3.2.1-setup.msi SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</command> command, or edit the installer with the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.technipages.com/download-orca-msi-editor.html">Orca MSI editor</link>, and add the <parameter>SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</parameter> to the installation parameters on the <guimenu>Customization</guimenu> tab.</para>
                    </listitem>
                    <listitem>
                        <para>To import the XML configuration file into the registry of the host, use the following command: <command>configmanager.exe -import &lt;destination&gt; "source xml file"</command> command, then restart the &agentabbrev; service. The &lt;destination&gt; parameter determines which configuration the XML configuration will be converted to:</para>
                        <itemizedlist>
                            <listitem>
                                <para><parameter>{GPO ID}</parameter>: Import the configuration to the specified Group Policy Object ID (for example, <parameter>{99AF1185-AB80-40B2-B4B8-41A1E907F329}</parameter>).</para>
                            </listitem>
                            <listitem>
                                <para><parameter>localsettings</parameter>: Import the configuration as the local settings of the host.</para>
                            </listitem>
                            <listitem>
                                <para><parameter>domainsettings</parameter>: Import the configuration as the domain settings of the host.</para>
                            </listitem>
                        </itemizedlist>
                        <warning>
                            <para>Importing the configuration file from an XML file into the registry of the host has no effect if &agentabbrev; is configured to use an XML configuration file.</para>
                        </warning>
                    </listitem>
                </itemizedlist>
            </section>
        </section>
    </section>
    <section xml:id="windows-destinations">
        <title>Configuring destinations</title>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>destinations</secondary>
        </indexterm>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>configuring the logserver</secondary>
        </indexterm>
        <indexterm>
            <primary>destinations</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <para>The &agent; application can send the log messages of the Windows host to a central log server or relay. It is possible to send the same messages to multiple servers, when each server receives the same messages; and also to configure failover servers, when the agent sends the messages to a primary server, or to a failover server if the primary becomes unavailable. If the agent loses the connection to a destination server and the reconnection fails, it will send an eventlog message. The successful reconnection attempt is also logged. (If the server is unavailable for a long time, the agent sends a log message about the failed connection once in every ten minutes.)</para>
        <para>If the failover server also becomes unavailable, the application will switch to the next failover server, and so on. If the last failover server is unavailable, it switches back to the primary. The application does not switch back automatically to the primary server if it becomes available again, only if the syslog-ng Agent for Windows has been restarted.</para>
        <note>
            <para>The failover servers will use the same options that the primary server uses. Only the name and the address can be configured for the failover servers.</para>
        </note>
        <para>Similarly to the Linux version, the agent now sends MARK messages to the server to indicate that the client host is alive but there are no log messages to send. A MARK message is sent every ten minutes.</para>
        <warning>
            <para>The &agent; application does not support the unreliable UDP protocol. Configure your central log server to accept logs using TCP or TLS connections. If needed, adjust your firewall configuration to permit such traffic to the log server.</para>
        </warning>
        <figure>
            <title>Adding new destinations</title>
            <mediaobject>
                <imageobject role="html">
                    <imagedata format="PNG" align="center" fileref="win-destinations.png"/>
                </imageobject>
                <imageobject role="fo">
                    <imagedata format="PNG" fileref="&imgroot;/win-destinations.png" contentwidth="&screenshotsize;"/>
                </imageobject>
            </mediaobject>
        </figure>
        <procedure xml:id="windows-configure-destination">
            <title>Configuring the destination logservers</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>To configure a new destination, complete the following steps:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, and double-click on <guimenu>Add new server</guimenu>.</para>
            </step>
            <step>
                <para>Enter the hostname or the IP address of the logserver into the <guimenu>Server Name</guimenu> field. If your logserver is configured to accept messages on a non-standard port, type the port number into the <guimenu>Server Port</guimenu> field.</para>
                <figure>
                    <title>Adding new server</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-server-property-server.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&imgroot;/win-server-property-server.png" contentwidth="10cm"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <!-- FIXME Ezt a templates reszt kulon helyre is ki kellene rakni, hogy konnyebb legyen megtalalni -->
                <para>On <guimenu>Messages</guimenu> tab, select the protocol used to transfer log messages and press <guimenu>Reset</guimenu> to apply the selected template. The following protocol templates are available:</para>
                <itemizedlist>
                    <listitem>
                        <indexterm>
                            <primary>BSD-syslog protocol</primary>
                        </indexterm>
                        <indexterm>
                            <primary>Legacy-syslog protocol</primary>
                        </indexterm>
                        <indexterm>
                            <primary>RFC 3164</primary>
                        </indexterm>
                        <para><guimenu>Legacy BSD Syslog Protocol</guimenu>: Use the legacy BSD-syslog protocol specified in RFC3164. This option uses the following message template: <parameter>&lt;${PRI}&gt;${BSDDATE} ${HOST} ${APP_NAME}[${PROCESS_ID}]: ${MSG}</parameter>. Within the message part, &agentabbrev; replaces CRLF with 2 spaces and TAB character with 1 space.</para>
                        <figure>
                            <title>Legacy BSD Syslog Protocol</title>
                            <mediaobject>
                                <imageobject role="html">
                                    <imagedata format="PNG" align="center" fileref="win-legacy-bsd-syslog-protocol.png"/>
                                </imageobject>
                                <imageobject role="fo">
                                    <imagedata format="PNG" fileref="&imgroot;/win-legacy-bsd-syslog-protocol.png" contentwidth="10cm"/>
                                </imageobject>
                            </mediaobject>
                        </figure>
                        <example xml:id="example-legacy-bsd">
                            <title>Legacy BSD Syslog Protocol log</title>
                            <synopsis>&lt;134&gt;Oct 04 14:45:33 zts-win019.ztswin2008dom.balabit Microsoft-Windows-Eventlog[2880]: ZTSWIN2008DOM\balabit: System Microsoft-Windows-Eventlog: [Information] The Application log file was cleared. (EventID 104)</synopsis>
                        </example>
                    </listitem>
                    <listitem>
                        <indexterm>
                            <primary>syslog protocol</primary>
                        </indexterm>
                        <indexterm>
                            <primary>IETF-syslog protocol</primary>
                        </indexterm>
                        <indexterm>
                            <primary>RFC 5424-5428</primary>
                        </indexterm>
                        <para><guimenu>Syslog Protocol</guimenu>: Use the new IETF-syslog protocol specified in <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://tools.ietf.org/html/rfc5424">RFC 5424-5428</link>. Starting from version 3.0, syslog-ng also supports the IETF-protocol.</para>
                        <figure>
                            <title>Syslog Protocol</title>
                            <mediaobject>
                                <imageobject role="html">
                                    <imagedata format="PNG" align="center" fileref="win-syslog-protocol.png"/>
                                </imageobject>
                                <imageobject role="fo">
                                    <imagedata format="PNG" fileref="&imgroot;/win-syslog-protocol.png" contentwidth="10cm"/>
                                </imageobject>
                            </mediaobject>
                        </figure>
                        <note>
                            <para>Starting with version 3.2, the &agent; application uses the IETF-syslog protocol by default, and the default metadata to include is <parameter>Macro names and values</parameter>.</para>
                        </note>
                        <indexterm>
                            <primary>SDATA</primary>
                        </indexterm>
                        <indexterm>
                            <primary>sending macros in SDATA</primary>
                        </indexterm>
                        <indexterm>
                            <primary>metadata in SDATA</primary>
                        </indexterm>
                        <indexterm>
                            <primary>IETF-syslog protocol</primary>
                            <secondary>SDATA</secondary>
                        </indexterm>
                        <indexterm>
                            <primary>IETF-syslog protocol</primary>
                            <secondary>adding macros to SDATA</secondary>
                        </indexterm>
                        <!-- FIXME we should find a better place for this info, or structure the procedure differently -->
                        <para>When using the IETF-syslog protocol to transfer Eventlog messages, the &agentabbrev; application can include the macros (name-value pairs) in the SDATA part of the log message. Select the data to add to the log messages from the <guimenu>Metadata to include</guimenu> list. The following options are available:</para>
                        <itemizedlist>
                            <listitem>
                                <para><parameter>None</parameter>: Include only the data mandated by RFC5424.</para>
                                <synopsis>[meta sequenceId="value" sysUpTime="value"] [origin ip="value" software="value"]</synopsis>
                            </listitem>
                            <listitem>
                                <para><parameter>Macro names and values</parameter>: Include every available Event macro, except <parameter>EVENT_MSG (EVENT_MESSAGE)</parameter>, <parameter>EVENT_MSG_XML (EVENT_MESSAGE_XML)</parameter> and macros with null value.</para>
                                <para>This is the default setting.</para>
                                <synopsis>499 &lt;132&gt;1 2010-09-28T12:02:30+02:00 zts-win004.ztswin2003dom.balabit testapp 1220 - [meta sequenceId="1" sysUpTime="1"][origin ip="zts-win004.ztswin2003dom.balabit" software="testapp"][win@18372.4 EVENT_ID="1000" EVENT_NAME="Application" EVENT_REC_NUM="1673" EVENT_SID="S-1-5-21-3460971693-970282485-2299281428-1001" EVENT_SID_TYPE="User" EVENT_SOURCE="testapp" EVENT_TYPE="Warning" EVENT_USERNAME="ZTS-WIN004\\balabit"] ﻿ZTS-WIN004\balabit: Application testapp: [Warning] test message (EventID 1000)</synopsis>
                                <note>
                                    <para>The names of SDATA fields must be in the following format: name@&lt;private enterprise number&gt;, for example, <parameter>mySDATA-field@18372.4</parameter>. (18372.4 is the private enterprise number of BalaBit IT Security, the developer of &agent;.)</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>Messages received from eventlog sources include the <parameter>win@18372.4</parameter> SD-ID. For example, on your &abbrev; server you can refer to message fields like: <parameter>${.SDATA.win@18372.4.EVENT_SOURCE}</parameter></para>
                                        </listitem>
                                        <listitem>
                                            <para>Messages received from eventlog sources include the <parameter>file@18372.4</parameter> SD-ID. For example, on your &abbrev; server you can refer to message fields like: <parameter>${.SDATA.file@18372.4.name}</parameter></para>
                                        </listitem>
                                    </itemizedlist>
                                </note>
                            </listitem>
                            <listitem>
                                <para><parameter>EventData (deprecated Agent v3.1 functionality)</parameter>: Include the name-vaule pairs from the <parameter>EventData > &lt;Data&gt;</parameter> field of the log message and the <parameter>Keyword</parameter> value from the System part of the XML Eventlog messages. Note that these fields are available only on Windows Vista and newer operating systems, and &agentabbrev; 3.1. automatically included these values in the log messages.</para>
                                <synopsis>[EventData@18372.4 "name"="value"] [Keywords@18372.4 Keyword="value"]</synopsis>
                                <para>See the following sample log message:</para>
                                <synopsis>338 &lt;132&gt;1 2010-09-28T12:02:30+02:00 zts-win004.ztswin2003dom.balabit testapp 1620 - [meta sequenceId="1" sysUpTime="1"][origin ip="zts-win004.ztswin2003dom.balabit" software="testapp"][EventData@18372.4 Data="test message"][Keywords@18372.4 Keyword="Classic"] ﻿ZTS-WIN004\balabit: Application testapp: [Warning] test message (EventID 1000)332</synopsis>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem>
                        <indexterm>
                            <primary>snare</primary>
                        </indexterm>
                        <para><guimenu>Snare Protocol</guimenu>: Send log messages in a format compatible with the Snare log monitoring tool.</para>
                        <figure>
                            <title>Snare Protocol</title>
                            <mediaobject>
                                <imageobject role="html">
                                    <imagedata format="PNG" align="center" fileref="win-snare-protocol.png"/>
                                </imageobject>
                                <imageobject role="fo">
                                    <imagedata format="PNG" fileref="&imgroot;/win-snare-protocol.png" contentwidth="10cm"/>
                                </imageobject>
                            </mediaobject>
                        </figure>
                        <warning>
                            <para>3.1 and earlier versions of the &agent; application used an imperfect message template to send Snare-compatible messages. This has been corrected in the <guimenu>Snare Protocol</guimenu> option. If you need the old, imperfect mode of operation, select a syslog protocol and select <guimenu>Message Type > Agent v3.1 Snare Compatible Message Type (deprecated)</guimenu>, then click <guimenu>Reset Event Message Template</guimenu>.</para>
                        </warning>
                        <note>
                            <para>Snare is a tab-separated message format. Within the message part, agent replaces CRLF with 2 space, TAB character with 1 space.</para>
                            <para>You cannot modify the log format if you have selected this protocol.</para>
                        </note>
                        <example xml:id="example-snare-log">
                            <title>Snare log</title>
                            <synopsis>&lt;134&gt;Oct 06 13:49:41 zts-win019.ztswin2008dom.balabit MSWinEventLog   1   Application 1   Wed Oct 06 13:49:41 2010    1   syslog-ng Agent   S-1-5-21-551780264-1021859348-3425375765-1003   User    Information zts-win019.ztswin2008dom.balabit    None        Application started 1</synopsis>
                        </example>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>Selecting the <guimenu>Syslog Protocol</guimenu> option is identical to using the <parameter>syslog</parameter> driver in the Linux/Unix version of syslog-ng. Similarly, selecting <guimenu>Legacy BSD Syslog Protocol</guimenu> is equivalent to the <parameter>tcp</parameter> driver of syslog-ng.</para>
                    <para>Changing a protocol does not automatically change the protocol template used. To use a protocol-specific template, select <guimenu>Reset Protocol Template</guimenu> after modifying the protocol.</para>
                </note>
            </step>
            <step>
                <indexterm>
                    <primary>message template</primary>
                </indexterm>
                <indexterm>
                    <primary>message format</primary>
                </indexterm>
                <indexterm>
                    <primary>formatting messages</primary>
                </indexterm>
                <para>If needed, modify the template of the messages. The format of the messages can be different for the eventlog and the file sources.</para>
                <warning>
                    <para>The maximal length of the template is 1023 characters.</para>
                </warning>
            </step>
            <step>
                <indexterm>
                    <primary>hostname resolution</primary>
                </indexterm>
                <indexterm>
                    <primary>hostname in the messages</primary>
                </indexterm>
                <para>If the host running &agentabbrev; is sometimes logged in into a domain, sometimes not, then its hostname might change depending on its actual domain membership. This might cause that the hostname appearing in the syslog messages depends on the domain membership of the host. To avoid this situation, enable the <guimenu>Force DNS Hostname</guimenu> option. That way &agentabbrev; resolves the name of its host from the DNS server, and uses the resolved FQDN in the syslog messages.</para>
            </step>
            <step>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>failover servers</secondary>
                </indexterm>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>client-side failover</secondary>
                </indexterm>
                <indexterm>
                    <primary>client-side failover</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <para>If you have a backup server that can accept log messages if the primary logserver becomes unavailable, select the <guimenu>Failover Servers</guimenu> tab, click <guimenu>Add</guimenu>, and enter the hostname or the IP address of the backup logserver into the <guimenu>Server Name</guimenu> field. Repeat this step if you have more than one backup servers.</para>
                <figure>
                    <title>Failover Servers</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-server-property-failover.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&imgroot;/win-server-property-failover.png" contentwidth="10cm"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>If you want to send the log messages to more than on server in parallel, so that every server receives every message, repeat Steps 3-4 to add the secondary servers. Secondary servers may have failover servers as well.</para>
                <note>
                    <para>The &agent; application considers a message received by the logserver if the primary server of the destination, or one of its failover servers receives it. To modify which server of a destination is the primary server, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, right-click on the server you want to be primary, select <guimenu>Properties > Set Primary Server</guimenu>. </para>
                </note>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
        <procedure xml:id="windows-rate-limit">
            <title>Limiting the rate of messages</title>
            <indexterm>
                <primary>throttle</primary>
                <secondary>on Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>message rate</primary>
                <secondary>on Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>throttle</secondary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The &agentabbrev; can control the rate of messages (message per second) sent to the central server. That way sudden message-bursts can be avoided, and the load of the server is decreased.</para>
            <para>To limit the number of messages sent to a destination, complete the following steps:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
            </step>
            <step>
                <para>Select the destination server and select <guimenu>Properties</guimenu>. To limit the number of messages that the &agentabbrev; sends to the server per second, enter the desired limit into the <guimenu>Throttle</guimenu> field. By default (<parameter>0</parameter>), the &agentabbrev; does not limit the number of messages sent.</para>
                <note>
                    <para>The throttling parameter applies to the total number of messages sent, not to every source independently. The same value applies to the failover servers of the destination.</para>
                    <para>If you are sending messages to multiple servers, then the speed of the primary server is important: if the primary server cannot accept the messages fast enough, the &agentabbrev; will reduce the number of sent messages to match the speed of the primary server, even if the secondary servers could accept messages faster. If the secondary servers cannot accept messages as fast as the primary server, then the secondary servers will lose messages; the &agentabbrev; will not slow down to wait for them.</para>
                </note>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="windows-sources">
        <title>Configuring message sources</title>
        <para>The &agent; application can read messages from eventlog containers and text files. The following sections explain how to configure these message sources.</para>
        <itemizedlist>
            <listitem>
                <para>For details on how to forward messages from eventlog containers, see <xref linkend="windows-sources-eventlog"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to forward messages from plain text log files, see <xref linkend="windows-sources-file"/>.</para>
            </listitem>
            <listitem>
                <para>Some global settings can apply to both types of sources, these are described in <xref linkend="windows-global-settings"/>.</para>
            </listitem>
        </itemizedlist>
        <section xml:id="windows-sources-eventlog">
            <title>Eventlog sources</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>eventlog sources</secondary>
            </indexterm>
            <indexterm>
                <primary>sources</primary>
                <secondary>eventlog</secondary>
            </indexterm>
            <para>The &agent; application can collect messages from the standard Windows eventlog containers, as well as from custom containers. The agent automatically forwards the messages from three standard eventlog containers (<parameter>Application, Security, System</parameter>). To enable or disable these sources, or to add custom eventlog containers, complete the following steps:</para>
            <note>
                <para>The &agent; sends its own log messages into the <parameter>Application</parameter> eventlog container.</para>
                <para>The agent caches in the registry the ID of the last message sent to the destination server, so if the agent is not operating for a time (for example it is restarted ), then it starts reading messages from the last cached message ID, sending out all the new messages.</para>
            </note>
            <warning>
                <para>If an eventlog container becomes corrupt, the agent will stop processing the event source. A log message (<parameter>Eventlog file is corrupt</parameter>) is sent directly to the logserver to notify about the error.</para>
            </warning>
            <warning>
                <para>Hazard of data loss! It is not recommended to setup archiving for the event container. It is possible to lose logs if there are non-processed events in the event container when the archiving is started. Windows closes and renames the event container and starts a new one regardless of any reading applications.</para>
                <para>To prevent this, enable <guimenu>overwrite events when needed</guimenu> mode in the Windows Event Viewer with the following conditions:</para>
                <itemizedlist>
                    <listitem>
                        <para>The messages are not generated faster than the agent's processing speed.</para>
                    </listitem>
                    <listitem>
                        <para>There is enough window between the first and the last events for planned agent stops. Ensure that new events will not overwrite the event last read by the agent during agent stop.</para>
                    </listitem>
                </itemizedlist>
            </warning>
            <procedure xml:id="windows-sources-regular-eventlog">
                <title>Managing eventlog sources</title>
                <figure>
                    <title>Managing eventlog sources</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-event-containers-properties.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&imgroot;/win-event-containers-properties.png" contentwidth="10cm"/>
                        </imageobject>
                    </mediaobject>
                </figure>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the configuration interface of the &agent; application.</para>
                </step>
                <step>
                    <para>Select <guimenu>syslog-ng Agent Settings > Eventlog Sources</guimenu>, and double-click on <guimenu>Event Containers</guimenu>.</para>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To disable sending messages from an eventlog container, unselect the checkbox before the name of the container.</para>
                        </listitem>
                        <listitem>
                            <para>To modify the log facility associated with the messages of the container, select the container, click <guimenu>Edit</guimenu>, and select the log facility to use in the <guimenu>Log Facility</guimenu> field.</para>
                        </listitem>
                        <listitem>
                            <para>To add a custom container, select <guimenu>Add</guimenu>, and enter the name if the container into the <guimenu>Event Container Name</guimenu> field. If you do not know the name of the container, see <xref linkend="windows-custom-eventlog-name-vista"/> and <xref linkend="windows-custom-eventlog-name-xp"/>.</para>
                        </listitem>
                    </itemizedlist>
                </step>
                <step>
                    <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
                </step>
            </procedure>
            <procedure xml:id="windows-custom-eventlog-name-vista">
                <title>Determining the name of a custom eventlog container on Windows Vista and newer</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To determine the name of a custom eventlog container on Windows Vista, Server 2008, and Windows 7, complete the following steps.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Open the Event Viewer application.</para>
                </step>
                <step>
                    <para>Select the custom container you are looking for (for example <parameter>DNS Server</parameter>).</para>
                </step>
                <step>
                    <para>Right click on the container and select <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>The name of the container is the name of the file (without the extension) displayed in the <guimenu>Logname</guimenu> field (for example for <parameter>C:\WINDOWS\system32\config\DnsEvent.Evt</parameter> it is <parameter>DnsEvent</parameter>).</para>
                </step>
                <step>
                    <para>Use this name as the name of the custom eventlog container during the procedure described in <xref linkend="windows-sources-regular-eventlog"/>.</para>
                    <note>
                        <para>On Windows Vista and Server 2008, some container are not real containers, but show selected messages collected from multiple containers. To forward such messages to the syslog-ng server, you have to find out which real containers are displayed in the container, and add them to the configuration of the syslog-ng Agent.</para>
                        <para>Some containers have the <parameter>%4</parameter> characters in their names. When adding these to the &agentabbrev;, replace <parameter>%4</parameter> with the <parameter>/</parameter> (slash) character. For example write <parameter>microsoft-windows-bits-client/analytic</parameter> instead of <parameter>microsoft-windows-bits-client%4analytic</parameter>.</para>
                        <para>If you are sending old messages to the server as well, the &agentabbrev; will not send the very first message stored in the container. This is a bug in the Windows API.</para>
                    </note>
                </step>
            </procedure>
            <procedure xml:id="windows-custom-eventlog-name-xp">
                <title>Determining the name of a custom eventlog container on Windows 2000, XP, or Server 2003</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To determine the name of a custom eventlog container on Windows 2000, XP, or Server 2003, complete the following steps.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>On the client host select <guimenu>Start > Run > regedit</guimenu>.</para>
                </step>
                <step>
                    <para>Navigate to <guimenu>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\</guimenu>. The custom containers are listed here. For example, the following are valid container names: <parameter>DFS Replication</parameter>, <parameter>File Replication Service</parameter>, <parameter>DNS Server</parameter>.</para>
                </step>
                <step>
                    <para>Use this name as the name of the custom eventlog container during the procedure described in <xref linkend="windows-sources-regular-eventlog"/>.</para>
                </step>
            </procedure>
        </section>
        <procedure xml:id="windows-sources-file">
            <title>Managing file sources</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>file sources</secondary>
            </indexterm>
            <indexterm>
                <primary>sources</primary>
                <secondary>windows log files</secondary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The &agent; application can collect log messages from text files. It can process messages spanning multiple lines, and supports the use of wildcards (<parameter>*</parameter>, <parameter>?</parameter>) in filenames to be able to follow log files that are automatically rotated. Note that every line of the file that ends with a newline character is considered a separate message. However, if a file contains only a single line that does not end with a newline character, &agentabbrev; will not process the line.</para>
            <para>To configure file sources, complete the following steps:</para>
            <xi:include href="../../common/wnt/warning-windows-network-shares.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <note>
                <para>If an application writes a message into a log file without ending the line with a new-line character, saves (closes) the file, and later continues to write into the same line, then this is visible in the file as a single line, but the &agentabbrev; interprets them as two separate messages.</para>
            </note>
            <warning>
                <para>If an application deletes a log file, the application must ensure that &agentabbrev; had enough time to forward the messages from the file to the central server to avoid losing messages.</para>
            </warning>
            <example>
                <title xml:id="example-collecting-multiple">Collecting the logs of multiple applications from a single folder</title>
                <para>If two applications log into the same folder (for example <filename>C:\logs</filename>), you have to create two file sources. For example, if the name of the log files is <parameter>application1-*.log</parameter> and <parameter>application2-*.log</parameter>, respectively, then create two file sources with the <filename>C:\logs</filename> Base Directory, but with different File Name Filter: <parameter>application1-*.log</parameter> and <parameter>application2-*.log</parameter>, respectively.</para>
                <para>If other applications log into the <filename>C:\logs</filename> folder, add a separate expression for each application.</para>
                <para>By default, the &agentabbrev; will send every message to the server that arrives into any of the monitored log files. To send only the messages that arrive into the latest file of the source, enable the <guimenu>Last Modified File Only</guimenu> option.</para>
            </example>
            <figure>
                <title>Managing file sources</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" align="center" fileref="win-file-source-property.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/win-file-source-property.png" contentwidth="10cm"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Sources properties</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" align="center" fileref="win-sources-properties.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/win-sources-properties.png" contentwidth="10cm"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings > File Sources</guimenu>, double-click on <guimenu>Sources</guimenu>, and check the <guimenu>Enable</guimenu> option.</para>
            </step>
            <step>
                <para>Select <guimenu>Add > Browse</guimenu>, and select the folder containing the log files in the <guimenu>Base Directory</guimenu> field. Select or enter the name and extension of the log files in the <guimenu>File Name Filter</guimenu> field. Wildcards may be used. The &agentabbrev; will forward log messages from every file that is located in this folder and has a name that matches the filter expression.</para>
                <xi:include href="../../common/wnt/warning-windows-network-shares.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <tip>
                    <para>When specifying the Base Directory, you can use the environment variables of Windows, for example <parameter>%WINDIR%</parameter>, <parameter>%SYSTEMROOT%</parameter>, <parameter>%PROGRAMFILES%</parameter>, and so on.</para>
                </tip>
                <warning>
                    <para>Note that when managing members of a domain, the selected path must be available on the domain members, for example <filename>C:\logs</filename> must be available on the client hosts and not on the domain controller.</para>
                </warning>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para>To send messages from the files located in the subfolders of the folder set as Base Directory, select the <guimenu>Recursive</guimenu> option.</para>
                    </listitem>
                    <listitem>
                        <para>To send messages only from the file that was last modified, select the <guimenu>Last Modified File Only</guimenu> option.</para>
                        <note>
                            <para>When using the <guimenu>Last Modified File Only</guimenu> option with a file source that has wildcard in the filename (for example <parameter>*.log</parameter>), the following will happen. When started for the first time, the agent will send the contents of every matching file to the central server, and store the position of the last message in the file with the most recent modification date. When new messages are written to this file, the agent will send only the new messages. However, if an older file is modified, the agent will resend the entire contents of this newly modified file, and store the position of the last message in this file only.</para>
                            <para>When you use wildcards together with the <guimenu>Last Modified File Only</guimenu> option, make sure that older files will not be modified.</para>
                        </note>
                        <para>If you are forwarding the logs of Internet Information Server (IIS) 5 applications, select the <guimenu>IIS 5.x Log</guimenu> option.</para>
                        <note>
                            <para>If this option is not selected, the &agentabbrev; monitors every matching file in the folder for changes, and sends new log messages from all files.</para>
                        </note>
                    </listitem>
                    <listitem>
                        <para>To send messages only from the file that was last modified of every subfolder of the Base Directory, select both the <guimenu>Last Modified File Only</guimenu> and the <guimenu>Recursive</guimenu> options.</para>
                    </listitem>
                    <listitem>
                        <para>To change the log facility or the log severity associated to the file source, select the desired facility or priority from the <guimenu>Log Facility</guimenu> or <guimenu>Log Severity</guimenu> fields, respectively.</para>
                        <note>
                            <para>Significant changes to the settings of a file source may cause the &agentabbrev; to resend the entire contents of the matching files. This means that log messages already sent earlier to the syslog-ng server may be resent and thus duplicated in the server logs. Configuration changes that may result in such behavior are:</para>
                            <itemizedlist>
                                <listitem>
                                    <para>changing the Base Directory,</para>
                                </listitem>
                                <listitem>
                                    <para>changing filter options,</para>
                                </listitem>
                                <listitem>
                                    <para>changing recursivity and Last Modified File Only options.</para>
                                </listitem>
                            </itemizedlist>
                        </note>
                    </listitem>
                </itemizedlist>
            </step>
            <step xml:id="windows-sources-file-encoding">
                <indexterm>
                    <primary>file sources</primary>
                    <secondary>encoding</secondary>
                </indexterm>
                <indexterm>
                    <primary>file encoding</primary>
                </indexterm>
                <para>By default, the &agentabbrev; application assumes that the source files are encoded using the default windows ANSI code page, specific to the locale of the host. If the files have a different encoding, select it from the <guimenu>File Encoding</guimenu> field. Unicode, UTF-16, and UTF-32 encodings are currently not supported. Note that the log messages are sent to the destinations using UTF-8 encoding.</para>
            </step>
            <step xml:id="windows-sources-file-multi-line" xreflabel="Processing multi-line messages">
                <indexterm>
                    <primary>processing multi-line messages</primary>
                </indexterm>
                <indexterm>
                    <primary>multi-line messages</primary>
                </indexterm>
                <indexterm>
                    <primary>multiline messages</primary>
                </indexterm>
                <para>If a log messages in the log file consists of multiple lines, that is, the log messages contain newline characters, configure &agentabbrev; to process the related lines as a single message.</para>
                <indexterm>
                    <primary>Tomcat log messages</primary>
                </indexterm>
                <indexterm>
                    <primary>Catalina log messages</primary>
                </indexterm>
                <indexterm>
                    <primary>Apache Tomcat Catalina log messages</primary>
                </indexterm>
                <indexterm>
                    <primary>Oracle SQL log messages</primary>
                </indexterm>
                <para>The &agentabbrev; application can automatically handle Apache Tomcat Catalina and Oracle SQL log messages. To process such messages, select the name of the application from the <guimenu>Multiple Lines > Application</guimenu> field. Note that the timestamp of Tomcat log messages depends on the locale of the host.</para>
                <para>To process multi-line log messages of a different application, complete the following steps.</para>
                <substeps>
                    <step>
                        <para>Select <guimenu>Multiple Lines > Application > Custom</guimenu>, and set the <guimenu>Multiple Lines > Prefix</guimenu> and optionally the <guimenu>Multiple Lines > Garbage</guimenu> fields.</para>
                    </step>
                    <step>
                        <indexterm type="parameter">
                            <primary>multi-line-prefix()</primary>
                        </indexterm>
                        <para>Specify a string or regular expression that matches the beginning of the log messages in the <guimenu>Multiple Lines > Prefix</guimenu> field. If the <guimenu>Prefix</guimenu> option is set, the &agentabbrev; ignores newline characters from the source until a line matches the regular expression again, and treats the lines between the matching lines as a single message.</para>
                        <note>
                            <para>Use as simple regular expressions as possible, because complex regular expressions can severely reduce the rate of processing multi-line messages.</para>
                        </note>
                    </step>
                    <step>
                        <para>Use the <guimenu>Multiple Lines > Garbage</guimenu> option when processing multi-line messages that contain unneeded parts between the messages. Specify a string or regular expression that matches the beginning of the unneeded message parts. If the <guimenu>Garbage</guimenu> option is set, the &agentabbrev; ignores lines between the line matching the <guimenu>Garbage</guimenu> expression and the next line matching <guimenu>Prefix</guimenu>.</para>
                        <para>When receiving multi-line messages from a source when the <guimenu>Garbage</guimenu> option is set but no matching line is received between two lines that match <guimenu>Prefix</guimenu>, the &agentabbrev; application will continue to process the incoming lines as a single message until a line matching <guimenu>Garbage</guimenu> is received.</para>
                        <warning>
                            <para>If the <guimenu>Garbage</guimenu> option is set, the &agentabbrev; application discards lines between the line matching the <guimenu>Garbage</guimenu> and the next line matching <guimenu>Prefix</guimenu> expressions.</para>
                        </warning>
                    </step>
                    <step>
                        <para><emphasis>Optional Step</emphasis>: After creating and testing a custom pattern, please consider sending your pattern to &vendor; so we can include it in a future version of &agentabbrev;. To share your pattern with &vendor; and other &agentabbrev; users, click <guimenu>Multiple Lines > Send custom pattern to BalaBit</guimenu>. Your e-mail application will open, with an e-mail containing the application name and the pattern.</para>
                    </step>
                </substeps>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
        <procedure xml:id="windows-global-settings">
            <title>Configuring global settings</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The &agent; application has some global settings that can apply to both eventlog and file sources. To configure the global settings, complete the following procedure:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings</guimenu> and double-click on <guimenu>Global Settings</guimenu>.</para>
            </step>
            <step>
                <para>Set the default log facility associated to the messages.</para>
            </step>
            <step>
                <para>By default, the filters and regular expressions (see <xref linkend="windows-message-filtering"/>) used in the message filters are case-sensitive. To make them case-insensitive, select the <guimenu>Regular Expressions Ignore Case</guimenu> or the <guimenu>Filters Ignore Case</guimenu> options, or both.</para>
                <note>
                    <para>The <guimenu>Regular Expressions Ignore Case</guimenu> option makes the <parameter>Message Contents</parameter> filter case-insensitive for both file and eventlog sources. The <guimenu>Filters Ignore Case</guimenu> option makes the <parameter>Computers</parameter>, <parameter>Sources and Categories</parameter>, and the <parameter>Users</parameter> filter case-insensitive.</para>
                </note>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
        <procedure xml:id="windows-disable-source">
            <title>Disabling sources and filters globally</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>disabling sources and filters</secondary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>Filters and sources can be disabled globally as well. Disabling filters or sources means that the &agentabbrev; ignores the disabled settings: that is, if the file sources are disabled, the agent does not send the messages from the files to the server. For details, see the following procedure.</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para>To disable eventlog sources, select <guimenu>syslog-ng Agent Settings</guimenu>, right-click on <guimenu>Eventlog Sources</guimenu>, then select <guimenu>Properties > Disable</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To disable file sources, select <guimenu>syslog-ng Agent Settings</guimenu>, right-click on <guimenu>File Sources</guimenu>, then select <guimenu>Properties > Disable</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To disable eventlog filters, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, right-click on <guimenu>Global Event Filters</guimenu>, then select <guimenu>Properties > Disable</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To disable file filters, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, right-click on <guimenu>Global File Filters</guimenu>, then select <guimenu>Properties > Disable</guimenu>.</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="windows-ssl">
        <title>Using SSL-encrypted connections with the &agentabbrev;</title>
        <indexterm>
            <primary>authentication</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <indexterm>
            <primary>TLS</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <indexterm>
            <primary>certificates</primary>
        </indexterm>
        <para>When connecting to a syslog-ng server using an encrypted connection, the syslog-ng agent verifies the certificate of the server. The connection is established only if the Certificate Authority (CA) that issued the certificate of the server is available in the Certificate Store (<guimenu>MMC > Certificates > Computer Account > Local Computer > Trusted Root Certificates</guimenu>) of the Windows-based host.</para>
        <note>
            <para>This certificate (sometimes also called the CACert of the server) is not the certificate of the server: it is the certificate of the CA that signed the certificate of the server.<!-- (For details on how certificate-based authentication
                works, see <xref linkend="concepts-tls"/>)--></para>
        </note>
        <procedure xml:id="windows-enable-ssl">
            <title>Enabling encrypted connections</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>To enable SSL-encrypted connections to the server, complete the following steps:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
            </step>
            <step>
                <para>Right-click on the server that accepts encrypted connections and select <guimenu>Properties</guimenu>.</para>
            </step>
            <step>
                <para>Select the <guimenu>Use SSL</guimenu> option.</para>
                <warning>
                    <para>The connection can be established only if the Certificate Authority (CA) that issued the certificate of the server is available in the Certificate Store (<guimenu>MMC > Certificates > Computer Account > Local Computer > Trusted Root Certificates</guimenu>) of the Windows-based host. For details on importing certificates, see <xref linkend="windows-importcert"/>.</para>
                </warning>
                <xi:include href="../../syslog-ng-guide-admin/chapters/chapter-encrypted-transport-tls.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(cert-common-name)"/>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
        <section xml:id="windows-ssl-mutual">
            <title>Using mutual authentication with &agentabbrev;</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>mutual authentication</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>client authentication</secondary>
            </indexterm>
            <indexterm>
                <primary>mutual authentication</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <indexterm>
                <primary>client authentication</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <para>When the syslog-ng server is configured to use mutual authentication, it requests a certificate from the syslog-ng clients. The &agentabbrev; application can automatically show the requested certificate to the server when the connection is established, provided it is available in the <guimenu>Personal Certificates</guimenu> store (<guimenu>MMC > Certificates > Computer Account > Local Computer > Personal Certificates</guimenu>) of the Local Computer. Use the <guimenu>Certificate Import Wizard</guimenu> to import this certificate. For details, see <xref linkend="windows-importcert"/>.</para>
            <!--      <note>
                <para>If the syslog-ng agent cannot find a suitable certificate in the Local
                    Computer/Personal Certificates store, it also checks the Personal Certificates
                    store of the syslog-ng Agent service. If the syslog-ng agent was started
                    manually, the Personal Certificates store of the current user is also
                checked.</para>
            </note>-->
            <note>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>certificate revocation lists</secondary>
                </indexterm>
                <indexterm>
                    <primary>&agentabbrev;</primary>
                    <secondary>CRL</secondary>
                </indexterm>
                <indexterm>
                    <primary>certificate revocation lists</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <indexterm>
                    <primary>CRL</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <para>If a certificate revocation list (CRL) is available in the Local Computer/Personal Certificates store, the &agentabbrev; verifies that the certificate of the syslog-ng server is not on this list.</para>
            </note>
            <procedure xml:id="proc-windows-ssl-mutual">
                <title>Configuring mutual authentication with the &agentabbrev; for Windows</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>If the syslog-ng server requests authentication from the &agentabbrev;, complete the following steps.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Create certificates for the clients. By default, the &agentabbrev; will look for a certificate that contains the hostname or IP address of the central syslog-ng server in its Common Name. If you use a different Common Name, do not forget to complete Step 3 to set the Common Name of the certificate.</para>
                    <para>The certificate must contain the private key and must be in PKCS12 format.</para>
                    <tip>
                        <para>To convert a certificate and a key from PEM format to PKCS12 you can use the following command:</para>
                        <synopsis>openssl pkcs12 -export -in agentcertificate.pem -inkey agentprivatekey.pem -out agentcertificatewithkey.pfx </synopsis>
                    </tip>
                </step>
                <step>
                    <para>Import this certificate into the <guimenu>Personal Certificate</guimenu> store of the Local Computer using the Certificate Import Wizard. For details, see <xref linkend="windows-importcert"/>.</para>
                </step>
                <step>
                    <para>By default, the &agentabbrev; will look for a certificate that contains the hostname or IP address of the central syslog-ng server in its Common Name. (The agent will look for the server name or address set in the <guimenu>Server Name</guimenu> field of the destination.) If the certificate of the client has a different Common Name, complete the following steps:</para>
                    <substeps>
                        <step>
                            <para>Start the configuration interface of the &agentabbrev; for Windows application.</para>
                        </step>
                        <step>
                            <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
                        </step>
                        <step>
                            <para>Right-click on the server that requires mutual authentication and select <guimenu>Properties</guimenu>.</para>
                        </step>
                        <step>
                            <para>Select the <guimenu>Use SSL</guimenu> option, click <guimenu>Select</guimenu>, then select the certificate to use. You can also type the Common Name of the certificate into the <guimenu>Client Certificate Subject</guimenu> field.</para>
                            <para>If you have more than one certificates with the same Common Name, alternatively, you can type the Distinguished Name (DN) of the certificate into the <guimenu>Client Certificate Subject</guimenu> field. When using the Distinguished Name, type only the elements of the name, separated with comma, starting with the country. For example <parameter>US, Maryland, Pasadena, Example Inc, Sample Department, mycommonname</parameter>
                            </para>
                            <note>
                                <para>A common way is to use the hostname or the IP address of the host running the &agentabbrev; as the Common Name of the certificate (for example <parameter>syslog-ng-agent1.example.com</parameter>).</para>
                            </note>
                        </step>
                    </substeps>
                </step>
                <step>
                    <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
                </step>
            </procedure>
        </section>
        <procedure xml:id="windows-importcert">
            <title>Importing certificates with the Microsoft Management Console</title>
            <indexterm>
                <primary>certificates</primary>
                <secondary>importing on Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>importing certificates</secondary>
            </indexterm>
            <indexterm>
                <primary>importing certificates</primary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>To import a certificate, complete the following steps.</para>
            <!-- FIXME leirni, hogy a Ca es kliens certeket hogyan lehet domain controllerbol
        letolni a kliensekre
        CA: GPO > properties > edit > Windows Settings > Publi key policies > Trusted Root Certificates > Import
        -->
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start Microsoft Management Console by executing <filename>mmc.exe</filename> (<guimenu>Start</guimenu> menu <guimenu>Run application</guimenu>). </para>
                <note>
                    <para>Running <filename>mmc.exe</filename> requires administrator privileges.</para>
                </note>
            </step>
            <step>
                <para>Click on the <guimenu>Add/Remove snap-in</guimenu> item of the <guimenu>File</guimenu> menu.</para>
            </step>
            <step>
                <para>Click <guimenu>Add</guimenu>, select the <guimenu>Certificates</guimenu> module, and click <guimenu>Add</guimenu>.</para>
            </step>
            <step>
                <para>Select <guimenu>Computer account</guimenu> in the displayed window and click <guimenu>Next</guimenu>.</para>
            </step>
            <step>
                <para>Select <guimenu>Local computer</guimenu> and click <guimenu>Close</guimenu>. </para>
            </step>
            <step>
                <para>To import the CA certificate of the syslog-ng server's certificate, navigate to <guimenu>Console Root > Certificates > Trusted Root Certificate Authorities > Certificates</guimenu>.</para>
                <para>To import a certificate for the &agentabbrev; to perform mutual authentication, navigate to <guimenu>Console Root > Certificates > Personal > Certificates</guimenu>.</para>
            </step>
            <step>
                <para>Right-click on the <guimenu>Certificates</guimenu> folder and from the appearing menu select <guimenu>All tasks > Import</guimenu>. The <guimenu>Certificate Import Wizard</guimenu> will be displayed. Click <guimenu>Next</guimenu>.</para>
                <para><emphasis>Optional step</emphasis>: Certificates used to authenticate the &agentabbrev; in mutual authentication include the private key. Provide the password for the private key when requested.</para>
            </step>
            <step>
                <para>Windows offers a suitable certificate store by default, so click <guimenu>Next</guimenu>.</para>
            </step>
            <step>
                <para>Click <guimenu>Finish</guimenu> on the summary window and <guimenu>Yes</guimenu> on the window that marks the successful importing of the certificate.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="windows-message-filtering">
        <title>Filtering messages</title>
        <indexterm>
            <primary>message filtering</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>filtering messages</secondary>
        </indexterm>
        <para>The &agent; application can filter log messages both in blacklist- and whitelist fashion. When using blacklisting, you can define filters, and any message that matches the filters is ignored by the agent &mdash; only messages that do not match the filters are sent to the central server. When using whitelisting, you can define filters, and the messages matching the filters are forwarded to the central server &mdash; other messages are ignored. By default, blacklist filtering is used.</para>
        <para>If you define multiple filters, the messages must match every filter. In other words, the filters are connected to each other with logical AND operations.</para>
        <para>Different filters are available for eventlog- and file sources. When the &agentabbrev; processes a message, it checks the relevant filters on-by-one: if it finds a filter that matches the message, the agent stops processing the message without sending it to the server.</para>
        <note>
            <para>By default, all filters are case sensitive. For details on how to change this behavior, see <xref linkend="windows-global-settings"/>.</para>
        </note>
        <itemizedlist>
            <listitem>
                <para>For details on how to filter messages received from eventlog sources, see <xref linkend="filters-eventlog"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to filter messages received from file sources, see <xref linkend="filters-file"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to disable filtering globally, see <xref linkend="windows-disable-source"/>.</para>
            </listitem>
        </itemizedlist>

        <procedure xml:id="filters-eventlog">
            <title>Filtering eventlog messages</title>
            <indexterm>
                <primary>message filtering</primary>
                <secondary>eventlog messages</secondary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The following types of filters are available for eventlog sources:</para>
            <itemizedlist>
                <listitem>
                    <para><emphasis>Sources</emphasis>: Filter on the source (application) that created the message. Corresponds with the <link linkend="EVENT-SOURCE"><parameter>EVENT_SOURCE</parameter></link> macro.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Sources and Event ID</emphasis>: Filter on the source (application) that created the message, and optionally on the identification number of the event. Corresponds with the <link linkend="EVENT-SOURCE"><parameter>EVENT_SOURCE</parameter></link> and <link linkend="EVENT-ID"><parameter>EVENT_ID</parameter></link> macros.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Message Contents</emphasis>: Filter the text of the message, that is, the contents of the <link linkend="EVENT-MESSAGE"><parameter>EVENT_MESSAGE</parameter></link> macro. In this filter you can use regular expressions.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Sources and Categories</emphasis>: Filter on the source (application) that created the message, and optionally on the category of the event. Corresponds with the <link linkend="EVENT-SOURCE"><parameter>EVENT_SOURCE</parameter></link> and <link linkend="EVENT-CATEGORY"><parameter>EVENT_CATEGORY</parameter></link> macros.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Users</emphasis>: Filter on the username associated with the event. Corresponds with the <link linkend="EVENT-USERNAME"><parameter>EVENT_USERNAME</parameter></link> macro.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Computers</emphasis>: Filter on the name of the computer (host) that created the event. Corresponds with the <link linkend="HOST"><parameter>HOST</parameter></link> macro.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Event Types</emphasis>: Filter on the type of the event. Corresponds with the <link linkend="EVENT-TYPE"><parameter>EVENT_TYPE</parameter></link> macro.</para>
                </listitem>
            </itemizedlist>
            <para>To modify the filters used for eventlog messages, complete the following procedure:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para>To apply filters globally to every eventlog message, select <guimenu>syslog-ng Agent Settings > Destinations > Global Event Filters</guimenu>, and right-click <guimenu>Global Event Filters</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To apply filters only to a specific destination, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, select the destination server, then select <guimenu>Event Filters</guimenu>. Right-click <guimenu>Event Filters</guimenu>.</para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>If you want to use both global and local (server side) filtering, first global filters will be applied to the eventlog messages and then the local filters.</para>
                </note>
            </step>
            <step>
                <para>Select <guimenu>Properties > Enable > OK</guimenu>.</para>
                <figure>
                    <title>Global event filters</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-global-event-filters-properties.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&imgroot;/win-global-event-filters-properties.png" contentwidth="10cm"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>To use whitelist-filtering, select <guimenu>White List Filtering</guimenu>. By default, &agentabbrev; uses blacklist filtering.</para>
            </step>
            <step>
                <para>On the right-hand pane, double-click on the type of filter you want to create.</para>
            </step>
            <step>
                <itemizedlist>
                    <!-- FIXME linkeket a makrokra -->
                    <listitem>
                        <para>To ignore messages sent by a specific application, or messages of the application with a specific event ID, double-click on <guimenu>Sources and Event ID</guimenu>, select <guimenu>Add</guimenu>, and select the name of the source (application) whose messages you want to ignore from the <guimenu>Source Name</guimenu> field. To ignore only specific messages of the application, enter the ID of the event into the <guimenu>Event ID</guimenu> field. Select <guimenu>Add > Apply</guimenu>.</para>
                        <figure>
                            <title>Sources and Event ID</title>
                            <mediaobject>
                                <imageobject role="html">
                                    <imagedata format="PNG" align="center" fileref="win-sources-and-event-ids-properties.png"/>
                                </imageobject>
                                <imageobject role="fo">
                                    <imagedata format="PNG" fileref="&imgroot;/win-sources-and-event-ids-properties.png" contentwidth="10cm"/>
                                </imageobject>
                            </mediaobject>
                        </figure>
                    </listitem>
                    <listitem>
                        <para>To ignore messages that contain a specific string or text, double-click on <guimenu>Message Contents</guimenu>, enter the search term or a regular expression into the <guimenu>Regular Expression</guimenu> field, then select <guimenu>Add > Apply</guimenu>.</para>
                        <figure>
                            <title>Message Contents</title>
                            <mediaobject>
                                <imageobject role="html">
                                    <imagedata format="PNG" align="center" fileref="win-message-contents-properties.png"/>
                                </imageobject>
                                <imageobject role="fo">
                                    <imagedata format="PNG" fileref="&imgroot;/win-message-contents-properties.png" contentwidth="10cm"/>
                                </imageobject>
                            </mediaobject>
                        </figure>
                    </listitem>
                    <listitem>
                        <para>To ignore messages sent by a specific application, or messages of the application that fall into a specific category, double-click on <guimenu>Sources and Categories</guimenu>, select <guimenu>Add</guimenu>, and select the name of the application whose messages you want to ignore from the <guimenu>Application Name</guimenu> field. To ignore only those messages of the application that fall into a specific category, enter the name of the category into the <guimenu>Category</guimenu> field. Select <guimenu>Add > Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To ignore messages sent by a specific user, double-click on <guimenu>Users</guimenu>, enter the name of the user into the <guimenu>User</guimenu> field, then select <guimenu>Add > Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To ignore messages sent by a specific computer (host), double-click on <guimenu>Computers</guimenu>, enter the name of the user into the <guimenu>Computer</guimenu> field, then select <guimenu>Add > Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>Event Types</emphasis>: To ignore messages of a specific event-type, double-click on <guimenu>Event Types</guimenu>, select the event types to ignore, and select <guimenu>Ok > Apply</guimenu>.</para>
                        <note>
                            <para>Under Windows Vista and Server 2008, Windows labels certain messages as level 3 and the Event Viewer labels such messages as warnings. This is against the official specification: level 3 should not be used; and only level 2 messages are warnings. To filter these events, you have to manually add a new event type to the registry and set its value to 3, for example <parameter>HKEY_LOCAL_MACHINE\SOFTWARE\BalaBit\syslog-ng Agent\Local Settings\EventSources\Filter\Type\Rule0\Type=3</parameter></para>
                        </note>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>

        <procedure xml:id="filters-file">
            <title>Filtering file messages</title>
            <indexterm>
                <primary>message filtering</primary>
                <secondary>file filters</secondary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The following types of filters are available for file sources:</para>
            <itemizedlist>
                <listitem>
                    <para><emphasis>Message Contents</emphasis>: Filter the text of the message, that is, the contents of the <link linkend="FILE-MESSAGE"><parameter>FILE_MESSAGE</parameter></link> macro. In this filter you can use regular expressions.</para>
                </listitem>
                <listitem>
                    <para><emphasis>File Name</emphasis>: Filter on the file name. Corresponds with the <link linkend="FILE-NAME"><parameter>FILE_NAME</parameter></link> macro. In this filter you can use regular expressions. Only available for destination file filters.</para>
                </listitem>
            </itemizedlist>
            <para>To modify the filters used for file messages, complete the following procedure:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para>To apply filters globally to every file message, select <guimenu>syslog-ng Agent Settings > Destinations > Global File Filters</guimenu>, and right-click <guimenu>Global File Filters</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To apply filters only to a specific destination, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, select the destination server, then select <guimenu>File Filters</guimenu>. Right-click <guimenu>File Filters</guimenu>.</para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>If you want to use both global and local (server side) filtering, first global filters will be applied to the file messages and then the local filters.</para>
                </note>
            </step>
            <step>
                <para>Select <guimenu>Properties > Enable > OK</guimenu>.</para>
                <figure>
                    <title>Global file filters</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-global-file-filters-properties.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&imgroot;/win-global-file-filters-properties.png" contentwidth="10cm"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>To use whitelist-filtering, select <guimenu>White List Filtering</guimenu>. By default, &agentabbrev; uses blacklist filtering.</para>
            </step>
            <step>
                <para>On the right-hand pane, double-click on the type of filter you want to create.</para>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para>To ignore messages that contain a specific string or text, double-click on <guimenu>Message Contents</guimenu>, enter the search term or a regular expression into the <guimenu>Regular Expression</guimenu> field, then select <guimenu>Add</guimenu>.</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="windows-message-format">
        <title>Customizing the message format</title>
        <indexterm>
            <primary>message format</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>message format</secondary>
        </indexterm>
        <para>The format of the messages received from the eventlog and the file sources can be customized using templates. You can define separate message format for the eventlog and the file sources. If you have multiple destination servers configured, you can define separate templates for each server. When creating a template to customize the message format, you can use macros, all alphanumeric characters, and the following special characters: <parameter>&lt;&gt;,():;-+/_</parameter>.</para>
        <procedure xml:id="windows-customize-messages">
            <title>Customizing messages using templates</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>To create a template, complete the following procedure:</para>
            <warning>
                <para>These macros are available only in the &agent;. To recognize Windows-specific elements of the log message (for example eventlog-related macros) on the syslog-ng server, you have to use parsers on the syslog-ng server. The parser must be configured to match the message format set in the syslog-ng Agent. For details on configuring parsers on your &product; server, see <olink targetdoc="syslog-ng-pe-guide-admin-en" targetptr="chapter-parsers"/>.</para>
            </warning>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Start the configuration interface of the &agent; application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>. Select your logserver, and click <guimenu>Properties</guimenu>.</para>
            </step>
            <step>
                <para>To change the format of messages received from eventlog sources, type the message format you want to use into the <guimenu>Event Message Format > Message Template</guimenu> field.</para>
                <para>To change the format of messages received from file sources, type the message format you want to use into the <guimenu>File Message Format > Message Template</guimenu> field.</para>
                <para>Do not forget to add the <parameter>$</parameter> character before macros. For a complete list of the available macros, see <xref linkend="windows-macros"/>.</para>
                <para>For example, to send the messages in the <parameter>DATE HOSTNAME MESSAGE</parameter> format, type <parameter>Date:$DATE Hostname:$HOST Logmessage:$MESSAGE</parameter>.</para>
                <para>Note that the $MESSAGE macro contains not only the text of the log message, but also additional information received from the message source, such as the name of the eventlog container, or the file, as set in the eventlog-specific and file-specific templates.</para>
                <note>
                    <para>Templates are assigned to a single destination server, so it is possible to use different templates for different servers. However, a server and its failover servers always receive the same message.</para>
                </note>
                <warning>
                    <para>If you have more than one destination servers configured (separate servers, not in failover mode), and you want to use the same template for every server, you must manually copy the template into the configuration of each server. Template modifications are not applied automatically to every server.</para>
                    <para>To use a Snare-compatible message format, select <guimenu>Message Type > Snare Compatible Message Type</guimenu> and click <guimenu>Reset Message Template</guimenu>.</para>
                    <indexterm>
                        <primary>snare</primary>
                    </indexterm>
                </warning>
            </step>
            <step>
                <para>Click <guimenu>OK</guimenu>.</para>
            </step>
            <step>
                <para>To activate the changes, restart the &agentabbrev; service.</para>
            </step>
        </procedure>

        <section xml:id="windows-timestamp">
            <title>Customizing the timestamp used by the &agentabbrev;</title>
            <indexterm>
                <primary>timestamp</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>timestamp</secondary>
            </indexterm>
            <para>The &agentabbrev; can send the syslog messages using either the ISO or the BSD timestamp format. It is recommended to use the ISO format, because it contains much more information than the BSD format.</para>
            <para>Note that in the &agentabbrev;, the macros without prefix (for example <parameter>DATE</parameter>) always refer to the receiving date of the message (for example <parameter>R_DATE</parameter>) when it arrived into the event log container, and are included only for compatibility reasons.</para>
            <warning>
                <indexterm>
                    <primary>timezone</primary>
                    <secondary>Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>eventlog</primary>
                    <secondary>remote logging</secondary>
                </indexterm>
                <para>If a remote host is logging into the event log of the local host that is running &agent;, both hosts should be in the same timezone, because the event log message does not include the timezone information of the sender host. Otherwise, the date of the messages received from the remote host will be incorrect.</para>
            </warning>
        </section>
        <section xml:id="windows-macros">
            <title>Macros available in the &agentabbrev;</title>
            <para>The following sections list the available macros:</para>
            <warning>
                <para>These macros are available only in the &agent;. To recognize Windows-specific elements of the log message (for example eventlog-related macros) on the syslog-ng server, you have to use parsers on the syslog-ng server. The parser must be configured to match the message format set in the syslog-ng Agent. For details on configuring parsers on your &abbrev; server, see <olink targetdoc="syslog-ng-pe-guide-admin-en" targetptr="chapter-parsers"/>.</para>
            </warning>
            <itemizedlist>
                <listitem>
                    <para>
                        <link linkend="macro-protocol-agent">Macros related to protocol headers</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="macro-time-agent">Macros related to the date and time of the message</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="macro-event-agent">Macros related to eventlog sources</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="macro-file-agent">Macros related to file sources</link>
                    </para>
                </listitem>
            </itemizedlist>
            <note>
                <para>Note that if you use the Syslog protocol template (meaning that messages are sent using the IETF-syslog protocol), only the message part of the log message can be customized, the structure of the headers and other information is fixed by the protocol.</para>
            </note>
            <!-- FIXME ezt updatelni, mi van file sourcenal -->
            <para>By default, &agentabbrev; uses the following format: <parameter>&lt;${PRI}&gt;${BSDDATE} ${HOST} ${APP_NAME}[${PROCESS_ID}]: ${MESSAGE}</parameter>, where <parameter>$MESSAGE</parameter> is <parameter>${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}] ${EVENT_MSG} (EventID ${EVENT_ID})</parameter> for eventlog messages, and <parameter>$FILE_NAME: $FILE_CURRENT_POSITION/$FILE_SIZE: $FILE_MESSAGE</parameter> for file messages.</para>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>default message format</secondary>
            </indexterm>
            <section xml:id="macro-protocol-agent">
                <title>Protocol-related macros of the &agentabbrev;</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>protocol</secondary>
                </indexterm>
                <simplesect xml:id="APP-NAME">
                    <title>APP_NAME</title>
                    <para><guimenu>Description:</guimenu> An alias for the <link linkend="APPLICATION-NAME"><parameter>APPLICATION_NAME</parameter></link> macro.</para>
                </simplesect>
                <simplesect xml:id="APPLICATION-NAME">
                    <title>APPLICATION_NAME</title>
                    <para><guimenu>Description:</guimenu>
                        <itemizedlist>
                            <listitem>
                                <para>At event container: Name of the application the message came from</para>
                            </listitem>
                            <listitem>
                                <para>At file as the name of creator (default value): syslog-ng-agent </para>
                            </listitem>
                        </itemizedlist>
                    </para>
                </simplesect>
                <simplesect xml:id="HOST">
                    <title>HOST</title>
                    <para><guimenu>Description:</guimenu> Name of the host sending the message. Hostnames are automatically converted to lowercase.</para>
                </simplesect>
                <simplesect xml:id="MESSAGE">
                    <title>MESSAGE</title>
                    <para><guimenu>Description:</guimenu> The content of the message, including the text of the message and any file- or event-specific macros that are set for the source.</para>
                </simplesect>
                <simplesect xml:id="MSG">
                    <title>MSG</title>
                    <para><guimenu>Description:</guimenu> An alias for the <link linkend="MESSAGE"><parameter>MESSAGE</parameter></link> macro.</para>
                </simplesect>
                <simplesect xml:id="PRI">
                    <title>PRI</title>
                    <para><guimenu>Description:</guimenu> Priority header of the message, storing the facility and the level of the message.</para>
                </simplesect>
                <simplesect xml:id="PROCESS-ID">
                    <title>PROCESS_ID</title>
                    <para><guimenu>Description:</guimenu> PID of the application the message came from.</para>
                </simplesect>
            </section>
            <section xml:id="macro-time-agent">
                <title>Time-related macros of the &agentabbrev;</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>date and time</secondary>
                </indexterm>
                <simplesect xml:id="macro-bsddate">
                    <title>BSDDATE, R_BSDDATE, S_BSDDATE</title>
                    <indexterm type="parameter">
                        <primary>BSDDATE, R_BSDDATE, S_BSDDATE</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> Date of the message in BSD timestamp format (month/day/hour/minute/second, each expressed in two digits). This is the original syslog time stamp without year information, for example <parameter>Jun 13 15:58:00</parameter>. If possible, it is recommended to use <parameter>ISODATE</parameter> for timestamping.</para>
                </simplesect>
                <simplesect xml:id="macro-date">
                    <title>DATE</title>
                    <indexterm type="parameter">
                        <primary>DATE</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> An alias of the ISODATE macro.</para>
                </simplesect>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-day)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-fulldate)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-hour)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <simplesect xml:id="macro-isodate">
                    <title>ISODATE, R_ISODATE, S_ISODATE</title>
                    <indexterm type="parameter">
                        <primary>ISODATE, R_ISODATE, S_ISODATE</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> Date of the message in the ISO 8601 compatible standard timestamp format (yyyy-mm-ddThh:mm:ss+-ZONE), for example: <parameter>2006-06-13T15:58:00.123+01:00</parameter>. If possible, it is recommended to use <parameter>ISODATE</parameter> for timestamping. Note that the &agentabbrev; cannot produce fractions of a second (for example milliseconds) in the timestamp.</para>
                </simplesect>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-min)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-month)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <simplesect xml:id="macro-monthname">
                    <title>MONTHNAME, R_MONTHNAME, S_MONTHNAME</title>
                    <indexterm type="parameter">
                        <primary>MONTHNAME, R_MONTHNAME, S_MONTHNAME</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> The English name of the month the message was sent, abbreviated to three characters (for example Jan, Feb, and so on).</para>
                </simplesect>
                <simplesect xml:id="macro-r-date">
                    <title>R_DATE</title>
                    <indexterm type="parameter">
                        <primary>R_DATE</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> Date when the message was recorded into the eventlog container.</para>
                </simplesect>
                <simplesect xml:id="macro-s-date">
                    <title>S_DATE</title>
                    <indexterm type="parameter">
                        <primary>S_DATE</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> Date when the message was created.</para>
                </simplesect>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-sec)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <simplesect xml:id="macro-tz">
                    <title>TZ, R_TZ, S_TZ</title>
                    <indexterm type="parameter">
                        <primary>TZ, R_TZ, S_TZ</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> The name of the time zone of the host.</para>
                </simplesect>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-tzoffset)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-unixtime)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-year)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <xi:include href="../../syslog-ng-guide-admin/chapters/reference-macros.xml" xpointer="element(macro-week)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                <simplesect xml:id="macro-weekday">
                    <title>WEEKDAY, R_WEEKDAY, S_WEEKDAY</title>
                    <indexterm type="parameter">
                        <primary>WEEKDAY, R_WEEKDAY, S_WEEKDAY</primary>
                    </indexterm>
                    <indexterm type="parameter">
                        <primary>$WEEKDAY, $R_WEEKDAY, $S_WEEKDAY</primary>
                    </indexterm>
                    <para><guimenu>Description:</guimenu> The 3-letter name of the day of week the message was sent, for example <parameter>Thu</parameter>.</para>
                </simplesect>
            </section>
            <section xml:id="macro-event-agent">
                <title>Eventlog-related macros of the &agentabbrev;</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>eventlog sources</secondary>
                </indexterm>
                <simplesect xml:id="EVENT-CATEGORY">
                    <title>EVENT_CATEGORY</title>
                    <para><guimenu>Description:</guimenu> The category of the event.</para>
                </simplesect>
                <simplesect xml:id="EVENT-FACILITY">
                    <title>EVENT_FACILITY</title>
                    <para><guimenu>Description:</guimenu> The facility that sent the message.</para>
                </simplesect>
                <simplesect xml:id="EVENT-ID">
                    <title>EVENT_ID</title>
                    <para><guimenu>Description:</guimenu> The identification number of the event.</para>
                </simplesect>
                <simplesect xml:id="EVENT-LEVEL">
                    <title>EVENT_LEVEL</title>
                    <para><guimenu>Description:</guimenu> Importance level of the message represented as a number: 6 - Success, 5 - Informational, 4- Warning, or 3 - Error).</para>
                </simplesect>
                <simplesect xml:id="EVENT-MESSAGE">
                    <title>EVENT_MESSAGE</title>
                    <para><guimenu>Description:</guimenu> The content of the message.</para>
                </simplesect>
                <simplesect xml:id="EVENT-MESSAGE-XML">
                    <title>EVENT_MESSAGE_XML</title>
                    <para><guimenu>Description:</guimenu> Contains the entire message in XML format. Available only on Windows Vista and Server 2008 platforms</para>
                </simplesect>
                <simplesect xml:id="EVENT-MSG">
                    <title>EVENT_MSG</title>
                    <para><guimenu>Description:</guimenu> The content of the message. This is an alias of the <link linkend="EVENT-MESSAGE"><parameter>EVENT_MESSAGE</parameter></link>.</para>
                </simplesect>
                <simplesect xml:id="EVENT-MSG-XML">
                    <title>EVENT_MSG_XML</title>
                    <para><guimenu>Description:</guimenu> Contains the entire message in XML format. This is an alias of the <link linkend="EVENT-MESSAGE-XML"><parameter>EVENT_MESSAGE_XML</parameter></link>. Available only on Windows Vista and Server 2008 platforms</para>
                </simplesect>
                <simplesect xml:id="EVENT-NAME">
                    <title>EVENT_NAME</title>
                    <para><guimenu>Description:</guimenu> Name of the Windows event log container (for example Application or Security).</para>
                </simplesect>
                <simplesect xml:id="EVENT-REC-NUM">
                    <title>EVENT_REC_NUM</title>
                    <para><guimenu>Description:</guimenu> The record number of the event in the event log.</para>
                </simplesect>
                <simplesect xml:id="EVENT-SID">
                    <title>EVENT_SID</title>
                    <para><guimenu>Description:</guimenu> The security identification number of the event.</para>
                </simplesect>
                <simplesect xml:id="EVENT-SID-TYPE">
                    <title>EVENT_SID_TYPE</title>
                    <para><guimenu>Description:</guimenu> The security identification number resolved into name. One of the following: <parameter>User</parameter>, <parameter>Group</parameter>, <parameter>Domain</parameter>, <parameter>Alias</parameter>
                        <parameter>WellKnownGroup</parameter>, <parameter>DeletedAccount</parameter>, <parameter>Invalid</parameter>, <parameter>Unknown</parameter>, <parameter>Computer</parameter>. </para>
                </simplesect>
                <simplesect xml:id="EVENT-SOURCE">
                    <title>EVENT_SOURCE</title>
                    <para><guimenu>Description:</guimenu> The application that created the message.</para>
                </simplesect>
                <simplesect xml:id="EVENT-TASK">
                    <title>EVENT_TASK</title>
                    <para><guimenu>Description:</guimenu> The task category of the event. Available only on Windows Vista and Server 2008 platforms</para>
                </simplesect>
                <simplesect xml:id="EVENT-TYPE">
                    <title>EVENT_TYPE</title>
                    <para><guimenu>Description:</guimenu> The importance level of the message in text format.</para>
                </simplesect>
                <simplesect xml:id="EVENT-USERNAME">
                    <title>EVENT_USERNAME</title>
                    <para><guimenu>Description:</guimenu> The user running the application that created the message.</para>
                </simplesect>
            </section>
            <section xml:id="macro-file-agent">
                <title>File-related macros of the &agentabbrev;</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>&agentabbrev;</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>file sources</secondary>
                </indexterm>
                <simplesect xml:id="FILE-CURRENT-POSITION">
                    <title>FILE_CURRENT_POSITION</title>
                    <para><guimenu>Description:</guimenu> The position of the message from the beginning of the file in bytes.</para>
                </simplesect>
                <simplesect xml:id="FILE-FACILITY">
                    <title>FILE_FACILITY</title>
                    <para><guimenu>Description:</guimenu> The facility that sent the message.</para>
                </simplesect>
                <simplesect xml:id="FILE-LEVEL">
                    <title>FILE_LEVEL</title>
                    <para><guimenu>Description:</guimenu> Importance level of the message represented as a number: 6 - Success, 5 - Informational, 4- Warning, or 3 - Error).</para>
                </simplesect>
                <simplesect xml:id="FILE-MESSAGE">
                    <title>FILE_MESSAGE</title>
                    <para><guimenu>Description:</guimenu> The content of the message.</para>
                </simplesect>
                <simplesect xml:id="FILE-MSG">
                    <title>FILE_MSG</title>
                    <para><guimenu>Description:</guimenu> The content of the message. This is an alias of the <link linkend="FILE-MESSAGE"><parameter>FILE_MESSAGE</parameter></link> macro.</para>
                </simplesect>
                <simplesect xml:id="FILE-NAME">
                    <title>FILE_NAME</title>
                    <para><guimenu>Description:</guimenu> Name of the log file (including its path) from where the &agentabbrev; received the message.</para>
                </simplesect>
                <simplesect xml:id="FILE-SIZE">
                    <title>FILE_SIZE</title>
                    <para><guimenu>Description:</guimenu> The current size of the file in bytes.</para>
                </simplesect>
            </section>
        </section>
    </section>
    <section xml:id="windows-service">
        <title>Controlling the &agentabbrev; services</title>
        <para>During installation, &agentabbrev; registers the <parameter>syslog-ng Agent</parameter> service that is started automatically when the host boots. To disable the automatic startup of the &agentabbrev;, or manually start or stop the service, use the <guimenu>Start Menu > Control Panel > Administrative Tools > Services</guimenu> interface. The service is running with the privileges of the <parameter>NT AUTHORITY\SYSTEM</parameter> user.</para>
        <para>When the &agentabbrev; service is started or stopped, it sends a syslog message to the central log server and an eventlog message to the Application eventlog container of the host.</para>
        <warning>
            <indexterm>
                <primary>timezone</primary>
                <secondary>Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>timezone</secondary>
            </indexterm>
            <para>If you change the timezone setting of the host while the &agentabbrev; is running, you have to restart the &agentabbrev;. Otherwise, it will not receive the updated timezone information and the date of the events will be incorrect.</para>
        </warning>
        <note>
            <para>It is possible to run the service with an administrator account that has "log on as service" rights (to set user rights, navigate to <guimenu>Local Security Policy > Local Policies > User rights Assignment</guimenu>). These settings are unsupported, use them only at your own risk. Also note that during the next upgrade procedure, these settings will be overwritten by factory default settings.</para>
        </note>
        <section xml:id="windows-command-line">
            <title>Command-line options</title>
            <para>The &agent; application has the following command-line options:</para>
            <note>
                <para>Command-line options are case-insensitive. The options consist of a single letter introduced by either "<parameter>-</parameter>" or "<parameter>/</parameter>".</para>
            </note>
            <note>
                <para>On Windows Vista or above, command line options will only work with administrator permission.</para>
            </note>
            <variablelist>
                <varlistentry>
                    <term>
                        <command>/c</command>
                    </term>
                    <listitem>
                        <para>Start the &agentabbrev; using the specified XML configuration file.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/d</command>
                    </term>
                    <listitem>
                        <para>Start the &agentabbrev; in debug mode. The debug messages can be displayed using the <command>dbgview</command> application (<link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx">available here</link>).</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/e</command>
                    </term>
                    <listitem>
                        <para>Start the &agentabbrev; in debug mode and send the messages to the Application eventlog container.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/h</command>
                    </term>
                    <listitem>
                        <para>Display a help message about the command-line options.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/i</command>
                    </term>
                    <listitem>
                        <para>Install the &agentabbrev; service into the services list.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/r</command>
                    </term>
                    <listitem>
                        <para>Remove the &agentabbrev; service from the services list.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/v</command>
                    </term>
                    <listitem>
                        <para>Display version information.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>
                        <command>/x</command>
                    </term>
                    <listitem>
                        <para>Validate XML configuration file without importing it.</para>
                    </listitem>
                </varlistentry>
            </variablelist>
            <para>To use these options, select <guimenu>Start > Run > cmd</guimenu>, navigate to the directory where the &agentabbrev; is installed (for example <command>cd C:\Windows\Program Files\BalaBit\syslog-ng Agent\</command>), and execute the <command>syslog-ng-agent.exe</command> file with the required option.</para>
            <example xml:id="example-using-commandline">
                <title>Using command line options</title>
                <para>To start &agentabbrev; in debug mode:</para>
                <synopsis>syslog-ng-agent.exe /d</synopsis>
                <para>To start &agentabbrev; with XML configuration file:</para>
                <synopsis>syslog-ng-agent.exe /c C:\ConfigFiles\syslog-ng-agent-conf.xml </synopsis>
                <para>To register &agentabbrev; as a service using XML configuration file: </para>
                <synopsis>syslog-ng-agent.exe /i C:\ConfigFiles\syslog-ng-agent-conf.xml
                </synopsis>
            </example>
        </section>
    </section>
</chapter>
