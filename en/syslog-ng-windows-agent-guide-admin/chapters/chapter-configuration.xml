<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../shared/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-configuration" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>How to configure the &agentabbrev;</title>
    <para>This section describes how to configure the &agentabbrev; application. The exact method depends on the installation scenario and also on the configuration method (regular or XML-based) you want to use. The &agent; application is configured usually using its MMC snap-in (when managed globally from the domain controller or when configuring it in standalone mode). However, it is also possible to use an XML-based configuration file.</para>
    <itemizedlist>
        <listitem>
            <para>For details on how to configure a &agentabbrev; that was installed in standalone mode, see <xref linkend="windows-configure-standalone"/>.</para>
        </listitem>
        <listitem>
            <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows-configure-domain-hosts"/>.</para>
        </listitem>
        <listitem>
            <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows-configure-domain-controllers"/>.</para>
        </listitem>
        <listitem>
            <para>For details on how to configure &agentabbrev; from file, see <xref linkend="windows-xml-config"/>.</para>
        </listitem>
    </itemizedlist>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-configure-standalone.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-configure-domain.xml"/>
    <section xml:id="windows-xml-config">
        <title>Using an XML-based configuration file</title>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>configuration file</secondary>
        </indexterm>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>XML</secondary>
        </indexterm>
        <para>Starting from &agent; version 3.2, it is possible to export the configuration of &agentabbrev; into an XML file. This configuration file can be used as the default configuration when installing the &agentabbrev; to another host, or can be imported to an existing installation using a command-line utility.</para>
        <warning>
            <para>Do not manually edit or modify the exported XML file.</para>
            <para>In case you want to validate the XML file, use the <filename>syslog-ng-agent-conf.xsd</filename> file located in the installation directory of &agent;.</para>
        </warning>
        <xi:include href="../../shared/wnt/warning-windows-mmc-xml.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-xml-config-create.xml"/>
        <section xml:id="windows-xml-config-import">
            <title>Configuring &agentabbrev; from an XML file</title>
            <!-- FIXME ezt meglinkelni az install reszekbol, vagy atrakni oket oda -->
            <para>How you configure the &agentabbrev; application to use an XML configuration file depends on your environment. The following list describes the available possibilities.</para>
            <warning>
                <itemizedlist>
                    <listitem>
                        <para>Do not manually edit or modify the exported XML file.</para>
                    </listitem>
                    <listitem>
                        <para>Do not delete the XML configuration file: &agent; will look for the file every time it is started or restarted. If you need to change the location of the file, edit the <parameter>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\syslog-ng Agent\ImagePath</parameter> registry key.</para>
                    </listitem>
                </itemizedlist>
            </warning>
            <itemizedlist>
                <listitem>
                    <para>To use the XML file during the installation of the &agentabbrev; application, navigate to <guimenu>Setup &agent; operating mode</guimenu> window and select <guimenu>XML mode</guimenu>. In the next window, browse your XML configuration. Note that the XML schema file will be installed in the &agentabbrev; directory.</para>
                </listitem>
                <listitem>
                    <para>If you want to use the .msi installer with an XML file, use the <command>syslog-ng-agent-setup-&lt;version&gt;-&lt;amd64/i386&gt;.msi SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</command> command, or edit the installer with the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.technipages.com/download-orca-msi-editor">Orca MSI editor</link>, and add the <parameter>SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</parameter> to the installation parameters on the <guimenu>Customization</guimenu> tab.</para>
                </listitem>
                <listitem>
                    <formalpara xml:id="windows-xml-config-from-file">
                        <title>Use an XML file as the configuration file of &agent;.</title>
                        <para>To start an already installed, standalone &agentabbrev; using an XML configuration file, execute the following steps in a command line. In this case, the configuration of &abbrev; is stored in the XML file, it is not imported into the registry (for details on importing a configuration from XML file into the registry, see <xref linkend="windows-xml-configimport-to-registry"/>).</para>
                    </formalpara>
                    <orderedlist>
                        <listitem>
                            <para><command>cd &lt;syslog-ng agent installation directory&gt;\bin</command></para>
                        </listitem>
                        <listitem>
                            <para><command>net stop "syslog-ng agent"</command></para>
                        </listitem>
                        <listitem>
                            <para><command>syslog-ng-agent.exe /r</command></para>
                        </listitem>
                        <listitem>
                            <para><command>syslog-ng-agent.exe /i &lt;PATH&gt;\configuration.xml</command></para>
                        </listitem>
                        <listitem>
                            <para><command>net start "syslog-ng agent"</command></para>
                        </listitem>
                    </orderedlist>
                </listitem>
                <listitem>
                    <formalpara xml:id="windows-xml-configimport-to-registry">
                        <title>Import the XML configuration into the registry</title>
                        <para>To import the XML configuration file into the registry of the host, use the following command: <command>configmanager.exe -import &lt;destination&gt; "source xml file"</command> command, then restart the &agentabbrev; service. The &lt;destination&gt; parameter determines which configuration the XML configuration will be converted to:</para>
                    </formalpara>
                    <itemizedlist>
                        <listitem>
                            <para><parameter>{GPO ID}</parameter>: Import the configuration to the specified Group Policy Object ID (for example, <parameter>{99AF1185-AB80-40B2-B4B8-41A1E907F329}</parameter>).</para>
                        </listitem>
                        <listitem>
                            <para><parameter>localsettings</parameter>: Import the configuration as the local settings of the host.</para>
                        </listitem>
                        <listitem>
                            <para><parameter>domainsettings</parameter>: Import the configuration as the domain settings of the host.</para>
                        </listitem>
                    </itemizedlist>
                    <warning>
                        <para>Importing the configuration file from an XML file into the registry of the host has no effect if &agentabbrev; is configured to use an XML configuration file.</para>
                    </warning>
                </listitem>
            </itemizedlist>
        </section>
    </section>
</chapter>
