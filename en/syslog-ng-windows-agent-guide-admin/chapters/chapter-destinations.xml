<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../shared/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-destinations" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Configuring destinations</title>
    <indexterm>
        <primary>&agentabbrev;</primary>
        <secondary>destinations</secondary>
    </indexterm>
    <indexterm>
        <primary>&agentabbrev;</primary>
        <secondary>configuring the log server</secondary>
    </indexterm>
    <indexterm>
        <primary>destinations</primary>
        <secondary>&agentabbrev;</secondary>
    </indexterm>
    <para>The &agent; application can send the log messages of the Windows host to a central log server or relay. It is possible to send the same messages to multiple servers, when each server receives the same messages; and also to configure failover servers, when the agent sends the messages to a primary server, or to a failover server if the primary becomes unavailable. If the agent loses the connection to a destination server and the reconnection fails, it will generate an eventlog message. The successful reconnection attempt is also logged. (If the server is unavailable for a long time, the agent generates a log message about the failed connection once in every ten seconds.)</para>
    <para>If the failover server also becomes unavailable, the application will switch to the next failover server, and so on. If the last failover server is unavailable, it switches back to the primary. The application does not switch back automatically to the primary server if it becomes available again, only if the syslog-ng Agent for Windows has been restarted.</para>
    <note>
        <para>The failover servers will use the same options that the primary server uses. Only the name and the address can be configured for the failover servers.</para>
    </note>
    <para>Similarly to the Linux version, the agent now sends MARK messages to the server to indicate that the client host is alive but there are no log messages to send. A MARK message is sent every ten minutes.</para>
    <warning>
        <para>The &agent; application does not support the unreliable UDP protocol. Configure your central log server to accept logs using TCP or TLS connections. If needed, adjust your firewall configuration to permit such traffic to the log server.</para>
    </warning>
    <figure>
        <title>Adding new destinations</title>
        <mediaobject>
            <imageobject role="html">
                <imagedata format="PNG" fileref="win-destinations.png"/>
            </imageobject>
            <imageobject role="fo">
                <imagedata format="PNG" fileref="&imgroot;/win-destinations.png" contentwidth="&screenshotsize;"/>
            </imageobject>
        </mediaobject>
    </figure>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-configure-destination.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-rate-limit.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-agent-mark-messages.xml"/>
    <section xml:id="windows-agent-flow-control">
        <title>Flow-control in &agent;</title>
        <indexterm>
            <primary>flow-control</primary>
        </indexterm>
        <para>Starting with version 5 LTS, the flow-control feature of &product; is automatically enabled for the destinations. Using flow-control means that the &agentabbrev; will stop reading messages from the sources if the destination cannot accept them (for example, because of a network error). For details on the concepts of flow-control, see <olink targetdoc="syslog-ng-pe-guide-admin" targetptr="concepts-flow-control"/>.</para>
        <para>To enable or disable flow-control for a destination, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, double-click on the destination, then select <guimenu>Server > Enable flow-control</guimenu>.</para>
        <xi:include href="../../shared/wnt/note-windows-agent-rltp-flowcontrol.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <note>
            <para>The flow-control of &agentabbrev; 5 LTS replaces the <guimenu>Primary Server</guimenu> option of earlier versions.</para>
        </note>
        <xi:include href="../../shared/chunk/flow-control-multiple-destinations.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    </section>
</chapter>
