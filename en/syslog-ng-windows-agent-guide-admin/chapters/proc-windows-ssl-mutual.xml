<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../shared/syslog-ng-entities.ent">
  %entities;]>
<procedure xml:id="proc-windows-ssl-mutual" xmlns="http://docbook.org/ns/docbook">
    <title>Configuring mutual authentication with the &agentabbrev; for Windows</title>
    <formalpara>
        <title>Purpose:</title>
        <para/>
    </formalpara>
    <para>If the syslog-ng server requests authentication from the &agentabbrev;, complete the following steps.</para>
    <formalpara>
        <title>Steps:</title>
        <para/>
    </formalpara>
    <step>
        <para>Create certificates for the clients. By default, the &agentabbrev; will look for a certificate that contains the hostname or IP address of the central syslog-ng server in its Common Name. If you use a different Common Name, do not forget to complete Step 3 to set the Common Name of the certificate.</para>
        <para>The certificate must contain the private key and must be in PKCS12 format.</para>
        <tip>
            <para>To convert a certificate and a key from PEM format to PKCS12 you can use the following command:</para>
            <synopsis>openssl pkcs12 -export -in agentcertificate.pem -inkey agentprivatekey.pem -out agentcertificatewithkey.pfx </synopsis>
        </tip>
    </step>
    <step>
        <para>Import this certificate into the <guimenu>Personal Certificate</guimenu> store of the Local Computer using the Certificate Import Wizard. For details, see <xref linkend="windows-importcert"/>.</para>
    </step>
    <step>
        <para>By default, the &agentabbrev; will look for a certificate that contains the hostname or IP address of the central syslog-ng server in its Common Name. (The agent will look for the server name or address set in the <guimenu>Server Name</guimenu> field of the destination.) If the certificate of the client has a different Common Name, complete the following steps:</para>
        <substeps>
            <step>
                <para>Start the configuration interface of the &agentabbrev; for Windows application.</para>
            </step>
            <step>
                <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
            </step>
            <step>
                <para>Right-click on the server that requires mutual authentication and select <guimenu>Properties</guimenu>.</para>
            </step>
            <step>
                <para>Select the <guimenu>Use SSL</guimenu> option, click <guimenu>Select</guimenu>, then select the certificate to use. You can also type the Common Name of the certificate into the <guimenu>Client Certificate Subject</guimenu> field.</para>
                <para>If you have more than one certificates with the same Common Name, alternatively, you can type the Distinguished Name (DN) of the certificate into the <guimenu>Client Certificate Subject</guimenu> field. When using the Distinguished Name, type only the elements of the name, separated with comma, starting with the country. For example <parameter>US, Maryland, Pasadena, Example Inc, Sample Department, mycommonname</parameter></para>
                <note>
                    <para>A common way is to use the hostname or the IP address of the host running the &agentabbrev; as the Common Name of the certificate (for example <parameter>syslog-ng-agent1.example.com</parameter>).</para>
                </note>
            </step>
        </substeps>
    </step>
    <step>
        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To activate the changes, restart the &agentabbrev; service.</para>
    </step>
</procedure>
