<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-install" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Installing the &agentabbrev;</title>
    <indexterm>
        <primary>&agentabbrev;</primary>
        <secondary>installing</secondary>
    </indexterm>
    <indexterm>
        <primary>installing syslog-ng</primary>
        <secondary>on Windows</secondary>
    </indexterm>
    <indexterm>
        <primary>installing syslog-ng</primary>
        <secondary>&agentabbrev; on domain controllers</secondary>
    </indexterm>
    <para>The &agent; application can be installed in standalone mode on independent hosts. If your hosts are members of a domain, you can install the syslog-ng agent on the domain controller and configure them globally.</para>
    <itemizedlist>
        <listitem>
            <para>For details on how to install the &agent; application in standalone mode, see <xref linkend="windows-install-standalone"/>.</para>
        </listitem>
        <listitem>
            <para>For details on how to install the &agent; application on the members of a domain, see <xref linkend="windows-install-domain-controller"/>.</para>
        </listitem>
    </itemizedlist>
    <note>
        <para>The &agent; application is configured usually using its MMC snap-in (when managed globally from the domain controller or when configuring it in standalone mode). However, it is also possible to use an XML-based configuration file. For details, see <xref linkend="windows-xml-config"/>.</para>
    </note>
    <formalpara>
        <title>Installer types:</title>
        <para/>
    </formalpara>
    <itemizedlist>
        <listitem>
            <para><filename>syslog-ng-agent-&lt;version&gt;-setup.exe</filename> is the general installer. This installs an agent that can be configured with a local configuration, XML configuration file and can receive configuration from domain group policy. The installer contains both the 32bit and 64bit versions of &agentabbrev;.</para>
        </listitem>
        <listitem>
            <para><filename>syslog-ng-agent-nosnapin-&lt;version&gt;-setup.exe</filename> is a special installer. .NET environment is not required for it. This installs an agent that can only be configured with an XML configuration file, and can receive configuration from domain group policy. The installer contains both the 32bit and 64bit versions of &agentabbrev;.</para>
        </listitem>
        <listitem>
            <para><filename>syslog-ng-agent-setup-&lt;version&gt;-&lt;amd64/i386&gt;.msi</filename> is an MSI installer for domain clients, installing by group policy.</para>
        </listitem>
    </itemizedlist>

    <procedure xml:id="windows-install-standalone">
        <title>Installing the &agentabbrev; in standalone mode</title>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>installing the agent in standalone mode</secondary>
        </indexterm>
        <formalpara>
            <title>Purpose:</title>
            <para/>
        </formalpara>
        <para>The &agent; application can be installed in standalone mode on independent hosts. If your hosts are members of a domain, install the &agentabbrev; on the domain controller, as described in <xref linkend="windows-install-domain-controller"/>. The &agentabbrev; requires about 10 MB hard disk space.</para>
        <para>To install the &agentabbrev; in standalone mode, complete the following steps:</para>

        <xi:include href="../../common/wnt/note-windows-agent-dotnet.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>

        <formalpara>
            <title>Steps:</title>
            <para/>
        </formalpara>
        <step>
            <para>Start the installer. Run the <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> file.</para>
            <note>
                <para>Installing the &agentabbrev; requires administrator privileges.</para>
            </note>
        </step>
        <step>
            <para>Read the End User License Agreement and select <guimenu>I Agree</guimenu>.</para>
        </step>
        <step>
            <para>Select the destination folder where you want to install the syslog-ng Agent for Windows application, then select <guimenu>Next</guimenu>.</para>
        </step>
        <step>
            <para>Select <guimenu>Standalone mode</guimenu>, then click <guimenu>Next</guimenu>.</para>
            <figure>
                <title>Installing in Standalone mode</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" align="center" fileref="win-install-standalone.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/win-install-standalone.png" contentwidth="11cm"/>
                    </imageobject>
                </mediaobject>
            </figure>
        </step>
        <step>
            <para>The installer automatically opens the configuration interface of the &agentabbrev;. As a minimum, you must set the IP address of the destination server, and the agent will automatically start sending eventlog messages to your central log server from the Application, Security, and System eventlog containers.</para>
            <note>
                <para>The installation is completed only after you close the configuration interface. For details on how to modify the configuration later, see <xref linkend="windows-configure-standalone"/>.</para>
            </note>
        </step>
    </procedure>
    <section xml:id="windows-install-domain-controller">
        <title>Installing the &agentabbrev; on the domain controller and the hosts of a domain</title>
        <indexterm>
            <primary>installing the agent</primary>
            <secondary>from the domain controller</secondary>
        </indexterm>
        <indexterm>
            <primary>domain installation</primary>
        </indexterm>
        <para>The &agent; application can be installed on the domain controller and the members of a domain from the domain controller, and configured globally using group policies. The &agentabbrev; requires about 10 MB hard disk space.</para>
        <itemizedlist>
            <listitem>
                <para>For details on how to install the &agentabbrev; application in a domain, see <xref linkend="windows-install-domain"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows-configure-domain-hosts"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows-configure-domain-controllers"/>.</para>
            </listitem>
        </itemizedlist>
        <note>
            <para>Starting from version <parameter>3.0.4</parameter>, the <parameter>.msi</parameter> version of the installer does not install the MMC configuration snap-in of the agent, therefore the <parameter>.msi</parameter> installer does not require the .NET framework.</para>
        </note>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>installing the agent from the domain controller</secondary>
        </indexterm>
        <procedure xml:id="windows-install-domain">
            <title>Installing the &agentabbrev; on the domain controller and the hosts of a domain</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>To install the &agentabbrev; application on the domain controller and the hosts of a domain, complete the following steps.</para>
            <para>This procedure assumes that you install the &agentabbrev; on the domain controllers in standalone mode, and configure the domain hosts from each domain controller.</para>
            <note>
                <para>To configure the &agentabbrev; from domain controllers, you need to install the &agentabbrev; in standalone mode on at least one domain controller. You can then export the configuration of &agentabbrev; from the first domain controller and import it to other domain controllers, or you can configure an agent group policy on the other domain controllers, and install &agentabbrev; in domain mode. </para>
            </note>
            <note>
                <para>By default, the &agent; application sends messages as follows:</para>
                <itemizedlist>
                    <listitem>
                        <para>From eventlog sources, the &agentabbrev; application sends only messages that are created after the agent has been installed.</para>
                    </listitem>
                    <listitem>
                        <para>From file sources, it sends the entire content of the file.</para>
                    </listitem>
                </itemizedlist>
            </note>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Download both the Microsoft Installer (<parameter>.msi</parameter>) version and the executable (<parameter>.exe</parameter>) version of the &agentabbrev; installer to the domain controller host. Make sure to download the executable that includes the MMC snap-in module. Note that separate .msi installers are available for 32-bit and 64-bit operating systems.</para>
                <note>
                    <para>Installing the &agentabbrev; requires administrator privileges, but configuring the related group policies on the domain controller requires domain administrator or higher (for example enterprise administrator) privileges.</para>
                </note>
            </step>
            <step>
                <para>Install the &agentabbrev; application to your domain controllers using the <parameter>.exe</parameter> installer.</para>

                <xi:include href="../../common/wnt/note-windows-agent-dotnet.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>

            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para><emphasis>On Windows 2008</emphasis>: Select <guimenu>Start > Control Panel > Administrative Tools > Group Policy Management</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>On other Windows platforms</emphasis>: Select <guimenu>Start > Control Panel > Administrative Tools > Active Directory Users and Computers</guimenu>, right-click on the Organizational Unit of the domain whose hosts you want to install the &agentabbrev; on, and select <guimenu>Properties</guimenu>.</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para><emphasis>On Windows 2008</emphasis>: Select and edit the Group Policy object you want to add the &agentabbrev; configuration to. Alternatively, you can create a new group policy object as well.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>On other Windows platforms</emphasis>: Select <guimenu>Group Policy</guimenu>, and edit the Group Policy object you want to add the &agentabbrev; configuration to. Alternatively, you can create a new group policy object as well.</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>Select <guimenu>Computer Configuration</guimenu>, right-click on <guimenu>Software Settings</guimenu>, and select <guimenu>New > Package</guimenu>.</para>
            </step>
            <step>
                <para>Navigate to the &agent; <parameter>.msi</parameter> installer and select <guimenu>Open</guimenu>. </para>
            </step>
            <step>
                <para>Select <guimenu>Assigned</guimenu>, then <guimenu>OK</guimenu>.</para>
            </step>
            <step>
                <para>Select <guimenu>Computer Configuration > syslog-ng Agent Settings</guimenu> and configure the &agentabbrev;. The members of the domain will use this configuration.</para>
                <figure>
                    <title>syslog-ng Agent Settings</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-group-policy-mngmt-editor.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&imgroot;/win-group-policy-mngmt-editor.png" contentwidth="&screenshotsize;"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>The &agent; application will be automatically installed on the members of the domain when they are next rebooted.</para>
                <note>
                    <para>If you do not want to install the &agentabbrev; automatically from the domain controller, skip Steps 5-7, complete Step 8, then install the <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file manually on the members of the domain. This method is useful if you do not want to install the &agentabbrev; on every host of the domain.</para>
                </note>
            </step>
            <step>
                <para>After the members of the domain have been rebooted, execute the <command>gpupdate</command> command on the members of the domain. The &agent; application will receive its configuration during the group policy update, and start processing log messages accordingly.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="windows-install-silent">
        <title>Silent installation</title>
        <indexterm>
            <primary>installing the agent</primary>
            <secondary>without user interaction</secondary>
        </indexterm>
        <indexterm>
            <primary>silent installation</primary>
        </indexterm>
        <para>The &agent; application can be installed in silent mode as well, without requiring any user interaction. The various installer options can be specified as command-line options. Using the <parameter>/S</parameter> option is required. The following options are available:</para>
        <variablelist>
            <varlistentry>
                <term><command>/D=&lt;path&gt;</command></term>
                <listitem>
                    <para>Install the &agentabbrev; into the specified folder.</para>
                    <warning>
                        <para>If you use the <parameter>/D</parameter> option, make sure that this is the last option in the command-line. For example: <command>syslog-ng-agent-nosnapin-&lt;version&gt;-setup.exe /S /XMLCONFIG=c:\test.xml /LOCALUPGRADE /D=c:\agent\</command></para>
                    </warning>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/LOCAL</command></term>
                <listitem>
                    <para>Install &agentabbrev; in standalone mode. This is the default installation mode of the &agentabbrev;. When using this option, you can also set the following two options:</para>
                    <itemizedlist>
                        <listitem>
                            <para><parameter>/GPOUPGRADE</parameter>: Upgrade all GPO configuration having &agentabbrev; settings during the installation.</para>
                            <warning>
                                <para>Use it only on a domain controller.</para>
                            </warning>
                        </listitem>
                        <listitem>
                            <para><parameter>/LOCALUPGRADE</parameter>: Upgrade local settings.</para>
                            <note>
                                <para>If &agentabbrev; uses only local configuration and you do not specify this option, it is possible that &agentabbrev; will not start while you are upgrading its local configuration by opening local configuration with syslog-ng agent MMC snap-in.</para>
                            </note>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/NOMENU</command></term>
                <listitem>
                    <para>Do not add entries about &agentabbrev; to the Start menu.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/NOUPGRADE</command></term>
                <listitem>
                    <para>The installer does not perform upgrade during the installation (default). Use it if the configuration comes from GPO or you are using XML configuration and you do not want to upgrade it (in this case, agent will upgrade it temporarily after starting).</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/REMOTE</command></term>
                <listitem>
                    <para>Install &agentabbrev; in domain mode.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/S</command></term>
                <listitem>
                    <para>Start the installer in silent mode. This option is required for the silent installation.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/XMLCONFIG=</command></term>
                <listitem>
                    <para>Use the specified XML configuration file for the configuration of &agentabbrev;. When using this option, you can also set the following option:</para>
                    <itemizedlist>
                        <listitem>
                            <para><parameter>/XMLUPGRADE</parameter>: Upgrade xml configuration during the installation if xml configuration file is used.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </varlistentry>
        </variablelist>
        <para>The upgrade operation will be only performed if upgrading is really needed for the specified configuration. For example: If there is no configuration version switching between the current and the previous version of the &agentabbrev; (for example when upgrading from version 3.0.7 to version 3.0.8) the local settings will not be upgraded even you specify the <command>/LOCALUPGRADE</command> option.</para>
        <para>The <parameter>/LOCAL</parameter>, <parameter>/XMLCONFIG</parameter>, and <parameter>/REMOTE</parameter> options conflict with each other. If you specify more than one of them, then <parameter>/REMOTE</parameter> takes precedence over the other two options, and <parameter>/XMLCONFIG</parameter> takes precedence over the <parameter>/LOCAL</parameter> option.</para>
    </section>
    <procedure xml:id="windows-msi-install-custom-directory">
        <title>Installing the MSI package of &agentabbrev; into a custom folder</title>
        <indexterm>
            <primary>installing the agent</primary>
            <secondary>into a custom directory</secondary>
        </indexterm>
        <indexterm>
            <primary>custom installation folder</primary>
        </indexterm>
        <formalpara>
            <title>Purpose:</title>
            <para/>
        </formalpara>
        <para>The <filename>.msi</filename> installer package of &agentabbrev; can be modified to install the &agentabbrev; application into a custom folder.</para>
        <formalpara>
            <title>Steps:</title>
            <para/>
        </formalpara>
        <para>When installing the &agentabbrev; application from the command line, execute the following command to specify a custom installation folder: <command>msiexec /i syslog-ng-agent-setup-&lt;version&gt;-&lt;amd64/i386&gt;.msi INSTDIR=C:\&lt;path-to-custom-folder&gt;\</command></para>
        <para>Otherwise, complete the following steps to modify the <filename>.msi</filename> package.</para>
        <step>
            <para>Download the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.technipages.com/download-orca-msi-editor.html">Orca MSI editor</link>.</para>
        </step>
        <step>
            <para>Start Orca and load the <filename>syslog-ng-agent-setup-&lt;version&gt;-&lt;amd64/i386&gt;.msi</filename> file to modify.</para>
        </step>
        <step>
            <para>Select <guimenu>Transform > New Transform</guimenu>.</para>
        </step>
        <step>
            <para>Add the <parameter>INSTDIR</parameter> property to the Property Table, and set its value to the full path of the folder where you want to install the &agentabbrev; application.</para>
        </step>
        <step>
            <para>Select <guimenu>Transform > Generate Transform</guimenu> and save the modifications into a <filename>.mst</filename> file.</para>
        </step>
        <step>
            <para>Close the Orca MSI Editor.</para>
        </step>
        <step>
            <para>Select <guimenu>Start > Control Panel > Administrative Tools > Active Directory Users and Computers</guimenu> and edit the Group Policy object that contains the &agentabbrev; configuration.</para>
        </step>
        <step>
            <para>Add the saved <filename>.mst</filename> package as a modification to the &agentabbrev; <filename>.msi</filename> package.</para>
        </step>
    </procedure>
    <section xml:id="windows-upgrade">
        <title>Upgrading &agent; to the latest version</title>
        <indexterm significance="preferred">
            <primary>&agentabbrev;</primary>
            <secondary>upgrading</secondary>
        </indexterm>
        <para>The exact upgrading procedure of the &agent; application depends on how you have installed and how you manage the agent.</para>
        <warning>
            <para>When upgrading agents running in domain mode, always upgrade the agents running on the domain hosts before upgrading the agent running on the domain controllers.</para>
            <para>The hosts of a domain (including the domain controllers) should run the same version of the &agentabbrev;, running different versions on the hosts in neither supported nor recommended.</para>
        </warning>
        <note>
            <indexterm significance="preferred">
                <primary>&agentabbrev;</primary>
                <secondary>upgrading to 5 LTS</secondary>
            </indexterm>
            <para>Upgrading to &agent; version 5 LTS is supported only from &agentabbrev; version 4.0.3 (the latest stable release).</para>
        </note>
        <note>
            <para>If the option <guimenu>Force DNS hostname</guimenu> was enabled in version 4.0.3, then in version 5.0.1, option <guimenu>Use FQDN</guimenu> will be enabled after the upgrade. For details, see <xref linkend="windows-global-hostname"/>.</para>
        </note>
        <itemizedlist>
            <listitem>
                <para>If a host is running &agentabbrev; in standalone mode, download and execute the <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> installer on the host and verify that the displayed information is correct. The agent will be automatically restarted when you close the configuration window.</para>
            </listitem>
            <listitem>
                <para>If a domain host is running the &agentabbrev; that was installed by the domain controller from the <parameter>.msi</parameter> installer package, complete the steps described in <xref linkend="windows-install-domain-controller"/>. The system will automatically recognize that the new package will update the &agent; application.</para>
            </listitem>
            <listitem>
                <para>If a domain host is running the &agentabbrev; that was installed manually from the <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file, run the new <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file on the host. After the installation is complete, select <guimenu>Start > Run</guimenu> and execute the <command>gpupdate</command> command to refresh the domain settings of the agent.</para>
            </listitem>
            <listitem>
                <para>If &agentabbrev; has been installed with an XML configuration file with <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> or <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename>, download and execute the same installer. It will display the previous XML configuration file, and upgrades it if desired.</para>
            </listitem>
        </itemizedlist>
    </section>
    <procedure xml:id="windows-uninstall-gui">
        <title>Uninstalling &agentabbrev;</title>
        <indexterm>
            <primary>uninstalling the agent</primary>
            <secondary>using the GUI</secondary>
        </indexterm>
        <para>To uninstall the &agentabbrev; application, complete the following steps. To uninstall &agentabbrev; from the command-line, see <xref linkend="windows-uninstall-silent"/>.</para>
        <step>
            <para>Navigate to the installation directory of &agentabbrev;.</para>
        </step>
        <step>
            <para>Start the <filename>uninstall.exe</filename> file.</para>
        </step>
        <step>
            <para>Follow the on-screen instructions.</para>
        </step>
    </procedure>
    <procedure xml:id="windows-uninstall-silent">
        <title>Uninstalling &agentabbrev; in silent mode</title>
        <indexterm>
            <primary>uninstalling the agent</primary>
            <secondary>in silent mode</secondary>
        </indexterm>
        <para>To uninstall the &agentabbrev; application from the command-line, complete the following steps. To uninstall &agentabbrev; using the graphical interface, see <xref linkend="windows-uninstall-gui"/>.</para>
        <step>
            <para>Start a command prompt and navigate to the installation directory of &agentabbrev;.</para>
        </step>
        <step>
            <itemizedlist>
                <listitem>
                    <para>To uninstall &agentabbrev; and delete its configuration from the registry, execute the <filename>uninstall.exe /S /DELCONF</filename> command.</para>
                </listitem>
                <listitem>
                    <para>To uninstall &agentabbrev;, without deleting its configuration, execute the <filename>uninstall.exe /S</filename> command.</para>
                </listitem>
            </itemizedlist>
        </step>
    </procedure>
</chapter>
