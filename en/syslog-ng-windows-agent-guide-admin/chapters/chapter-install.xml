<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../shared/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-install" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Installing the &agentabbrev;</title>
    <indexterm>
        <primary>&agentabbrev;</primary>
        <secondary>installing</secondary>
    </indexterm>
    <indexterm>
        <primary>installing syslog-ng</primary>
        <secondary>on Windows</secondary>
    </indexterm>
    <indexterm>
        <primary>installing syslog-ng</primary>
        <secondary>&agentabbrev; on domain controllers</secondary>
    </indexterm>
    <para>The &agent; application can be installed in standalone mode on independent hosts. If your hosts are members of a domain, you can install the syslog-ng agent on the domain controller and configure them globally.</para>
    <itemizedlist>
        <listitem>
            <para>For details on how to install the &agent; application in standalone mode, see <xref linkend="windows-install-standalone"/>.</para>
        </listitem>
        <listitem>
            <para>For details on how to install the &agent; application on the members of a domain, see <xref linkend="windows-install-domain-controller"/>.</para>
        </listitem>
    </itemizedlist>
    <note>
        <para>The &agent; application is configured usually using its MMC snap-in (when managed globally from the domain controller or when configuring it in standalone mode). However, it is also possible to use an XML-based configuration file. For details, see <xref linkend="windows-xml-config"/>.</para>
    </note>
    <xi:include href="../../shared/wnt/warning-windows-mmc-xml.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    <formalpara>
        <title>Installer types:</title>
        <para/>
    </formalpara>
    <itemizedlist>
        <listitem>
            <para><filename>syslog-ng-agent-&lt;version&gt;-setup.exe</filename> is the general installer. This installs an agent that can be configured with a local configuration, XML configuration file and can receive configuration from domain group policy. The installer contains both the 32bit and 64bit versions of &agentabbrev;.</para>
        </listitem>
        <listitem>
            <para><filename>syslog-ng-agent-nosnapin-&lt;version&gt;-setup.exe</filename> is a special installer. .NET environment is not required for it. This installs an agent that can only be configured with an XML configuration file, and can receive configuration from domain group policy. The installer contains both the 32bit and 64bit versions of &agentabbrev;.</para>
        </listitem>
        <listitem>
            <para><filename>syslog-ng-agent-setup-&lt;version&gt;-&lt;amd64/i386&gt;.msi</filename> is an MSI installer for domain clients, installing by group policy.</para>
        </listitem>
    </itemizedlist>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-install-standalone.xml"/>
    <section xml:id="windows-install-domain-controller">
        <title>Installing the &agentabbrev; on the domain controller and the hosts of a domain</title>
        <indexterm>
            <primary>installing the agent</primary>
            <secondary>from the domain controller</secondary>
        </indexterm>
        <indexterm>
            <primary>domain installation</primary>
        </indexterm>
        <para>The &agent; application can be installed on the domain controller and the members of a domain from the domain controller, and configured globally using group policies. The &agentabbrev; requires about 30 MB hard disk space.</para>
        <itemizedlist>
            <listitem>
                <para>For details on how to install the &agentabbrev; application in a domain, see <xref linkend="windows-install-domain"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows-configure-domain-hosts"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows-configure-domain-controllers"/>.</para>
            </listitem>
        </itemizedlist>
        <note>
            <para>The <parameter>.msi</parameter> version of the installer does not install the MMC configuration snap-in of the agent, therefore the <parameter>.msi</parameter> installer does not require the .NET framework.</para>
        </note>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>installing the agent from the domain controller</secondary>
        </indexterm>
        <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-install-domain.xml"/>
    </section>
    <section xml:id="windows-install-silent">
        <title>Silent installation</title>
        <indexterm>
            <primary>installing the agent</primary>
            <secondary>without user interaction</secondary>
        </indexterm>
        <indexterm>
            <primary>silent installation</primary>
        </indexterm>
        <para>The &agent; application can be installed in silent mode as well, without requiring any user interaction. The various installer options can be specified as command-line options. Using the <parameter>/S</parameter> option is required. The following options are available.</para>
        <warning>
            <para>Write all options in uppercase.</para>
        </warning>
        <variablelist>
            <varlistentry>
                <term><command>/D=&lt;path&gt;</command>
                </term>
                <listitem>
                    <para>Install the &agentabbrev; into the specified folder. Do not use quotes (<userinput>''</userinput>) or double-quotes (<userinput>""</userinput>) around the folder name, even if it contains whitespace characters.</para>
                    <warning>
                        <para>If you use the <parameter>/D</parameter> option, make sure that this is the last option in the command-line. For example: <command>syslog-ng-agent-nosnapin-&lt;version&gt;-setup.exe /S /XMLCONFIG=c:\test.xml /LOCALUPGRADE /D=c:\Program Files\agent\</command></para>
                    </warning>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/LOCAL</command>
                </term>
                <listitem>
                    <para>Install &agentabbrev; in standalone mode. This is the default installation mode of the &agentabbrev;. When using this option, you can also set the following two options:</para>
                    <itemizedlist>
                        <listitem>
                            <para><parameter>/GPOUPGRADE</parameter>: Upgrade all GPO configuration having &agentabbrev; settings during the installation.</para>
                            <warning>
                                <para>Use it only on a domain controller.</para>
                            </warning>
                        </listitem>
                        <listitem>
                            <para><parameter>/LOCALUPGRADE</parameter>: Upgrade local settings.</para>
                            <note>
                                <para>If &agentabbrev; uses only local configuration and you do not specify this option, it is possible that &agentabbrev; will not start while you are upgrading its local configuration by opening local configuration with syslog-ng agent MMC snap-in.</para>
                            </note>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/NOMENU</command>
                </term>
                <listitem>
                    <para>Do not add entries about &agentabbrev; to the Start menu.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/NOUPGRADE</command>
                </term>
                <listitem>
                    <para>The installer does not perform upgrade during the installation (default). Use it if the configuration comes from GPO or you are using XML configuration and you do not want to upgrade it (in this case, agent will upgrade it temporarily after starting).</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/REMOTE</command>
                </term>
                <listitem>
                    <para>Install &agentabbrev; in domain mode.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/S</command>
                </term>
                <listitem>
                    <para>Start the installer in silent mode. This option is required for the silent installation.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><command>/XMLCONFIG=</command>
                </term>
                <listitem>
                    <para>Use the specified XML configuration file for the configuration of &agentabbrev;. When using this option, you can also set the following option:</para>
                    <itemizedlist>
                        <listitem>
                            <para><parameter>/XMLUPGRADE</parameter>: Upgrade XML configuration during the installation if XML configuration file is used.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </varlistentry>
        </variablelist>
        <para>The upgrade operation will be only performed if upgrading is really needed for the specified configuration. For example: If there is no configuration version switching between the current and the previous version of the &agentabbrev; (for example when upgrading from version 3.0.7 to version 3.0.8) the local settings will not be upgraded even you specify the <command>/LOCALUPGRADE</command> option.</para>
        <para>The <parameter>/LOCAL</parameter>, <parameter>/XMLCONFIG</parameter>, and <parameter>/REMOTE</parameter> options conflict with each other. If you specify more than one of them, then <parameter>/REMOTE</parameter> takes precedence over the other two options, and <parameter>/XMLCONFIG</parameter> takes precedence over the <parameter>/LOCAL</parameter> option.</para>
    </section>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-msi-install-custom-directory.xml"/>
    <section xml:id="windows-upgrade">
        <title>Upgrading &agent; to the latest version</title>
        <indexterm significance="preferred">
            <primary>&agentabbrev;</primary>
            <secondary>upgrading</secondary>
        </indexterm>
        <para>The exact upgrading procedure of the &agent; application depends on how you have installed and how you manage the agent.</para>
        <warning>
            <itemizedlist>
                <listitem>
                    <para>When upgrading agents running in domain mode, always upgrade the agents running on the domain hosts before upgrading the agent running on the domain controllers.</para>
                </listitem>
                <listitem>
                    <para>The hosts of a domain (including the domain controllers) have to run the same version of the &agentabbrev;, running different versions on the hosts is neither supported nor recommended.</para>
                </listitem>
                <listitem>
                    <para>If the <guimenu>Services</guimenu> window of MMC is open, close it before upgrading, because it can prevent the successful registration of the agent service.</para>
                </listitem>
            </itemizedlist>
        </warning>
        <note>
            <indexterm significance="preferred">
                <primary>&agentabbrev;</primary>
                <secondary>upgrading to 5 LTS</secondary>
            </indexterm>
            <para>Upgrading to &agent; version 5 LTS is supported only from &agentabbrev; version 4.0.3 (the latest stable release).</para>
        </note>
        <note>
            <para>If the option <guimenu>Force DNS hostname</guimenu> was enabled in version 4.0.3, then in version 5.0.1, option <guimenu>Use FQDN</guimenu> will be enabled after the upgrade. For details, see <xref linkend="windows-global-hostname"/>.</para>
        </note>
        <itemizedlist>
            <listitem>
                <para>If a host is running &agentabbrev; in standalone mode, download and execute the <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> installer on the host and verify that the displayed information is correct. The agent will be automatically restarted when you close the configuration window.</para>
            </listitem>
            <listitem>
                <para>If a domain host is running the &agentabbrev; that was installed by the domain controller from the <parameter>.msi</parameter> installer package, complete the steps described in <xref linkend="windows-install-domain-controller"/>. The system will automatically recognize that the new package will update the &agent; application.</para>
            </listitem>
            <listitem>
                <para>If a domain host is running the &agentabbrev; that was installed manually from the <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file, run the new <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file on the host. After the installation is complete, select <guimenu>Start > Run</guimenu> and execute the <command>gpupdate</command> command to refresh the domain settings of the agent.</para>
            </listitem>
            <listitem>
                <para>If &agentabbrev; has been installed with an XML configuration file with <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> or <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename>, download and execute the same installer. It will display the previous XML configuration file, and upgrades it if desired.</para>
            </listitem>
        </itemizedlist>
    </section>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-uninstall-gui.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="windows-uninstall-silent.xml"/>
</chapter>
