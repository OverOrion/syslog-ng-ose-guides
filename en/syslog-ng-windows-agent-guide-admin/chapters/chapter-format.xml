<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-format" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Customizing the message format</title>
    <indexterm>
        <primary>message format</primary>
        <secondary>&agentabbrev;</secondary>
    </indexterm>
    <indexterm>
        <primary>&agentabbrev;</primary>
        <secondary>message format</secondary>
    </indexterm>
    <para>The format of the messages received from the eventlog and the file sources can be customized using templates. You can define separate message format for the eventlog and the file sources. If you have multiple destination servers configured, you can define separate templates for each server. When creating a template to customize the message format, you can use macros, all alphanumeric characters, and the following special characters: <userinput>&lt;&gt;,():;-+/_</userinput>.</para>
    <para>By default, &agentabbrev; uses the following templates to forward messages:</para>
    <indexterm>
        <primary>&agentabbrev;</primary>
        <secondary>default message format</secondary>
    </indexterm>
    <itemizedlist>
        <listitem>
            <para>For the BSD protocol: <userinput>&lt;${PRI}&gt;${BSDDATE} ${HOST} ${MSGHDR}${MESSAGE}</userinput></para>
        </listitem>
        <listitem>
            <para>For messages read from the eventlog, the <userinput>$MESSAGE</userinput> part is <userinput>${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}] ${EVENT_MSG} (EventID ${EVENT_ID})</userinput> for every protocol.</para>
        </listitem>
        <listitem>
            <para>For messages read from a file, the <userinput>$MESSAGE</userinput> part is <userinput>$FILE_NAME: $FILE_CURRENT_POSITION/$FILE_SIZE: $FILE_MESSAGE</userinput> for every protocol.</para>
        </listitem>
    </itemizedlist>
    <procedure xml:id="windows-customize-messages">
        <title>Customizing messages using templates</title>
        <formalpara>
            <title>Purpose:</title>
            <para/>
        </formalpara>
        <para>To create a template, complete the following procedure:</para>
        <warning>
            <para>These macros are available only in the &agent;. To recognize Windows-specific elements of the log message (for example eventlog-related macros) on the syslog-ng server, you have to use parsers on the syslog-ng server. The parser must be configured to match the message format set in the syslog-ng Agent. For details on configuring parsers on your &product; server, see<olink targetdoc="syslog-ng-pe-guide-admin" targetptr="chapter-parsers"/>.</para>
        </warning>
        <formalpara>
            <title>Steps:</title>
            <para/>
        </formalpara>
        <step>
            <para>Start the configuration interface of the &agent; application.</para>
        </step>
        <step>
            <para>Select<guimenu>syslog-ng Agent Settings > Destinations</guimenu>. Select your log server, and click<guimenu>Properties</guimenu>.</para>
        </step>
        <step>
            <para>To change the format of messages received from eventlog sources, type the message format you want to use into the<guimenu>Event Message Format > Message Template</guimenu>field.</para>
            <para>To change the format of messages received from file sources, type the message format you want to use into the<guimenu>File Message Format > Message Template</guimenu>field.</para>
            <para>Do not forget to add the <userinput>$</userinput> character before macros. For a complete list of the available macros, see <xref linkend="windows-macros"/>.</para>
            <para>For example, to send the messages in the <userinput>DATE HOSTNAME MESSAGE</userinput> format, type <userinput>Date:$DATE Hostname:$HOST Logmessage:$MESSAGE</userinput>.</para>
            <para>Note that the $MESSAGE macro contains not only the text of the log message, but also additional information received from the message source, such as the name of the eventlog container, or the file, as set in the eventlog-specific and file-specific templates.</para>
            <note>
                <para>Templates are assigned to a single destination server, so it is possible to use different templates for different servers. However, a server and its failover servers always receive the same message.</para>
            </note>
            <warning>
                <para>If you have more than one destination servers configured (separate servers, not in failover mode), and you want to use the same template for every server, you must manually copy the template into the configuration of each server. Template modifications are not applied automatically to every server.</para>
            </warning>
        </step>
        <step>
            <para>Click<guimenu>OK</guimenu>.</para>
        </step>
        <step>
            <para>To activate the changes, restart the &agentabbrev; service.</para>
        </step>
    </procedure>
    <section xml:id="windows-timestamp">
        <title>Customizing the timestamp used by the &agentabbrev;</title>
        <indexterm>
            <primary>timestamp</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>timestamp</secondary>
        </indexterm>
        <para>The &agentabbrev; can send the syslog messages using either the ISO or the BSD timestamp format. It is recommended to use the ISO format, because it contains much more information than the BSD format.</para>
        <para>Note that in the &agentabbrev;, the macros without prefix (for example <parameter>DATE</parameter>) always refer to the receiving date of the message (for example <parameter>R_DATE</parameter>) when it arrived into the event log container, and are included only for compatibility reasons.</para>
        <warning>
            <indexterm>
                <primary>timezone</primary>
                <secondary>Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>eventlog</primary>
                <secondary>remote logging</secondary>
            </indexterm>
            <para>If a remote host is logging into the event log of the local host that is running &agent;, both hosts have to be in the same timezone, because the event log message does not include the timezone information of the sender host. Otherwise, the date of the messages received from the remote host will be incorrect.</para>
        </warning>
    </section>
    <section xml:id="windows-macros">
        <title>Macros available in the &agentabbrev;</title>
        <para>The following sections list the available macros:</para>
        <warning>
            <para>These macros are available only in the &agent;. To recognize Windows-specific elements of the log message (for example eventlog-related macros) on the syslog-ng server, you have to use parsers on the syslog-ng server. The parser must be configured to match the message format set in the syslog-ng Agent. For details on configuring parsers on your &abbrev; server, see<olink targetdoc="syslog-ng-pe-guide-admin" targetptr="chapter-parsers"/>.</para>
        </warning>
        <itemizedlist>
            <listitem>
                <para><link linkend="macro-protocol-agent">Macros related to protocol headers</link></para>
            </listitem>
            <listitem>
                <para><link linkend="macro-time-agent">Macros related to the date and time of the message</link></para>
            </listitem>
            <listitem>
                <para><link linkend="macro-event-agent">Macros related to eventlog sources</link></para>
            </listitem>
            <listitem>
                <para><link linkend="macro-file-agent">Macros related to file sources</link></para>
            </listitem>
        </itemizedlist>
        <note>
            <para>Note that if you use the Syslog protocol template (meaning that messages are sent using the IETF-syslog protocol), only the message part of the log message can be customized, the structure of the headers and other information is fixed by the protocol.</para>
        </note>
        <section xml:id="macro-protocol-agent">
            <title>Protocol-related macros of the &agentabbrev;</title>
            <indexterm>
                <primary>macros</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <indexterm>
                <primary>macros</primary>
                <secondary>protocol</secondary>
            </indexterm>
            <xi:include href="../../common/chunk/macro-app-name.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-application-name.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <simplesect xml:id="HOST">
                <title>HOST</title>
                <para><emphasis role="bold">Description:</emphasis> Name of the host sending the message. Hostnames are automatically converted to lowercase.</para>
            </simplesect>
            <simplesect xml:id="MESSAGE">
                <title>MESSAGE</title>
                <para><emphasis role="bold">Description:</emphasis> The content of the message, including the text of the message and any file- or event-specific macros that are set for the source.</para>
            </simplesect>
            <simplesect xml:id="MSG">
                <title>MSG</title>
                <para><emphasis role="bold">Description:</emphasis> An alias for the <link linkend="MESSAGE"><parameter>MESSAGE</parameter></link> macro.</para>
            </simplesect>
            <xi:include href="../../common/chunk/macro-msghdr.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <simplesect xml:id="PRI">
                <title>PRI</title>
                <para><emphasis role="bold">Description:</emphasis> Priority header of the message, storing the facility and the level of the message.</para>
            </simplesect>
            <xi:include href="../../common/chunk/macro-process-id.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </section>
        <section xml:id="macro-time-agent">
            <title>Time-related macros of the &agentabbrev;</title>
            <indexterm>
                <primary>macros</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <indexterm>
                <primary>macros</primary>
                <secondary>date and time</secondary>
            </indexterm>
            <xi:include href="../../common/chunk/macro-bsddate.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-date.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-day.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-fulldate.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-hour.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <simplesect xml:id="macro-isodate">
                <title>ISODATE, R_ISODATE, S_ISODATE</title>
                <indexterm>
                    <primary>ISODATE, R_ISODATE, S_ISODATE</primary>
                </indexterm>
                <para><emphasis role="bold">Description:</emphasis> Date of the message in the ISO 8601 compatible standard timestamp format (yyyy-mm-ddThh:mm:ss+-ZONE), for example: <parameter>2006-06-13T15:58:00.123+01:00</parameter>. If possible, it is recommended to use <parameter>ISODATE</parameter> for timestamping. Note that the &agentabbrev; cannot produce fractions of a second (for example milliseconds) in the timestamp.</para>
            </simplesect>
            <xi:include href="../../common/chunk/macro-min.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-month.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-monthname.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-sec.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-tz.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-tzoffset.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-unixtime.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-year.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-week.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <simplesect xml:id="macro-weekday">
                <title>WEEKDAY, R_WEEKDAY, S_WEEKDAY</title>
                <indexterm>
                    <primary>WEEKDAY, R_WEEKDAY, S_WEEKDAY</primary>
                </indexterm>
                <indexterm>
                    <primary>$WEEKDAY, $R_WEEKDAY, $S_WEEKDAY</primary>
                </indexterm>
                <para><emphasis role="bold">Description:</emphasis> The 3-letter name of the day of week the message was sent, for example <parameter>Thu</parameter>.</para>
            </simplesect>
        </section>
        <section xml:id="macro-event-agent">
            <title>Eventlog-related macros of the &agentabbrev;</title>
            <indexterm>
                <primary>macros</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <indexterm>
                <primary>macros</primary>
                <secondary>eventlog sources</secondary>
            </indexterm>
            <simplesect xml:id="EVENT-CATEGORY">
                <title>EVENT_CATEGORY</title>
                <para><emphasis role="bold">Description:</emphasis> The category of the event.</para>
            </simplesect>
            <simplesect xml:id="EVENT-DATA">
                <title>EVENT_DATA</title>
                <para><emphasis role="bold">Description:</emphasis> Empty macro, does not contain any data.</para>
            </simplesect>
            <simplesect xml:id="EVENT-CONTAINER-COUNTER">
                <title>EVENT_CONTAINER_COUNTER</title>
                <para><emphasis role="bold">Description:</emphasis> The number of received messages per container since the &agent; was started.</para>
            </simplesect>
            <simplesect xml:id="EVENT-FACILITY">
                <title>EVENT_FACILITY</title>
                <para><emphasis role="bold">Description:</emphasis> The facility that sent the message.</para>
            </simplesect>
            <simplesect xml:id="EVENT-GLOBAL-COUNTER">
                <title>EVENT_GLOBAL_COUNTER</title>
                <para><emphasis role="bold">Description:</emphasis> A unique ID for messages generated at reception time on the receiving host. It facilitates defining relationships between messages that are potentially distributed to different files on the same host, or different hosts.</para>
            </simplesect>
            <simplesect xml:id="EVENT-HOST">
                <title>EVENT_HOST</title>
                <para><emphasis role="bold">Description:</emphasis> The name of the host that sent the log message.</para>
            </simplesect>
            <simplesect xml:id="EVENT-ID">
                <title>EVENT_ID</title>
                <para><emphasis role="bold">Description:</emphasis> The identification number of the event.</para>
            </simplesect>
            <simplesect xml:id="EVENT-LEVEL">
                <title>EVENT_LEVEL</title>
                <para><emphasis role="bold">Description:</emphasis> Importance level of the message represented as a number: 6 - Success, 5 - Informational, 4- Warning, or 3 - Error).</para>
            </simplesect>
            <simplesect xml:id="EVENT-MESSAGE">
                <title>EVENT_MESSAGE</title>
                <para><emphasis role="bold">Description:</emphasis> The content of the message.</para>
            </simplesect>
            <simplesect xml:id="EVENT-MESSAGE-XML">
                <title>EVENT_MESSAGE_XML</title>
                <para><emphasis role="bold">Description:</emphasis> Contains the entire message in XML format. Available only on Windows Vista and Server 2008 platforms</para>
            </simplesect>
            <simplesect xml:id="EVENT-MSG">
                <title>EVENT_MSG</title>
                <para><emphasis role="bold">Description:</emphasis> The content of the message. This is an alias of the <link linkend="EVENT-MESSAGE"><parameter>EVENT_MESSAGE</parameter></link>.</para>
            </simplesect>
            <simplesect xml:id="EVENT-MSG-XML">
                <title>EVENT_MSG_XML</title>
                <para><emphasis role="bold">Description:</emphasis> Contains the entire message in XML format. This is an alias of the <link linkend="EVENT-MESSAGE-XML"><parameter>EVENT_MESSAGE_XML</parameter></link>. Available only on Windows Vista and Server 2008 platforms</para>
            </simplesect>
            <simplesect xml:id="EVENT-NAME">
                <title>EVENT_NAME</title>
                <para><emphasis role="bold">Description:</emphasis> Name of the Windows event log container (for example Application or Security).</para>
            </simplesect>
            <simplesect xml:id="EVENT-PROVIDER">
                <title>EVENT_PROVIDER</title>
                <para><emphasis role="bold">Description:</emphasis> Name of the service that generated the log message.</para>
            </simplesect>
            <simplesect xml:id="EVENT-REC-NUM">
                <title>EVENT_REC_NUM</title>
                <para><emphasis role="bold">Description:</emphasis> The record number of the event in the event log.</para>
            </simplesect>
            <simplesect xml:id="EVENT-SID">
                <title>EVENT_SID</title>
                <para><emphasis role="bold">Description:</emphasis> The security identification number of the event.</para>
            </simplesect>
            <simplesect xml:id="EVENT-SID-TYPE">
                <title>EVENT_SID_TYPE</title>
                <para><emphasis role="bold">Description:</emphasis> The security identification number resolved into name. One of the following: <parameter>User</parameter>, <parameter>Group</parameter>, <parameter>Domain</parameter>, <parameter>Alias</parameter> <parameter>WellKnownGroup</parameter>, <parameter>DeletedAccount</parameter>, <parameter>Invalid</parameter>, <parameter>Unknown</parameter>, <parameter>Computer</parameter>.</para>
            </simplesect>
            <simplesect xml:id="EVENT-SOURCE">
                <title>EVENT_SOURCE</title>
                <para><emphasis role="bold">Description:</emphasis> The application that created the message.</para>
            </simplesect>
            <simplesect xml:id="EVENT-TASK">
                <title>EVENT_TASK</title>
                <para><emphasis role="bold">Description:</emphasis> The task category of the event. Available only on Windows Vista and Server 2008 platforms</para>
            </simplesect>
            <simplesect xml:id="EVENT-TYPE">
                <title>EVENT_TYPE</title>
                <para><emphasis role="bold">Description:</emphasis> The importance level of the message in text format.</para>
            </simplesect>
            <simplesect xml:id="EVENT-USERNAME">
                <title>EVENT_USERNAME</title>
                <para><emphasis role="bold">Description:</emphasis> The user running the application that created the message.</para>
            </simplesect>
        </section>
        <section xml:id="macro-file-agent">
            <title>File-related macros of the &agentabbrev;</title>
            <indexterm>
                <primary>macros</primary>
                <secondary>&agentabbrev;</secondary>
            </indexterm>
            <indexterm>
                <primary>macros</primary>
                <secondary>file sources</secondary>
            </indexterm>
            <simplesect xml:id="FILE-CURRENT-POSITION">
                <title>FILE_CURRENT_POSITION</title>
                <para><emphasis role="bold">Description:</emphasis> The position of the message from the beginning of the file in bytes.</para>
            </simplesect>
            <xi:include href="../../common/chunk/macro-file-facility.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-file-level.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-file-message.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-file-msg.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/macro-file-name.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <simplesect xml:id="FILE-SIZE">
                <title>FILE_SIZE</title>
                <para><emphasis role="bold">Description:</emphasis> The current size of the file in bytes.</para>
            </simplesect>
        </section>
    </section>
</chapter>
