<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section
 [  <!ENTITY % entities SYSTEM "syslog-ng-entities.ent">
 %entities;]>
<section xml:id="syslog-ng-patterndb-scheme" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>The syslog-ng pattern database format</title>
    <indexterm>
        <primary>pattern database</primary>
    </indexterm>
    <indexterm>
        <primary>classifying messages</primary>
        <secondary>creating databases</secondary>
    </indexterm>
    <indexterm>
        <primary>message</primary>
        <secondary>classification</secondary>
    </indexterm>
    <indexterm>
        <primary>pattern database</primary>
        <secondary>schema</secondary>
    </indexterm>
    <para>Pattern databases are XML files that contain rules describing the message patterns. For sample pattern databases, see <xref linkend="patterndb-download"/>.</para>
    <para>The following scheme describes the V4 format of the pattern database. This format is used by &abbrev; <phrase condition="pe">4 F1</phrase><phrase condition="ose">3.2</phrase> and later, and is backwards-compatible with the earlier V3 format.</para>
    <para>For a sample database containing only a single pattern, see <xref linkend="example-pattern-database-v4-su"/>.</para>
    <tip>
        <para>Use the <command>pdbtool</command> utility that is bundled with syslog-ng to test message patterns and convert existing databases to the latest format. For details, see <xref linkend="pdbtool.1"/>.</para>
        <para>To automatically create an initial pattern database from an existing log file, use the <command>pdbtool patternize</command> command. For details, see <xref linkend="pdbtool-patternize"/>.</para>
    </tip>
    <section xml:id="element-patterndb-patterndb">
        <title>Element: patterndb</title>
        <simplesect>
            <title>Location</title>
            <para>/<emphasis role="bold">patterndb</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>The container element of the pattern database.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">version</emphasis>: The schema version of the pattern database. The current version is <userinput>4</userinput>.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">pubdate</emphasis>: The publication date of the XML file.</para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><link linkend="element-patterndb-ruleset"><emphasis role="bold">ruleset</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <synopsis>&lt;patterndb version='4' pub_date='2010-10-25'&gt;</synopsis>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-ruleset">
        <title>Element: ruleset</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<emphasis role="bold">ruleset</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>A container element to group log patterns for an application or program.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">name</emphasis>: The name of the application. Note that the function of this attribute is to make the database more readable, syslog-ng uses the <userinput>&lt;pattern&gt;</userinput> element to identify the applications sending log messages.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">id</emphasis>: A unique ID of the application, for example, the md5 sum of the <userinput>name</userinput> attribute.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">description</emphasis>: OPTIONAL &mdash; A description of the ruleset or the application.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">url</emphasis>: OPTIONAL &mdash; An URL referring to further information about the ruleset or the application.</para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><link linkend="element-patterndb-patterns"><emphasis role="bold">patterns</emphasis></link></para>
                </listitem>
                <listitem>
                    <para><link linkend="element-patterndb-rules"><emphasis role="bold">rules</emphasis></link></para>
                </listitem>
                <listitem>
                    <para><link linkend="element-patterndb-actions"><emphasis role="bold">actions</emphasis></link></para>
                </listitem>
                <listitem>
                    <para><link linkend="element-patterndb-tags"><emphasis role="bold">tags</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <synopsis>&lt;ruleset name='su' id='480de478-d4a6-4a7f-bea4-0c0245d361e1'&gt;</synopsis>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-patterns">
        <title>Element: patterns</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<emphasis role="bold">patterns</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>A container element. A <userinput>&lt;patterns&gt;</userinput> element may contain any number of <userinput>&lt;pattern&gt;</userinput> elements.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">pattern</emphasis>: The name of the application &mdash; syslog-ng matches this value to the ${PROGRAM} header of the syslog message to find the rulesets applicable to the syslog message.</para>
                    <para>Specifying multiple patterns is useful if two or more applications have different names (that is, different ${PROGRAM} fields), but otherwise send identical log messages.</para>
                    <para>It is not necessary to use multiple patterns if only the end of the ${PROGRAM} fields is different, use only the beginning of the ${PROGRAM} field as the <userinput>pattern</userinput>. For example, the Postfix e-mail server sends messages using different process names, but all of them begin with the <userinput>postfix</userinput> string.</para>
                    <note>
                        <para>If the <userinput>&lt;pattern&gt;</userinput> element of a ruleset is not specified, &abbrev; will use this ruleset as a fallback ruleset: it will apply the ruleset to messages that have an empty PROGRAM header, or if none of the program patterns matched the PROGRAM header of the incoming message.</para>
                    </note>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <synopsis>&lt;patterns&gt;
    &lt;pattern&gt;firstapplication&lt;/pattern&gt;
    &lt;pattern&gt;otherapplication&lt;/pattern&gt;
&lt;/patterns&gt;</synopsis>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-rules">
        <title>Element: rules</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<emphasis role="bold">rules</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>A container element for the rules of the ruleset.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><link linkend="element-patterndb-rule"><emphasis role="bold">rule</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <synopsis>&lt;rules&gt;
    &lt;rule provider='me' id='182437592347598' class='system'&gt;
        &lt;patterns&gt;
            &lt;pattern&gt;Accepted @QSTRING:SSH.AUTH_METHOD: @ for@QSTRING:SSH_USERNAME: @from\ @QSTRING:SSH_CLIENT_ADDRESS: @port @NUMBER:SSH_PORT_NUMBER:@ ssh2&lt;/pattern&gt;
        &lt;/patterns&gt;
    &lt;/rule&gt;
&lt;/rules&gt;</synopsis>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-rule">
        <title>Element: rule</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-rules">rules</link>/<emphasis role="bold">rule</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>An element containing message patterns and how a message that matches these patterns is classified.</para>
            <note>
                <para>If the following characters appear in the message, they must be escaped in the rule as follows:</para>
                <itemizedlist>
                    <listitem>
                        <para><userinput>@</userinput>: Use @@, for example <userinput>user@@example.com</userinput></para>
                    </listitem>
                    <listitem>
                        <para><emphasis>&lt;</emphasis>: Use <userinput>&amp;lt;</userinput></para>
                    </listitem>
                    <listitem>
                        <para><emphasis>&gt;</emphasis>: Use <userinput>&amp;gt;</userinput></para>
                    </listitem>
                    <listitem>
                        <para>&amp;: Use <userinput>&amp;amp;</userinput></para>
                    </listitem>
                </itemizedlist>
            </note>
            <para>The <emphasis role="bold">&lt;rules&gt;</emphasis> element may contain any number of <emphasis role="bold">&lt;rule&gt;</emphasis> elements.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">provider</emphasis>: The provider of the rule. This is used to distinguish between who supplied the rule; that is, if it has been created by BalaBit, or added to the XML by a local user.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">id</emphasis>: The globally unique ID of the rule.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">class</emphasis>: The class of the rule &mdash; syslog-ng assigns this class to the messages matching a pattern of this rule.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">context-id</emphasis>: OPTIONAL &mdash; An identifier to group related log messages when using the pattern database to correlate events. The ID can be a descriptive string describing the events related to the log message (for example, <userinput>ssh-sessions</userinput> for log messages related to SSH traffic), but can also contain macros to generate IDs dynamically. When using macros in IDs, see also the <link linkend="patterndb-schema-context-scope"><parameter>context-scope</parameter></link> attribute. For details on correlating messages, see <xref linkend="patterndb-correlation"/>.</para>
                    <note>
                        <para>The &abbrev; application determines the context of the message <emphasis>after</emphasis> the pattern matching is completed. This means that macros and name-value pairs created by the matching pattern database rule can be used as context-id macros.</para>
                    </note>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">context-timeout</emphasis>: OPTIONAL &mdash; The number of seconds the context is stored. Note that for high-traffic log servers, storing open contexts for long time can require significant amount of memory. For details on correlating messages, see <xref linkend="patterndb-correlation"/>.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">context-scope</emphasis>: OPTIONAL &mdash; Specifies which messages belong to the same context. This attribute is used to determine the context of the message if the <link linkend="patterndb-schema-context-id"><parameter>context-id</parameter></link> does not specify any macros. Usually, <parameter>context-scope</parameter> acts a filter for the context, with <parameter>context-id</parameter> refining the filtering if needed. The <parameter>context-scope</parameter> attribute has the following possible values:</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>process &mdash; context-scope</primary>
                            </indexterm>
                            <para><emphasis>process</emphasis>: Only messages that are generated by the same process of a client belong to the same context, that is, messages that have identical ${HOST}, ${PROGRAM} and ${PID} values. This is the default behavior of &abbrev; if <parameter>context-scope</parameter> is not specified.</para>
                        </listitem>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>program &mdash; context-scope</primary>
                            </indexterm>
                            <para><emphasis>program</emphasis>: Messages that are generated by the same application of a client belong to the same context, that is, messages that have identical ${HOST} and ${PROGRAM} values.</para>
                        </listitem>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>host &mdash; context-scope</primary>
                            </indexterm>
                            <para><emphasis>host</emphasis>: Every message generated by a client belongs to the same context, only the ${HOST} value of the messages must be identical.</para>
                        </listitem>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>global &mdash; context-scope</primary>
                            </indexterm>
                            <para><emphasis>global</emphasis>: Every message belongs to the same context.</para>
                        </listitem>
                    </itemizedlist>
                    <note>
                        <para>Using the <parameter>context-scope</parameter> attribute is significantly faster than using macros in the <parameter>context-id</parameter> attribute.</para>
                    </note>
                    <para>For details on correlating messages, see <xref linkend="patterndb-correlation"/>.</para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><link linkend="element-patterndb-rule-patterns"><emphasis role="bold">patterns</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <synopsis>&lt;rule provider='balabit' id='f57196aa-75fd-11dd-9bba-001e6806451b' class='violation'&gt;</synopsis>
            <para>The following example specifies attributes for correlating messages as well. For details on correlating messages, see <xref linkend="patterndb-correlation"/>.</para>
            <synopsis>&lt;rule provider='balabit' id='f57196aa-75fd-11dd-9bba-001e6806451b' class='violation' context-id='same-session' context-scope='process' context-timeout='360'&gt;</synopsis>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-rule-patterns">
        <title>Element: patterns</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-rules">rules</link>/<link linkend="element-patterndb-rule">rule</link>/<emphasis role="bold">patterns</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>An element containing the patterns of the rule. If a <emphasis role="bold">&lt;patterns&gt;</emphasis> element contains multiple <emphasis role="bold">&lt;pattern&gt;</emphasis> elements, the class of the <emphasis role="bold">&lt;rule&gt;</emphasis> is assigned to every syslog message matching any of the patterns.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">pattern</emphasis>: A pattern describing a log message. This element is also called <userinput>message pattern</userinput>. For example: <synopsis>&lt;pattern&gt;+ ??? root-&lt;/pattern&gt;</synopsis></para>
                    <note>
                        <para>Support for XML entities is limited, you can use only the following entities: <userinput>&amp;amp; &amp;lt; &amp;gt; &amp;quot; &amp;apos;</userinput>. User-defined entities are not supported.</para>
                    </note>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">description</emphasis>: OPTIONAL &mdash; A description of the pattern or the log message matching the pattern.</para>
                </listitem>
                <listitem>
                    <para><link linkend="element-patterndb-urls"><emphasis role="bold">urls</emphasis></link></para>
                </listitem>
                <listitem>
                    <para><link linkend="element-patterndb-values"><emphasis role="bold">values</emphasis></link></para>
                </listitem>
                <listitem>
                    <para><link linkend="element-patterndb-examples"><emphasis role="bold">examples</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-urls">
        <title>Element: urls</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-rules">rules</link>/<link linkend="element-patterndb-rule">rule</link>/<link linkend="element-patterndb-rule-patterns">patterns</link>/<emphasis role="bold">urls</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; An element containing one or more URLs referring to further information about the patterns or the matching log messages.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">url</emphasis>: OPTIONAL &mdash; An URL referring to further information about the patterns or the matching log messages.</para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-values">
        <title>Element: values</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-rules">rules</link>/<link linkend="element-patterndb-rule">rule</link>/<link linkend="element-patterndb-rule-patterns">patterns</link>/<emphasis role="bold">values</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; Name-value pairs that are assigned to messages matching the patterns, for example, the representation of the event in the message according to the Common Event Format (CEF) or Common Event Exchange (CEE). The names can be used as macros to reference the assigned values.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><emphasis role="bold">value</emphasis>: OPTIONAL &mdash; Contains the value of the name-value pair that is assigned to the message. For example:</para>
                    <synopsis>&lt;value name=".classifier.outcome"&gt;/Success&lt;/value&gt;</synopsis>
                    <para>The &lt;value&gt; element of name-value pairs can include template functions. For details, see <xref linkend="template-functions"/>, for examples, see <xref linkend="template-function-if"/>.</para>
                    <para>When used together with message correlation, the &lt;value&gt; element of name-value pairs can include references to the values of earlier messages from the same context. For details, see <xref linkend="patterndb-correlation"/>.</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>name &mdash; pattern value</primary>
                            </indexterm>
                            <para><emphasis>name</emphasis>: The name of the name-value pair. It can also be used as a macro to reference the assigned value.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-examples">
        <title>Element: examples</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-rules">rules</link>/<link linkend="element-patterndb-rule">rule</link>/<link linkend="element-patterndb-rule-patterns">patterns</link>/<emphasis role="bold">examples</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; A container element for sample log messages that should be recognized by the pattern. These messages can be used also to test the patterns and the parsers.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><link linkend="element-patterndb-example"><emphasis role="bold">example</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-example">
        <title>Element: example</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-rules">rules</link>/<link linkend="element-patterndb-rule">rule</link>/<link linkend="element-patterndb-rule-patterns">patterns</link>/<link linkend="element-patterndb-examples">examples</link>/<emphasis role="bold">example</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; A container element for a sample log message.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <indexterm type="parameter">
                        <primary>test_message</primary>
                    </indexterm>
                    <para><emphasis role="bold">test_message</emphasis>: OPTIONAL &mdash; A sample log message that should match this pattern. For example:<synopsis>&lt;test_message program="myapplication"&gt;Content filter has been enabled&lt;/test_message&gt;</synopsis></para>
                    <itemizedlist>
                        <listitem>
                            <para><emphasis>program</emphasis>: The program pattern of the test message. For example:<synopsis>&lt;test_message program="proftpd">ubuntu (::ffff:192.168.2.179[::ffff:192.168.2.179]) - FTP session closed.&lt;/test_message&gt;</synopsis></para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <indexterm type="parameter">
                        <primary>test_values</primary>
                    </indexterm>
                    <para><emphasis role="bold">test_values</emphasis>: OPTIONAL &mdash; A container element to test the results of the parsers used in the pattern.</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>test_value</primary>
                            </indexterm>
                            <para><emphasis role="bold">test_value</emphasis>: OPTIONAL &mdash; The expected value of the parser when matching the pattern to the test message. For example: <synopsis>&lt;test_value name=".dict.ContentFilter"&gt;enabled&lt;/test_value&gt;</synopsis></para>
                            <itemizedlist>
                                <listitem>
                                    <indexterm type="parameter">
                                        <primary>name &mdash; test_value</primary>
                                    </indexterm>
                                    <para><emphasis>name</emphasis>: The name of the parser to test.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-actions">
        <title>Element: actions</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<emphasis role="bold">actions</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; A container element for actions that are performed if a message is recognized by the pattern. For details on actions, see <xref linkend="patterndb-triggers-actions"/>.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <para><link linkend="element-patterndb-action"><emphasis role="bold">action</emphasis></link></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-action">
        <title>Element: action</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<link linkend="element-patterndb-actions">actions</link>/<emphasis role="bold">action</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; A container element describing an action that is performed when a message matching the rule is received.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <itemizedlist>
                <listitem>
                    <indexterm type="parameter">
                        <primary>condition</primary>
                    </indexterm>
                    <para><emphasis>condition</emphasis>: A syslog-ng filter expression. The action is performed only if the message matches the filter. The filter can include macros and name-value pairs extracted from the message.</para>
                </listitem>
                <listitem>
                    <indexterm type="parameter">
                        <primary>rate</primary>
                    </indexterm>
                    <para><emphasis>rate</emphasis>: Specifies maximum how many messages should be generated in the specified time period in the following format: <userinput>&lt;number-of-messages&gt;/&lt;period-in-seconds&gt;</userinput>. For example: <userinput>1/60</userinput> allows 1 message per minute. Rates apply within the scope of the context, that is, if <userinput>context-scope="host"</userinput> and <userinput>rate="1/60"</userinput>, then maximum one message is generated per minute for every host that sends a log message matching the rule. Excess messages are dropped. Note that when applying the rate to the generated messages, &abbrev; uses the timestamps of the log messages, similarly to calculating the <parameter>context-timeout</parameter>. That way <userinput>rate</userinput> is applied correctly even if the log messages are processed offline.</para>
                </listitem>
                <listitem>
                    <indexterm type="parameter">
                        <primary>trigger</primary>
                    </indexterm>
                    <para><emphasis>trigger</emphasis>: Specifies when the action is executed. The <parameter>trigger</parameter> attribute has the following possible values:</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>match</primary>
                            </indexterm>
                            <para><emphasis>match</emphasis>: Execute the action immediately when a message matching the rule is received.</para>
                        </listitem>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>timeout</primary>
                            </indexterm>
                            <para><emphasis>timeout</emphasis>: Execute the action when the correlation timer (<link linkend="patterndb-schema-context-timeout"><parameter>context-timeout</parameter></link>) expires. This is available only if actions are used together with correlating messages.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <indexterm type="parameter">
                        <primary>message</primary>
                    </indexterm>
                    <para><emphasis role="bold">message</emphasis>: A container element storing the message to be sent when the action is executed. Currently &abbrev; sends these messages to the <parameter>internal()</parameter> destination.</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>inherit-properties</primary>
                            </indexterm>
                            <para><emphasis>inherit-properties</emphasis>: If set to <userinput>TRUE</userinput>, the original message that triggered the action is cloned, including its name-value pairs and tags. For details, see <xref linkend="patterndb-triggers-actions"/>.</para>
                            <para>If set to <parameter>context</parameter>, &abbrev; collects every name-value pair from each message stored in the context, and includes them in the generated message. If a name-value pair appears in multiple messages of the context, the value in the latest message will be used. Note that tags are not merged, the generated message will inherit the tags assigned to the last message of the context. For details on the message context, see <xref linkend="patterndb-correlation"/> and <xref linkend="patterndb-actions-correlation"/>.</para>
                            <para condition="pe">This option is available in &abbrev; 5.3.2 and later.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <indexterm type="parameter">
                        <primary>values &mdash; action</primary>
                    </indexterm>
                    <para><emphasis role="bold">values</emphasis>: A container element for values and fields that are used to create the message generated by the action.</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>value &mdash; action</primary>
                            </indexterm>
                            <para><emphasis role="bold">value</emphasis>: Sets the value of the message field specified in the <parameter>name</parameter> attribute of the element. For example, to specify the body of the generated message, use the following syntax:</para>
                            <synopsis>&lt;value name="MESSAGE"&gt;A log message matched rule number $.classifier.rule_id&lt;/value&gt;</synopsis>
                            <para>Note that currently it is not possible to add DATE, FACILITY, or SEVERITY fields to the message.</para>
                            <para>When the action is used together with message correlation, the &abbrev; application automatically adds fields to the message based on the <parameter>context-scope</parameter> parameter. For example, using <userinput>context-scope="process"</userinput> automatically fills the HOST, PROGRAM, and PID fields of the generated message.</para>
                        </listitem>
                        <listitem>
                            <indexterm type="parameter">
                                <primary>name &mdash; value &mdash; action</primary>
                            </indexterm>
                            <para><emphasis>name</emphasis>: Name of the message field set by the <parameter>value</parameter> element.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
    <section xml:id="element-patterndb-tags">
        <title>Element: tags</title>
        <simplesect>
            <title>Location</title>
            <para>/<link linkend="element-patterndb-patterndb">patterndb</link>/<link linkend="element-patterndb-ruleset">ruleset</link>/<emphasis role="bold">tags</emphasis></para>
        </simplesect>
        <simplesect>
            <title>Description</title>
            <para>OPTIONAL &mdash; An element containing custom keywords (tags) about the messages matching the patterns. The tags can be used to label specific events (for example user logons). It is also possible to filter on these tags later (for details, see <xref linkend="tagging-messages"/>). Starting with &product; 3.2, the list of tags assigned to a message can be referenced with the <parameter>${TAGS}</parameter> macro.</para>
        </simplesect>
        <simplesect>
            <title>Attributes</title>
            <para>N/A</para>
        </simplesect>
        <simplesect>
            <title>Children</title>
            <itemizedlist>
                <listitem>
                    <indexterm type="parameter">
                        <primary>tag &mdash; rule</primary>
                    </indexterm>
                    <para><emphasis role="bold">tag</emphasis>: OPTIONAL &mdash; A keyword or tags applied to messages matching the rule. For example: <synopsis>&lt;tags&gt;&lt;tag&gt;UserLogin&lt;/tag&gt;&lt;/tags&gt;</synopsis></para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Example</title>
            <para>N/A</para>
        </simplesect>
    </section>
</section>
