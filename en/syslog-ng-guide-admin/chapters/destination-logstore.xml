<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section
 [  <!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
 %entities;]>
<section xml:id="configuring-destinations-logstore" condition="pe" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Storing messages in encrypted files</title>
    <indexterm>
        <primary>logstore</primary>
    </indexterm>
    <indexterm>
        <primary>encrypting log messages</primary>
        <secondary>on the hard disk</secondary>
    </indexterm>
    <indexterm>
        <primary>encrypting log files</primary>
    </indexterm>
    <indexterm>
        <primary>signing log files</primary>
    </indexterm>
    <indexterm>
        <primary>file encryption</primary>
    </indexterm>
    <indexterm>
        <primary>Timestamping Authority</primary>
    </indexterm>
    <indexterm>
        <primary>TSA</primary>
    </indexterm>
    <indexterm>
        <primary>destination drivers</primary>
        <secondary><parameter>logstore()</parameter> driver</secondary>
    </indexterm>
    <para>The &abbrev; application can store log messages securely in encrypted, compressed and timestamped binary files. Timestamps can be requested from an external Timestamping Authority (TSA).</para>
    <para>Logstore files consist of individual chunks, every chunk can be encrypted, compressed, and timestamped separately. Chunks contain compressed log messages and header information needed for retrieving messages from the logstore file.</para>
    <para>The &abbrev; application generates an SHA-1 hash for every chunk to verify the integrity of the chunk. The hashes of the chunks are chained together to prevent injecting chunks into the logstore file. The &abbrev; application can encrypt the logstore using various algorithms, using the <userinput>aes128</userinput> encryption algorithm in CBC mode and the <userinput>hmac-sha1</userinput> hashing (HMAC) algorithm as default. For other algorithms, see <xref linkend="destination-logstore-options-cipher"/> and <xref linkend="destination-logstore-options-digest"/>.</para>
    <para>The destination filename may include macros which get expanded when the message is written, thus a simple <parameter>logstore()</parameter> driver may create several files. For more information on available macros see <xref linkend="reference-macros"/>. </para>
    <para>If the expanded filename refers to a directory which does not exist, it will be created depending on the <parameter>create_dirs()</parameter> setting (both global and a per destination option).</para>
    <para>The <parameter>logstore()</parameter> has a single required parameter that specifies the filename that stores the log messages. For the list of available optional parameters, see <xref linkend="reference-destination-logstore"/>.</para>
    <synopsis>Declaration:
        logstore(filename options());</synopsis>
    <example xml:id="example-destination-logstore">
        <title>Using the logstore() driver</title>
        <para>A simple example saving and compressing log messages.</para>
        <synopsis>destination d_logstore { logstore("/var/log/messages.lgs" compress(5) ); };</synopsis>
        <xi:include href="../../common/wnt/note-windows-filenames.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <para>A more detailed example that encrypts messages, modifies the parameters for closing chunks, and sets file privileges.</para>
        <synopsis>destination d_logstore { logstore("/var/log/messages-logstore.lgs"
encrypt_certificate("/opt/syslog-ng/etc/syslog-ng/keys/10-100-20-40/public-certificate-of-the-server.pem")
owner("balabit")
group("balabit")
perm(0777)
); };</synopsis>
        <para>The URL to the Timestamping Authority and if needed, the OID of the timestamping policy can be set as global options, or also per logstore destination. The following example specifies the URL and the OID as global options:</para>
        <synopsis>options {
        timestamp_url("http://10.50.50.50:8080/");
        timestamp_policy("0.4.0.2023.1.1");
};</synopsis>
    </example>
    <note>
        <para>When using the <parameter>logstore()</parameter> destination, update the configuration of your log rotation program to rotate these files. Otherwise, the log files can become very large.</para>
    </note>
    <warning>
        <para>Since the state of each created file must be tracked by syslog-ng, it consumes some memory for each file. If no new messages are written to a file within 60 seconds (controlled by the <parameter>time_reap()</parameter> global option), it is closed, and its state is freed. </para>
        <para>Exploiting this, a DoS attack can be mounted against the system. If the number of possible destination files and its needed memory is more than the amount available on the syslog-ng server.</para>
        <para>The most suspicious macro is <parameter>${PROGRAM}</parameter>, where the number of possible variations is rather high. Do not use the <parameter>${PROGRAM}</parameter> macro in insecure environments.</para>
    </warning>
    <section xml:id="logstore-display-contents">
        <title>Displaying the contents of logstore files</title>
        <para>To display the contents of a logstore file, use the <command>lgstool</command> (formerly called <command>logcat</command>) command supplied with syslog-ng, for example <command>lgstool cat /var/log/messages.lgs</command>. Log messages available in the journal file of the logstore (but not yet written to the logstore file itself) are displayed as well.</para>
        <indexterm>
            <primary>logcat</primary>
        </indexterm>
        <indexterm>
            <primary>lgstool</primary>
        </indexterm>
        <para>To display the contents of encrypted log files, specify the private key of the certificate used to encrypt the file, for example <command>lgstool cat -k private.key /var/log/messages.lgs</command>. The contents of the file are sent to the standard output, so it is possible to use <command>grep</command> and other tools to find particular log messages, for example <command>lgstool cat /var/log/messages.lgs |grep 192.168.1.1</command>. For further details, see <xref linkend="lgstool.1"/>.</para>
        <tip>
            <para>The <command>lgstool</command> utility is available for Microsoft Windows operating systems at the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.balabit.com/network-security/syslog-ng/central-syslog-server/upgrades/">&product; Download Page</link>.</para>
        </tip>
        <warning>
            <para>For files that are in use by syslog-ng, the last chunk that is open cannot be read.</para>
            <!--
            <para>If the computer running &product; crashes, an unclosed chunk remains at the end of the logstore file. This chunk is marked as broken, its data stays there but is not shown by <command>lgstool</command>.</para>
-->
        </warning>
    </section>
    <section xml:id="concepts-logstore-journal">
        <title>Journal files</title>
        <indexterm>
            <primary>journal files</primary>
        </indexterm>
        <para>Starting with &product; 3.2, &abbrev; processes log messages into a journal file before writing them to the logstore file. That way logstore files are consistent even if &abbrev; crashes unexpectedly, avoiding losing messages. Note that this does not protect against losing messages if the operating system crashes.</para>
        <para>A journal file is automatically created for every logstore file that &abbrev; opens. A journal file consists of journal blocks which store the log messages. When a journal block fills up with messages, &abbrev; writes the entire block into the logstore file and starts to reuse the journal block (one journal block becomes one chunk in the logstore file). If the messages cannot be written to the logstore file (for example, because the disk becomes unaccessible, or file operations are slow), messages are put to the next journal block (&abbrev; uses four blocks by default). When all journal blocks become full, &abbrev; will stop processing incoming traffic. &abbrev; starts accepting messages to the logstore file again when the first journal block is successfully written to the logstore file. If &abbrev; receives a HUP or STOP signal, or no new message arrives into the logstore for the period set in the <parameter>time_reap()</parameter> parameter, it writes every journal block to the logstore.</para>
        <para>When &abbrev; is restarted, it automatically processes the journal files to the logstore files, unless a particular logstore file is not part of configuration of &abbrev;. Such orphaned journal files can be processed with the <command>lgstool recover</command> command. For details on processing orphaned journal files, see <xref linkend="lgstool-recover"/>.</para>
        <warning>
            <itemizedlist>
                <listitem>
                    <para>If a particular logstore destination receives messages at a constant but very low message rate (for example, a 100-byte message every 30 seconds), messages do not get written to the logstore file for a long time, because the journal block does not get full, and messages are more frequent than the <parameter>time_reap()</parameter> time. This becomes a problem when using logrotate to rotate the logstore files, because log messages will not be in the files they are expected. To avoid this situation, either use time-based macros in the filenames of the logstore files, or send a HUP signal to &abbrev; right before rotating the logstore files.</para>
                </listitem>
                <listitem>
                    <para>When every block of a journal becomes full and &abbrev; stops processing incoming traffic, <emphasis>it will not read new messages at all</emphasis> until a block is successfully written to the related logstore file. This is in contrast with flow-control, where only messages from the source related to the particular destination are not processed.</para>
                </listitem>
                <listitem>
                    <para>The messages in the journal file are in plain-text format: they are neither encrypted nor compressed. The journal file has the same permission as the logstore, by default, <userinput>root</userinput> privileges are required to access them. Make sure you consider this if you change the permissions of the journal file (owner, group, perm) in the &abbrev; configuration file. </para>
                </listitem>
            </itemizedlist>
        </warning>
        <note>
            <para>Journal files are located in the same folder as the logstore file. The name of the journal file is the same as the logstore file with <filename>.jor</filename> suffix added. For example, the journal file for <filename>messages.lgs</filename> is <filename>messages.lgs.jor</filename>.</para>
        </note>
        <indexterm>
            <primary>memory use of</primary>
            <secondary>logstore journal files</secondary>
        </indexterm>
        <para>The &abbrev; application uses a separate journal file for every logstore file; every journal file is processed by a separate thread. The journal files are mapped into the memory. The journal of an individual logstore file uses up to <userinput>journal_block_size()*journal_block_count()</userinput> memory address, which is 4MB by default. However, if you have several logstore files open in parallel (for example, you are collecting log messages from 500 hosts and storing them in separate files for every host, and the hosts are continuously sending messages) the memory requirements for journaling rise quickly (to ~2GB for the 500 hosts). To limit the memory use of journals, adjust the <link linkend="logstore-option-journal-memory-limit"><parameter>logstore_journal_shmem_threshold()</parameter></link> global option (by default, it is 512 MB).</para>
        <xi:include href="../../common/chunk/option-description-destination-logstore-journal-shmem-threshold.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <warning>
            <para>If you have a large amount of open logstore files in parrallel (for example, you are using the <parameter>${HOST}</parameter> or <parameter>${PROGRAM}</parameter> macros in your filenames) consider lowering the <parameter>journal_block_size()</parameter> to avoid &abbrev; consuming the entire memory of the system.</para>
        </warning>
        <xi:include href="../../common/chunk/example-logstore-memory-threshold.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    </section>
    <section xml:id="reference-destination-logstore">
        <title>logstore() destination options</title>
        <indexterm>
            <primary>destination drivers</primary>
            <secondary><parameter>logstore()</parameter> driver</secondary>
        </indexterm>
        <para>The logstore driver stores log messages in binary files that can be encrypted, compressed, checked for integrity, and timestamped by an external Timestamping Authority (TSA). Otherwise, it is very similar to the <parameter><link linkend="reference-destination-file">file()</link></parameter> destination.</para>
        <xi:include href="../../common/wnt/warning-fd-ulimit.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <xi:include href="../../common/wnt/note-logrotate.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <para>The <parameter>logstore()</parameter> has a single required parameter that specifies the filename that stores the log messages.</para>
        <synopsis>Declaration:
logstore(filename options());</synopsis>
        <para>The <parameter>logstore()</parameter> destination has the following options:</para>
        <!-- FIXME Global options for destinations files should be cleaned up -->
        <simplesect xml:id="destination-logstore-options-cipher">
            <title>cipher()</title>
            <indexterm type="parameter">
                <primary>cipher()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>string</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry><userinput>aes-128-cbc</userinput></entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> Set the cipher method used to encrypt the logstore. The following cipher methods are available: <userinput>aes-128-cbc</userinput>, <userinput>aes-128-cfb</userinput>, <userinput>aes-128-cfb1</userinput>, <userinput>aes-128-cfb8</userinput>, <userinput>aes-128-ecb</userinput>, <userinput>aes-128-ofb </userinput>, <userinput>aes-192-cbc</userinput>, <userinput>aes-192-cfb</userinput>, <userinput>aes-192-cfb1</userinput>, <userinput>aes-192-cfb8</userinput>, <userinput>aes-192-ecb</userinput>, <userinput>aes-192-ofb </userinput>, <userinput>aes-256-cbc</userinput>, <userinput>aes-256-cfb</userinput>, <userinput>aes-256-cfb1</userinput>, <userinput>aes-256-cfb8</userinput>, <userinput>aes-256-ecb</userinput>, <userinput>aes-256-ofb </userinput>, <userinput>aes128 </userinput>, <userinput>aes192 </userinput>, <userinput>aes256</userinput>, <userinput>bf </userinput>, <userinput>bf-cbc </userinput>, <userinput>bf-cfb</userinput>, <userinput>bf-ecb </userinput>, <userinput>bf-ofb </userinput>, <userinput>blowfish</userinput>, <userinput>cast </userinput>, <userinput>cast-cbc </userinput>, <userinput>cast5-cbc </userinput>, <userinput>cast5-cfb</userinput>, <userinput>cast5-ecb</userinput>, <userinput>cast5-ofb </userinput>, <userinput>des</userinput>, <userinput>des-cbc</userinput>, <userinput>des-cfb </userinput>, <userinput>des-cfb1 </userinput>, <userinput>des-cfb8 </userinput>, <userinput>des-ecb </userinput>, <userinput>des-ede</userinput>, <userinput>des-ede-cbc</userinput>, <userinput>des-ede-cfb </userinput>, <userinput>des-ede-ofb</userinput>, <userinput>des-ede3 </userinput>, <userinput>des-ede3-cbc</userinput>, <userinput>des-ede3-cfb</userinput>, <userinput>des-ede3-ofb</userinput>, <userinput>des-ofb </userinput>, <userinput>des3 </userinput>, <userinput>desx </userinput>, <userinput>desx-cbc</userinput>, <userinput>rc2</userinput>, <userinput>rc2-40-cbc </userinput>, <userinput>rc2-64-cbc</userinput>, <userinput>rc2-cbc</userinput>, <userinput>rc2-cfb</userinput>, <userinput>rc2-ecb </userinput>, <userinput>rc2-ofb</userinput>, <userinput>rc4</userinput>, and <userinput>rc4-40</userinput>. By default, syslog-ng PE uses the <userinput>aes-128-cbc</userinput> method.</para>
            <para>Note that the size of the digest hash must be equal to or larger than the key size of the cipher method. For example, to use the <userinput>aes-256-cbc</userinput> cipher method, the digest method must be at least <userinput>SHA-256</userinput>. This option is available in syslog-ng PE 3.1 and later.</para>
        </simplesect>
        <simplesect>
            <title>chunk_size()</title>
            <indexterm type="parameter">
                <primary>chunk_size()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>number</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>128</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> This option is obsolete. Use the <parameter>journal_block_size()</parameter> option instead.</para>
            <para>Size of a logstore chunk in kilobytes. Note that this size refers to the compressed size of the chunk. Also, the gzip library used for compressing the messages has a 32k long buffer; messages may not appear in the actual logfile until this buffer is not filled. Logstore chunks are closed when they reach the specified size, or when the time limit set in <parameter>chunk_time()</parameter> expires.</para>
        </simplesect>
        <simplesect>
            <title>chunk_time()</title>
            <indexterm type="parameter">
                <primary>chunk_time()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>number</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>5</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> This option is obsolete.</para>
            <para>Time limit in seconds: syslog-ng PE closes the chunk if no new messages arrive until the time limit expires. Logstore chunks are closed when the time limit expires, or when they reach the size specified in the <parameter>chunk_size()</parameter> parameter. If the time limit set in the <parameter>time_reap()</parameter> parameter expires, the entire file is closed.</para>
        </simplesect>
        <simplesect>
            <title>compress()</title>
            <indexterm type="parameter">
                <primary>compress()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>number between 0-9</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>3</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> Compression level. <userinput>0</userinput> means uncompressed files, while 1-9 is the compression level used by gzip (<userinput>9</userinput> means the highest but slowest compression, <userinput>3</userinput> is usually a good compromise).</para>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-create-dirs.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect xml:id="destination-logstore-options-digest">
            <title>digest()</title>
            <indexterm type="parameter">
                <primary>digest()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>string</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>SHA-1</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> Set the digest method to use. The following digest methods are available: <userinput>MD2</userinput>, <userinput>MD4</userinput>, <userinput>MD5</userinput>, <userinput>SHA-0 (SHA)</userinput>, <userinput>SHA-1</userinput>, <userinput>RIPEMD-160</userinput>, <userinput>SHA-224</userinput>, <userinput>SHA-256</userinput>, <userinput>SHA-384</userinput>, and <userinput>SHA-512</userinput>. By default, syslog-ng PE uses the <userinput>SHA-1</userinput> method.</para>
            <para>Note that the size of the digest hash must be equal to or larger than the key size of the cipher method. For example, to use the <userinput>aes-256-cbc</userinput> cipher method, the digest method must be at least <userinput>SHA-256</userinput>. This option is available in syslog-ng PE 3.1 and later.</para>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-dir-group.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-dir-owner.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-dir-perm.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <title>encrypt_certificate()</title>
            <indexterm type="parameter">
                <primary>encrypt_certificate()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>filename</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>none</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis>Name of a file, that contains an X.509 certificate (and the public key) in PEM format. The syslog-ng application uses this certificate to encrypt the logstore files which can be decrypted using the private key of the certificate.</para>
        </simplesect>
        <simplesect xml:id="destination-logstore-options-flags">
            <title>flags()</title>
            <indexterm type="parameter">
                <primary>flags()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>serialized</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>empty set</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> Flags influence the behavior of the destination driver.</para>
            <itemizedlist>
                <listitem>
                    <para>The <parameter>serialized</parameter> flag instructs the driver to store the log messages in a serialized format. When using the <command>lgstool</command> utility to display messages from the logstore, the messages can be reformatted with a template only if the <parameter>serialized</parameter> flag has been enabled on the logstore.</para>
                </listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-frac-digits.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-group.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-log-fifo-size.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <title>journal_block_count()</title>
            <indexterm type="parameter">
                <primary>journal_block_count()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>number (1-255)</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>4</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> The number of blocks in the journal file. If set to <userinput>0</userinput>, syslog-ng will set it to the default value (<userinput>4</userinput>). The maximal value is <userinput>255</userinput>; if <parameter>journal_block_count()</parameter> is set higher than 255 syslog-ng will use the maximum value.</para>
            <note>
                <para>By default, journal files are mapped into the memory of the host. To influence the amount of memory addresses used by journal files, see the <link linkend="logstore-option-journal-memory-limit"><parameter>logstore_journal_shmem_threshold()</parameter></link> global option.</para>
            </note>
            <xi:include href="../../common/chunk/example-logstore-journal.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <title>journal_block_size()</title>
            <indexterm type="parameter">
                <primary>journal_block_size()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>number</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>1048576</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> The size of blocks (in bytes) in the journal file. The size of the block must be a multiple of the page size: if not, &abbrev; automatically increases it to the next multiple of the page size. The maximum size of a journal block is 32MB, the minimum size is 256KB. If the value specified as <parameter>journal_block_size()</parameter> is lower than minimum size or higher than the maximum size, &abbrev; will use the minimum or maximum size, respectively.</para>
            <note>
                <itemizedlist>
                    <listitem>
                        <para>At least one journal block for every logstore file open is mapped into the memory. For details on logstore journals, see <xref linkend="concepts-logstore-journal"/>.</para>
                    </listitem>
                    <listitem>
                        <para>The size of the journal block is not equal with the size of logstore chunks, because the records in the logstore file can be encrypted or compressed.</para>
                    </listitem>
                </itemizedlist>
            </note>
            <xi:include href="../../common/chunk/example-logstore-journal.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>

        <!-- Currently not implemented for logstore destinations.
                    <xi:include href="reference-common.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude"
                        xpointer="element(destination-commonoption-log-fifo-size)"/>
                     -->

        <simplesect>
            <xi:include href="../../common/chunk/option-destination-owner.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-perm.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <!-- FIXME uncomment when the B-02983 backlog item is released
        <simplesect>
            <xi:include href="chunks/option-destination-suppress.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>       -->
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-template.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-throttle.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <title>timestamp_freq()</title>
            <indexterm type="parameter">
                <primary>timestamp_freq()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>number in seconds</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>Use global setting.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <xi:include href="../../common/chunk/option-description-destination-logstore-timestamp-freq.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <title>timestamp_policy()</title>
            <indexterm type="parameter">
                <primary>timestamp_policy()</primary>
            </indexterm>
            <indexterm>
                <primary>timestamping</primary>
                <secondary>OID</secondary>
            </indexterm>
            <indexterm>
                <primary>timestamping</primary>
                <secondary>policies</secondary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>string</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry/>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <para><emphasis role="bold">Description:</emphasis> If the Timestamping Server has timestamping policies configured, specify the OID of the policy to use with this parameter. &abbrev; will include this ID in the timestamping requests sent to the TSA. This option is available in syslog-ng PE 3.1 and later.</para>
        </simplesect>
        <simplesect>
            <title>timestamp_url()</title>
            <indexterm type="parameter">
                <primary>timestamp_url()</primary>
            </indexterm>
            <informaltable frame="topbot" colsep="0" rowsep="0">
                <tgroup cols="2">
                    <colspec colnum="1" colwidth="40pt"/>
                    <tbody>
                        <row>
                            <entry>Type: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>string</entry>
                        </row>
                        <row>
                            <entry>Default: <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                            <entry>Use global setting.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
            <xi:include href="../../common/chunk/option-description-destination-logstore-timestamp-url.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-timezone.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
        <simplesect>
            <xi:include href="../../common/chunk/option-destination-ts-format.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </simplesect>
    </section>
</section>
