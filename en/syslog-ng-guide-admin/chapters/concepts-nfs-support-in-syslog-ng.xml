<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
<!ENTITY % entities SYSTEM "../../shared/syslog-ng-entities.ent">
  %entities;]>
<section xml:id="concepts-nfs-support-in-syslog-ng" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>NFS file system for log files</title>
    <para>Using the NFS network file system can lead to problems if NFS connection is not stable, therefore &vendor; does neither recommend nor officially support such scenarios. If you can avoid it, do not store log files on NFS. If the NFS connection is stable and reliable, &abbrev; can read and write files on mounted NFS partitions as a normal file source or destination. Read this section carefully before using &abbrev; and NFS-mounted log files.</para>
    <simplesect xml:id="nfs-risks">
        <title>Risks</title>
        <para>If there is any issue with the NFS connection (for example, connection loss, the NFS server stops), &abbrev; can stop working. These NFS issues can be related to the operating system, and can also vary depending on its patch level and kernel version. The possible effects include the following:</para>
        <itemizedlist>
            <listitem>
                <para>&abbrev; freezes, does not respond, does not process logs, is unable to stop or reload, and you can stop it only using the <command>kill -9</command> command</para>
            </listitem>
            <listitem>
                <para>&abbrev; is not able to start, and hangs during startup</para>
            </listitem>
            <listitem>
                <para>Message loss or message duplication</para>
            </listitem>
            <listitem>
                <para>Message becomes corrupt (it is not lost, but the message or some parts of it contain garbage)</para>
            </listitem>
            <listitem>
                <para>When using the <parameter>logstore()</parameter> destination, the logstore file becomes corrupt</para>
            </listitem>
            <listitem>
                <para>On some RHEL-based systems (possibly depending on the kernel version too), <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://access.redhat.com/solutions/22717">NFS returns NULL characters when reading a file that another process is writing</link> at the very same moment.</para>
            </listitem>
        </itemizedlist>
    </simplesect>
    <simplesect xml:id="nfs-limitations" condition="pe">
        <title>Limitations of using &abbrev; with NFS</title>
        <itemizedlist>
            <listitem>
                <para>Do not use the <parameter>logstore()</parameter> destination to store files on an NFS-mounted partition</para>
            </listitem>
            <listitem>
                <para>To use wildcards in the file source, set the <parameter>force-directory_polling()</parameter> option to <userinput>yes</userinput> to detect newly created files. Note that this option is available only in &abbrev; version 6.0.3 and newer versions of the 6.x branch, and is not yet available in &abbrev; version 7.</para>
            </listitem>
            <listitem>
                <para>Since &vendor; does not officially support scenarios where you use &abbrev; together with NFS, &vendor; will handle support requests and bugs related to such scenarios only if you can reproduce the issue independently from NFS.</para>
            </listitem>
        </itemizedlist>
    </simplesect>
    <simplesect xml:id="nfs-recommendations">
        <title>Recommendations for using NFS with &abbrev;</title>
        <para>If you cannot avoid using NFS with &abbrev; note the following points.</para>
        <itemizedlist>
            <listitem>
                <para>USE at least NFS v4 (or newer if available)</para>
            </listitem>
            <listitem>
                <para>USE the soft mount option (<userinput>-o soft</userinput>) to mount the partition</para>
            </listitem>
            <listitem>
                <para>USE the TCP mount option (<userinput>-o tcp</userinput>) to mount the partition</para>
            </listitem>
            <xi:include href="../../shared/chunk/listitem-nfs-do-not-install.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <listitem>
                <para>DO NOT use logstore on an NFS-mounted partition, it can easily become corrupted</para>
            </listitem>
        </itemizedlist>
    </simplesect>
</section>
