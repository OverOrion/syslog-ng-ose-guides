<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
  %entities;]>
<chapter xml:id="chapter-concepts" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>The concepts of syslog-ng</title>
    <para>This chapter discusses the technical concepts of syslog-ng.</para>
    <section>
        <title>The philosophy of syslog-ng</title>
        <para xml:id="para-philosophy-intro">Typically, syslog-ng is used to manage log messages and implement centralized logging, where the aim is to collect the log messages of several devices on a single, central log server. The different devices &mdash; called syslog-ng clients &mdash; all run syslog-ng, and collect the log messages from the various applications, files, and other <emphasis>sources</emphasis>. The clients send all important log messages to the remote syslog-ng server, which sorts and stores them.</para>
    </section>
    <section xml:id="concepts-logging-with-syslog-ng">
        <title>Logging with syslog-ng</title>
        <indexterm>
            <primary>sources</primary>
        </indexterm>
        <xi:include href="../../common/chunk/intro-concepts.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <procedure xml:id="concepts-route-of-a-message">
            <title>The route of a log message in syslog-ng</title>
            <indexterm>
                <primary>logging procedure</primary>
            </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The following procedure illustrates the route of a log message from its source on the syslog-ng client to its final destination on the central syslog-ng server.</para>
            <figure>
                <title>The route of a log message</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" fileref="logging01.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/logging01.png"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>A device or application sends a log message to a source on the syslog-ng client. For example, an Apache web server running on Linux enters a message into the <filename>/var/log/apache</filename> file.</para>
            </step>
            <step>
                <para>The syslog-ng client running on the web server reads the message from its <filename>/var/log/apache</filename> source.</para>
            </step>
            <step>
                <para>The syslog-ng client processes the first log statement that includes the <filename>/var/log/apache</filename> source.</para>
            </step>
            <step>
                <para>The syslog-ng client performs optional operations (message filtering, parsing, and rewriting) on the message; for example, it compares the message to the filters of the log statement (if any). If the message complies with all filter rules, syslog-ng sends the message to the destinations set in the log statement, for example, to the remote syslog-ng server.</para>
                <warning>
                    <para>Message filtering, parsing, and rewriting is performed in the order that the operations appear in the log statement.</para>
                </warning>
                <note>
                    <para>The syslog-ng client sends a message to <emphasis>all</emphasis> matching destinations by default. As a result, a message may be sent to a destination more than once, if the destination is used in multiple log statements. To prevent such situations, use the <parameter>final</parameter> flag in the destination statements. For details, see <xref linkend="logflags"/>.</para>
                </note>
            </step>
            <step>
                <para>The syslog-ng client processes the next log statement that includes the <filename>/var/log/apache</filename> source, repeating Steps 3-4.</para>
            </step>
            <step>
                <para>The message sent by the syslog-ng client arrives from a source set in the syslog-ng server.</para>
            </step>
            <step>
                <para>The syslog-ng server reads the message from its source and processes the first log statement that includes that source.</para>
            </step>
            <step>
                <para>The syslog-ng server performs optional operations (message filtering, parsing, and rewriting) on the message; for example, it compares the message to the filters of the log statement (if any). If the message complies with all filter rules, syslog-ng sends the message to the destinations set in the log statement.</para>
                <warning>
                    <para>Message filtering, parsing, and rewriting is performed in the order that the operations appear in the log statement.</para>
                </warning>
            </step>
            <step>
                <para>The syslog-ng server processes the next log statement, repeating Steps 7-9.</para>
                <note>
                    <para>The syslog-ng application can stop reading messages from its sources if the destinations cannot process the sent messages. This feature is called flow-control and is detailed in <xref linkend="concepts-flow-control"/>.</para>
                </note>
            </step>
        </procedure>
    </section>
    <section xml:id="concepts-modes-of-operation">
        <title>Modes of operation</title>
        <indexterm>
            <primary>modes of operation</primary>
        </indexterm>
        <para xml:id="para-modes-of-operation-intro">The &product; application has three <phrase condition="pe">distinct </phrase><phrase condition="ose">typical </phrase>operation scenarios: <emphasis>Client</emphasis>, <emphasis>Server</emphasis>, and <emphasis>Relay</emphasis>.<phrase condition="pe"> The &abbrev; application running on a host determines the mode of operation automatically based on the license and the configuration file.</phrase></para>
        <section xml:id="concepts-client-mode">
            <title>Client mode</title>
            <indexterm>
                <primary>client mode</primary>
            </indexterm>
            <indexterm>
                <primary>modes of operation</primary>
                <secondary>client mode</secondary>
            </indexterm>
            <figure>
                <title>Client-mode operation</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" fileref="client_mode01.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/client_mode01.png"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <para xml:id="para-modes-of-operation-client">In client mode, syslog-ng collects the local logs generated by the host and forwards them through a network connection to the central syslog-ng server or to a relay. Clients often also log the messages locally into files.</para>
            <para condition="pe">No license file is required to run syslog-ng in client mode.</para>
        </section>
        <section xml:id="concepts-relay-mode">
            <title>Relay mode</title>
            <indexterm>
                <primary>relay mode</primary>
            </indexterm>
            <indexterm>
                <primary>modes of operation</primary>
                <secondary>relay mode</secondary>
            </indexterm>
            <figure>
                <title>Relay-mode operation</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" fileref="relay_mode01.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/relay_mode01.png" scale="75"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <para xml:id="para-modes-of-operation-relay">In relay mode, syslog-ng receives logs through the network from syslog-ng clients and forwards them to the central syslog-ng server using a network connection. Relays also log the messages from the relay host into a local file, or forward these messages to the central syslog-ng server.</para>
            <para condition="pe">No license file is required to run syslog-ng in relay mode.</para>
        </section>
        <section xml:id="concepts-server-mode">
            <title>Server mode</title>
            <indexterm>
                <primary>server mode</primary>
            </indexterm>
            <indexterm>
                <primary>modes of operation</primary>
                <secondary>server mode</secondary>
            </indexterm>
            <figure>
                <title>Server-mode operation</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" fileref="server_mode01.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&imgroot;/server_mode01.png"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <para xml:id="para-modes-of-operation-server">In server mode, syslog-ng acts as a central log-collecting server. It receives messages from syslog-ng clients and relays over the network, and stores them locally in files, or passes them to other applications, for example log analyzers.</para>
            <indexterm condition="pe">
                <primary>license</primary>
            </indexterm>
            <para condition="pe">Running &product; in server mode requires a license file. The license determines how many individual hosts can connect to the server. For details on how &abbrev; calculates the number of hosts, see <xref linkend="concepts-licensing"/>.</para>
        </section>
    </section>
    <section xml:id="msgroute">
        <title>Global objects</title>
        <indexterm>
            <primary>global objects</primary>
        </indexterm>
        <para>The syslog-ng application uses the following objects:</para>
        <itemizedlist>
            <listitem>
                <indexterm>
                    <primary>source drivers</primary>
                </indexterm>
                <para><emphasis>Source driver</emphasis>: A communication method used to receive log messages. For example, syslog-ng can receive messages from a remote host via TCP/IP, or read the messages of a local application from a file. For details on source drivers, see <xref linkend="chapter-sources"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>sources</primary>
                </indexterm>
                <para><emphasis>Source</emphasis>: A named collection of configured source drivers.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>destination drivers</primary>
                </indexterm>
                <para><emphasis>Destination driver</emphasis>: A communication method used to send log messages. For example, syslog-ng can send messages to a remote host via TCP/IP, or write the messages into a file or database. For details on destination drivers, see <xref linkend="chapter-destinations"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>destinations</primary>
                </indexterm>
                <para><emphasis>Destination</emphasis>: A named collection of configured destination drivers.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>filters</primary>
                </indexterm>
                <para><emphasis>Filter</emphasis>: An expression to select messages. For example, a simple filter can select the messages received from a specific host. For details, see <xref linkend="customizing-message-format"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>macros</primary>
                </indexterm>
                <para><emphasis>Macro</emphasis>: An identifier that refers to a part of the log message. For example, the <parameter>${HOST}</parameter> macro returns the name of the host that sent the message. Macros are often used in templates and filenames. For details, see <xref linkend="customizing-message-format"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>parsers</primary>
                </indexterm>
                <para><emphasis>Parser</emphasis>: Parsers are objects that parse the incoming messages, or parts of a message. For example, the <parameter>csv-parser()</parameter> can segment messages into separate columns at a predefined separator character (for example a comma). Every column has a unique name that can be used as a macro. For details, see <xref linkend="chapter-parsers"/> and <xref linkend="chapter-patterndb"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>rewrite rules</primary>
                </indexterm>
                <para><emphasis>Rewrite rule</emphasis>: A rule modifies a part of the message, for example, replaces a string, or sets a field to a specified value. For details, see <xref linkend="modifying-messages"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>log statements</primary>
                </indexterm>
                <para><emphasis>Log paths</emphasis>: A combination of sources, destinations, and other objects like filters, parsers, and rewrite rules. The syslog-ng application sends messages arriving from the sources of the log paths to the defined destinations, and performs filtering, parsing, and rewriting of the messages. Log paths are also called log statements. Log statements can include other (embedded) log statements and junctions to create complex log paths. For details, see <xref linkend="chapter-routing-filters"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>templates</primary>
                </indexterm>
                <para><emphasis>Template</emphasis>: A template is a set of macros that can be used to restructure log messages or automatically generate file names. For example, a template can add the hostname and the date to the beginning of every log message. For details, see <xref linkend="customizing-message-format"/>.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>options</primary>
                </indexterm>
                <para><emphasis>Option</emphasis>: Options set global parameters of syslog-ng, like the parameters of name resolution and timezone handling. For details, see <xref linkend="chapter-global-options"/>.</para>
            </listitem>
        </itemizedlist>
        <para>For details on the above objects, see <xref linkend="configuration-syntax"/>.</para>
    </section>
    <section xml:id="timezone-handling">
        <title>Timezones and daylight saving</title>
        <indexterm>
            <primary>daylight saving changes</primary>
        </indexterm>
        <para>The syslog-ng application receives the timezone and daylight saving information from the operating system it is installed on. If the operating system handles daylight saving correctly, so does syslog-ng.</para>
        <indexterm>
            <primary>timezones</primary>
        </indexterm>
        <para>The syslog-ng application supports messages originating from different timezones. The original syslog protocol (RFC3164) does not include timezone information, but syslog-ng provides a solution by extending the syslog protocol to include the timezone in the log messages. The syslog-ng application also enables administrators to supply timezone information for legacy devices which do not support the protocol extension.</para>
        <procedure xml:id="procedure-associating-timezone">
            <title>How &abbrev; assigns timezone to the message</title>
            <para>When &abbrev; receives a message, it assigns timezone information to the message using the following algorithm.</para>
            <step>
                <para>The sender application (for example the syslog-ng client) or host specifies the timezone of the messages. If the incoming message includes a timezone it is associated with the message. Otherwise, the local timezone is assumed.</para>
            </step>
            <step>
                <para>Specify the <parameter>time-zone()</parameter> parameter for the source driver that reads the message. This timezone will be associated with the messages only if no timezone is specified within the message itself. Each source defaults to the value of the <link linkend="global-option-recv-time-zone"> <parameter>recv-time-zone()</parameter> </link> global option. It is not possible to override only the timezone information of the incoming message; but setting the <parameter>keep-timestamp()</parameter> option to <userinput>no</userinput> allows &abbrev; to replace the full timestamp (timezone included) with the time the message was received.</para>
                <note>
                    <para>When processing a message that does not contain timezone information, the &abbrev; application will use the timezone and daylight-saving that was effective when the timestamp was generated. For example, the current time is <userinput>2011-03-11</userinput> (March 11, 2011) in the <userinput>EU/Budapest</userinput> timezone. When daylight-saving is active (summertime), the offset is <userinput>+02:00</userinput>. When daylight-saving is inactive (wintertime) the timezone offset is <userinput>+01:00</userinput>. If the timestamp of an incoming message is <userinput>2011-01-01</userinput>, the timezone associated with the message will be <userinput>+01:00</userinput>, but the timestamp will be converted, because 2011-01-01 meant winter time when daylight saving is not active but the current timezone is <userinput>+02:00</userinput>.</para>
                </note>
            </step>
            <step>
                <para>Specify the timezone in the destination driver using the <parameter>time-zone()</parameter> parameter. Each destination driver might have an associated timezone value; syslog-ng converts message timestamps to this timezone before sending the message to its destination (file or network socket). Each destination defaults to the value of the <link linkend="global-option-send-time-zone"> <parameter>send-time-zone()</parameter> </link> global option.</para>
                <note>
                    <para>A message can be sent to multiple destination zones. The syslog-ng application converts the timezone information properly for every individual destination zone.</para>
                </note>
                <warning>
                    <para>If &abbrev; sends the message is to the destination using the legacy-syslog protocol (RFC3164) which does not support timezone information in its timestamps, the timezone information cannot be encapsulated into the sent timestamp, so &abbrev; will convert the hour:min values based on the explicitly specified timezone.</para>
                </warning>
            </step>
            <step>
                <para>If the timezone is not specified, local timezone is used.</para>
            </step>
            <step>
                <para>When macro expansions are used in the destination filenames, the local timezone is used. (Also, if the timestamp of the received message does not contain the year of the message, &abbrev; uses the local year.)</para>
            </step>
        </procedure>
        <section xml:id="example-timezones">
            <title>A note on timezones and timestamps</title>
            <indexterm>
                <primary>timestamp</primary>
            </indexterm>
            <indexterm>
                <primary>timezones</primary>
            </indexterm>
            <indexterm>
                <primary>UTC</primary>
            </indexterm>
            <indexterm>
                <primary>Coordinated Universal Time</primary>
            </indexterm>
            <para>If the clients run syslog-ng, then use the ISO timestamp, because it includes timezone information. That way you do not need to adjust the <parameter>recv-time-zone()</parameter> parameter of syslog-ng.</para>
            <para>If you want syslog-ng to output timestamps in Unix (POSIX) time format, use the <parameter>S_UNIXTIME</parameter> and <parameter>R_UNIXTIME</parameter> macros. You do not need to change any of the timezone related parameters, because the timestamp information of incoming messages is converted to Unix time internally, and Unix time is a timezone-independent time representation. (Actually, Unix time measures the number of seconds elapsed since midnight of Coordinated Universal Time (UTC) January 1, 1970, but does not count leap seconds.)</para>
        </section>
    </section>
    <section xml:id="concepts-licensing" condition="ose">
        <title>The license of &abbrev;</title>
        <para>Starting with version 3.2, the &product; application is licensed under a combined LGPL+GPL license. The core of &abbrev; is licensed under the GNU Lesser General Public License Version 2.1 license, while the rest of the codebase is licensed under the GNU General Public License Version 2 license.</para>
        <note>
            <para>Practically, the code stored under the <filename>lib</filename> directory of the source code package is under LGPL, the rest is GPL.</para>
        </note>
        <para>For details about the LGPL and GPL licenses, see <xref linkend="lgpl"/> and <xref linkend="gpl"/>, respectively.</para>
    </section>
    <section xml:id="concepts-high-availability">
        <title>High availability support</title>
        <indexterm>
            <primary>fail-over</primary>
        </indexterm>
        <para>Multiple syslog-ng servers can be run in fail-over mode. The syslog-ng application does not include any internal support for this, as clustering support must be implemented on the operating system level. A tool that can be used to create UNIX clusters is Heartbeat (for details, see <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.linux-ha.org/wiki/Main_Page/">this page</link>).</para>
        <para condition="pe">Starting with &product; version 3.2, &abbrev; clients can be configured to send the log messages to failover servers in case the primary syslog server becomes unaccessible. For details on configuring failover servers, see the description of the <parameter>failover-servers()</parameter> destination option in <xref linkend="chapter-destinations"/>.</para>
    </section>
    <section xml:id="concepts-message-structure">
        <title>The structure of a log message</title>
        <indexterm>
            <primary>log messages, structure</primary>
        </indexterm>
        <para>The following sections describe the structure of log messages. Currently there are two standard syslog message formats:</para>
        <itemizedlist>
            <listitem>
                <para>The old standard described in RFC 3164 (also called the BSD-syslog or the legacy-syslog protocol): see <xref linkend="concepts-message-bsdsyslog"/></para>
            </listitem>
            <listitem>
                <para>The new standard described in RFC 5424 (also called the IETF-syslog protocol): see <xref linkend="concepts-message-ietfsyslog"/></para>
            </listitem>
            <listitem>
                <para>How messages are represented in &abbrev;: see <xref linkend="concepts-message-representation"/>.</para>
            </listitem>
        </itemizedlist>
        <section xml:id="concepts-message-bsdsyslog">
            <title>BSD-syslog or legacy-syslog messages</title>
            <indexterm>
                <primary>log messages, structure</primary>
                <secondary>BSD-syslog protocol</secondary>
            </indexterm>
            <indexterm>
                <primary>log messages, structure</primary>
                <secondary>legacy-syslog protocol</secondary>
            </indexterm>
            <indexterm>
                <primary>log messages, structure</primary>
                <secondary>RFC 3164</secondary>
            </indexterm>
            <para>This section describes the format of a syslog message, according to the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://tools.ietf.org/search/rfc3164">legacy-syslog or BSD-syslog protocol</link>. A syslog message consists of the following parts:</para>
            <itemizedlist>
                <listitem>
                    <para><parameter> <link linkend="bsdsyslog-pri">PRI</link> </parameter></para>
                </listitem>
                <listitem>
                    <para><parameter> <link linkend="bsdsyslog-header">HEADER</link> </parameter></para>
                </listitem>
                <listitem>
                    <para><parameter> <link linkend="bsdsyslog-msg">MSG</link> </parameter></para>
                </listitem>
            </itemizedlist>
            <para>The total message cannot be longer than 1024 bytes.</para>
            <para>The following is a sample syslog message: <emphasis>&lt;133&gt;Feb 25 14:09:07 webserver syslogd: restart</emphasis>. The message corresponds to the following format: <emphasis>&lt;priority&gt;timestamp hostname application: message</emphasis>. The different parts of the message are explained in the following sections.</para>
            <note>
                <para>The syslog-ng application supports longer messages as well. For details, see the <parameter>log-msg-size()</parameter> option in <xref linkend="reference-options"/>. However, it is not recommended to enable messages larger than the packet size when using UDP destinations.</para>
            </note>
            <section xml:id="bsdsyslog-pri">
                <title>The PRI message part</title>
                <para>The PRI part of the syslog message (known as Priority value) represents the Facility and Severity of the message. Facility represents the part of the system sending the message, while severity marks its importance. The Priority value is calculated by first multiplying the Facility number by 8 and then adding the numerical value of the Severity. The possible facility and severity values are presented below.</para>
                <note>
                    <para>Facility codes may slightly vary between different platforms. The syslog-ng application accepts facility codes as numerical values as well.</para>
                </note>
                <table>
                    <title>syslog Message Facilities</title>
<?dbfo keep-together="auto" ?>
                    <indexterm>
                        <primary>facilities</primary>
                    </indexterm>
                    <indexterm>
                        <primary>message</primary>
                        <secondary>facilities</secondary>
                    </indexterm>
                    <tgroup cols="2">
                        <thead>
                            <row>
                                <entry>Numerical Code</entry>
                                <entry>Facility</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>0</entry>
                                <entry>kernel messages</entry>
                            </row>
                            <row>
                                <entry>1</entry>
                                <entry>user-level messages</entry>
                            </row>
                            <row>
                                <entry>2</entry>
                                <entry>mail system</entry>
                            </row>
                            <row>
                                <entry>3</entry>
                                <entry>system daemons</entry>
                            </row>
                            <row>
                                <entry>4</entry>
                                <entry>security/authorization messages</entry>
                            </row>
                            <row>
                                <entry>5</entry>
                                <entry>messages generated internally by syslogd</entry>
                            </row>
                            <row>
                                <entry>6</entry>
                                <entry>line printer subsystem</entry>
                            </row>
                            <row>
                                <entry>7</entry>
                                <entry>network news subsystem</entry>
                            </row>
                            <row>
                                <entry>8</entry>
                                <entry>UUCP subsystem</entry>
                            </row>
                            <row>
                                <entry>9</entry>
                                <entry>clock daemon</entry>
                            </row>
                            <row>
                                <entry>10</entry>
                                <entry>security/authorization messages</entry>
                            </row>
                            <row>
                                <entry>11</entry>
                                <entry>FTP daemon</entry>
                            </row>
                            <row>
                                <entry>12</entry>
                                <entry>NTP subsystem</entry>
                            </row>
                            <row>
                                <entry>13</entry>
                                <entry>log audit</entry>
                            </row>
                            <row>
                                <entry>14</entry>
                                <entry>log alert</entry>
                            </row>
                            <row>
                                <entry>15</entry>
                                <entry>clock daemon</entry>
                            </row>
                            <row>
                                <entry>16-23</entry>
                                <entry>locally used facilities (local0-local7)</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>The following table lists the severity values.</para>
                <table>
                    <title>syslog Message Severities</title>
                    <tgroup cols="2">
                        <thead>
                            <row>
                                <entry>Numerical Code</entry>
                                <entry>Severity</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>0</entry>
                                <entry>Emergency: system is unusable</entry>
                            </row>
                            <row>
                                <entry>1</entry>
                                <entry>Alert: action must be taken immediately</entry>
                            </row>
                            <row>
                                <entry>2</entry>
                                <entry>Critical: critical conditions</entry>
                            </row>
                            <row>
                                <entry>3</entry>
                                <entry>Error: error conditions</entry>
                            </row>
                            <row>
                                <entry>4</entry>
                                <entry>Warning: warning conditions</entry>
                            </row>
                            <row>
                                <entry>5</entry>
                                <entry>Notice: normal but significant condition</entry>
                            </row>
                            <row>
                                <entry>6</entry>
                                <entry>Informational: informational messages</entry>
                            </row>
                            <row>
                                <entry>7</entry>
                                <entry>Debug: debug-level messages</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </section>
            <section xml:id="bsdsyslog-header">
                <title>The HEADER message part</title>
                <indexterm>
                    <primary>timestamp</primary>
                </indexterm>
                <indexterm>
                    <primary>local time</primary>
                </indexterm>
                <para>The HEADER part contains a timestamp and the hostname (without the domain name) or the IP address of the device. The timestamp field is the local time in the <emphasis>Mmm dd hh:mm:ss</emphasis> format, where:</para>
                <itemizedlist>
                    <listitem>
                        <para><emphasis>Mmm</emphasis> is the English abbreviation of the month: Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>dd</emphasis> is the day of the month on two digits. If the day of the month is less than 10, the first digit is replaced with a space. (For example <emphasis>Aug 7</emphasis>.)</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>hh:mm:ss</emphasis> is the local time. The hour (hh) is represented in a 24-hour format. Valid entries are between 00 and 23, inclusive. The minute (mm) and second (ss) entries are between 00 and 59 inclusive.</para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>The syslog-ng application supports other timestamp formats as well, like ISO, or the PIX extended format. For details, see the <parameter>ts-format()</parameter> option in <xref linkend="reference-options"/>.</para>
                </note>
            </section>
            <section xml:id="bsdsyslog-msg">
                <title>The MSG message part</title>
                <para>The MSG part contains the name of the program or process that generated the message, and the text of the message itself. The MSG part is usually in the following format: <emphasis>program[pid]: message text</emphasis>.</para>
            </section>
        </section>
        <section xml:id="concepts-message-ietfsyslog">
            <title>IETF-syslog messages</title>
            <indexterm>
                <primary>log messages, structure</primary>
                <secondary>IETF-syslog protocol</secondary>
            </indexterm>
            <indexterm>
                <primary>log messages, structure</primary>
                <secondary>RFC 5424</secondary>
            </indexterm>
            <para>This section describes the format of a syslog message, according to the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://tools.ietf.org/html/rfc5424">IETF-syslog protocol</link>. A syslog message consists of the following parts:</para>
            <itemizedlist>
                <listitem>
                    <para><parameter> <link linkend="ietfsyslog-header">HEADER</link></parameter> (includes the <parameter><link linkend="ietfsyslog-pri">PRI</link></parameter> as well)</para>
                </listitem>
                <listitem>
                    <para><parameter> <link linkend="ietfsyslog-structureddata">STRUCTURED-DATA</link> </parameter></para>
                </listitem>
                <listitem>
                    <para><parameter> <link linkend="ietfsyslog-msg">MSG</link> </parameter></para>
                </listitem>
            </itemizedlist>
<!--FIXME update
                <para>The total message must be shorter than 1024 bytes.</para>
            <note>
                <para>The syslog-ng application supports longer messages as well. For details, see
                    the <parameter>log-msg-size()</parameter> option in <xref
                        linkend="reference-options"/>. However, it is not recommended to enable
                    messages larger than the packet size when using UDP destinations.</para>
            </note>
            -->
            <para>The following is a sample syslog message:<footnote>
                <para>Source: https://tools.ietf.org/html/rfc5424</para>
            </footnote></para>
            <synopsis>&lt;34&gt;1 2003-10-11T22:14:15.003Z mymachine.example.com su - ID47 - BOM'su root' failed for lonvick on /dev/pts/8</synopsis>
            <para>The message corresponds to the following format:</para>
            <synopsis>&lt;priority&gt;VERSION ISOTIMESTAMP HOSTNAME APPLICATION PID MESSAGEID STRUCTURED-DATA MSG</synopsis>
            <para>In this example, the Facility has the value of 4, severity is 2, so PRI is 34. The VERSION is 1. The message was created on 11 October 2003 at 10:14:15pm UTC, 3 milliseconds into the next second. The message originated from a host that identifies itself as "mymachine.example.com". The APP-NAME is "su" and the PROCID is unknown. The MSGID is "ID47". The MSG is "'su root' failed for lonvick...", encoded in UTF-8. The encoding is defined by the<glossterm linkend="glossary-bom" role="underline">BOM</glossterm><footnote>
                <xi:include href="../../common/chunk/para-bom-definition.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            </footnote>. There is no STRUCTURED-DATA present in the message, this is indicated by "-" in the STRUCTURED-DATA field. The MSG is "'su root' failed for lonvick...".</para>
            <para>The HEADER part of the message must be in plain ASCII format, the parameter values of the STRUCTURED-DATA part must be in UTF-8, while the MSG part should be in UTF-8. The different parts of the message are explained in the following sections.</para>
            <section xml:id="ietfsyslog-pri">
                <title>The PRI message part</title>
                <para>The PRI part of the syslog message (known as Priority value) represents the Facility and Severity of the message. Facility represents the part of the system sending the message, while severity marks its importance. The Priority value is calculated by first multiplying the Facility number by 8 and then adding the numerical value of the Severity. The possible facility and severity values are presented below.</para>
                <note>
                    <para>Facility codes may slightly vary between different platforms. The syslog-ng application accepts facility codes as numerical values as well.</para>
                </note>
                <table>
                    <title>syslog Message Facilities</title>
<?dbfo keep-together="auto" ?>
                    <indexterm>
                        <primary>facilities</primary>
                    </indexterm>
                    <indexterm>
                        <primary>message</primary>
                        <secondary>facilities</secondary>
                    </indexterm>
                    <tgroup cols="2">
                        <thead>
                            <row>
                                <entry>Numerical Code</entry>
                                <entry>Facility</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>0</entry>
                                <entry>kernel messages</entry>
                            </row>
                            <row>
                                <entry>1</entry>
                                <entry>user-level messages</entry>
                            </row>
                            <row>
                                <entry>2</entry>
                                <entry>mail system</entry>
                            </row>
                            <row>
                                <entry>3</entry>
                                <entry>system daemons</entry>
                            </row>
                            <row>
                                <entry>4</entry>
                                <entry>security/authorization messages</entry>
                            </row>
                            <row>
                                <entry>5</entry>
                                <entry>messages generated internally by syslogd</entry>
                            </row>
                            <row>
                                <entry>6</entry>
                                <entry>line printer subsystem</entry>
                            </row>
                            <row>
                                <entry>7</entry>
                                <entry>network news subsystem</entry>
                            </row>
                            <row>
                                <entry>8</entry>
                                <entry>UUCP subsystem</entry>
                            </row>
                            <row>
                                <entry>9</entry>
                                <entry>clock daemon</entry>
                            </row>
                            <row>
                                <entry>10</entry>
                                <entry>security/authorization messages</entry>
                            </row>
                            <row>
                                <entry>11</entry>
                                <entry>FTP daemon</entry>
                            </row>
                            <row>
                                <entry>12</entry>
                                <entry>NTP subsystem</entry>
                            </row>
                            <row>
                                <entry>13</entry>
                                <entry>log audit</entry>
                            </row>
                            <row>
                                <entry>14</entry>
                                <entry>log alert</entry>
                            </row>
                            <row>
                                <entry>15</entry>
                                <entry>clock daemon</entry>
                            </row>
                            <row>
                                <entry>16-23</entry>
                                <entry>locally used facilities (local0-local7)</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>The following table lists the severity values.</para>
                <table>
                    <title>syslog Message Severities</title>
                    <tgroup cols="2">
                        <thead>
                            <row>
                                <entry>Numerical Code</entry>
                                <entry>Severity</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>0</entry>
                                <entry>Emergency: system is unusable</entry>
                            </row>
                            <row>
                                <entry>1</entry>
                                <entry>Alert: action must be taken immediately</entry>
                            </row>
                            <row>
                                <entry>2</entry>
                                <entry>Critical: critical conditions</entry>
                            </row>
                            <row>
                                <entry>3</entry>
                                <entry>Error: error conditions</entry>
                            </row>
                            <row>
                                <entry>4</entry>
                                <entry>Warning: warning conditions</entry>
                            </row>
                            <row>
                                <entry>5</entry>
                                <entry>Notice: normal but significant condition</entry>
                            </row>
                            <row>
                                <entry>6</entry>
                                <entry>Informational: informational messages</entry>
                            </row>
                            <row>
                                <entry>7</entry>
                                <entry>Debug: debug-level messages</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </section>
            <section xml:id="ietfsyslog-header">
                <title>The HEADER message part</title>
                <indexterm>
                    <primary>timestamp</primary>
                </indexterm>
                <indexterm>
                    <primary>local time</primary>
                </indexterm>
                <para>The HEADER part contains the following elements:</para>
                <itemizedlist>
                    <listitem>
                        <para><emphasis>VERSION</emphasis>: Version number of the syslog protocol standard. Currently this can only be <userinput>1</userinput>.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>ISOTIMESTAMP</emphasis>: The time when the message was generated in the ISO 8601 compatible standard timestamp format (yyyy-mm-ddThh:mm:ss+-ZONE), for example: <userinput>2006-06-13T15:58:00.123+01:00</userinput>.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>HOSTNAME</emphasis>: The machine that originally sent the message.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>APPLICATION</emphasis>: The device or application that generated the message</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>PID</emphasis>: The process name or process ID of the syslog application that sent the message. It is not necessarily the process ID of the application that generated the message.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>MESSAGEID</emphasis>: The ID number of the message.</para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>The syslog-ng application supports other timestamp formats as well, like ISO, or the PIX extended format. The timestamp used in the IETF-syslog protocol is derived from RFC3339, which is based on ISO8601. For details, see the <parameter>ts-format()</parameter> option in <xref linkend="reference-options"/>.</para>
                </note>
                <para>The &abbrev; application will truncate the following fields:</para>
                <itemizedlist>
                    <listitem>
                        <para>If <emphasis>APP-NAME</emphasis> is longer than 48 characters it will be truncated to 48 characters.</para>
                    </listitem>
                    <listitem>
                        <para>If <emphasis>PROC-ID</emphasis> is longer than 128 characters it will be truncated to 128 characters.</para>
                    </listitem>
                    <listitem>
                        <para>If <emphasis>MSGID</emphasis> is longer than 32 characters it will be truncated to 32 characters.</para>
                    </listitem>
                    <listitem>
                        <para>If <emphasis>HOSTNAME</emphasis> is longer than 255 characters it will be truncated to 255 characters.</para>
                    </listitem>
                </itemizedlist>
            </section>
            <section xml:id="ietfsyslog-structureddata">
                <title>The STRUCTURED-DATA message part</title>
                <para>The STRUCTURED-DATA message part may contain meta- information about the syslog message, or application-specific information such as traffic counters or IP addresses. STRUCTURED-DATA consists of data blocks enclosed in brackets (<emphasis>[]</emphasis>). Every block includes the ID of the block, and one or more <emphasis>name=value</emphasis> pairs. The syslog-ng application automatically parses the STRUCTURED-DATA part of syslog messages, which can be referenced in macros (for details, see <xref linkend="reference-macros"/>). An example STRUCTURED-DATA block looks like:</para>
                <synopsis>[exampleSDID@0 iut="3" eventSource="Application" eventID="1011"][examplePriority@0 class="high"]</synopsis>
            </section>
            <section xml:id="ietfsyslog-msg">
                <title>The MSG message part</title>
                <para>The MSG part contains the text of the message itself. The encoding of the text must be UTF-8 if the<glossterm linkend="glossary-bom" role="underline">BOM</glossterm><footnote>
                    <xi:include href="../../common/chunk/para-bom-definition.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </footnote>character is present in the message. If the message does not contain the BOM character, the encoding is treated as unknown. Usually messages arriving from legacy sources do not include the BOM character. CRLF characters will not be removed from the message.</para>
            </section>
        </section>
    </section>
    <section xml:id="concepts-message-representation">
        <title>Message representation in &abbrev;</title>
        <indexterm>
            <primary>log messages, representation</primary>
        </indexterm>
        <para>When the &abbrev; application receives a message, it automatically parses the message. The &abbrev; application can automatically parse log messages that conform to the RFC3164 (BSD or legacy-syslog) or the RFC5424 (IETF-syslog) message formats. If &abbrev; cannot parse a message, it results in an error.</para>
        <tip>
            <para>In case you need to relay messages that cannot be parsed without any modifications or changes, use the <parameter>flags(no-parse)</parameter> option in the source definition, and a template containing only the <parameter>${MSG}</parameter> macro in the destination definition.</para>
        </tip>
        <para>A parsed message has the following parts.</para>
        <itemizedlist>
            <listitem>
                <formalpara>
                    <title>Timestamps</title>
                    <para>Two timestamps are associated with every message: one is the timestamp contained within the message (that is, when the sender sent the message), the other is the time when &abbrev; has actually received the message.</para>
                </formalpara>
            </listitem>
            <listitem>
                <formalpara>
                    <title>Severity</title>
                    <para>The severity of the message.</para>
                </formalpara>
            </listitem>
            <listitem>
                <formalpara>
                    <title>Facility</title>
                    <para>The facility that sent the message.</para>
                </formalpara>
            </listitem>
            <listitem>
                <formalpara>
                    <title>Tags</title>
                    <para>Custom text labels added to the message that are mainly used for filtering. None of the current message transport protocols adds tags to the log messages. Tags can be added to the log message only within &abbrev;. The &abbrev; application automatically adds the id of the source as a tag to the incoming messages. Other tags can be added to the message by the pattern database, or using the <parameter>tags()</parameter> option of the source.</para>
                </formalpara>
            </listitem>
            <listitem>
                <formalpara>
                    <title>IP address of the sender</title>
                    <para>The IP address of the host that sent the message. Note that the IP address of the sender is a hard macro and cannot be modified within &abbrev; but the associated hostname can be modified, for example, using rewrite rules.</para>
<!-- FIXME is this the original sender, or the last relay? -->
                </formalpara>
            </listitem>
            <listitem>
                <formalpara>
                    <title>Hard macros</title>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>hard</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>read-only</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>hard macros</primary>
                    </indexterm>
                    <indexterm>
                        <primary>read-only macros</primary>
                    </indexterm>
                    <para>Hard macros contain data that is directly derived from the log message, for example, the ${MONTH} macro derives its value from the timestamp. The most important consideration with hard macros is that they are read-only, meaning they cannot be modified using rewrite rules or other means.</para>
                </formalpara>
            </listitem>
            <listitem>
                <formalpara>
                    <title>Soft macros</title>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>soft</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>rewritable</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>soft macros</primary>
                    </indexterm>
                    <indexterm>
                        <primary>rewritable macros</primary>
                    </indexterm>
                    <para>Soft macros (sometimes also called name-value pairs) are either built-in macros automatically generated from the log message (for example, ${HOST}), or custom user-created macros generated by using the syslog-ng pattern database or a CSV-parser. The SDATA fields of RFC5424-formatted log messages become soft macros as well. In contrast with hard macros, soft macros are writable and can be modified within &abbrev;, for example, using rewrite rules.</para>
                </formalpara>
                <note>
                    <para>It is also possible to set the value of built-in soft macros using parsers, for example, to set the ${HOST} macro from the message using a column of a CSV-parser.</para>
                    <para>The data extracted from the log messages using named pattern parsers in the pattern database are also soft macros.</para>
                </note>
                <tip>
                    <para>For the list of hard and soft macros, see <xref linkend="macros-hard-vs-soft"/>.</para>
                </tip>
            </listitem>
        </itemizedlist>
    </section>
    <xi:include href="concepts-value-pairs.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
</chapter>
