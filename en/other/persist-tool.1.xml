<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE reference
[
  <!ENTITY % entities SYSTEM "../common/syslog-ng-entities.ent">
  %entities;
  ]>
<reference xmlns="http://docbook.org/ns/docbook" version="5.0">
    <info>
        <productname>&product;</productname>
        <title>The persist-tool tool manual page</title>
    </info>
    <refentry xml:id="persist-tool.1">
        <refmeta>
            <refentrytitle>persist-tool</refentrytitle>
            <manvolnum>1</manvolnum>
            <refmiscinfo class="version">&version;</refmiscinfo>
            <refmiscinfo class="source">&product;</refmiscinfo>
        </refmeta>
        <refnamediv>
            <refname>persist-tool</refname>
            <refpurpose>Display the content of the persist state</refpurpose>
        </refnamediv>
        <refsynopsisdiv>
            <cmdsynopsis>
                <command>persist-tool</command>
                <arg>command</arg>
                <arg>options</arg>
            </cmdsynopsis>
        </refsynopsisdiv>
        <refsection xml:id="persist-tool-mandescription">
            <title>Description</title>
            <para>NOTE: The persist-tool application is distributed with the &product; system logging application, and is usually part of the syslog-ng package. The latest version of the syslog-ng application is available at the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.balabit.com/network-security/syslog-ng/">official syslog-ng website</link>.</para>
            <para>This manual page is only an abstract; for the complete documentation of syslog-ng, see <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="http://www.balabit.com/support/documentation/">The &product; Administrator Guide </link>.</para>
            <para>The <command>persist-tool</command> application is a utility that can be used to:</para>
            <itemizedlist>
                <listitem>
                    <para>display the content of the persist state</para>
                </listitem>
                <listitem>
                    <para>in case of &agentabbrev; convert the registry state to persist state</para>
                </listitem>
                <listitem>
                    <para>in case of &agentabbrev; start sending the logs from the actual position even if there is no persist state for the source</para>
                </listitem>
            </itemizedlist>
            <warning>
                <para>Persist-tool is a special tool for syslog-ng experts. Do use the tool unless you know exactly what you are doing. Misconfiguring it will result in irrecoverable damage to the persist file, without any warning.</para>
            </warning>
            <note>
                <para>Limitations:</para>
                <itemizedlist>
                    <listitem>
                        <para>The persist-state functions can be used only with syslog-ng PE 5 LTS style persist file (SLP4). Older persist files are not supported. </para>
                    </listitem>
                    <listitem>
                        <para>Wildcard characters are not supported in file/directory names.</para>
                    </listitem>
                </itemizedlist>
            </note>
        </refsection>
        <refsection xml:id="persist-tool-dump">
            <title>The dump command</title>
            <cmdsynopsis>
                <command>dump</command>
                <arg>options</arg>
                <arg>persist_file</arg>
            </cmdsynopsis>
            <para>Use the <command>dump</command> command to print the current content of the persist file in JSON format to the console.</para>
            <para>The <command>dump</command> command has the following options:</para>
            <variablelist>
                <varlistentry>
                    <term><command>--help</command> or <command>-?</command></term>
                    <listitem>
                        <para>Display a brief help message.</para>
                    </listitem>
            </variablelist>
            <para>Example: <synopsis>persist-tool.exe dump "c:\syslog-ng.persist"</synopsis></para>
            <para>The output looks like:</para>
            <synopsis>evtxlog_reader_curpos(Application) = { "version": 0, "big_endian": false, "bookmark_xml": "&lt;BookmarkList Direction='backward'&gt;\r\n  &lt;Bookmark Channel='Application' RecordId='2610170' IsCurrent='true'\
/&gt;\r\n&lt;\/BookmarkList&gt;" }</synopsis>
            <synopsis>affile_sd_curpos(C:\logs\002-filesource-encoding-utf-8-arvizturo-utf-8.txt) = { "version": 1, "big_endian": false, "raw_buffer_leftover_size": 0, "buffer_pos": 0, "pending_buffer_end": 0, "buffer_size
": 0, "buffer_cached_eol": 0, "pending_buffer_pos": 0, "raw_stream_pos": 64, "pending_raw_stream_pos": 0, "raw_buffer_size": 0, "pending_raw_buffer_size": 0, "file_size": 64, "file_inode": 0, "run_id"
: 0 }</synopsis>
        </refsection>
        <refsection xml:id="persist-tool-generate">
            <title>The generate command</title>
            <cmdsynopsis>
                <command>generate</command>
                <arg>options</arg>
            </cmdsynopsis>
            <para>Use the <command>generate</command> command to generate a persist file based on the content of the given configuration file. It will find all files and event sources that match the sources configured in the configuration file, and generate a state entry into the persist file for all of them. The position for the state entries will be set to the end of the source, therefore syslog-ng will continue them from the last position instead of sending messages from the beginning. Any other type of source will be skipped from persist generation.</para>
            <para>The <command>generate</command> command has the following options:</para>
            <variablelist>
                <varlistentry>
                    <term><command>--help</command> or <command>-?</command></term>
                    <listitem>
                        <para>Display a brief help message.</para>
                    </listitem>
            </variablelist>
            <para>Example: <synopsis>persist-tool.exe dump "c:\syslog-ng.persist"</synopsis></para>
            <para>The output looks like:</para>
            <synopsis>evtxlog_reader_curpos(Application) = { "version": 0, "big_endian": false, "bookmark_xml": "&lt;BookmarkList Direction='backward'&gt;\r\n  &lt;Bookmark Channel='Application' RecordId='2610170' IsCurrent='true'\
/&gt;\r\n&lt;\/BookmarkList&gt;" }</synopsis>
            <synopsis>affile_sd_curpos(C:\logs\002-filesource-encoding-utf-8-arvizturo-utf-8.txt) = { "version": 1, "big_endian": false, "raw_buffer_leftover_size": 0, "buffer_pos": 0, "pending_buffer_end": 0, "buffer_size
": 0, "buffer_cached_eol": 0, "pending_buffer_pos": 0, "raw_stream_pos": 64, "pending_raw_stream_pos": 0, "raw_buffer_size": 0, "pending_raw_buffer_size": 0, "file_size": 64, "file_inode": 0, "run_id"
: 0 }</synopsis>
        </refsection>
        <refsection>
            <title>Files</title>
            <para>
                <filename>/opt/syslog-ng/bin/persist-tool</filename>
            </para>
        </refsection>
        <refsection>
            <title>See also</title>
            <para>
                <link linkend="syslog-ng.conf.5">
                    <command>syslog-ng.conf</command>(5)</link>
            </para>
            <para>
                <link linkend="syslog-ng.8">
                    <command>syslog-ng</command>(8)</link>
            </para>
            <xi:include href="manpage-see-also.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </refsection>
        <xi:include href="manpage-author.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <xi:include href="manpage-copyright.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    </refentry>
</reference>
