<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  [
  <!ENTITY % entities SYSTEM "../shared/syslog-ng-entities.ent">
  %entities;
  ]
 >
<section xml:id="test-environment" xmlns="http://docbook.org/ns/docbook">
    <title>The test environment</title>
    <para>The test environment consisted of a single client and a server hardware, connected via a Gigabit switch. Note that in certain test runs, the client opened several separate connections to the servers to simulate real-life logging environments. The &product; application was installed from the <filename>.run</filename> package.</para>
    <formalpara>
        <title>Hardware parameters:</title>
        <para/>
    </formalpara>
    <para>The client hardware had the following main parameters:</para>
    <itemizedlist>
        <listitem>
            <para>2x Intel® Xeon® Processor E5-2620 v3 (15M Cache, 2.40 GHz, 8 GT/s Intel® QPI, 6 cores)</para>
        </listitem>
        <listitem>
            <para>Hyperthreading disabled, turbo boost disabled</para>
        </listitem>
        <listitem>
            <para>16 GB RAM</para>
        </listitem>
        <listitem>
            <para>10 Gbps Ethernet</para>
        </listitem>
        <listitem>
            <para>HDD 500 GB</para>
        </listitem>
        <listitem>
            <para>Operating system: <parameter>ubuntu-xenial amd64</parameter></para>
        </listitem>
    </itemizedlist>
    <para>The server hardware had the following main parameters:</para>
    <itemizedlist>
        <listitem>
            <para>2x Intel® Xeon® Processor E5-2620 v3 (15M Cache, 2.40 GHz, 8 GT/s Intel® QPI, 6 cores)</para>
        </listitem>
        <listitem>
            <para>Hyperthreading disabled, turbo boost disabled</para>
        </listitem>
        <listitem>
            <para>16 GB RAM</para>
        </listitem>
        <listitem>
            <para>10 Gbps Ethernet</para>
        </listitem>
        <listitem>
            <para>SSD 500 GB</para>
        </listitem>
        <listitem>
            <para>Operating system: <parameter>ubuntu-xenial amd64</parameter></para>
        </listitem>
    </itemizedlist>
    <formalpara>
        <title>Performance improvement:</title>
        <para/>
    </formalpara>
    <para>The following settings were used for performance improvement:</para>
    <itemizedlist>
        <listitem>
            <para>Improving performance with lots of connections:</para>
            <literallayout>max_connections = active_connections
log_iw_size = number of active_connections * 1000
log_fetch_limit = 1000
flush_lines = 1000
log_fifo_size = log_iw_size * 2
use_dns = no
keep_hostname = yes
keep_timestamp = no</literallayout>
        </listitem>
        <listitem>
            <para>Improving performance with a few connections but high amount of traffic:</para>
            <para>Source side:</para>
            <literallayout>log_iw_size = number of active_connections * 100,000
log_fetch_limit = number of active_connections * 100,000
</literallayout>
            <para>Destination side:</para>
            <literallayout>log_fifo_size = max_connections * (log_iw_size/number of active_connections)
flush_lines = 10,000 or greater</literallayout>
        </listitem>
    </itemizedlist>
    <formalpara>
        <title>Resource usage:</title>
        <para/>
    </formalpara>
    <para>The performance tests were carried out in multithreaded mode:</para>
    <literallayout>threaded(yes)</literallayout>
    <para>One way to optimize the resource usage of &abbrev; is to limit the number of worker threads that syslog-ng uses. This helps prevent &abbrev; from using all available CPUs. You can limit the number of worker threads using the <parameter>--worker-threads</parameter> command-line option that sets the maximum total number of threads &abbrev; can use, including the main &abbrev; thread. </para>
    <para>Note, however, that SQL sources and destinations, as well as Java destinations, such as Elasticsearch, HDFS, and Apache Kafka, always run in their own, separate threads. This means that the <parameter>--worker-threads</parameter> command-line option has no impact on them.</para>
</section>
