<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE article
  [
  <!ENTITY % entities SYSTEM "../common/syslog-ng-entities.ent">
  %entities;
  ]
 >
<article xmlns="http://docbook.org/ns/docbook" version="5.0" condition="pe" xml:id="syslog-ng-pe-performance-whitepaper">
    <info>
        <title>Performance Guideline for &product; 6 LTS</title>
        <orgname>&fullvendor;</orgname>
        <keywordset>
            <keyword>system logging, syslog-ng performance, message rate, &docgithash;</keyword>
        </keywordset>
        <subjectset>
            <subject>
                <subjectterm>Measuring the performance and throughput of syslog-ng servers</subjectterm>
            </subject>
        </subjectset>
        <xi:include href="../xml-stylesheet/common/common.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="common_copyright_bb"/>
        <pubdate><?dbtimestamp?></pubdate>
        <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="../xml-stylesheet/common/common.xml" xpointer="common_logo_bb"/>
        <abstract>
            <para>Performance analysis of syslog-ng Premium Edition</para>
        </abstract>
    </info>
    <section>
        <title>Preface</title>
        <para>This document summarizes the findings of several performance tests and measurements carried out on different versions of &product;. The main focus was &abbrev; version 6 LTS, but similar performance tests are performed and published regularly with every major &abbrev; release.</para>
    </section>
    <section xml:id="executive-summary">
        <title>Executive summary</title>
        <para>The main findings of the performance tests are as follows:</para>
        <itemizedlist>
            <listitem>
                <para>The fastest way the &abbrev; application can receive log messages from the network is using plain TCP transport with the <parameter>network()</parameter> source driver.</para>
            </listitem>
            <listitem>
                <para>By default, &abbrev; runs in multithreaded mode to scale to multiple CPUs or cores for increased performance.</para>
                <para>Depending on the exact &abbrev; configuration, environment, and other parameters, &abbrev; is capable of processing:</para>
                <itemizedlist>
                    <listitem>
                        <para>over 590,000 messages per second (over 220 MB of data per second) when receiving messages from multiple connections and storing them in text files</para>
                    </listitem>
                    <listitem>
                        <para>over 560,000 messages per second (210 MB of data per second) when receiving messages from multiple connections and storing them in logstore files (that is, encrypted files)</para>
                    </listitem>
                    <listitem>
                        <para>over 565,000 messages per second (over 210 MB of data per second) when receiving messages from multiple secure (TLS-encrypted) connections and storing them in text files.</para>
                    </listitem>
                </itemizedlist>
            </listitem>
            <listitem>
                <para>The tests were performed using real log messages of 130-2000 bytes and of varying complexity, obtained from real machines. The tests ran for 10 minutes.</para>
            </listitem>
            <listitem>
                <para>PatternDB only works on one thread. Therefore, using PatternDB can significantly decrease performance depending on how many messages match a pattern in the specified ruleset. If a large amount of messages are being received but the specified pattern matches a small number of messages, there is no significant performance degradation.</para>
            </listitem>
            <listitem>
                <para>Using disk buffer on the client side can significantly degrade performance. This is especially the case if relays that are heavily loaded are used together with disk buffer enabled on the relays. Performance can also be degraded if lots of messages are received on the syslog-ng server, and are forwarded through the network (for example to a log analyzer or SIEM), and therefore disk buffer is enabled on the server as well.</para>
            </listitem>
            <listitem>
                <para>Higher <parameter>stats_level</parameter> decreases the performance. For example, <parameter>stats_level(2)</parameter> means -10% in performance.</para>
            </listitem>
            <listitem>
                <para>Simple filtering (for example, filtering on facility or tag) has no impact on performance at all. However, regular expressions, even simple ones, significantly decrease the message-processing rate, by about 40-45%.</para>
            </listitem>
            <listitem>
                <para>Results of the performance tests show a standard deviation of +-5%. This means that when comparing measurements of a particular dimension (for example, non-encrypted versus encrypted log processing), a difference of 5% does not necessarily indicate a real difference in performance.</para>
            </listitem>
        </itemizedlist>
        <!-- This section below is re-used in the syslog-ng pe performance whitepaper executive summary section. There are two different files and the reference to the entities is different on purpose. -->
        <xi:include href="../common/multithreading-performance.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <section>
            <title>Use cases for performance improvement</title>
            <formalpara>
                <title>Improving performance with lots of connections:</title>
                <para/>
            </formalpara>
            <para>If there are several thousand active connections simultaneously, it is advised to place relay syslog-ng-s on another computer in front of the syslog-ng server. Switching between active connections is time-consuming, while the amount of incoming messages is usually not significant. This problem is solved by using relays, since they are collecting the logs. The syslog-ng solution can handle lots of log messages sent from a few connections easily.</para>
            <para>It is best to handle no more than 1,000-2,000 connections per &abbrev; application. When your environment has more connections than that, then our recommendation is that those should be handled by more than one &abbrev; application. For example, when there are 4,000 connections, employ two relays, each of them running one &abbrev; application and handling 2,000 connections.</para>
            <para>Note, however, that the exact capacity of &abbrev; depends on your particular circumstances (such as hardware performance, number and complexity of log messages, and so on), and needs to be measured on an individual basis.</para>
            <formalpara>
                <title>Storing lots of log messages:</title>
                <para/>
            </formalpara>
            <para>It requires large free disk space if syslog-ng receives lots of messages per second (note that syslog-ng can process messages at even 225 MB/sec speed). In this case, it is advised to use compressed logstore files instead of plain text files for storing data. The size of a compressed logstore (<parameter>compress(3)</parameter>) is only a few percent of the file destination. Obviously, the effectiveness of the compression depends on the pattern of the incoming messages, but since most of the time the log messages consist of simple text messages, they can be compressed quite effectively (around 90% compression rate).</para>
            <formalpara>
                <title>Filtering messages:</title>
                <para/>
            </formalpara>
            <para>It is advised to use the simplest filters when filtering incoming messages. If a message can be filtered with several types of filters, check the measured data. For example, if a message is filtered with a <parameter>regexp</parameter>, the performance of syslog-ng can drop down to 55-60% of the original performance level. Whereas if the <parameter>tag</parameter> or <parameter>facility</parameter> filters are used, there is no decrease in performance.</para>
            <para>When using multiple filters one after the other, or connecting filters with the logical AND/OR operators, the order of filters has a significant impact on performance. We recommend to put those filters in front that are the most likely to match the incoming log messages (if known). </para>
            <formalpara>
                <title>Identifying bottlenecks:</title>
                <para/>
            </formalpara>
            <para>It is advised to first identify the bottlenecks if the performance of syslog-ng seems to be too low. For example, if syslog-ng is writing on slow disks at the destination side, upgrading the source-side device will not help increasing the performance.</para>
        </section>
        <section>
            <title>Configuration guidelines</title>
            <para>Log messages can be collected and processed at a faster rate in the latest version of &product; compared to version 5 LTS and earlier versions but several configuration aspects will affect the rate at which log messages are collected and stored. The following tables show the results of tests performed with &abbrev; 6 LTS. Taking the following factors into consideration will optimize &product; performance:</para>
            <formalpara>
                <title>Number of network connections:</title>
                <para/>
            </formalpara>
            <para>In a multithreaded environment, an increase in connections will have no significant impact on the rate at which &abbrev; processes log messages.</para>
            <table>
                <title>Number of network connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> Number of Connections </entry>
                            <entry> Messages Per Second </entry>
                            <entry> Average Data Rate (MB/sec) </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> 10 </entry>
                            <entry> 600,000 </entry>
                            <entry> 225 </entry>
                        </row>
                        <row>
                            <entry> 50 </entry>
                            <entry> 575,000 </entry>
                            <entry> 215 </entry>
                        </row>
                        <row>
                            <entry> 100 </entry>
                            <entry> 555,000 </entry>
                            <entry> 210 </entry>
                        </row>
                        <row>
                            <entry> 200 </entry>
                            <entry> 565,000 </entry>
                            <entry> 210 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right">Configuration: path – TCP, destination – multiple files (using macros), message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <formalpara>
                <title>Encrypted log transfer:</title>
                <para/>
            </formalpara>
            <para>The &abbrev; application uses the Transport Layer Security (TLS) protocol to encrypt the communication. TLS also allows the mutual authentication of the host and the server using X.509 certificates. </para>
            <table>
                <title>Encrypted log transfer &mdash; 10 connections</title>
                <tgroup cols="5">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <colspec colname="c4"/>
                    <colspec colname="c5"/>
                    <thead>
                        <row>
                            <entry morerows="1" valign="middle"> </entry>
                            <entry namest="c2" nameend="c3" align="center"> Legacy syslog </entry>
                            <entry namest="c4" nameend="c5" align="center"> IETF syslog </entry>
                        </row>
                        <row>
                            <entry> Not Encrypted </entry>
                            <entry> TLS Encryption </entry>
                            <entry> Not Encrypted </entry>
                            <entry> TLS Encryption </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Messages per second </entry>
                            <entry> 600,000 </entry>
                            <entry> 570,000 </entry>
                            <entry> 140,000 </entry>
                            <entry> 140,000 </entry>
                        </row>
                        <row>
                            <entry> Average data rate (MB/sec) </entry>
                            <entry> 225 </entry>
                            <entry> 215 </entry>
                            <entry> 70 </entry>
                            <entry> 70 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c5" align="right">Configuration: path – TCP, multithreaded, 10 connections, destination – multiple files (using macros), message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <table>
                <title>Encrypted log transfer &mdash; 100 connections</title>
                <tgroup cols="5">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <colspec colname="c4"/>
                    <colspec colname="c5"/>
                    <thead>
                        <row>
                            <entry morerows="1" valign="middle"> </entry>
                            <entry namest="c2" nameend="c3" align="center"> Legacy syslog </entry>
                            <entry namest="c4" nameend="c5" align="center"> IETF syslog </entry>
                        </row>
                        <row>
                            <entry> Not Encrypted </entry>
                            <entry> TLS Encryption </entry>
                            <entry> Not Encrypted </entry>
                            <entry> TLS Encryption </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Messages per second </entry>
                            <entry> 565,000 </entry>
                            <entry> 520,000 </entry>
                            <entry> 135,000 </entry>
                            <entry> 130,000 </entry>
                        </row>
                        <row>
                            <entry> Average data rate (MB/sec) </entry>
                            <entry> 210 </entry>
                            <entry> 195 </entry>
                            <entry> 70 </entry>
                            <entry> 65 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c5" align="right">Configuration: path – TCP, multithreaded, 100 connections, destination – multiple files (using macros), message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <formalpara>
                <title>Type of storage:</title>
                <para/>
            </formalpara>
            <para>The &abbrev; application can:</para>
            <itemizedlist>
                <listitem>
                    <para>Store log messages securely in encrypted, compressed and timestamped binary files.</para>
                    <para>While using encrypted and compressed logstore files uses more CPU resources, data is stored more securely and requires less storage space.</para>
                </listitem>
                <listitem>
                    <para>Send syslog messages through the network to a &abbrev; server.</para>
                </listitem>
                <listitem>
                    <para>Store log messages in a database.</para>
                </listitem>
                <listitem>
                    <para>Store log messages in the <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://hadoop.apache.org/">Hadoop Distributed File System (HDFS)</link>.</para>
                </listitem>
                <listitem>
                    <para>Send log messages to <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.elastic.co/products/elasticsearch">Elasticsearch</link>.</para>
                </listitem>
            </itemizedlist>
            <table>
                <title>Type of storage &mdash; 10 connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> Type of Storage </entry>
                            <entry> Messages Per Second </entry>
                            <entry> Average Data Rate (MB/sec) </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Plain text file </entry>
                            <entry> 290,000 </entry>
                            <entry> 110 </entry>
                        </row>
                        <row>
                            <entry> Multiple plain text files (using macros, with log messages divided by hostname)</entry>
                            <entry> 590,000 </entry>
                            <entry> 220 </entry>
                        </row>
                        <row>
                            <entry> Logstore </entry>
                            <entry> 210,000 </entry>
                            <entry> 80 </entry>
                        </row>
                        <row>
                            <entry> Multiple logstores (using macros, with log messages divided by hostname)</entry>
                            <entry> 560,000 </entry>
                            <entry> 210 </entry>
                        </row>
                        <row>
                            <entry> Network destination &mdash; legacy syslog </entry>
                            <entry> 360,000 </entry>
                            <entry> 135</entry>
                        </row>
                        <row>
                            <entry> Network destination &mdash; IETF syslog with <trademark>RLTP</trademark> </entry>
                            <entry> 35,000 </entry>
                            <entry> 10 </entry>
                        </row>
                        <row>
                            <entry> Network destination &mdash; IETF syslog with <trademark>RLTP</trademark>, compressed </entry>
                            <entry> 20,000 </entry>
                            <entry> 10 </entry>
                        </row>
                        <row>
                            <entry>Database destination &mdash; MongoDB </entry>
                            <entry namest="c2" nameend="c3"> <para>In the case of MongoDB destinations, performance is influenced by a number of criteria unrelated to syslog-ng. If you need information on MongoDB-related performance measurements, contact &vendor;. </para> <para>If you are an existing customer, contact the <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://support.balabit.com/">&vendor; Support Team</link>. Otherwise, contact your Pre-Sales Engineer.</para> </entry>
                        </row>
                        <row>
                            <entry> Database destination &mdash; SQL </entry>
                            <entry namest="c2" nameend="c3"> <para>In the case of SQL destinations, performance is influenced by a number of criteria unrelated to syslog-ng. If you need information on SQL-related performance measurements, contact &vendor;. </para> <para>If you are an existing customer, contact the <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://support.balabit.com/">&vendor; Support Team</link>. Otherwise, contact your Pre-Sales Engineer.</para> </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right"> <para>Configuration: path – TCP, multithreaded, 10 connections, message size: 400 bytes</para> <para>Note: Writing into only one logstore cannot be scaled because of technical limitations even when syslog-ng receives messages from more connections.</para> </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <table>
                <title>Type of storage &mdash; 100 connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> Type of Storage </entry>
                            <entry> Messages Per Second </entry>
                            <entry> Average Data Rate (MB/sec) </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Plain text file </entry>
                            <entry> 425,000 </entry>
                            <entry> 160 </entry>
                        </row>
                        <row>
                            <entry> Multiple plain text files (using macros, with log messages divided by hostname)</entry>
                            <entry> 565,000 </entry>
                            <entry> 210 </entry>
                        </row>
                        <row>
                            <entry> Logstore </entry>
                            <entry> 210,000 </entry>
                            <entry> 80 </entry>
                        </row>
                        <row>
                            <entry> Multiple logstores (using macros, with log messages divided by hostname)</entry>
                            <entry> 580,000 </entry>
                            <entry> 215 </entry>
                        </row>
                        <row>
                            <entry> Network destination &mdash; legacy syslog </entry>
                            <entry> 330,000 </entry>
                            <entry> 125</entry>
                        </row>
                        <row>
                            <entry> Network destination &mdash; IETF syslog with <trademark>RLTP</trademark> </entry>
                            <entry> 30,000 </entry>
                            <entry> 10 </entry>
                        </row>
                        <row>
                            <entry> Network destination &mdash; IETF syslog with <trademark>RLTP</trademark>, compressed </entry>
                            <entry> 20,000 </entry>
                            <entry> 10 </entry>
                        </row>
                        <row>
                            <entry>Database destination &mdash; MongoDB </entry>
                            <entry namest="c2" nameend="c3"> <para>In the case of MongoDB destinations, performance is influenced by a number of criteria unrelated to syslog-ng. If you need information on MongoDB-related performance measurements, contact &vendor;. </para> <para>If you are an existing customer, contact the <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://support.balabit.com/">&vendor; Support Team</link>. Otherwise, contact your Pre-Sales Engineer.</para> </entry>
                        </row>
                        <row>
                            <entry> Database destination &mdash; SQL </entry>
                            <entry namest="c2" nameend="c3"> <para>In the case of SQL destinations, performance is influenced by a number of criteria unrelated to syslog-ng. If you need information on SQL-related performance measurements, contact &vendor;. </para> <para>If you are an existing customer, contact the <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://support.balabit.com/">&vendor; Support Team</link>. Otherwise, contact your Pre-Sales Engineer.</para> </entry>
                        </row>
                        <row>
                            <entry morerows="1"> HDFS </entry>
                            <entry> 140,000 </entry>
                            <entry> 50 </entry>
                        </row>
                        <row>
                            <entry namest="c2" nameend="c3">Note: Processing speed is heavily influenced by the number of HDFS data nodes in use. When syslog-ng writes multiple files to HDFS, and Hadoop places these on different data nodes, then processing speed might increase in proportion to the number of data nodes used (not necessarily in a linear fashion). The data provided here shows performance in the case of a single data node.</entry>
                        </row>
                        <row>
                            <entry> Elasticsearch </entry>
                            <entry> <para>1,500 (with <userinput>flush_limit(1)</userinput>)</para> <para>10,500 (with <userinput>flush_limit(5000)</userinput>)</para> </entry>
                            <entry> <para>1 (with <userinput>flush_limit(1)</userinput>)</para> <para>5 (with <userinput>flush_limit(5000)</userinput>)</para> </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right"> <para>Configuration: path – TCP, multithreaded, 100 connections, message size: 400 bytes</para> <para>Note: Writing into only one logstore cannot be scaled because of technical limitations even when syslog-ng receives messages from more connections.</para> </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <formalpara>
                <title>Number of files and directories when reading log messages from multiple plain text files:</title>
                <para/>
            </formalpara>
            <para>When reading log messages from a set of files, the number of directories and the number of files per directory used have no significant impact on performance.</para>
            <table>
                <title>Number of files and directories</title>
                <tgroup cols="4">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <colspec colname="c4"/>
                    <thead>
                        <row>
                            <entry> Number of Directories </entry>
                            <entry> Number of Files Per Directory </entry>
                            <entry> Messages Per Second </entry>
                            <entry> Average Data Rate (MB/sec) </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry morerows="2"> 1 </entry>
                            <entry> 1 </entry>
                            <entry> 105,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> 10 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> 100 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry morerows="2"> 10 </entry>
                            <entry> 1 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> 10 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> 100 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry morerows="2"> 100 </entry>
                            <entry> 1 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> 10 </entry>
                            <entry> 100,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> 100 </entry>
                            <entry> 95,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c4" align="right">Configuration: path – TCP, multithreaded, File source message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <formalpara>
                <title>Disk buffer:</title>
                <para/>
            </formalpara>
            <para>The &product; stores messages on the local hard disk if the central log server or the network connection to the server becomes unavailable. </para>
            <table>
                <title>Disk buffer</title>
                <tgroup cols="4">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <colspec colname="c4"/>
                    <thead>
                        <row>
                            <entry> </entry>
                            <entry> Without Disk Buffer </entry>
                            <entry> Reliable </entry>
                            <entry> Normal </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Messages per second </entry>
                            <entry> 360,000 </entry>
                            <entry> 40,000 </entry>
                            <entry> 50,000 </entry>
                        </row>
                        <row>
                            <entry> Average data rate (MB/sec) </entry>
                            <entry> 135 </entry>
                            <entry> 15 </entry>
                            <entry> 20 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c4" align="right">Configuration: path – TCP, multithreaded, disk buffer: 1000 MB, 100 connections, message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <formalpara>
                <title>Log pre-processing:</title>
                <para/>
            </formalpara>
            <para>Depending on the type of pre-processing, the rate at which &abbrev; collects messages can vary. Regular Expressions, rewriting, using parsers, as well as pattern recognition processing through PatternDB have a significant impact on the message processing rate. Facility filtering and tag filtering have no impact at all.</para>
            <para>Note that in a multithreaded environment, PatternDB has a particularly large impact on performance. </para>
            <table>
                <title>Log pre-processing &mdash; 10 connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> </entry>
                            <entry> Messages Per Second </entry>
                            <entry> Average Data Rate (MB/sec) </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> No pre-processing </entry>
                            <entry> 595,000 </entry>
                            <entry> 225 </entry>
                        </row>
                        <row>
                            <entry> All pre-processing (except PatternDB and JSON parser) </entry>
                            <entry> 190,000 </entry>
                            <entry> 70 </entry>
                        </row>
                        <row>
                            <entry> Simple regexp (for example, matching a single string) </entry>
                            <entry> 335,000 </entry>
                            <entry> 125 </entry>
                        </row>
                        <row>
                            <entry> Facility filter </entry>
                            <entry> 595,000 </entry>
                            <entry> 225 </entry>
                        </row>
                        <row>
                            <entry> Tag filter </entry>
                            <entry> 595,000 </entry>
                            <entry> 225 </entry>
                        </row>
                        <row>
                            <entry> PatternDB (10 % of messages matched) </entry>
                            <entry> 35,000 </entry>
                            <entry> 10 </entry>
                        </row>
                        <row>
                            <entry> Simple rewrite (for example, rewrite hostname) </entry>
                            <entry> 260,000 </entry>
                            <entry> 100 </entry>
                        </row>
                        <row>
                            <entry> JSON parser </entry>
                            <entry> 70,000 </entry>
                            <entry> 45 </entry>
                        </row>
                        <row>
                            <entry> kv parser </entry>
                            <entry> 205,000 </entry>
                            <entry> 75 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right">Configuration: path – TCP, multithreaded, 10 connections, message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <table>
                <title>Log pre-processing &mdash; 100 connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> </entry>
                            <entry> Messages Per Second </entry>
                            <entry> Average Data Rate (MB/sec) </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> No pre-processing </entry>
                            <entry> 570,000 </entry>
                            <entry> 215 </entry>
                        </row>
                        <row>
                            <entry> All pre-processing (except PatternDB and JSON parser) </entry>
                            <entry> 230,000 </entry>
                            <entry> 90 </entry>
                        </row>
                        <row>
                            <entry> Simple regexp (for example, matching a single string) </entry>
                            <entry> 340,000 </entry>
                            <entry> 125 </entry>
                        </row>
                        <row>
                            <entry> Facility filter </entry>
                            <entry> 555,000 </entry>
                            <entry> 205 </entry>
                        </row>
                        <row>
                            <entry> Tag filter </entry>
                            <entry> 565,000 </entry>
                            <entry> 210 </entry>
                        </row>
                        <row>
                            <entry> PatternDB (10 % of messages matched) </entry>
                            <entry> 30,000 </entry>
                            <entry> 10 </entry>
                        </row>
                        <row>
                            <entry> Simple rewrite (for example, rewrite hostname) </entry>
                            <entry> 310,000 </entry>
                            <entry> 115 </entry>
                        </row>
                        <row>
                            <entry> JSON parser </entry>
                            <entry> 60,000 </entry>
                            <entry> 40 </entry>
                        </row>
                        <row>
                            <entry> kv parser </entry>
                            <entry> 225,000 </entry>
                            <entry> 85 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right">Configuration: path – TCP, multithreaded, 100 connections, message size: 400 bytes</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <formalpara>
                <title>Application-level acknowledgement via <trademark>Reliable Log Transfer Protocol</trademark> (<trademark>RLTP</trademark>):</title>
                <para/>
            </formalpara>
            <para>The latest version of &product; supports the <trademark>RLTP</trademark> that allows the logserver to notify clients when a message is received. The application-level acknowledgment has an effect on the number of log messages processed per second.</para>
            <para>Performance is also heavily influenced by the degree of latency between two machines. This is due to how <trademark>RLTP</trademark> works. syslog-ng will not send a new batch of log messages until it has received acknowledgement from the receiving party about having processed the previous batch. When the acknowledgement takes longer to arrive (for example, because the machines are located on different continents), that can impact processing speed. In such cases, our recommendation is to increase the value of the <parameter>flush-lines()</parameter> parameter, which determines how many lines of log messages are sent to a destination at a time. </para>
            <table>
                <title>Application-level acknowledgement via <trademark>Reliable Log Transfer Protocol</trademark> (<trademark>RLTP</trademark>) &mdash; 10 connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> </entry>
                            <entry> TCP </entry>
                            <entry> <trademark>RLTP</trademark> </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Messages per second </entry>
                            <entry> 600,000 </entry>
                            <entry> 180,000 </entry>
                        </row>
                        <row>
                            <entry> Average data rate (MB/sec) </entry>
                            <entry> 224 </entry>
                            <entry> 90 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right"> <para>Configuration: multithreaded, 10 connections, message size: 400 bytes</para> <para>Note: This result is measured on the server side. When <trademark>RLTP</trademark> is applied on a relay server, both the source side and the destination side apply <trademark>RLTP</trademark>, which would decrease performance slightly.</para> </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <table>
                <title>Application-level acknowledgement via <trademark>Reliable Log Transfer Protocol</trademark> (<trademark>RLTP</trademark>) &mdash; 100 connections</title>
                <tgroup cols="3">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <colspec colname="c3"/>
                    <thead>
                        <row>
                            <entry> </entry>
                            <entry> TCP </entry>
                            <entry> <trademark>RLTP</trademark> </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Messages per second </entry>
                            <entry> 560,000 </entry>
                            <entry> 180,000 </entry>
                        </row>
                        <row>
                            <entry> Average data rate (MB/sec) </entry>
                            <entry> 211 </entry>
                            <entry> 90 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c3" align="right"> <para>Configuration: multithreaded, 100 connections, message size: 400 bytes</para> <para>Note: This result is measured on the server side. When <trademark>RLTP</trademark> is applied on a relay server, both the source side and the destination side apply <trademark>RLTP</trademark>, which would decrease performance slightly.</para> </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section>
            <title>Configuration guidelines for Windows Agent</title>
            <para>The following table shows the results of tests performed with &agentabbrev; 6 LTS.</para>
            <table>
                <title>Configuration guidelines for Windows Agent based on log sources</title>
                <tgroup cols="2">
                    <colspec colname="c1"/>
                    <colspec colname="c2"/>
                    <thead>
                        <row>
                            <entry> Source </entry>
                            <entry> Messages Per Second </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Eventlog </entry>
                            <entry> 800 &mdash; 1,500 </entry>
                        </row>
                        <row>
                            <entry> File </entry>
                            <entry> 10,000 </entry>
                        </row>
                        <row>
                            <entry namest="c1" nameend="c2" align="right"> <para>Configuration: path – TCP</para> </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
    <section xml:id="test-environment">
        <title>The test environment</title>
        <para>The test environment consisted of a single client and a server hardware, connected via a Gigabit switch. Note that in certain test runs, the client opened several separate connections to the servers to simulate real-life logging environments. The &product; application was installed from the <filename>.run</filename> package.</para>
        <formalpara>
            <title>Hardware parameters:</title>
            <para/>
        </formalpara>
        <para>The client hardware had the following main parameters:</para>
        <itemizedlist>
            <listitem>
                <para>2x Intel® Xeon® Processor E5-2620 v3 (15M Cache, 2.40 GHz, 8 GT/s Intel® QPI, 6 cores)</para>
            </listitem>
            <listitem>
                <para>Hyperthreading disabled, turbo boost disabled</para>
            </listitem>
            <listitem>
                <para>16 GB RAM</para>
            </listitem>
            <listitem>
                <para>10 Gbps Ethernet</para>
            </listitem>
            <listitem>
                <para>HDD 500 GB</para>
            </listitem>
            <listitem>
                <para>Operating system: <parameter>ubuntu-xenial amd64</parameter></para>
            </listitem>
        </itemizedlist>
        <para>The server hardware had the following main parameters:</para>
        <itemizedlist>
            <listitem>
                <para>2x Intel® Xeon® Processor E5-2620 v3 (15M Cache, 2.40 GHz, 8 GT/s Intel® QPI, 6 cores)</para>
            </listitem>
            <listitem>
                <para>Hyperthreading disabled, turbo boost disabled</para>
            </listitem>
            <listitem>
                <para>16 GB RAM</para>
            </listitem>
            <listitem>
                <para>10 Gbps Ethernet</para>
            </listitem>
            <listitem>
                <para>SSD 500 GB</para>
            </listitem>
            <listitem>
                <para>Operating system: <parameter>ubuntu-xenial amd64</parameter></para>
            </listitem>
        </itemizedlist>
        <formalpara>
            <title>Performance improvement:</title>
            <para/>
        </formalpara>
        <para>The following settings were used for performance improvement:</para>
        <itemizedlist>
            <listitem>
                <para>Improving performance with lots of connections:</para>
                <literallayout>max_connections = active_connections
log_iw_size = number of active_connections * 1000
log_fetch_limit = 1000
flush_lines = 1000
log_fifo_size = log_iw_size * 2
use_dns = no
keep_hostname = yes
keep_timestamp = no</literallayout>
            </listitem>
            <listitem>
                <para>Improving performance with a few connections but high amount of traffic:</para>
                <para>Source side:</para>
                <literallayout>log_iw_size = number of active_connections * 100,000
log_fetch_limit = number of active_connections * 100,000
</literallayout>
                <para>Destination side:</para>
                <literallayout>log_fifo_size = max_connections * (log_iw_size/number of active_connections)
flush_lines = 10,000 or greater</literallayout>
            </listitem>
        </itemizedlist>
        <formalpara>
            <title>Resource usage:</title>
            <para/>
        </formalpara>
        <para>The performance tests were carried out in multithreaded mode:</para>
        <literallayout>threaded(yes)</literallayout>
        <para>One way to optimize the resource usage of &abbrev; is to limit the number of worker threads that syslog-ng uses. This helps prevent &abbrev; from using all available CPUs. You can limit the number of worker threads using the <parameter>--worker-threads</parameter> command-line option that sets the maximum total number of threads &abbrev; can use, including the main &abbrev; thread. </para>
        <para>Note, however, that SQL sources and destinations, as well as Java destinations, such as Elasticsearch, HDFS, and Apache Kafka, always run in their own, separate threads. This means that the <parameter>--worker-threads</parameter> command-line option has no impact on them.</para>
    </section>
    <section xml:id="summary">
        <title>Summary</title>
        <para>The test measurements show that the processing capabilities of &product; have increased significantly from version 5.0, and that &abbrev; is capable of receiving and processing high-volume log traffic.</para>
        <xi:include href="../xml-stylesheet/common/about-balabit.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    </section>
</article>
