<?xml version="1.0" encoding="UTF-8"?>

<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="configuring-sources-file" oldrole="section">
<h1 name="configuring-sources-file" version="5.0" xmlns="http://docbook.org/ns/docbook"><span class="Code" oldrole="parameter">file</span>: Collecting messages from text files</h1>
<MadCap:keyword term="source drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;file()&lt;/span&gt;, ' driver']"></MadCap:keyword>
<p oldrole="para">Collects log messages from plain-text files, for example, from the logfiles of an Apache webserver. If you want to use <a href="source-wildcard-file.htm">wildcards in the filename, use the <span class="Code" oldrole="parameter">wildcard-file()</span> source</a>.</p>
<p oldrole="para">The syslog-ng application notices if a file is renamed or replaced with a new file, so it can correctly follow the file even if logrotation is used. When syslog-ng is restarted, it records the position of the last sent log message in the <span class="Code" oldrole="filename">/opt/syslog-ng/var/syslog-ng.persist</span> file, and continues to send messages from this position after the restart.</p>
<p oldrole="para">The file driver has a single required parameter specifying the file to open. If you want to use <a href="source-wildcard-file.htm">wildcards in the filename, use the <span class="Code" oldrole="parameter">wildcard-file()</span> source</a>. For the list of available optional parameters, see <MadCap:xref href="source-file.htm#reference-source-file"></MadCap:xref>.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><MadCap:sinppetBlock src="../../shared/wnt/warning-nfs.htm"></MadCap:sinppetBlock></td></tr></tbody></table>
<h6 oldrole="formalpara">Declaration:</h6>

<pre class="Code" oldrole="synopsis">file("filename");</pre>

<h6 name="example-source-file" oldrole="example">Example: Using the file() driver</h6>
<pre class="Code" oldrole="synopsis">source s_file { file("/var/log/messages"); };</pre>


<h6 oldrole="example">Example: Tailing files</h6>
<p oldrole="para">The following source checks the <span class="Code" oldrole="filename">access.log</span> file every second for new messages.</p>
<pre class="Code" oldrole="synopsis">source s_tail { file("/var/log/apache/access.log"
        follow-freq(1) flags(no-parse)); };</pre>

<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span><p oldrole="para">If the message does not have a proper syslog header, syslog-ng treats messages received from files as sent by the <span class="Code" oldrole="parameter">kern</span> facility. Use the <span class="Code" oldrole="parameter">default-facility()</span> and <span class="Code" oldrole="parameter">default-priority()</span> options in the source definition to assign a different facility if needed.</p></td></tr></tbody></table>
<h2 name="kernel-messages">Notes on reading kernel messages</h2>
<p oldrole="para">Note the following points when reading kernel messages on various platforms.</p>
<ul oldrole="itemizedlist">
<MadCap:keyword term="kmsg"></MadCap:keyword>
<li oldrole="listitem">
<p oldrole="para">The kernel usually sends log messages to a special file (<span class="Code" oldrole="filename">/dev/kmsg</span> on BSDs, <span class="Code" oldrole="filename">/proc/kmsg</span> on Linux). The <span class="Code" oldrole="parameter">file()</span> driver reads log messages from such files. The syslog-ng application can periodically check the file for new log messages if the <span class="Code" oldrole="parameter">follow-freq()</span> option is set.</p>
</li>
<li oldrole="listitem">
<MadCap:keyword term="klogd"></MadCap:keyword>
<p oldrole="para">On Linux, the <span class="Code" oldrole="parameter">klogd</span> daemon can be used in addition to syslog-ng to read kernel messages and forward them to syslog-ng. <span class="Code" oldrole="parameter">klogd</span> used to preprocess kernel messages to resolve symbols and so on, but as this is deprecated by <span class="Code" oldrole="parameter">ksymoops</span> there is really no point in running both <span class="Code" oldrole="parameter">klogd</span> and syslog-ng in parallel. Also note that running two processes reading <span class="Code" oldrole="filename">/proc/kmsg</span> at the same time might result in dead-locks.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">When using syslog-ng to read messages from the <span class="Code" oldrole="filename">/proc/kmsg</span> file, syslog-ng automatically disables the <span class="Code" oldrole="parameter">follow-freq()</span> parameter to avoid blocking the file.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">To read the kernel messages on HP-UX platforms, use the following options in the source statement:</p>
<pre class="Code" oldrole="synopsis">file("/dev/klog" program-override("kernel") flags(kernel) follow-freq(0));</pre>
</li>
</ul>
<h2 name="file-source-and-syslog-destination">File sources and the RFC5424 message format</h2>
<MadCap:keyword term="file@18372.4"></MadCap:keyword>
<MadCap:keyword term="SDATA:['file@18372.4']"></MadCap:keyword>
<MadCap:keyword term="file information:['file@18372.4']"></MadCap:keyword>
<MadCap:keyword term="including filename in messages"></MadCap:keyword>
<p oldrole="para">When reading messages from a file and forwarding them in IETF-syslog (RFC5424) format, <MadCap:variable name="General.abbrev"></MadCap:variable> automatically adds all file-related information to the <span class="Code" oldrole="userinput">file@18372.4</span> SDATA block. When the source is file and the transport protocol is syslog or syslog-protocol flags were used in the destination side, the message will contain the following source file-related information:</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">size</i>: size of the file</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">position</i>: file position the message was read from</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">name</i>: name of the file</p>
</li>
</ul>

<h6 oldrole="example">Example: File-related information in message</h6>
<p oldrole="para"><pre class="Code" oldrole="synopsis">309 &lt;38&gt;1 2010-10-19T15:50:45.018203+02:00 server1 localprg 1234 - [timeQuality isSynced="0" tzKnown="0"][file@18372.4 size="184567" pos="1024" name="/var/tmp/msg.txt"] seq: 0000000001, runid: 1287496244, stamp: 2010-10-19T15:50:45 messagetext</pre></p>

<h2 name="reference-source-file">file() source options</h2>
<MadCap:keyword term="source drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;file()&lt;/span&gt;, ' driver']"></MadCap:keyword>
<p oldrole="para">The <span class="Code" oldrole="parameter">file()</span> driver has the following options:</p>

<MadCap:sinppetBlock src="../../shared/chunk/option-source-default-facility.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-default-priority.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-encoding.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-flags.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-follow-freq.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-keep-timestamp.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-log-fetch-limit.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-file-log-iw-size.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-log-msg-size.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-log-prefix.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-multi-line-garbage.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-multi-line-mode.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-multi-line-prefix.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-multi-line-suffix.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-pad-size.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-program-override.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-tags.htm"></MadCap:sinppetBlock>


<MadCap:sinppetBlock src="../../shared/chunk/option-source-time-zone.htm"></MadCap:sinppetBlock>

</body></html>
