
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="syslog-ng-upgrade-ose-to-pe" oldrole="procedure">
<h1 name="syslog-ng-upgrade-ose-to-pe" xmlns="http://docbook.org/ns/docbook">Upgrading from syslog-ng OSE to <MadCap:variable name="General.abbrev"></MadCap:variable></h1>
<h6 oldrole="formalpara">Purpose:</h6>

<p oldrole="para">The cleanest way to upgrade from syslog-ng OSE to <MadCap:variable name="General.abbrev"></MadCap:variable> is to remove the syslog-ng OSE package from the system. This way you can avoid the packaging conflicts and feature differences.</p>
<p oldrole="para">In the example procedure provided here, we describe an upgrade of syslog-ng OSE version 3.12 from unofficial repositories running on Red Hat Enterprise Linux 7.4 to <MadCap:variable name="General.abbrev"></MadCap:variable> version 7.0.4. The process should work in a fairly similar way when using other OS or syslog-ng versions.</p>
<h6 oldrole="formalpara">Steps:</h6>

<ol oldrole="procedure"><li oldrole="step">
<p oldrole="para">Remove syslog-ng OSE.</p>
<p oldrole="para">The following instructions assume that the user is in the <span class="Code" oldrole="filename">/root</span> directory.</p>
<ol oldrole="substeps">
<li oldrole="step">
<p oldrole="para">Unless you have not touched the syslog-ng configuration at all, make a backup of <span class="Code" oldrole="filename">syslog-ng.conf</span> first. Copy the contents of <span class="Code" oldrole="filename">/etc/syslog-ng</span> to a directory under <span class="Code" oldrole="filename">/root</span> (or where you can find it), so you have a backup you can work from later:</p>
<pre class="Code" oldrole="synopsis">cp -R /etc/syslog-ng sngose</pre>
</li>
<li oldrole="step">
<p oldrole="para">Remove the syslog-ng package and dependent subpackages:</p>
<pre class="Code" oldrole="synopsis">yum erase syslog-ng</pre>
</li>
<li oldrole="step">
<p oldrole="para">Remove the <span class="Code" oldrole="filename">/etc/syslog-ng</span> directory:</p>
<pre class="Code" oldrole="synopsis">rm -fr /etc/syslog-ng</pre>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">Check the output of yum carefully. If there are any applications listed other than syslog-ng and subpackages, remove syslog-ng using <b oldrole="command">rpm -e ânodeps</b>, so dependent packages are not removed.</p></td></tr></tbody></table>
</li>
</ol>
</li><li oldrole="step">
<p oldrole="para">Install <MadCap:variable name="General.abbrev"></MadCap:variable>.</p>
<p oldrole="para">The following instructions assume that the <MadCap:variable name="General.abbrev"></MadCap:variable> rpm package is available in the current directory. You can install <MadCap:variable name="General.abbrev"></MadCap:variable> using the following command:</p>
<pre class="Code" oldrole="synopsis">[root@localhost ~]# rpm -Uvh syslog-ng-premium-edition-compact-7.0.5-1.rhel7.x86_64.rpm
Preparing...                          ################################# [100%]
Trying to stop syslog services on Linux, using systemd services.
Updating / installing...
   1:syslog-ng-premium-edition-compact################################# [100%]
Created symlink from /etc/systemd/system/multi-user.target.wants/syslog-ng.service to /usr/lib/systemd/system/syslog-ng.service.
[root@localhost ~]#</pre>
</li><li oldrole="step">
<p oldrole="para">Merge configurations.</p>
<p oldrole="para">The configuration file of the freshly installed <MadCap:variable name="General.abbrev"></MadCap:variable> is available under <span class="Code" oldrole="filename">/opt/syslog-ng/etc/syslog-ng.conf</span>. Start by making a backup of it.</p>
<p oldrole="para">The next steps largely depend on the particulars of your previous syslog-ng OSE configuration and what you want to achieve:</p>
<ol oldrole="substeps">
<li oldrole="step">
<p oldrole="para">Append your old OSE configuration to <span class="Code" oldrole="filename">/opt/syslog-ng/etc/syslog-ng.conf</span>.</p>
</li>
<li oldrole="step">
<p oldrole="para">Edit out redundant configuration parts, for example, a version declaration.</p>
</li>
<li oldrole="step">
<p oldrole="para">Edit out those configuration parts that refer to features unavailable in <MadCap:variable name="General.abbrev"></MadCap:variable>, such as the Riemann destination.</p>
<p oldrole="para">If you try to start <MadCap:variable name="General.abbrev"></MadCap:variable> with an unknown feature enabled, it fails with a similar error message (in the example, it is the Riemann destination that is causing the error):</p>
<pre class="Code" oldrole="synopsis">/opt/syslog-ng/sbin/syslog-ng -s
Error parsing destination, destination plugin riemann not found in /opt/syslog-ng/etc/syslog-ng.conf at line 41, column 2:

    riemann(
    ^^^^^^^</pre>
</li>
<li oldrole="step">
<p oldrole="para">Syntax check your configuration using the <span class="Code" oldrole="userinput">-s</span> option of syslog-ng. Make sure that you use the full path to <MadCap:variable name="General.abbrev"></MadCap:variable>, or add it to the PATH:</p>
<pre class="Code" oldrole="synopsis">/opt/syslog-nb/sbin/syslog-ng -s</pre>
</li>
<li oldrole="step">
<p oldrole="para">If no errors are found, stop syslog-ng:</p>
<pre class="Code" oldrole="synopsis">systemctl stop syslog-ng</pre>
</li>
<li oldrole="step">
<p oldrole="para">Try to start syslog-ng from the command line in the foreground using the <span class="Code" oldrole="userinput">-F</span> option, so you can see any errors:</p>
<pre class="Code" oldrole="synopsis">/opt/syslog-ng/sbin/syslog-ng -F</pre>
<p oldrole="para">Some common error messages and explanations:</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">syslog-ng OSE uses <span class="Code" oldrole="userinput">s_sys</span> for references to local system sources, while <MadCap:variable name="General.abbrev"></MadCap:variable> uses <span class="Code" oldrole="userinput">s_local</span>. Remember to rename such references, otherwise a similar error message will be displayed:</p>
<pre class="Code" oldrole="synopsis">[2017-10-03T14:04:18.968550] Error resolving reference; content='source', name='s_sys', location='/opt/syslog-ng/etc/syslog-ng.conf:86:2'</pre>
</li>
<li oldrole="listitem">
<p oldrole="para">Some features of <MadCap:variable name="General.abbrev"></MadCap:variable> require a license file to be present. In the example shown here, a Java plugin failed to initialize due to a missing license:</p>
<pre class="Code" oldrole="synopsis">[2017-10-03T14:07:05.894534] syslog-ng running in client/relay mode, cannot initialize plugin; plugin name='java'
[2017-10-03T14:07:05.894560] Error initializing message pipeline; plugin name='java', location='#buffer:2:3'</pre>
</li>
</ul>
<p oldrole="para">Once you have made sure that your configuration works fine, you do not have to start syslog-ng in the foreground anymore.</p>
</li>
<li oldrole="step">
<p oldrole="para">Stop syslog-ng using <span class="Code" oldrole="userinput">Ctrl-C</span>.</p>
</li>
<li oldrole="step">
<p oldrole="para">Start syslog-ng as a service using <span class="Code" oldrole="userinput">systemctl start syslog-ng</span>.</p>
</li>
</ol>
</li></ol></body></html>
