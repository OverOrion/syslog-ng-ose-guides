<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="10" MadCap:lastHeight="2455" MadCap:lastWidth="1414">
    <head>
        <meta name="description" content="" />
    </head>
    <body name="chapter-examples" oldrole="chapter">
        <h1 name="chapter-examples" version="5.0" xmlns="http://docbook.org/ns/docbook">Best practices and examples</h1>
        <p oldrole="para">This chapter discusses some special examples and recommendations.</p>
        <h2 name="example-general">General recommendations</h2>
        <p oldrole="para">This section provides general tips and recommendations on using syslog-ng. Some of the recommendations are detailed in the subsequent sections.</p>
        <ul oldrole="itemizedlist">
            <MadCap:keyword term="facilities">
            </MadCap:keyword>
            <li oldrole="listitem">
                <p oldrole="para">Do not base the separation of log messages into different files on the <span class="Code" oldrole="parameter">facility</span> parameter. As several applications and processes can use the same facility, the facility does not identify the application that sent the message. By default, the <span class="Code" oldrole="parameter">facility</span> parameter is not even included in the log message itself. In general, sorting the log messages into several different files can make finding specific log messages difficult. If you must create separate log files, use the application name.</p>
            </li>
            <li oldrole="listitem">
                <MadCap:keyword term="timestamp">
                </MadCap:keyword>
                <p oldrole="para">Standard log messages include the local time of the sending host, without any time zone information. It is recommended to replace this timestamp with an ISODATE timestamp, because the ISODATE format includes the year and timezone as well. To convert all timestamps to the ISODATE format, include the following line in the syslog-ng configuration file:</p><pre class="Code" oldrole="synopsis">options {ts-format(iso) ; };</pre>
            </li>
            <li oldrole="listitem">
                <MadCap:keyword term="name resolution">
                </MadCap:keyword>
                <p oldrole="para">Resolving the IP addresses of the clients to domain names can decrease the performance of syslog-ng. For details, see <MadCap:xref href="chapter-examples.htm#examples-dns"></MadCap:xref>.</p>
            </li>
        </ul>
        <h2 name="handling-large-load">Handling large message load</h2>
        <MadCap:keyword term="optimizing syslog-ng performance">
        </MadCap:keyword>
        <MadCap:keyword term="filters">
        </MadCap:keyword>
        <MadCap:keyword term="regular expressions">
        </MadCap:keyword>
        <p oldrole="para">This section provides tips on optimizing the performance of syslog-ng. Optimizing the performance is important for syslog-ng hosts that handle large traffic.</p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">Disable DNS resolution, or resolve hostnames locally. For details, see <MadCap:xref href="chapter-examples.htm#examples-dns"></MadCap:xref>.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Enable flow-control for the TCP sources. For details, see <MadCap:xref href="chapter-routing-filters.htm#concepts-flow-control"></MadCap:xref>.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Do not use the <span class="Code" oldrole="parameter">usertty()</span> destination driver. Under heavy load, the users are not be able to read the messages from the console, and it slows down syslog-ng.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Do not use regular expressions in our filters. Evaluating general regular expressions puts a high load on the CPU. Use simple filter functions and logical operators instead. For details, see <MadCap:xref href="chapter-manipulating-messages.htm#regular-expressions"></MadCap:xref>.</p>
            </li>
            <li oldrole="listitem">
                <MadCap:snippetBlock src="../../shared/wnt/warning-udp-recvbuf.htm">
                </MadCap:snippetBlock>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Increase the value of the <span class="Code" oldrole="parameter">flush-lines()</span> parameter. Increasing <span class="Code" oldrole="parameter">flush-lines()</span> from <span class="Code" oldrole="userinput">0</span> to <span class="Code" oldrole="userinput">100</span> can increase the performance of <MadCap:variable name="General.abbrev"></MadCap:variable> by 100%.</p>
            </li>
        </ul>
        <!-- FIXME the sync option is obsolete, should be updated to flush-lines - if this section is needed at all -->
        <!--	<section xml:id="sync">
            <title>The sync() parameter</title>

            <indexterm>
            <primary>parameters</primary>
            <secondary>sync()</secondary>
            </indexterm>
            <para>The syslog-ng application buffers the log messages to be sent in an output queue. The
            <parameter>sync()</parameter> parameter specifies the number of messages held in
            this buffer.</para>
            <para>Note that syslog-ng does not write all buffered messages into a single chunk; each
            message is written with a single <parameter>write()</parameter> system call.</para>
            <para>For file destinations, the received messages can be written to disk immediately after
            the message is received. To accomplish this, set the <parameter>sync()</parameter>
            option to zero.</para>
            <synopsis>
            options { sync(0); };
            </synopsis>
            </section>-->
        <h2 name="examples-dns">Using name resolution in syslog-ng</h2>
        <MadCap:keyword term="name resolution">
        </MadCap:keyword>
        <p oldrole="para">The syslog-ng application can resolve the hostnames of the clients and include them in the log messages. However, the performance of syslog-ng is severely degraded if the domain name server is unaccessible or slow. Therefore, it is not recommended to resolve hostnames in syslog-ng. If you must use name resolution from syslog-ng, consider the following:</p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">Use DNS caching. Verify that the DNS cache is large enough to store all important hostnames. (By default, the syslog-ng DNS cache stores <span class="Code" oldrole="userinput">1007</span> entries.)</p><pre class="Code" oldrole="synopsis">options { dns-cache-size(2000); };</pre>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">If the IP addresses of the clients change only rarely, set the expiry of the DNS cache large.</p><pre class="Code" oldrole="synopsis">options { dns-cache-expire(87600); };</pre>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">If possible, resolve the hostnames locally. For details, see <MadCap:xref href="example-local-dns.htm#example-local-dns"></MadCap:xref>.</p>
            </li>
        </ul>
        <table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');">
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2">
            </col>
            <tbody>
                <tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1">
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1">
                        <p>
                            <img src="../../Resources/Images/Common/note.png" />
                        </p>
                    </td>
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span>
                        <p oldrole="para">Domain name resolution is important mainly in relay and server mode.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <MadCap:snippetBlock src="example-local-dns.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="example-chroot.htm">
        </MadCap:snippetBlock>
        <h2 name="example-logrotate">Configuring log rotation</h2>
        <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application does not rotate logs by itself. To use <MadCap:variable name="General.abbrev"></MadCap:variable> for log rotation, consider the following approaches:</p>
        <h6 oldrole="formalpara">Use logrotate together with <MadCap:variable name="General.abbrev"></MadCap:variable>:</h6>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">Ideal for workstations or when processing fewer logs.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">It is included in most distributions by default.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Less scripting is required, only <b oldrole="command">logrotate</b> has to be configured correctly.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Requires frequent restart (<MadCap:variable name="General.abbrev"></MadCap:variable> must be reloaded/restarted when the files are rotated). After rotating the log files, reload <MadCap:variable name="General.abbrev"></MadCap:variable> using the <b oldrole="command">syslog-ng-ctl reload</b> command, or use another method to send a SIGHUP to <MadCap:variable name="General.abbrev"></MadCap:variable>.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">The statistics collected by <MadCap:variable name="General.abbrev"></MadCap:variable>, and the correlation information gathered with Pattern Database is lost with each restart.</p>
            </li>
        </ul>
        <h6 oldrole="formalpara">Separate incoming logs based on time, host or other information:</h6>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">Ideal for central log servers, where regular restart of <MadCap:variable name="General.abbrev"></MadCap:variable> is unfavorable.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Requires shell scripts or cron jobs to remove old logs.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">It can be done by using macros in the destination name (in the filename, directory name, or the database table name).</p>
            </li>
        </ul>
        <h6 oldrole="example">Example: File destination for log rotation </h6>
        <p oldrole="para">This sample file destination configuration stores incoming logs in files that are named based on the current year, month and day, and places these files in directories that are named based on the hostname:</p><pre class="Code" oldrole="synopsis">destination d_sorted { file("/var/log/remote/${HOST}/${YEAR}_${MONTH}_${DAY}.log" create-dirs(yes)); };</pre>
        <h6 condition="pe" oldrole="example">Example: Logstore destination for log rotation </h6>
        <p oldrole="para">This sample logstore destination configuration stores incoming logs in logstores that are named based on the current year, month and day, and places these logstores in directories that are named based on the hostname:</p><pre class="Code" oldrole="synopsis">destination d_logstore { logstore("/var/log/remote/${HOST}/${YEAR}_${MONTH}_${DAY}.lgs" create-dirs(yes)); };</pre>
        <h6 oldrole="example">Example: Command for cron for log rotation</h6>
        <p oldrole="para">This sample command for <b oldrole="command">cron</b> removes files older than two weeks from the <span class="Code" oldrole="filename">/var/log/remote</span> directory:</p><pre class="Code" oldrole="synopsis">find /var/log/remote/ -daystart -mtime +14 -type f -exec rm {} \;</pre>
    </body>
</html>