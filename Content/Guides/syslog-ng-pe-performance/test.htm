<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <body name="test-environment" oldrole="section">
        <h1 name="test-environment">The test environment</h1>
        <p oldrole="para">The test environment consisted of a single client and a server hardware, connected via a Gigabit switch. Note that in certain test runs, the client opened several separate connections to the servers to simulate real-life logging environments. The <MadCap:variable name="General.product"></MadCap:variable> application was installed from the <span class="Code" oldrole="filename">.run</span> package.</p>
        <h6 oldrole="formalpara">Hardware parameters:</h6>
        <p oldrole="para">The client hardware had the following main parameters:</p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">2x Intel® Xeon® Processor E5-2620 v3 (15M Cache, 2.40 GHz, 8 GT/s Intel® QPI, 6 cores)</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Hyperthreading disabled, turbo boost disabled</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">16 GB RAM</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">10 Gbps Ethernet</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">HDD 500 GB</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Operating system: <span class="Code" oldrole="parameter">ubuntu-xenial amd64</span></p>
            </li>
        </ul>
        <p oldrole="para">The server hardware had the following main parameters:</p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">2x Intel® Xeon® Processor E5-2620 v3 (15M Cache, 2.40 GHz, 8 GT/s Intel® QPI, 6 cores)</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Hyperthreading disabled, turbo boost disabled</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">16 GB RAM</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">10 Gbps Ethernet</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">SSD 500 GB</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Operating system: <span class="Code" oldrole="parameter">ubuntu-xenial amd64</span></p>
            </li>
        </ul>
        <h6 oldrole="formalpara">Performance improvement:</h6>
        <p oldrole="para">The following settings were used for performance improvement:</p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">Improving performance with lots of connections:</p>
                <p>
                    <literallayout>max_connections = active_connections
log_iw_size = number of active_connections * 1000
log_fetch_limit = 1000
flush_lines = 1000
log_fifo_size = log_iw_size * 2
use_dns = no
keep_hostname = yes
keep_timestamp = no</literallayout>
                </p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Improving performance with a few connections but high amount of traffic:</p>
                <p oldrole="para">Source side:</p>
                <p>
                    <literallayout>log_iw_size = number of active_connections * 100,000
log_fetch_limit = number of active_connections * 100,000
</literallayout>
                    <p oldrole="para">Destination side:</p>
                    <literallayout>log_fifo_size = max_connections * (log_iw_size/number of active_connections)
flush_lines = 10,000 or greater</literallayout>
                </p>
            </li>
        </ul>
        <h6 oldrole="formalpara">Resource usage:</h6>
        <p oldrole="para">The performance tests were carried out in multithreaded mode:</p>
        <p> <literallayout>threaded(yes)</literallayout></p>
        <p oldrole="para">One way to optimize the resource usage of <MadCap:variable name="General.abbrev"></MadCap:variable> is to limit the number of worker threads that syslog-ng uses. This helps prevent <MadCap:variable name="General.abbrev"></MadCap:variable> from using all available CPUs. You can limit the number of worker threads using the <span class="Code" oldrole="parameter">--worker-threads</span> command-line option that sets the maximum total number of threads <MadCap:variable name="General.abbrev"></MadCap:variable> can use, including the main <MadCap:variable name="General.abbrev"></MadCap:variable> thread.</p>
        <p oldrole="para">Note, however, that SQL sources and destinations, as well as Java destinations, such as Elasticsearch, HDFS, and Apache Kafka, always run in their own, separate threads. This means that the <span class="Code" oldrole="parameter">--worker-threads</span> command-line option has no impact on them.</p>
    </body>
</html>