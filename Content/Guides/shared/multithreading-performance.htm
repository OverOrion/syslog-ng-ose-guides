<?xml version="1.0" encoding="UTF-8"?>

<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="section-multithreading-performance" oldrole="section">
<h1 name="section-multithreading-performance">Optimizing multithreaded performance</h1>
<MadCap:keyword term="performance:['optimizing multithreading']"></MadCap:keyword>
<h6 oldrole="formalpara">Sources:</h6>

<p oldrole="para">File sources scale based on the number of files that the <MadCap:variable name="General.abbrev"></MadCap:variable> is reading. If there are 10 files all coming to the same source, then that source can use 10 threads, one thread for each file.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span><p oldrole="para">When collecting log messages from multiple files, the file source is a <span class="Code" oldrole="parameter">wildcard-file()</span> source.</p></td></tr></tbody></table>
<p oldrole="para">TCP-based network sources scale based on the number of active connections. This means that if there are 10 incoming connections all coming to the same source, then that source can use 10 threads, one thread for each connection.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span><p oldrole="para">UDP-based network sources do not scale by themselves because they always use a single thread. If you want to handle a large number of UDP connections, it is best to configure a subset of your clients to send the messages to a different port of your syslog-ng server, and use separate source definitions for each port.</p></td></tr></tbody></table>
<p class="CaptionFigure">How multithreading works — sources</p>
<p><img class="Image" contentwidth="&screenshotsize;" fileref="&imgroot;/multithreading-sources.png" format="PNG" MadCap:mediastyle="@media print { width: auto; height: auto; }" oldrole="figure" src="../Resources/Images_Notlocalized/syslog-ng-pe-guide-admin/multithreading-sources.png" style="height: auto; width: auto;"/></p>
<h6 oldrole="formalpara">Message processors:</h6>

<p oldrole="para">Message processors — such as filters, rewrite rules, and parsers — are executed by the reader thread in a sequential manner.</p>
<p oldrole="para">For example, if you have a log path that defines two sources and a filter, the filter will be performed by the source1 reader thread when log messages come from source1, and by the source2 reader thread when log messages come from source2. This means that if log messages come from both source1 and source2, they will both have a reader thread and that way filtering will be performed simultaneously.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span><p oldrole="para">This is not true for PatternDB because it uses message correlation. When using PatternDB, it runs in only one thread at a time, and this significantly decreases performance.</p></td></tr></tbody></table>
<h6 oldrole="formalpara">Destinations:</h6>

<p oldrole="para">In syslog-ng, every destination has a writer thread. To improve scaling on the destination side, use multiple destinations instead of one.</p>
<p oldrole="para">For example, when sending messages to a syslog-ng server, you can use multiple connections to the server if you configure the syslog-ng server to receive messages on multiple ports, and configure the clients to use both ports.</p>
<p oldrole="para">When writing the log messages to files, use macros in the filename to split the messages to separate files (for example, using the ${HOST} macro). Files with macros in their filenames are processed in separate writer threads.</p>
<p class="CaptionFigure">How multithreading works — destinations</p>
<p><img class="Image" contentwidth="&screenshotsize;" fileref="&imgroot;/multithreading-destinations.png" format="PNG" MadCap:mediastyle="@media print { width: auto; height: auto; }" oldrole="figure" src="../Resources/Images_Notlocalized/syslog-ng-pe-guide-admin/multithreading-destinations.png" style="height: auto; width: auto;"/></p>
</body></html>
