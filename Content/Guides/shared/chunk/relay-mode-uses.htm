<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1>Example relay use cases</h1>
        <p>The relay collects log messages through the network, and after processing, but without writing them onto the disk for storage, forwards them to one or more remote destinations. </p>
        <p>You can use a relay for many different use cases as described in the examples below:</p>
        <h6>UDP-only source devices</h6>
        <p>Most network devices send log messages over UDP. However, UDP does not guarantee that all UDP packets are delivered and this makes UDP unreliable. </p>
        <p>To ensure at least a best effort level of reliability, <MadCap:variable name="CommonVariables.CompanyNameShort" /> recommends that you deploy a relay on the network, close to the source devices. With the  most reliable hops between the source and the relay, you can minimize the risk of losing UDP packets. Once the packet arrives at the relay, <a href="https://syslog-ng.com/blog/upgrading-from-syslog-ng-open-source-to-premium-edition/"><MadCap:variable name="General.oseabbrev" MadCap:conditions="General.ose" /><MadCap:variable name="General.peabbrev" MadCap:conditions="General.pe" /></a> ensures that the messages are delivered to the central server in a reliable manner, based on TCP/TLS, and for <MadCap:variable name="General.peabbrev" /> only, Advanced Log Transfer Protocol (ALTP).</p>
        <h6>Too many source devices</h6>
        <p>Depending on the hardware and configuration, an average syslog-ng instance can usually handle the following number of concurrent connections:</p>
        <ul>
            <li>If the maximum message rate is lower than 200,000 messages per second:</li>
            <ul>
                <li>
                    <p>maximum ca. 5,000 TCP connections</p>
                </li>
                <li>
                    <p>maximum ca. 1,000 TLS connections</p>
                </li>
                <li>
                    <p>maximum ca. 1,000 ALTP connections</p>
                </li>
            </ul>
            <li>
                <p>If the message rate is higher than 200,000 messages per second, contact <MadCap:variable name="CommonVariables.CompanyNameShort" />.</p>
            </li>
        </ul>
        <p>As a result, if you have more source devices, you must deploy a relay machine at least per 5,000 sources and batch up all the logs into a single TCP connection that connects the relay to the server. If TLS or ALTP is used, you must deploy relays  per 1,000 source devices.</p>
        <h6>Collecting logs from remote sites (especially over public WAN)</h6>
        <p>If you need to collect log messages from geographically remote sites or over public WAN, <MadCap:variable name="CommonVariables.CompanyNameShort" /> recommends that you  install a relay node at least per each remote site. The relay can be the last outgoing hop for all the messages of the remote site, which has several benefits:</p>
        <ul>
            <li>
                <p><b>Maintenance</b>: You only need to change the configuration of the relay if you want to re-route the logs of some or all sources of the remote site. Also you do not need to change each source’s configuration one by one.<br /></p>
            </li>
            <li>
                <p><b>Security</b>: If you trust your internal network, it is not necessary to hold encrypted connections within the LAN of the remote site, as the messages can get to the relay without encryption. Messages must be sent in an encrypted way over the public WAN, and it is enough the hold only a single TCP/TLS connection between the sites, that is, between the remote relay and the central server. This eliminates the wasting of resources as holding several TLS connections directly from the clients is more costly than holding a single connection from the relay.</p>
            </li>
            <li>
                <p><b>Reliability</b>: You can set up a main disk-buffer on the relay. The main disk-buffer is only responsible for buffering all the logs of the remote site if the central <MadCap:variable name="General.oseabbrev" MadCap:conditions="General.ose" /><MadCap:variable name="General.peabbrev" MadCap:conditions="General.pe" /> server is temporarily unavailable. It is easier to maintain this single large main disk-buffer instead of setting disk-buffers on individual client machines.</p>
            </li>
        </ul>
        <h6>Separation, distribution, balancing of message processing tasks</h6>
        <p>Most Linux applications have their own human readable, but difficult to handle, log messages. Without parsing and normalization, it is difficult to alert and report on these log messages. Many syslog-ng users utilize the message parsing tools of syslog-ng to normalize their different log messages. Just like normalization, filtering can also be resource-heavy, depending on what the filtering is based on. In this case, it might be inefficient to perform all the message processing tasks on the server (which can result in decreased overall performance). It is a typical setup todeploy relays in front of the central server operating as a receiver front-end. Most resource-heavy tasks (for example, parsing, filtering, etc) are performed on this receiver layer. As all resource-heavy tasks are performed on the relay, the central server behind it only needs to get the messages from the relay and write them into the final text-based or tamper-proof format (logstore, PE only). As you have the means to run more relays, you can balance the resource-heavy tasks between more relays and a single server behind them can still be fast enough to write all the messages onto the disk.</p>
        <p>Acting as a relay depends on the functionality. Namely, a relay doesn't have to be a dedicated relay machine at all. In fact, it can be one of the clients with a relay configuration in terms of log collection. On the other hand, in a robust log collection infrastructure the relays have their own purpose, therefore it is recommended to run dedicated relay machines in such cases.</p>
        <p>When it comes to the commercial PE version of syslog-ng, the relays are included in the price (at least until the licensed LSH number). Hence, you can run several parallel relays to ensure horizontal redundancy. Let's say each of the relays has the very same configuration and if one goes down, an other relay can take over processing. Distribution of the logs can be done by the built-in client-side failover functionality and by a general load-balancer as well. The latter is also used to serve N+1 redundant relay deployments (in this case, switching from one relay to an other relay is done not only due to an outage, but due to real load-balancing purposes, too).</p>
        <h6>What syslog-ng relays are not good for</h6>
        <p>The purpose of the relay is to buffer the logs for short term (for example, a few minutes or a few hours long, depending on the log volume) outages. It is not designed to buffer logs generated by the sources during a very long (for example, up to a few days long) server or connection outage.</p>
        <p>If you expect extended outages, we recommend that you deploy servers instead of relays. There are many deployments where long term storage and archiving are performed on the central syslog-ng server, but relays also do short-term log storage. From the syslog-ng PE point of view, these are servers, and thus need separate server licenses.</p>
        <p>&#160;</p>
    </body>
</html>