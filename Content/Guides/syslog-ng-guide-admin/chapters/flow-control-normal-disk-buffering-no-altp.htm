<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css" rel="stylesheet" MadCap:stylesheetType="table" />
        <meta name="description" content="" />
    </head>
    <body name="flow-control-normal-disk-buffering-no-altp">
        <h1 name="flow-control-normal-disk-buffering-no-altp">Flow control, normal disk-buffer option, no <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /></h1>
        <h6>How it works:</h6>
        <ol>
            <li><MadCap:variable name="General.abbrev" /> puts messages into the disk-buffer file (set via <span class="Code">disk-buf-size()</span>) when the destination becomes unavailable or when it is not able to process logs as fast as they arrive through the sources.</li>
            <li>When the disk-buffer file is full, <MadCap:variable name="General.abbrev" /> puts messages into the memory buffer (set via <span class="Code">mem-buf-length()</span>). When the memory buffer gets full too, then <MadCap:variable name="General.abbrev" /> stops the source (flow-control mechanism).</li>
        </ol>
        <p class="CaptionFigure" MadCap:autonum="Figure 1: ">Flow control, normal disk buffering, no <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /></p>
        <p>
            <img src="../../Resources/Images_Notlocalized/syslog-ng-pe-guide-admin/flow-control-normal-disk-buffering-no-altp.png" />
        </p>
        <h6>How to set key parameters:</h6>
        <p>Set <span class="Code">flags(flow-control)</span> in the log path.</p>
        <p>The memory buffer must be large enough to store the incoming messages of every source:</p>
        <p><span class="Code">mem-buf-length()</span> &gt; sum of <span class="Code">log-iw-size()</span> of sources connected to this destination</p>
        <p>Configure the disk-buffer option. For details, see <MadCap:xref href="#config-normal-disk-buffering" class="HeadingOnPage"><span style="color: #04aada;" class="mcFormatColor">Example: Example configuration of the normal disk-buffer option</span></MadCap:xref>.</p>
        <div class="Example">
            <h6 oldrole="example"><a name="config-normal-disk-buffering"></a>Example: Example configuration of the normal disk-buffer option</h6><pre class="Code" oldrole="synopsis">disk-buffer(
	mem-buf-length(20000) # storing 20000 messages in memory, sum log-iw-size of sources should be less than 20000 to use flow-control
	disk-buf-size(2147483648) # storing 2 GB of messages on disk
	reliable(no)
)</pre>
        </div>
        <h6>Benefits:</h6>
        <p>This configuration minimizes the loss of log messages in the following situations:</p>
        <ul>
            <li><i>Unreachable destination server(s)</i>: Only as many incoming log messages are read as can be "delivered". When flow control is used in combination with disk buffering, messages that have been written to the disk-buffer file and/or the memory buffer are considered delivered. When the memory buffer becomes full, <MadCap:variable name="General.abbrev" /> stops reading messages from the configured sources. This means that no log messages get lost.</li>
            <li><i>Message loss outside of <MadCap:variable name="General.abbrev" /></i>: The greatest advantage of this configuration over when the disk-buffer option is not used at all is that when the <span class="Code">log-iw-size()</span> control window is full, the flow-control mechanism stops reading logs from the sources much later. This is because when it is not possible to send logs directly to the destinations, they are first written to the disk and then the memory buffer. It is only after both the disk-buffer file and the memory buffer have been filled to their full capacity that the sources are stopped. This enables you to minimize the loss of log messages during peak hours or when the network is temporarily down.</li>
            <li>
                <p><i>Message loss when <MadCap:variable name="General.abbrev" /> is stopped or restarted</i>: When syslog-ng is stopped or restarted, the contents of the memory buffer and the disk-buffer file are flushed to disk, meaning that no log loss occurs.</p>
                <MadCap:snippetBlock src="note-corrupted-disk-buffer.flsnp" />
            </li>
        </ul>
        <h6>Drawbacks:</h6>
        <p>One drawback of using the disk-buffer option is that the processing of log messages by <MadCap:variable name="General.abbrev" /> is slower.</p>
        <p>This configuration does not provide protection against the loss of log messages in the following situations:</p>
        <ul>
            <MadCap:snippetBlock src="reliability-tcp-error.flsnp" />
            <MadCap:snippetBlock src="reliability-unable-to-operate-normally.flsnp" />
        </ul>
    </body>
</html>