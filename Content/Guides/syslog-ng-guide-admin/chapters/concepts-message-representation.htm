<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="concepts-message-representation" oldrole="section">
<h1 name="concepts-message-representation">Message representation in &abbrev;</h1>
<MadCap:keyword term="log messages, representation"></MadCap:keyword>
<p oldrole="para">When the &abbrev; application receives a message, it automatically parses the message. The &abbrev; application can automatically parse log messages that conform to the RFC3164 (BSD or legacy-syslog) or the RFC5424 (IETF-syslog) message formats. If &abbrev; cannot parse a message, it results in an error.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="tip" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">TIP: </span><p oldrole="para">In case you need to relay messages that cannot be parsed without any modifications or changes, use the <span class="Code" oldrole="parameter">flags(no-parse)</span> option in the source definition, and a template containing only the <span class="Code" oldrole="parameter">${MSG}</span> macro in the destination definition.</p><p oldrole="para">To parse non-syslog messages, for example, JSON, CSV, or other messages, you can use the built-in parsers of &abbrev;. For details, see <MadCap:xref href="chapter-parsers.htm#chapter-parsers"></MadCap:xref>.</p></td></tr></tbody></table>
<p oldrole="para">A parsed syslog message has the following parts.</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<h6 oldrole="formalpara">Timestamps</h6>
<p oldrole="para">Two timestamps are associated with every message: one is the timestamp contained within the message (that is, when the sender sent the message), the other is the time when &abbrev; has actually received the message.</p>
</li>
<li oldrole="listitem">
<h6 oldrole="formalpara">Severity</h6>
<p oldrole="para">The severity of the message.</p>
</li>
<li oldrole="listitem">
<h6 oldrole="formalpara">Facility</h6>
<p oldrole="para">The facility that sent the message.</p>
</li>
<li oldrole="listitem">
<h6 oldrole="formalpara">Tags</h6>
<p oldrole="para">Custom text labels added to the message that are mainly used for filtering. None of the current message transport protocols adds tags to the log messages. Tags can be added to the log message only within &abbrev;. The &abbrev; application automatically adds the id of the source as a tag to the incoming messages. Other tags can be added to the message by the pattern database, or using the <span class="Code" oldrole="parameter">tags()</span> option of the source.</p>
</li>
<li oldrole="listitem">
<h6 oldrole="formalpara">IP address of the sender</h6>
<p oldrole="para">The IP address of the host that sent the message. Note that the IP address of the sender is a hard macro and cannot be modified within &abbrev; but the associated hostname can be modified, for example, using rewrite rules.</p>
<!-- FIXME is this the original sender, or the last relay? -->
</li>
<li oldrole="listitem">
<h6 oldrole="formalpara">Hard macros</h6>
<MadCap:keyword term="macros:['hard']"></MadCap:keyword>
<MadCap:keyword term="macros:['read-only']"></MadCap:keyword>
<MadCap:keyword term="hard macros"></MadCap:keyword>
<MadCap:keyword term="read-only macros"></MadCap:keyword>
<p oldrole="para">Hard macros contain data that is directly derived from the log message, for example, the ${MONTH} macro derives its value from the timestamp. The most important consideration with hard macros is that they are read-only, meaning they cannot be modified using rewrite rules or other means.</p>
</li>
<li oldrole="listitem">
<h6 oldrole="formalpara">Soft macros</h6>
<MadCap:keyword term="macros:['soft']"></MadCap:keyword>
<MadCap:keyword term="macros:['rewritable']"></MadCap:keyword>
<MadCap:keyword term="soft macros"></MadCap:keyword>
<MadCap:keyword term="rewritable macros"></MadCap:keyword>
<p oldrole="para">Soft macros (sometimes also called name-value pairs) are either built-in macros automatically generated from the log message (for example, ${HOST}), or custom user-created macros generated by using the syslog-ng pattern database or a CSV-parser. The SDATA fields of RFC5424-formatted log messages become soft macros as well. In contrast with hard macros, soft macros are writable and can be modified within &abbrev;, for example, using rewrite rules.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span><p oldrole="para">It is also possible to set the value of built-in soft macros using parsers, for example, to set the ${HOST} macro from the message using a column of a CSV-parser.</p><p oldrole="para">The data extracted from the log messages using named pattern parsers in the pattern database are also soft macros.</p></td></tr></tbody></table>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="tip" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">TIP: </span><p oldrole="para">For the list of hard and soft macros, see <MadCap:xref href="macros-hard-vs-soft.htm#macros-hard-vs-soft"></MadCap:xref>.</p></td></tr></tbody></table>
</li>
</ul>

<h6 name="message-size-and-encoding" oldrole="simplesect">Message size and encoding</h6>
<MadCap:keyword term="message encoding"></MadCap:keyword>
<MadCap:keyword term="truncating messages"></MadCap:keyword>
<p oldrole="para">Internally, &abbrev; represents every message as UTF-8. The maximal length of the log messages is limited by the <span class="Code" oldrole="parameter">log-msg-size()</span> option: if a message is longer than this value, &abbrev; truncates the message at the location it reaches the <span class="Code" oldrole="parameter">log-msg-size()</span> value, and discards the rest of the message.</p>
<p oldrole="para">When encoding is set in a source (using the <span class="Code" oldrole="parameter">encoding()</span> option) and the message is longer (in bytes) than <span class="Code" oldrole="parameter">log-msg-size()</span> in UTF-8 representation, &abbrev; splits the message at an undefined location (because the conversion between different encodings is not trivial).</p>

</body></html>
