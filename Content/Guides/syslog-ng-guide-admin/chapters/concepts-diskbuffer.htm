<?xml version="1.0" encoding="utf-8"?>

<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <meta name="description" content="" />
    </head>
    <body name="concepts-diskbuffer">
        <h1 name="concepts-diskbuffer">Using disk-based and memory buffering</h1>
        <MadCap:keyword term="disk buffer">
        </MadCap:keyword>
        <MadCap:keyword term="disk-based buffering">
        </MadCap:keyword>
        <MadCap:keyword term="parameters:['log-disk-fifo-size()']">
        </MadCap:keyword>
        
        <p>The <MadCap:variable name="General.product"></MadCap:variable> application can store messages on the local hard disk if the destination (for example, the central log server) or the network connection to the destination becomes unavailable. The <MadCap:variable name="General.abbrev"></MadCap:variable> application automatically sends the stored messages to the destination when the connection is reestablished. The disk buffer is used as a queue: when the connection to the destination is reestablished, <MadCap:variable name="General.abbrev"></MadCap:variable> sends the messages to the destination in the order they were received.</p>
		<div class="Note">
			<p class="Hyphenation"><span class="AllNoteStyles">NOTE:</span> 

			Disk-based buffering can be used in conjunction with flow-control. For details on flow-control, see <MadCap:xref href="concepts-flow-control.htm"><span style="color: #04aada;" class="mcFormatColor">Managing incoming and outgoing messages with flow-control</span></MadCap:xref>.</p>
        </div>
        <MadCap:snippetBlock src="../../shared/chunk/p-disk-buffer-drivers.htm">
        </MadCap:snippetBlock>
        <p>Every such destination uses a separate disk buffer (similarly to the output buffers controlled by <span class="Code" oldrole="parameter">log-fifo-size()</span>). The hard disk space is not pre-allocated, so ensure that there is always enough free space to store the disk buffers even when the disk buffers are full.</p>
        <p>If <MadCap:variable name="General.abbrev"></MadCap:variable> is restarted (using the <span class="Code" oldrole="command">/etc/init.d/syslog-ng restart</span> command, or another appropriate command on your platform), it automatically saves any unsent messages from the disk buffer and the output queue. After the restart, <MadCap:variable name="General.abbrev"></MadCap:variable> sends the saved messages to the destination. In other words, the disk buffer is persistent. The disk buffer is also resistant to <MadCap:variable name="General.abbrev"></MadCap:variable> crashes.</p>
        <p>The <MadCap:variable name="General.abbrev"></MadCap:variable> application supports two types of disk buffering: reliable and normal. For details, see <MadCap:xref href="configuring-diskbuffer-reliable.htm"><span style="color: #04aada;" class="mcFormatColor">Enabling reliable disk-based buffering</span></MadCap:xref> and <MadCap:xref href="configuring-diskbuffer-normal.htm"><span style="color: #04aada;" class="mcFormatColor">Enabling normal disk-based buffering</span></MadCap:xref>, respectively.</p>
        <div>
            <h6>Message handling and normal disk-based buffering</h6>
            <p>When you use disk-based buffering, and the <span class="Code" oldrole="parameter">reliable()</span> option is set to <span class="Code" oldrole="userinput">no</span>, <MadCap:variable name="General.abbrev"></MadCap:variable> handles outgoing messages the following way:</p>
            <p class="CaptionFigure" MadCap:autonum="Figure 1: ">Handling outgoing messages in <MadCap:variable name="General.abbrev"></MadCap:variable></p>
            <img class="Image"    src="../../Images/Figures/fig-syslog-ng-message-output.png"  />
            <ul>
                <li>
                    <p><i>Output queue</i>: Messages from the output queue are sent to the destination (for example, your central log server). The <MadCap:variable name="General.abbrev"></MadCap:variable> application puts the outgoing messages directly into the output queue, unless the output queue is full. By default, the output queue can hold 64 messages (you can adjust it using the <span class="Code" oldrole="parameter">quot-size()</span> option).</p>
                    <MadCap:keyword term="output queue">
                    </MadCap:keyword>
                </li>
                <li>
                    <p><i>Disk buffer</i>: If the output queue is full, disk-buffering is enabled, and <span class="Code" oldrole="parameter">reliable()</span> is set to <span class="Code" oldrole="userinput">no</span>, <MadCap:variable name="General.abbrev"></MadCap:variable> puts the outgoing messages into the disk buffer of the destination. (The disk buffer is enabled if the <span class="Code" oldrole="parameter">disk-buffer()</span> option is configured.)</p>
                    <MadCap:keyword term="disk queue{see}['disk buffer']">
                    </MadCap:keyword>
                </li>
                <li>
                    <p><i>Overflow queue</i>: If the output queue is full and the disk buffer is disabled or full, <MadCap:variable name="General.abbrev"></MadCap:variable> puts the outgoing messages into the overflow queue of the destination. (The overflow queue is identical to the output buffer used by other destinations.) The <span class="Code" oldrole="parameter">log-fifo-size()</span> parameter specifies the number of messages stored in the overflow queue. For details on sizing the <span class="Code" oldrole="parameter">log-fifo-size()</span> parameter, see also <MadCap:xref href="concepts-flow-control.htm"><span style="color: #04aada;" class="mcFormatColor">Managing incoming and outgoing messages with flow-control</span></MadCap:xref>.</p>
                    <MadCap:keyword term="overflow queue{see}['output buffer']">
                    </MadCap:keyword>
                </li>
            </ul>
			<div class="Note">
				<p class="Hyphenation"><span class="AllNoteStyles">NOTE:</span> 

				Using disk buffer can significantly decrease performance.</p>
            </div>
        </div>
        <div>
            <h6>Message handling and reliable disk-based buffering</h6>
            <p>When you use disk-based buffering, and the <span class="Code" oldrole="parameter">reliable()</span> option is set to <span class="Code" oldrole="userinput">yes</span>, <MadCap:variable name="General.abbrev"></MadCap:variable> handles outgoing messages the following way.</p>
            
            <p>The <span class="Code" oldrole="parameter">mem-buf-size()</span> option determines when flow-control is triggered. All messages arriving to the log path that includes the destination using the disk-buffer are written into the disk-buffer, until the size of the disk-buffer reaches (<span class="Code" oldrole="parameter">disk-buf-size()</span> minus <span class="Code" oldrole="parameter">mem-buf-size()</span>). Above that size, messages are written into both the disk-buffer and the memory-buffer, indicating that flow-control needs to slow down the message source. These messages are not taken out from the control window (governed by <span class="Code" oldrole="parameter">log-iw-size()</span>), causing the control window to fill up. If the control window is full, the flow-control completely stops reading incoming messages from the source.</p>
            <p>(As a result, <span class="Code" oldrole="parameter">mem-buf-size()</span> must be at least as large as <span class="Code" oldrole="parameter">log-iw-size()</span>.)</p>
        </div>
    </body>
</html>