<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css" rel="stylesheet" MadCap:stylesheetType="table" />
        <meta name="description" content="" />
    </head>
    <body name="flow-control-normal-disk-buffering-no-altp">
        <h1 name="flow-control-normal-disk-buffering-no-altp">Flow control, reliable disk-buffer, <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /></h1>
        <h6>How it works:</h6>
        <table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');">
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2">
            </col>
            <tbody>
                <tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1">
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1">
                        <p>
                            <img src="../../../Resources/Images/Common/note.png" />
                        </p>
                    </td>
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span>
                        <p oldrole="para">The example presented here is set in a client-relay-server scenario.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <ol>
            <li>The sender sends messages in batches (set via <span class="Code">batch-size()</span>).</li>
            <li>The relay writes messages to the disk-buffer file.</li>
            <li>
                <p>Once messages have been written to the disk-buffer file, the relay returns an acknowledgement to the client.</p>
            </li>
            <li>The relay sends messages to the server in batches (set via <span class="Code">batch-size()</span>).</li>
            <li>
                <p>When the server has successfully received and processed the messages in the batch, it sends an acknowledgement of the processed messages to the relay.</p>
                <p>It is only at this point that the relay removes log messages from the disk-buffer file because this is when logs are considered "delivered" to the server.</p>
                <p>After receiving the acknowledgement, the sender sends another batch of messages.</p>
            </li>
        </ol>
        <p>This configuration gives you the greatest degree of protection against log message loss. <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /> provides acknowledgement about the successful processing of log messages at the level of the application layer. Even if the reception of log messages has been acknowledged by TCP at the transport layer, log messages are considered delievered only when the <MadCap:variable name="General.abbrev" /> application has received an acknowledgement from the other <MadCap:variable name="General.abbrev" /> instance about the successful delivery of log messages.</p>
        <p>This mechanism guarantees that log messages are not lost between the client and the relay, or between the relay and the server, or on the relay itself. To minimize the risk of message loss on the client or the server, use <a href="concepts-flow-control.htm">flow control</a> and <a href="concepts-diskbuffer.htm">reliable disk-buffer</a>.</p>
        <p class="CaptionFigure" MadCap:autonum="Figure 1: ">Flow control, reliable disk-buffer, <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /></p>
        <p>
            <img src="../../Resources/Images_Notlocalized/syslog-ng-pe-guide-admin/flow-control-reliable-disk-buffering-altp.png" />
        </p>
        <MadCap:snippetBlock src="how-to-set-key-params-reliable-diskbuffer.flsnp" />
        <p>Enable <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /> by setting <span class="Code">transport(rltp)</span>. For details, see <MadCap:xref href="rltp-options.htm" class="HeadingOnPage"><span style="color: #04aada;" class="mcFormatColor">[%=syslogngPEVariables.RLTPUppercase%] options</span></MadCap:xref>.</p>
        <h6>Benefits:</h6>
        <p>This configuration minimizes the loss of log messages in the following situations:</p>
        <ul>
            <li><i>Unreachable destination server(s)</i>: Only as many incoming log messages are read as can be "delivered". When flow control is used in combination with reliable disk buffering and <MadCap:variable name="syslogngPEVariables.RLTPUppercase" />, those messages are considered delivered by the very first source driver that have been written to the disk buffer. <MadCap:variable name="General.abbrev" /> will not read new messages until the previous batch has been written to the disk buffer.</li>
            <li><i>TCP error</i>: In the case of a TCP connection, when messages are sent from the destination drivers to the destination servers, messages are written to the TCP socket. The TCP socket sends an acknowledgement to the destination drivers once it has successfully processed messages. However, while the acknowledge messages sent by the TCP socket implement flow control at the transport layer, <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /> introduces flow control at the application layer. This means that log messages are only considered delivered when the <MadCap:variable name="syslogngPEVariables.RLTPUppercase" /> acknowledge message is returned at the level of the syslog-ng application. That is to say, when a TCP error occurs, messages that have been written to the disk-buffer file do not get lost.
</li>
            <MadCap:snippetBlock src="reliability-message-loss-outside-syslog-ng.flsnp" />
            <MadCap:snippetBlock src="reliability-message-loss-syslog-ng-restart-reliable-db.flsnp" />
            <MadCap:snippetBlock src="reliability-unable-to-operate-normally-reliable-diskbuffer.flsnp" />
        </ul>
        <h6>Drawbacks:</h6>
        <p>This configuration results in the slowest processing time out of all the options described in this chapter.</p>
    </body>
</html>