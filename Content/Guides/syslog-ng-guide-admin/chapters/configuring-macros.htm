<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body name="configuring-macros" oldrole="section">
        <h1 name="configuring-macros">Templates and macros</h1>
        <!-- FIXME the template+macro, parser and rewrite sections should be moved into a common section -->
        <MadCap:keyword term="templates">
        </MadCap:keyword>
        <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application allows you to define message templates, and reference them from every object that can use a template. Templates can include strings, macros (for example date, the hostname, and so on), and template functions. For example, you can use templates to create standard message formats or filenames. For a list of macros available in <MadCap:variable name="General.product"></MadCap:variable>, see <MadCap:xref href="reference-macros.htm#reference-macros"></MadCap:xref>.<MadCap:conditionaltext MadCap:conditions="General.pe6"> For the macros of the syslog-ng Agent for Windows application, see <a href="https://support.oneidentity.com/technical-documents/one-identity-psm/syslog-ng-windows-agent-guide-admin/chapter-format" oldrole="olink"></a>.</MadCap:conditionaltext> Fields from the structured data (SD) part of messages using the new IETF-syslog standard can also be used as macros.</p>
        <h6 oldrole="formalpara">Declaration:</h6>
        <MadCap:keyword term="templates:['defining']">
        </MadCap:keyword><pre class="Code" oldrole="synopsis">template &lt;template-name&gt; {
    template("&lt;template-expression&gt;") &lt;template-escape(yes)&gt;;
};</pre>
        <p oldrole="para">Template objects have a single option called <span class="Code" oldrole="parameter">template-escape()</span>, which is disabled by default (<span class="Code" oldrole="userinput">template-escape(no)</span>). This behavior is useful when the messages are passed to an application that cannot handle escaped characters properly. Enabling template escaping (<span class="Code" oldrole="userinput">template-escape(yes)</span>) causes syslog-ng to escape the <span class="Code" oldrole="userinput">'</span>, <span class="Code" oldrole="userinput">"</span>, and backslash characters from the messages.</p>
        <p oldrole="para">If you do not want to enable the <span class="Code" oldrole="parameter">template-escape()</span> option (which is rarely needed), you can define the template without the enclosing braces.</p><pre class="Code" oldrole="synopsis">template &lt;template-name&gt; "&lt;template-expression&gt;";</pre>
        <p oldrole="para">You can also refer to an existing template from within a template. The result of the referred template will be pasted into the second template.</p><pre class="Code" oldrole="synopsis">template first-template "sample-text";
template second-template "The result of the first-template is: $(template first-template)";</pre>
        <p oldrole="para">If you want to use a template only once, you can define the template inline, for example:</p><pre class="Code" oldrole="synopsis">destination d_file {
    file ("/var/log/messages" template("${ISODATE} ${HOST} ${MSG}\n") );
};</pre>
        <p oldrole="para">Macros can be included by prefixing the macro name with a <span class="Code" oldrole="userinput">$</span> sign, just like in Bourne compatible shells. Although using braces around macro names is not mandatory, and the <span class="Code" oldrole="userinput">"$MSG"</span> and <span class="Code" oldrole="userinput">"${MSG}"</span> formats are equivalent, using the <span class="Code" oldrole="userinput">"${MSG}"</span> format is recommended for clarity.</p>
        <MadCap:keyword term="templates:['literal $']">
        </MadCap:keyword>
        <MadCap:keyword term="templates:['escaping']">
        </MadCap:keyword>
        <p oldrole="para">To use a literal <span class="Code" oldrole="userinput">$</span> character in a template, you have to escape it. In <MadCap:variable name="General.abbrev"></MadCap:variable> versions <MadCap:conditionaltext MadCap:conditions="General.pe">4.0-4.2</MadCap:conditionaltext><MadCap:conditionaltext MadCap:conditions="General.ose">3.4 and earlier</MadCap:conditionaltext>, use a backslash (<span class="Code" oldrole="userinput">\$</span>). In version <MadCap:conditionaltext MadCap:conditions="General.pe">5.0</MadCap:conditionaltext><MadCap:conditionaltext MadCap:conditions="General.ose">3.5</MadCap:conditionaltext> and later, use <span class="Code" oldrole="userinput">$$</span>.</p>
        <MadCap:snippetBlock src="../../shared/wnt/note-escape-at.htm">
        </MadCap:snippetBlock>
        <MadCap:keyword term="macros:['default value']">
        </MadCap:keyword>
        <p oldrole="para">Default values for macros can also be specified by appending the <span class="Code" oldrole="userinput">:-</span> characters and the default value of the macro. If a message does not contain the field referred to by the macro, or it is empty, the default value will be used when expanding the macro. For example, if a message does not contain a hostname, the following macro can specify a default hostname.</p><pre class="Code" oldrole="synopsis">${HOST:-default_hostname}</pre>
        <p oldrole="para">By default, syslog-ng sends messages using the following template: <span class="Code" oldrole="userinput">${ISODATE} ${HOST} ${MSGHDR}${MSG}\n</span>. (The <span class="Code" oldrole="userinput">${MSGHDR}${MSG}</span> part is written together because the <span class="Code" oldrole="parameter">${MSGHDR}</span> macro includes a trailing whitespace.)</p>
        <div class="Example">
            <h6 oldrole="example">Example: Using templates and macros</h6>
            <MadCap:keyword term="templates:['example']">
            </MadCap:keyword>
            <p oldrole="para">The following template (<span class="Code" oldrole="userinput">t_demo_filetemplate</span>) adds the date of the message and the name of the host sending the message to the beginning of the message text. The template is then used in a file destination: messages sent to this destination (<span class="Code" oldrole="userinput">d_file</span>) will use the message format defined in the template.</p><pre class="Code" oldrole="synopsis">template t_demo_filetemplate {
    template("${ISODATE} ${HOST} ${MSG}\n"); };
destination d_file {
    file("/var/log/messages" template(t_demo_filetemplate)); };</pre>
            <p oldrole="para">If you do not want to enable the <span class="Code" oldrole="parameter">template-escape()</span> option (which is rarely needed), you can define the template without the enclosing braces. The following two templates are equivalent.</p><pre class="Code" oldrole="synopsis">template t_demo_template-with-braces {
    template("${ISODATE} ${HOST} ${MSG}\n");
};
template t_demo_template-without-braces "${ISODATE} ${HOST} ${MSG}\n";
</pre>
            <p oldrole="para">Templates can also be used inline, if they are used only at a single location. The following destination is equivalent with the previous example:</p><pre class="Code" oldrole="synopsis">destination d_file {
    file ("/var/log/messages" template("${ISODATE} ${HOST} ${MSG}\n") );
};</pre>
            <MadCap:keyword term="macros:['in filenames']">
            </MadCap:keyword>
            <p oldrole="para">The following file destination uses macros to daily create separate logfiles for every client host.</p><pre class="Code" oldrole="synopsis">destination d_file {
        file("/var/log/${YEAR}.${MONTH}.${DAY}/${HOST}.log");
};</pre>
        </div>
        <table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');">
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2">
            </col>
            <tbody>
                <tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1">
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1">
                        <p>
                            <img src="../../../Resources/Images/Common/note.png" />
                        </p>
                    </td>
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span>
                        <p oldrole="para">Macros can be used to format messages, and also in the name of destination files or database tables. However, they cannot be used in sources as wildcards, for example, to read messages from files or directories that include a date in their name.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </body>
</html>