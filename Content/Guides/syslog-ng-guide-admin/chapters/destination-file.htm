<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body name="configuring-destinations-file" oldrole="section">
        <h1 name="configuring-destinations-file"><span class="Code" oldrole="parameter">file</span>: Storing messages in plain-text files</h1>
        <MadCap:keyword term="destination drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;file()&lt;/span&gt;, ' driver']">
        </MadCap:keyword>
        <p oldrole="para">The file driver is one of the most important destination drivers in syslog-ng. It allows to output messages to the specified text file, or to a set of files.</p>
        <p oldrole="para">The destination filename may include macros which get expanded when the message is written, thus a simple <span class="Code" oldrole="parameter">file()</span> driver may create several files: for example, <MadCap:variable name="General.abbrev"></MadCap:variable> can store the messages of client hosts in a separate file for each host. For more information on available macros see <MadCap:xref href="reference-macros.htm#reference-macros"></MadCap:xref>.</p>
        <p oldrole="para">If the expanded filename refers to a directory which does not exist, it will be created depending on the <span class="Code" oldrole="parameter">create-dirs()</span> setting (both global and a per destination option).</p>
        <p oldrole="para">The <span class="Code" oldrole="parameter">file()</span> has a single required parameter that specifies the filename that stores the log messages. For the list of available optional parameters, see <MadCap:xref href="reference-destination-file.htm#reference-destination-file"></MadCap:xref>.</p>
        <h6 oldrole="formalpara">Declaration:</h6><pre class="Code" oldrole="synopsis">file(filename options());</pre>
        <div class="Example">
            <h6 name="example-destination-file" oldrole="example"><a name="example-destination-file"></a>Example: Using the file() driver</h6><pre class="Code" oldrole="synopsis">destination d_file { file("/var/log/messages"); };</pre>
        </div>
        <div class="Example">
            <h6 name="example-destination-file-macro" oldrole="example"><a name="example-destination-file-macro"></a>Example: Using the file() driver with macros in the file name and a template for the message</h6><pre class="Code" oldrole="synopsis">destination d_file {
    file("/var/log/${YEAR}.${MONTH}.${DAY}/messages"
         template("${HOUR}:${MIN}:${SEC} ${TZ} ${HOST} [${LEVEL}] ${MESSAGE}\n")
         template-escape(no));
};</pre>
        </div>
        <MadCap:snippetBlock src="../../shared/wnt/note-logrotate.htm">
        </MadCap:snippetBlock>
        <table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');">
            <col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
            <col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2">
            </col>
            <tbody>
                <tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1">
                    <td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1">
                        <p>
                            <img src="../../../Resources/Images/Common/caution.png" />
                        </p>
                    </td>
                    <td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span>
                        <p oldrole="para">Since the state of each created file must be tracked by syslog-ng, it consumes some memory for each file. If no new messages are written to a file within 60 seconds (controlled by the <span class="Code" oldrole="parameter">time-reap()</span> global option), it is closed, and its state is freed.</p>
                        <p oldrole="para">Exploiting this, a DoS attack can be mounted against the system. If the number of possible destination files and its needed memory is more than the amount available on the syslog-ng server.</p>
                        <p oldrole="para">The most suspicious macro is <span class="Code" oldrole="parameter">${PROGRAM}</span>, where the number of possible variations is rather high. Do not use the <span class="Code" oldrole="parameter">${PROGRAM}</span> macro in insecure environments.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2 name="reference-destination-file">file() destination options</h2>
        <MadCap:keyword term="destination drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;file()&lt;/span&gt;, ' driver']">
        </MadCap:keyword>
        <p oldrole="para">The <span class="Code" oldrole="parameter">file()</span> driver outputs messages to the specified text file, or to a set of files. The <span class="Code" oldrole="parameter">file()</span> destination has the following options:</p>
        <MadCap:snippetBlock src="../../shared/wnt/warning-fd-ulimit.htm">
        </MadCap:snippetBlock>
        <!-- FIXME required parameters?? -->
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-create-dirs.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-dir-group.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-dir-owner.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-dir-perm.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-diskbuffer.htm">
        </MadCap:snippetBlock>
        <!--Other instances of flags() are single sourced and reused. This one is an exception because it has the value "threaded", which other flags() options don't have.-->
        <h6 oldrole="simplesect">flags()</h6>
        <MadCap:keyword term="flags()">
        </MadCap:keyword>
        <MadCap:keyword term="flags:['syslog-protocol']">
        </MadCap:keyword>
        <MadCap:keyword term="flags:['no-multi-line']">
        </MadCap:keyword>
        <MadCap:keyword term="flags:['threaded']">
        </MadCap:keyword>
        <table cellspacing="0" class="RuledTableWithHeading_DoNotEdit" colsep="0" frame="topbot" rowsep="0" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/RuledTableWithHeading_DoNotEdit.css');">
            <tbody>
                <tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Type: 

                            </td>
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">no-multi-line, syslog-protocol, threaded</td>
                </tr>
                <tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Default: 

                            </td>
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">empty set</td>
                </tr>
            </tbody>
            <col class="TableStyle-RuledTableWithHeading_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
        </table>
        <p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Flags influence the behavior of the destination driver.</p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para"><i oldrole="emphasis">no-multi-line</i>: The <span class="Code" oldrole="parameter">no-multi-line</span> flag disables line-breaking in the messages: the entire message is converted to a single line.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para"><i oldrole="emphasis">syslog-protocol</i>: The <span class="Code" oldrole="parameter">syslog-protocol</span> flag instructs the driver to format the messages according to the new IETF syslog protocol standard (RFC5424), but without the frame header. If this flag is enabled, macros used for the message have effect only for the text of the message, the message header is formatted to the new standard. Note that this flag is not needed for the <span class="Code" oldrole="parameter">syslog</span> driver, and that the <span class="Code" oldrole="parameter">syslog</span> driver automatically adds the frame header to the messages.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para"><i oldrole="emphasis">threaded</i>: The <span class="Code" oldrole="parameter">threaded</span> flag enables multithreading for the destination. For details on multithreading, see <MadCap:xref href="chapter-multithreading.htm#chapter-multithreading"></MadCap:xref>.</p>
                <table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');">
                    <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;">
                    </col>
                    <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2">
                    </col>
                    <tbody>
                        <tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1">
                            <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1">
                                <p>
                                    <img src="../../../Resources/Images/Common/note.png" />
                                </p>
                            </td>
                            <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span>
                                <p oldrole="para">The <span class="Code" oldrole="parameter">file</span> destination uses multiple threads only if the destination filename contains macros.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </li>
        </ul>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-flush-lines.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-flush-timeout.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-frac-digits.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-fsync.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-group.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-local-timezone.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-log-fifo-size.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-mark-freq.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-mark-mode.htm">
        </MadCap:snippetBlock>
        <h6 oldrole="simplesect">overwrite-if-older()</h6>
        <MadCap:keyword term="overwrite-if-older()">
        </MadCap:keyword>
        <MadCap:keyword term="overwrite_if_older()">
        </MadCap:keyword>
        <table cellspacing="0" class="RuledTableWithHeading_DoNotEdit" colsep="0" frame="topbot" rowsep="0" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/RuledTableWithHeading_DoNotEdit.css');">
            <tbody>
                <tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Type: 

                            </td>
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">number (seconds)</td>
                </tr>
                <tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Default: 

                            </td>
                    <td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">0</td>
                </tr>
            </tbody>
            <col class="TableStyle-RuledTableWithHeading_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
        </table>
        <p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> If set to a value higher than 0, <MadCap:variable name="General.abbrev"></MadCap:variable> checks when the file was last modified before starting to write into the file. If the file is older than the specified amount of time (in seconds), then syslog-ng removes the existing file and opens a new file with the same name. In combination with for example the <span class="Code" oldrole="parameter">${WEEKDAY}</span> macro, this can be used for simple log rotation, in case not all history has to be kept. (Note that in this weekly log rotation example if its Monday 00:01, then the file from last Monday is not seven days old, because it was probably last modified shortly before 23:59 last Monday, so it is actually not even six days old. So in this case, set the <span class="Code" oldrole="parameter">overwrite-if-older()</span> parameter to a-bit-less-than-six-days, for example, to <span class="Code" oldrole="userinput">518000</span> seconds.</p>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-owner.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-pad-size.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-perm.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-suppress.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-template.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-template-escape.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-timezone.htm">
        </MadCap:snippetBlock>
        <MadCap:snippetBlock src="../../shared/chunk/option-destination-ts-format.htm">
        </MadCap:snippetBlock>
    </body>
</html>