<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
[ 
  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
  %entities;]>
<book>
    <bookinfo/>
    <title/>
    <chapter id="chapter_intro">
        <title>Introduction</title>
        <indexterm>
            <primary>configuring syslog-ng</primary>
            <secondary>on Windows</secondary>
        </indexterm>
        <indexterm>
            <primary>&agentabbrev;</primary>
        </indexterm>
        <para>This chapter describes how to install and configure the &agentabbrev; on Microsoft
            Windows hosts.</para>
        <para>The &agent; is a log collector and forwarder application for the Microsoft Windows
            platform. It collects the log messages of the Windows-based host and forwards them to a
            syslog-ng server using regular or TLS-encrypted TCP connections.</para>
        <para>The features and restrictions of the &agentabbrev; are summarized below:</para>
        <itemizedlist>
            <listitem>
                <para>Reads messages from eventlog containers and log files.</para>
            </listitem>
            <listitem>
                <para>Transfers log messages using TCP.</para>
            </listitem>
            <listitem>
                <para>Supports TLS encryption.</para>
            </listitem>
            <listitem>
                <para>Authenticates the server using X.509 certificates. Mutual authentication is
                    also supported.</para>
            </listitem>
            <listitem>
                <para>The format of eventlog messages can be customized using macros.</para>
            </listitem>
            <listitem>
                <para>Supports multiple destinations both in parallel and fail-over modes.</para>
            </listitem>
            <listitem>
                <para>Can be managed from a domain controller using group policies.</para>
            </listitem>
            <listitem>
                <para>Only basic filtering is supported by the agent, message segmenting, parsing,
                    and classification is not.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>disk buffer</primary>
                    <secondary>on Windows</secondary>
                </indexterm>
                <para>Note that the log messages on Windows come from files &mdash; either eventlog
                    containers or custom logfiles &mdash; which are already stored on the harddisk,
                    so the agent does not use additional disk buffering.</para>
            </listitem>
        </itemizedlist>
        <section>
            <title>Supported operating systems</title>
            <para>The &agentabbrev; supports the following operating systems:</para>
            <indexterm>
                <primary>supported operating systems</primary>
            </indexterm>
            <itemizedlist id="windows-supported-platforms">
                <listitem>
                    <para>Microsoft Windows 2000</para>
                </listitem>
                <listitem>
                    <para>Microsoft Windows XP</para>
                </listitem>
                <listitem>
                    <para>Microsoft Windows Server 2003</para>
                </listitem>
                <listitem>
                    <para>Microsoft Windows Vista</para>
                </listitem>
                <listitem>
                    <para>Microsoft Windows Server 2008</para>
                </listitem>
                <listitem>
                    <para>Microsoft Windows 7</para>
                </listitem>
            </itemizedlist>
            <note>
                <para>The &agent; application supports the XML-based eventlog used format on
                    Microsoft Windows Vista and Microsoft Windows Server 2008, and Windows 7, and
                    also offers full support for 64-bit operating systems.</para>
            </note>
            <note>
                <para>Managing &agentabbrev; from a Windows 2000 domain controller is not supported.</para>
            </note>
        </section>
    </chapter>
    <chapter id="chapter_install">
        <title>Installing the syslog-ng agent</title>
        <indexterm>
            <primary>syslog-ng agent</primary>
            <secondary>installing</secondary>
        </indexterm>
        <indexterm>
            <primary>installing syslog-ng</primary>
            <secondary>on Windows</secondary>
        </indexterm>
        <indexterm>
            <primary>installing syslog-ng</primary>
            <secondary>syslog-ng agent on domain controllers</secondary>
        </indexterm>
        <para>The &agent; application can be installed in standalone mode on
            independent hosts. If your hosts are members of a domain, you can install the syslog-ng
            agent on the domain controller and configure them globally.</para>
        <itemizedlist>
            <listitem>
                <para>For details on how to install the syslog-ng Agent for Windows application in standalone mode, see
                        <xref linkend="windows_install_standalone"/>.</para>
            </listitem>
            <listitem>
                <para>For details on how to install the syslog-ng Agent for Windows application on the members of a
                    domain, see <xref linkend="windows_install_domain_controller"/>.</para>
            </listitem>
        </itemizedlist>
        <note>
            <para>The syslog-ng Agent for Windows application is configured usually using its MMC
                snap-in (when managed globally from the domain controller or when configuring it in standalone mode). However, it is also
                possible to use an XML-based configuration file. For details, see <xref
                    linkend="windows_xml_config"/>.</para>
        </note>
        <formalpara><title>Installer types:</title><para/></formalpara>
        <itemizedlist>
            <listitem><para><filename>syslog-ng-agent-&lt;version&gt;-setup.exe</filename> is the general installer. This installs an agent that can be configured with a local configuration, XML configuration file and can receive configuration from domain group policy.</para></listitem>
            <listitem><para><filename>syslog-ng-agent-nosnapin-&lt;version&gt;-setup.exe</filename> is a special installer. .NET environment is not required for it. This installs an agent that can only be configured with an XML configuration file, and can receive configuration from domain group policy.</para></listitem>
            <listitem><para><filename>syslog-ng-agent-setup-&lt;version&gt;-&lt;amd64/i386&gt;.msi</filename> is an MSI installer for domain clients, installing by group policy.</para></listitem>
        </itemizedlist>
        
        <procedure id="windows_install_standalone">
                <title>Installing the &agentabbrev; in standalone mode</title>
                <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>installing the agent in standalone mode</secondary>
            </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>The syslog-ng Agent for Windows application can be installed in standalone mode on
                independent hosts. If your hosts are members of a domain, install the &agentabbrev;
                on the domain controller, as described in <xref
                    linkend="windows_install_domain_controller"/>. The syslog-ng agent requires
                about 10 MB hard disk space.</para>
            <para>To install the &agentabbrev; in standalone mode, complete the following
                steps:</para>
            <note>
                <para>The syslog-ng Agent for Windows requires the Microsoft .NET Framework version
                    2.0, 3.0 or 3.5. This package is usually already installed on most hosts. <ulink
                        url="http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en"
                        >Download the package here</ulink>.</para>
            </note>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the installer. Run the
                            <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename>
                        file.</para>
                    <note>
                        <para>Installing the &agentabbrev; requires administrator privileges.</para>
                    </note>
                </step>
                <step>
                    <para>Read the End User License Agreement and select <guimenu>I
                            Agree</guimenu>.</para>
                </step>
                <step>
                    <para>Select the destination folder where you want to install the syslog-ng
                        Agent for Windows application, then select
                        <guimenu>Next</guimenu>.</para>
                </step>
                <step>
                    <para>Select <guimenu>Standalone mode</guimenu>, then click
                            <guimenu>Next</guimenu>. </para>
                    <figure>
                        <title>Installing in Standalone mode</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-install-standalone.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-install-standalone.png" contentwidth="11cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
                <step>
                    <para>Starting from version 3.0.3, the &agentabbrev; sends only messages that
                        are created after the agent has been installed. If you want to send old log
                        messages to the syslog-ng server, enable the <guimenu>Send log messages
                            generated before the syslog-ng Agent was installed</guimenu> option
                        and click <guimenu>Install</guimenu>.</para>
                </step>
                <step>
                    <para>The installer automatically opens the configuration interface of the
                        &agentabbrev;. As a minimum, you must set the IP address of the destination
                        server, and the agent will automatically start sending eventlog messages to
                        your central logserver from the Application, Security, and System eventlog
                        containers.</para>
                    <note>
                        <para>The installation is completed only after you close the configuration
                            interface. For details on how to modify the configuration later, see <xref
                                linkend="windows_configure_standalone"/>.</para>
                    </note>
                </step>
            </procedure>
        <section id="windows_install_domain_controller">
            <title>Installing the &agentabbrev; on the domain controller and the hosts of a
                domain</title>
            <para>The syslog-ng Agent for Windows application can be installed on the domain
                controller and the members of a domain from the domain controller, and configured
                globally using group policies. The &agentabbrev; requires about 10 MB hard disk
                space.</para>
            <itemizedlist>
                <listitem>
                    <para>For details on how to install the &agentabbrev; application in a domain, see <xref
                            linkend="windows_install_domain"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref
                            linkend="windows_configure_domain_hosts"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref
                            linkend="windows_configure_domain_controllers"/>.</para>
                </listitem>
            </itemizedlist>
            <note>
                <para>Starting from version <parameter>3.0.4</parameter>, the
                        <parameter>.msi</parameter> version of the installer does not install the
                    MMC configuration snap-in of the agent, therefore the
                        <parameter>.msi</parameter> installer does not require the .NET
                    framework.</para>
            </note>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>installing the agent from the domain controller</secondary>
            </indexterm>
            <procedure id="windows_install_domain">
                <title>Installing the &agentabbrev; on the domain controller and the hosts of a
                    domain</title>
                <note>
                    <para>Starting from version 3.0.3, the syslog-ng Agent sends only messages that
                        are created after the agent has been installed. If you want to send old log
                        messages to the syslog-ng server, download the Orca MSI editor <ulink
                            url="http://www.technipages.com/download-orca-msi-editor.html"
                            >here</ulink>, open
                        the .msi installer of the syslog-ng Agent, select
                            <guimenu>Property</guimenu>, and change the value of the
                            <guimenu>SENDOLDMESSAGES</guimenu> field to
                        <parameter>yes</parameter>.</para>
                </note>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Download both the Microsoft Installer (<parameter>.msi</parameter>)
                        version and the executable (<parameter>.exe</parameter>) version of the
                        &agentabbrev; installer to the domain controller host. Make sure to download
                        the executable that includes the MMC snap-in module. Note that separate .msi
                        intallers are available for 32-bit and 64-bit operating systems.</para>
                    <note>
                        <para>Installing the &agentabbrev; requires administrator privileges, but
                            configuring the related group policies on the domain controller requires
                            domain administrator or higher (for example enterprise administrator)
                            privileges.</para>
                        <para/>
                    </note>
                </step>
                <step>
                    <para>Install the &agentabbrev; application to your domain controllers using the
                            <parameter>.exe</parameter> installer.</para>
                    <note>
                        <para>The syslog-ng Agent for Windows requires the Microsoft .NET Framework
                            version 2.0. This package is usually already installed on most hosts. <ulink
                                url="http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en"
                                >Download the package here.</ulink></para>
                    </note>
                </step>
                <step>
                    <para>Select <guimenu>Start > Control Panel > Administrative Tools > Active
                            Directory Users and Computers</guimenu>, right-click on the
                        Organizational Unit of the domain whose hosts you want to install the
                        syslog-ng agent on, and select <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>Select <guimenu>Group Policy</guimenu>, and edit the Group Policy
                        object you want to add the syslog-ng agent configuration to. Alternatively,
                        you can create a new group policy object as well.</para>
                </step>
                <step>
                    <para>Select <guimenu>Computer Configuration</guimenu>, right-click on
                            <guimenu>Software Settings</guimenu>, and select <guimenu>New >
                            Package</guimenu>.</para>
                </step>
                <step>
                    <para>Navigate to the syslog-ng Agent for Windows <parameter>.msi</parameter>
                        installer and select <guimenu>Open</guimenu>. </para>
                </step>
                <step>
                    <para>Select <guimenu>Assigned</guimenu>, then
                        <guimenu>OK</guimenu>.</para>
                </step>
                <step>
                    <para>Select <guimenu>Computer Configuration > syslog-ng Agent
                            Settings</guimenu> and configure the syslog-ng Agent. The members of
                            the domain will use this configuration. </para>
                    <figure>
                        <title>syslog-ng Agent Settings</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-group-policy-mngmt-editor.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-group-policy-mngmt-editor.png" contentwidth="&screenshotsize;"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
                <step>
                    <para>The syslog-ng Agent for Windows application will be automatically
                        installed on the members of the domain when they are next rebooted. To
                        perform the installation earlier, execute the <command>gpupdate</command>
                        command on the members of the domain.</para>
                    <note>
                        <para>If you do not want to install the syslog-ng Agent automatically from
                            the domain controller, skip Steps 5-7, complete Step 8, then install the
                                <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename>
                            file manually on the members of the domain. This method is useful if you
                            do not want to install the syslog-ng Agent on every host of the
                            domain.</para>
                    </note>
                </step>
            </procedure>
        </section>
        <section id="windows_install_silent">
            <title>Silent installation</title>
            <para>The &agent; application can be installed in silent mode as well, without requiring
                any user interaction. The various installer options can be specified as command-line
                options. The following options are available:</para>
            <variablelist>
                <varlistentry>
                    <term><command>/S</command></term>
                    <listitem>
                        <para>Start the installer in silent mode. This option is required for
                            the silent installation.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><command>/D=</command></term>
                    <listitem>
                        <para>Install the &agentabbrev; into the specified folder.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><command>/NOMENU</command></term>
                    <listitem>
                        <para>Do not add entries about &agentabbrev; to the Start menu.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><command>/LOCAL</command></term>
                    <listitem>
                        <para>Install &agentabbrev; in standalone mode. This is the default,
                            installation mode of the &agentabbrev;.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><command>/REMOTE</command></term>
                    <listitem>
                        <para>Install &agentabbrev; in domain mode.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><command>/SENDOLDMSGS=</command></term>
                    <listitem>
                        <para>If set to <parameter>YES</parameter>, the &agentabbrev; will forward
                            every message available in its message sources. By default, it is <parameter>FALSE</parameter>, meaning that only new
                            messages are forwarded.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><command>/XMLCONFIG=</command></term>
                    <listitem>
                        <para>Use the specified XML configuration file for the configuration of
                            &agentabbrev;.</para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
        <section id="windows_upgrade">
            <title>Upgrading syslog-ng Agent for Windows to the latest version</title>
            <indexterm significance="preferred">
                <primary>syslog-ng agent</primary>
                <secondary>upgrading</secondary>
            </indexterm>
            <para>The exact upgrading procedure of the syslog-ng Agent for Windows application
                depends on how you have installed and how you manage the agent.</para>
            <warning>
                <para>When upgrading agents running in domain mode, always upgrade the agents
                    running on the domain hosts before upgrading the agent running on the domain
                    controllers.</para>
                <para>The hosts of a domain (including the domain controllers) should run the same
                    version of the syslog-ng Agent, running different versions on the hosts in
                    neither supported nor recommended.</para>
            </warning>
            <note>
                <indexterm significance="preferred">
                    <primary>syslog-ng agent</primary>
                    <secondary>upgrading to 4.0</secondary>
                </indexterm>
                <para>Upgrading to &agent; version 4.0 is supported only from &agentabbrev; version
                    3.0.8 (the latest stable release) and version 3.2.1 (the latest feature release).</para>
            </note>
            <itemizedlist>
                <listitem>
                    <para>If a host is running &agentabbrev; in standalone mode, download and
                        execute the
                            <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename>
                        installer on the host and verify that the displayed information is correct.
                        The agent will be automatically restarted when you close the configuration
                        window.</para>
                </listitem>
                <listitem>
                    <para>If a domain host is running the &agentabbrev; that was installed by the
                        domain controller from the <parameter>.msi</parameter> installer package,
                        complete the steps described in <xref
                            linkend="windows_install_domain_controller"/>. The system will
                        automatically recognize that the new package will update the syslog-ng Agent
                        for Windows application.</para>
                </listitem>
                <listitem>
                    <para>If a domain host is running the &agentabbrev; that was installed
                        manually from the
                            <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename>
                        file, run the new
                            <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename>
                        file on the host. After the installation is complete, select <guimenu>Start
                            > Run</guimenu> and execute the <command>gpupdate</command> command to
                        refresh the domain settings of the agent.</para>
                </listitem>
                <listitem>
                    <para>If &agentabbrev; has been installed with an XML configuration file with <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> or <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename>, download and execute the same installer. It will display the previous XML configuration file, and upgrades it if desired.</para>
                </listitem>
            </itemizedlist>
        </section>
    </chapter>
    <chapter id="chapter_configuration">
        <title>Configuring &agent;</title>
        <section id="windows_configuring">
            <title>How to configure the &agentabbrev;</title>
            <para>This section describes how to configure the &agentabbrev; application. The exact
                method depends on the installation scenario and also on the configuration method
                (regular or XML-based) you want to use. The syslog-ng Agent for Windows application
                is configured usually using its MMC snap-in (when managed globally from the domain controller or when configuring it in standalone mode). However, it is also possible to use an XML-based configuration file. </para>
            <itemizedlist>
                <listitem>
                    <para>For details on how to configure a &agentabbrev; that was installed in standalone mode, see
                            <xref linkend="windows_configure_standalone"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref
                            linkend="windows_configure_domain_hosts"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref
                            linkend="windows_configure_domain_controllers"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to configure &agentabbrev; from file, see <xref
                            linkend="windows_xml_config"/>.</para>
                </listitem>
            </itemizedlist>
            <section id="windows_configure_standalone">
                <title>Configuring a standalone &agentabbrev;</title>
                <indexterm>
                    <primary>configuring syslog-ng</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <para>In standalone mode, to configure an already installed syslog-ng Agent, select
                        <guimenu>Start Menu > Programs > syslog-ng Agent for Windows > Configure
                        syslog-ng Agent</guimenu>. Alternatively, select <guimenu>Start Menu >
                        Run</guimenu>, enter <parameter>gpedit.msc</parameter>, then select
                        <guimenu>Computer configuration > syslog-ng Agent
                    Settings</guimenu></para>
                <warning>
                    <para>After modifying its configuration, you have to restart the
                            <parameter>syslog-ng Agent</parameter> service for the changes to take
                        effect. To restart the syslog-ng Agent service, select <guimenu>Start Menu
                            > Run</guimenu> enter <parameter>services.msc</parameter> and restart
                        the <guimenu>syslog-ng Agent</guimenu> service.</para>
                </warning>
            </section>
            <section id="windows_configure_domain">
                <title>Configuring the &agentabbrev;s of a domain</title>
                <para>This section describes how to configure the &agent; application in domain
                    mode.</para>
                <itemizedlist>
                    <listitem>
                        <para>For details on how to configure the &agentabbrev;s of the domain hosts, see <xref
                                linkend="windows_configure_domain_hosts"/>.</para>
                    </listitem>
                    <listitem>
                        <para>For details on how to configure the &agentabbrev;s of the domain controllers, see <xref
                                linkend="windows_configure_domain_controllers"/>.</para>
                    </listitem>
                    <listitem>
                        <para>For details on the relationship of different group-policy levels, see
                                <xref linkend="windows_inheritance"/>.</para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>Managing &agentabbrev; from a Windows 2000 domain controller is not supported.</para>
                </note>
                <procedure id="windows_configure_domain_hosts">
                    <title>Configuring the &agentabbrev;s of the domain hosts</title>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>configuring domain hosts</secondary>
                    </indexterm>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                    <para>To configure an already installed &agentabbrev; from the domain
                        controller, perform the following steps.</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>On the domain controller, select <guimenu>Start > Control Panel >
                                Administrative Tools > Active Directory Users and
                                Computers</guimenu>.</para>
                    </step>
                    <step>
                        <para>Right-click on the Organizational Unit, then select
                                <guimenu>Properties > syslog-ng Agent Settings</guimenu>.</para>
                    </step>
                    <step>
                        <para>Configure the &agentabbrev; as needed for the domain hosts. The
                            changes will take affect when the domain hosts update their settings
                            from the domain controller. By default, this happens every 90 minutes,
                            depending on your domain settings. To download the configuration
                            earlier, execute the <command>gpupdate</command> command on the members
                            of the domain.</para>
                        <note>
                            <para>When the domain hosts update their settings, the syslog-ng agent
                                will be automatically restarted to load the new settings, except
                                when there is no difference between the old and the new
                                settings.</para>
                        </note>
                    </step>
                </procedure>
                <procedure id="windows_configure_domain_controllers">
                    <title>Configuring the &agentabbrev;s of the domain controllers</title>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>configuring domain controllers</secondary>
                    </indexterm>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                    <para>To configure the &agentabbrev; running on the domain controllers, perform
                    the following steps.</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>On the domain controller, select <guimenu>Start > Control Panel >
                                Administrative Tools > Active Directory Users and
                                Computers</guimenu>.</para>
                    </step>
                    <step>
                        <para>Right-click on the Organizational Unit of the domain whose domain
                            controllers you want to configure, then select
                                <guimenu>Properties</guimenu>. By default, the domain controllers
                            are in the Domain Controllers organizational unit.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>Group Policy</guimenu>, and edit the Group Policy
                            object you want to add the syslog-ng agent configuration to.
                            Alternatively, you can create a new group policy object as well.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>Computer Configuration > syslog-ng Agent
                                Settings</guimenu> and configure the syslog-ng Agent. The domain
                            controllers of the domain will use this configuration. </para>
                    </step>
                    <step>
                        <para>Configure the &agentabbrev; as needed for the domain controllers. If
                            you have multiple domain controllers, the changes will take affect when
                            the other domain controllers update their settings from this domain
                            controller. By default, this happens every 5 minutes, depending on your
                            domain settings. To download the configuration earlier, execute the
                                <command>gpupdate</command> command on the domain
                            controllers.</para>
                        <note>
                            <para>When the domain controllers receive the new settings, the
                                syslog-ng agent will be automatically restarted to load the new
                                settings, except when there is no difference between the old and the
                                new settings.</para>
                        </note>
                    </step>
                </procedure>

                <section id="windows_inheritance">
                    <title>Domain versus local settings</title>
                    <indexterm>
                        <primary>inheriting settings on Windows</primary>
                    </indexterm>
                    <indexterm>
                        <primary>syslog-ng Agent</primary>
                        <secondary>inheriting settings</secondary>
                    </indexterm>
                    <para>The &agentabbrev; follows the standard policy-inheritance methods of Windows:</para>
                    <para>GPOs (Group Policy Objects) from parent containers are inherited by default. When multiple GPOs apply to these computers, the settings in the GPOs are aggregated. The final value of a given policy setting is set only by the highest precedent GPO that contains the setting. (However, the final value for a few settings will actually be the combination of values across GPOs.) In this processing order, sites are applied first, but have the least precedence. OUs (Organization Units) are processed last, but have the highest precedence.</para>
                    <para>When multiple group policy objects are assigned, the group policies are applied in the following order:</para>
                    <orderedlist>
                        <listitem><para>The local group policy object is applied.</para></listitem>
                        <listitem><para>The group policy objects linked to sites are applied. If multiple GPOs exist for a site, they are applied in the order specified by the administrator.</para></listitem>
                        <listitem><para>GPOs linked to the domains are applied in the specified order.</para></listitem>
                        <listitem><para>GPOs linked to OUs are applied. The OU group policy objects are set from the largest to the smallest organizational unit; that is, first the parent OU and then the child OU. By default, a policy applied later overwrites a policy that was applied earlier. Hence, the settings in a child OU can override the settings in the parent OU.</para></listitem>
                        <listitem><para>If any group policy is not configured, the syslog-ng Agent checks its local policy settings, and uses the local setting if available.</para></listitem>
                    </orderedlist>
                    <para>The following are the rules regarding group policy settings inheritance:</para>
                    <itemizedlist>
                        <listitem><para>A policy setting is configured (<guimenu>Enabled</guimenu> or <guimenu>Disabled</guimenu>) for a parent OU, and the same policy setting is not configured for its child OUs. The child OUs inherit the parent’s policy.</para></listitem>
                        <listitem><para>A policy setting is configured (<guimenu>Enabled</guimenu> or <guimenu>Disabled</guimenu>) for a parent OU, and the same policy setting is configured for its child OUs. The child OUs settings override the settings inherited from the parent’s OU. There is a specific case, when the type of this setting is list:</para>
                        <itemizedlist>
                            <listitem><para>The &agentabbrev; will aggregate the contents of these lists and will use the same elements only once.</para></listitem>
                            <listitem><para>If any policy is not configured (<guimenu>Not Configured</guimenu>), no inheritance takes place.</para></listitem>
                        </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    
                </section>
            </section>
            <section id="windows_xml_config">
                <title>Using an XML-based configuration file</title>
                <indexterm>
                    <primary>syslog-ng Agent</primary>
                    <secondary>configuration file</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng Agent</primary>
                    <secondary>XML</secondary>
                </indexterm>
                <para>Starting from &agent; version 3.2, it is possible to export the configuration of &agentabbrev; into an XML file. This configuration file can be used as the default configuration when installing the &agentabbrev; to another host, or can be imported to an existing installation using a command-line utility.</para>
                <warning>
                    <para>Do not manually edit or modify the exported XML file.</para>
                </warning>
                <procedure id="windows_xml_config_create">
                    <title>Creating an XML configuration file for the &agentabbrev;</title>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                    <para>To create an XML configuration file that can be used by other &agentabbrev; configurations, perform the following steps.</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Install the &agent; application on a host.</para>
                    </step>
                    <step>
                        <para>Create the configuration you want to use on other hosts using the graphical interface.</para>
                    </step>
                    <step>
                        <para>Right-click on <guimenu>syslog-ng Agent Settings</guimenu> and select <guimenu>Export</guimenu>. Select where to save the configuration file.</para>
                        <para>Alternatively, you can export the configuration of &agentabbrev; from the command line using the <command>configmanager.exe -export &lt;source&gt; "destination xml file"</command> command. The &lt;source&gt; parameter determines where the configuration is imported:</para>
                        <itemizedlist>
                            <listitem>
                                <para><parameter>{GPO ID}</parameter>: Export the configuration related to the specified Group Policy Object ID (for example, <parameter>{99AF1185-AB80-40B2-B4B8-41A1E907F329}</parameter>).</para>
                            </listitem>
                            <listitem>
                                <para><parameter>localsettings</parameter>: Export the local settings of the host.</para>
                            </listitem>
                            <listitem>
                                <para><parameter>domainsettings</parameter>: Export the settings the host received from the domain controller.</para>
                            </listitem>
                        </itemizedlist>
                        <note><para>To overwrite the XML configuration file, use the /F option. This will force export even if the file already exists.</para></note>
                    </step>
                    <step>
                        <para>Use the configuration file on other hosts. For details on the different options, see <xref linkend="windows_xml_config_import"/>.</para>
                    </step>
                </procedure>
                <section id="windows_xml_config_import">
                    <title>Configuring &agentabbrev; from an XML file</title>
                    <!-- FIXME ezt meglinkelni az install reszekbol, vagy atrakni oket oda -->
                    <para>How you configure the &agentabbrev; application to use an XML configuration file depends on your environment. See the following list for details.</para>
                    <warning>
                        <para>Do not manually edit or modify the exported XML file.</para>
                    </warning>
                    <itemizedlist>
                        <listitem>
                            <para>To start an already installed, standalone &agentabbrev; using an XML configuration file, execute the following steps in a command line:</para>
                            <orderedlist>
                                <listitem><para><command>cd &lt;syslog-ng agent installation directory&gt;</command></para></listitem>
                                <listitem><para><command>net stop "syslog-ng agent"</command></para></listitem>
                                <listitem><para><command>syslog-ng-agent.exe -i &lt;PATH&gt;\configuration.xml</command></para></listitem>
                                <listitem><para><command>net start "syslog-ng agent"</command></para></listitem>
                            </orderedlist>
                            
                        </listitem>
                        <listitem>
                            <para>To use the XML file during the installation of the &agentabbrev; application, navigate to <guimenu>Setup syslog-ng Agent for Windows operating mode</guimenu> window and select <guimenu>XML mode</guimenu>. In the next window, browse your XML configuration. Note that the XML schema file will be installed in the &agentabbrev; directory.</para>
                        </listitem>
                        <listitem>
                            <para>If you want to use the .msi installer with an xml file,
                                        use the <command>syslog-ng-agent-3.2.1-setup.msi
                                            SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</command>
                                        command, or edit the installer with the <ulink
                                            url="http://www.technipages.com/download-orca-msi-editor.html"
                                            >Orca MSI editor</ulink>,
                                        and add the
                                            <parameter>SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</parameter>
                                        to the installation parameters on the
                                            <guimenu>Customization</guimenu> tab.</para>
                        </listitem>
                        <listitem>
                            <para>Starting with &agent; version 3.2, a command-line tool called <filename>configmanager.exe</filename> is available. To import the XML configuration file, use the following command: <command>configmanager.exe -import &lt;destination&gt; "source xml file"</command> command. The &lt;destination&gt; parameter determines which configuration the XML configuration will be converted to:</para>
                        <itemizedlist>
                            <listitem>
                                <para><parameter>{GPO ID}</parameter>: Import the configuration to the specified Group Policy Object ID (for example, <parameter>{99AF1185-AB80-40B2-B4B8-41A1E907F329}</parameter>).</para>
                            </listitem>
                            <listitem>
                                <para><parameter>localsettings</parameter>: Import the configuration as the local settings of the host.</para>
                            </listitem>
                            <listitem>
                                <para><parameter>domainsettings</parameter>: Import the configuration as the domain settings of the host.</para>
                            </listitem>
                        </itemizedlist>
                        </listitem>
                    </itemizedlist>

                </section>
            </section>

        </section>
        <section id="windows_destinations">
            <title>Configuring destinations</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>destinations</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>configuring the logserver</secondary>
            </indexterm>
            <indexterm>
                <primary>destinations</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <para>The syslog-ng Agent for Windows application can send the log messages of the
                Windows host to a central log server or relay. It is possible to send the same
                messages to multiple servers, when each server receives the same messages; and also
                to configure failover servers, when the agent sends the messages to a primary
                server, or to a failover server if the primary becomes unavailable. If the agent
                loses the connection to a destination server and the reconnection fails, it will
                sends an eventlog message. The successful reconnection attempt is also logged. (If
                the server is unavailable for a long time, the agent sends a log message about the
                failed connection once in every ten minutes.)</para>
            <para>Similarly to the Linux version, the agent now sends MARK messages to the server to
                indicate that the client host is alive but there are no log messages to send. A MARK
                message is sent every ten minutes.</para>
            <warning>
                <para>The &agent; application does not support the unreliable UDP protocol. Configure your central log server to accept logs using TCP or TLS connections. If needed, adjust your firewall configuration to permit such traffic to the log server.</para>
            </warning>
            <figure>
                <title>Adding new destinations</title>
                <mediaobject>
                    <imageobject role="html">
                        <imagedata format="PNG" align="center" fileref="win-destinations.png"/>
                    </imageobject>
                    <imageobject role="fo">
                        <imagedata format="PNG" fileref="&windowsimgroot;/win-destinations.png" contentwidth="&screenshotsize;"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <procedure id="windows_configure_destination">
                <title>Configuring the destination logservers</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To configure a new destination, complete the following steps:</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, and double-click on <guimenu>Add new server</guimenu>.</para>
                </step>
                <step>
                    <para>Enter the hostname or the IP
                        address of the logserver into the <guimenu>Server Name</guimenu> field. If
                        your logserver is configured to accept messages on a non-standard port, type
                        the port number into the <guimenu>Server Port</guimenu> field.</para>
                    <figure>
                        <title>Adding new server</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-server-property-server.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-server-property-server.png" contentwidth="10cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
                <step>
                    <!-- FIXME Ezt a templates reszt kulon helyre is ki kellene rakni, hogy konnyebb legyen megtalalni -->
                    <para>On <guimenu>Messages</guimenu> tab, select the protocol used to transfer log messages and press
                            <guimenu>Reset</guimenu> to apply the selected template. The
                        following protocol templates are available:</para>
                    <itemizedlist>
                        <listitem>
                            <indexterm>
                                <primary>BSD-syslog protocol</primary>
                            </indexterm>
                            <indexterm>
                                <primary>Legacy-syslog protocol</primary>
                            </indexterm>
                            <indexterm>
                                <primary>RFC 3164</primary>
                            </indexterm>
                            <para><guimenu>Legacy BSD Syslog Protocol</guimenu>: Use the legacy
                                BSD-syslog protocol specified in RFC3164. This option uses the
                                following message template: <parameter>&lt;${PRI}&gt;${BSDDATE}
                                ${HOST} ${APP_NAME}[${PROCESS_ID}]: ${MSG}</parameter>. Within the message part, &agentabbrev; replaces CRLF with 2 spaces and TAB character with 1 space.</para>
                            <figure>
                                <title>Legacy BSD Syslog Protocol</title>
                                <mediaobject>
                                    <imageobject role="html">
                                        <imagedata format="PNG" align="center" fileref="win-legacy-bsd-syslog-protocol.png"/>
                                    </imageobject>
                                    <imageobject role="fo">
                                        <imagedata format="PNG" fileref="&windowsimgroot;/win-legacy-bsd-syslog-protocol.png" contentwidth="10cm"/>
                                    </imageobject>
                                </mediaobject>
                            </figure>
                            <example>
                                <title>Legacy BSD Syslog Protocol log</title>
                                <synopsis>&lt;134&gt;Oct 04 14:45:33 zts-win019.ztswin2008dom.balabit Microsoft-Windows-Eventlog[2880]: ZTSWIN2008DOM\balabit: System Microsoft-Windows-Eventlog: [Information] The Application log file was cleared. (EventID 104)</synopsis>
                            </example>
                            
                        </listitem>
                        <listitem>
                            <indexterm>
                                <primary>syslog protocol</primary>
                            </indexterm>
                            <indexterm>
                                <primary>IETF-syslog protocol</primary>
                            </indexterm>
                            <indexterm>
                                <primary>RFC 5424-5428</primary>
                            </indexterm>
                            <para><guimenu>Syslog Protocol</guimenu>: Use the new IETF-syslog protocol specified in
                                <ulink
                                    url="http://tools.ietf.org/html/rfc5424"
                                    >RFC 5424-5428</ulink>.
                                Starting from version 3.0, syslog-ng also supports the
                                IETF-protocol.</para>
                            <figure>
                                <title>Syslog Protocol</title>
                                <mediaobject>
                                    <imageobject role="html">
                                        <imagedata format="PNG" align="center" fileref="win-syslog-protocol.png"/>
                                    </imageobject>
                                    <imageobject role="fo">
                                        <imagedata format="PNG" fileref="&windowsimgroot;/win-syslog-protocol.png" contentwidth="10cm"/>
                                    </imageobject>
                                </mediaobject>
                            </figure>
                                <note>
                                    <para>Starting with version 3.2, the &agent; application uses the IETF-syslog protocol by default, and the default metadata to include is <parameter>Macro names and values</parameter>.</para>
                                </note>
                                <indexterm>
                                    <primary>SDATA</primary>
                                </indexterm>
                                <indexterm>
                                    <primary>sending macros in SDATA</primary>
                                </indexterm>
                                <indexterm>
                                    <primary>metadata in SDATA</primary>
                                </indexterm>
                                <indexterm>
                                    <primary>IETF-syslog protocol</primary>
                                    <secondary>SDATA</secondary>
                                </indexterm>
                                <indexterm>
                                    <primary>IETF-syslog protocol</primary>
                                    <secondary>adding macros to SDATA</secondary>
                                </indexterm>
                                <!-- FIXME we should find a better place for this info, or structure the procedure differently -->
                                <para>When using the IETF-syslog protocol to transfer Eventlog messages, the &agentabbrev; application can include the macros (name-value pairs) in the SDATA part of the log message. Select the data to add to the log messages from the <guimenu>Metadata to include</guimenu> list. The following options are available:</para>
                                <itemizedlist>
                                    <listitem>
                                        <para><parameter>None</parameter>: Include only the data mandated by RFC5424.</para>
                                        <synopsis>[meta sequenceId="value" sysUpTime="value"] [origin ip="value" software="value"]</synopsis>
                                    </listitem>
                                    <listitem>
                                        <para><parameter>Macro names and values</parameter>: Include every available Event macro, except <parameter>EVENT_MSG (EVENT_MESSAGE)</parameter>, <parameter>EVENT_MSG_XML (EVENT_MESSAGE_XML)</parameter> and macros with null value.</para>
                                        <para>This is the default setting.</para>
                                        <synopsis>499 &lt;132&gt;1 2010-09-28T12:02:30+02:00 zts-win004.ztswin2003dom.balabit testapp 1220 - [meta sequenceId="1" sysUpTime="1"][origin ip="zts-win004.ztswin2003dom.balabit" software="testapp"][win@18372.4 EVENT_ID="1000" EVENT_NAME="Application" EVENT_REC_NUM="1673" EVENT_SID="S-1-5-21-3460971693-970282485-2299281428-1001" EVENT_SID_TYPE="User" EVENT_SOURCE="testapp" EVENT_TYPE="Warning" EVENT_USERNAME="ZTS-WIN004\\balabit"] ﻿ZTS-WIN004\balabit: Application testapp: [Warning] test message (EventID 1000)</synopsis>
                                    </listitem>
                                    <listitem>
                                        <para><parameter>EventData (deprecated Agent v3.1 functionality)</parameter>: Include the name-vaule pairs from the <parameter>EventData > &lt;Data&gt;</parameter> field of the log message and the <parameter>Keyword</parameter> value from the System part of the XML Eventlog messages. Note that these fields are available only on Windows Vista and newer operating systems, and &agentabbrev; 3.1. automatically included these values in the log messages.</para>
                                        <synopsis>[EventData@18372.4 "name"="value"] [Keywords@18372.4 Keyword="value"]</synopsis>
                                        <para>See the following sample log message:</para>
                                        <synopsis>338 &lt;132&gt;1 2010-09-28T12:02:30+02:00 zts-win004.ztswin2003dom.balabit testapp 1620 - [meta sequenceId="1" sysUpTime="1"][origin ip="zts-win004.ztswin2003dom.balabit" software="testapp"][EventData@18372.4 Data="test message"][Keywords@18372.4 Keyword="Classic"] ﻿ZTS-WIN004\balabit: Application testapp: [Warning] test message (EventID 1000)332</synopsis>
                                    </listitem>
                                    
                                </itemizedlist>
                        </listitem>
                        <listitem>
                            <indexterm>
                                <primary>snare</primary>
                            </indexterm>
                            <para><guimenu>Snare Protocol</guimenu>: Send
                                log messages in a format compatible with the Snare log monitoring
                                tool.</para>
                            <figure>
                                <title>Snare Protocol</title>
                                <mediaobject>
                                    <imageobject role="html">
                                        <imagedata format="PNG" align="center" fileref="win-snare-protocol.png"/>
                                    </imageobject>
                                    <imageobject role="fo">
                                        <imagedata format="PNG" fileref="&windowsimgroot;/win-snare-protocol.png" contentwidth="10cm"/>
                                    </imageobject>
                                </mediaobject>
                            </figure>
                            <warning>
                                <para>3.1 and earlier versions of the &agent; application used an imperfect message template to send Snare-compatible messages. This has been corrected in the <guimenu>Snare Protocol</guimenu> option. If you need the old, imperfect mode of operation, select a syslog protocol and select <guimenu>Message
                                Type > Agent v3.1 Snare Compatible Message Type (deprecated)</guimenu>, then click
                                <guimenu>Reset Event Message Template</guimenu>.</para>
                            </warning>
                            <note>
                                <para>Snare is a tab-separated message format. Within the message part, agent replaces CRLF with 2 space, TAB character with 1 space.</para><para>You cannot modify the log format if you have selected this protocol.</para>>
                            </note>
                            <example>
                                <title>Snare log</title>
                                <synopsis>&lt;134&gt;Oct 06 13:49:41 zts-win019.ztswin2008dom.balabit MSWinEventLog   1   Application 1   Wed Oct 06 13:49:41 2010    1   syslog-ng Agent   S-1-5-21-551780264-1021859348-3425375765-1003   User    Information zts-win019.ztswin2008dom.balabit    None        Application started 1</synopsis>
                            </example>
                            
                        </listitem>
                    </itemizedlist>
                    <note>
                        <para>Selecting the <guimenu>Syslog Protocol</guimenu> option is identical
                            to using the <parameter>syslog</parameter> driver in the Linux/Unix version of syslog-ng.
                            Similarly, selecting <guimenu>Legacy BSD Syslog Protocol</guimenu> is equivalent to
                            the <parameter>tcp</parameter> driver of syslog-ng.</para>
                        <para>Changing a protocol does not automatically change the protocol
                            template used. To use a protocol-specific template, select
                                <guimenu>Reset Protocol Template</guimenu> after modifying the
                            protocol.</para>
                    </note>
                </step>
                <step>
                    <indexterm>
                        <primary>message template</primary>
                    </indexterm>
                    <indexterm>
                        <primary>message format</primary>
                    </indexterm>
                    <indexterm>
                        <primary>formatting messages</primary>
                    </indexterm>
                    <para>If needed, modify the template of the messages. The format of the messages
                        can be different for the eventlog and the file sources.</para>
                </step>
                <step>
                    <indexterm>
                        <primary>hostname resolution</primary>
                    </indexterm>
                    <indexterm>
                        <primary>hostname in the messages</primary>
                    </indexterm>
                    <para>If the host running &agentabbrev; is sometimes logged in into a domain,
                        sometimes not, then its hostname might change depending on its actual domain
                        membership. This might cause that the hostname appearing in the syslog
                        messages depends on the domain membership of the host. To avoid this
                        situation, enable the <guimenu>Force DNS Hostname</guimenu> option. That
                        way &agentabbrev; resolves the name of its host from the DNS server, and
                        uses the resolved FQDN in the syslog messages.</para>
                </step>
                <step>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>failover servers</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>client-side failover</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>client-side failover</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <para>If you have a backup server that can accept log messages if the primary
                        logserver becomes unavailable, select the <guimenu>Failover
                            Servers</guimenu> tab, click <guimenu>Add</guimenu>, and enter the
                        hostname or the IP address of the backup logserver into the <guimenu>Server
                            Name</guimenu> field. Repeat this step if you have more than one backup
                            servers.</para>
                    <figure>
                        <title>Failover Servers</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-server-property-failover.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-server-property-failover.png" contentwidth="10cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
                <step>
                    <para>If you want to send the log messages to more than on server in parallel,
                        so that every server receives every message, repeat Steps 3-4 to add the
                        secondary servers. Secondary servers may have failover servers as
                        well.</para>
                    <note>
                        <para>The syslog-ng Agent for Windows application considers a message
                            received by the logserver if the primary server of the destination, or
                            one of its failover servers receives it. To modify which server of a
                            destination is the primary server, select <guimenu>syslog-ng Agent
                                Settings > Destinations</guimenu>, right-click on the
                            server you want to be primary, select <guimenu>Properties > Set Primary
                                Server</guimenu>. </para>
                    </note>
                </step>
                <step>
                    <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
            <procedure id="windows_rate_limit">
                    <title>Limiting the rate of messages</title>
                    <indexterm>
                    <primary>throttle</primary>
                    <secondary>on Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>message rate</primary>
                    <secondary>on Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>throttle</secondary>
                </indexterm>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                    <para>The syslog-ng Agent can control the rate of messages (message per second) sent
                    to the central server. That way sudden message-bursts can be avoided, and the
                    load of the server is decreased.</para>
                <para>To limit the number of messages sent to a destination, complete the following
                    steps:</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Start the configuration interface of the syslog-ng Agent for Windows
                            application.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
                    </step>
                    <step>
                        <para>Select the destination server and select <guimenu>Properties</guimenu>.
                            To limit the number of messages that the syslog-ng agent sends to the
                            server per second, enter the desired limit into the
                                <guimenu>Throttle</guimenu> field. By default
                                (<parameter>0</parameter>), the syslog-ng agent does not limit the
                            number of messages sent.</para>
                        <note>
                            <para>The throttling parameter applies to the total number of messages
                                sent, not to every source independently. The same value applies to
                                the failover servers of the destination.</para>
                            <para>If you are sending messages to multiple servers, then the speed of
                                the primary server is important: if the primary server cannot accept
                                the messages fast enough, the syslog-ng agent will reduce the number
                                of sent messages to match the speed of the primary server, even if
                                the secondary servers could accept messages faster. If the secondary
                                servers cannot accept messages as fast as the primary server, then
                                the secondary servers will lose messages; the syslog-ng agent will
                                not slow down to wait for them.</para>
                        </note>
                    </step>
                    <step>
                        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>.
                            To activate the changes, restart the syslog-ng Agent service.</para>
                    </step>
                </procedure>
        </section>
        <section id="windows_sources">
            <title>Configuring message sources</title>
            <para>The syslog-ng Agent for Windows application can read messages from eventlog
                containers and text files. The following sections explain how to configure these
                message sources.</para>
            <itemizedlist>
                <listitem>
                    <para>For details on how to forward messages from eventlog containers, see <xref
                            linkend="windows_sources_eventlog"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to forward messages from plain text log files, see <xref
                            linkend="windows_sources_file"/>.</para>
                </listitem>
                <listitem>
                    <para>Some global settings can apply to both types of sources, these are
                        described in <xref linkend="windows_global_settings"/>.</para>
                </listitem>
            </itemizedlist>
            <section id="windows_sources_eventlog">
                <title>Eventlog sources</title>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>eventlog sources</secondary>
                </indexterm>
                <indexterm>
                    <primary>sources</primary>
                    <secondary>eventlog</secondary>
                </indexterm>
                <para>The syslog-ng Agent for Windows application can collect messages from the
                    standard Windows eventlog containers, as well as from custom containers. The
                    agent automatically forwards the messages from three standard eventlog
                    containers (<parameter>Application, Security, System</parameter>). To enable or
                    disable these sources, or to add custom eventlog containers, complete the
                    following steps:</para>
                <note>
                    <para>The syslog-ng Agent for Windows sends its own log messages into the
                            <parameter>Application</parameter> eventlog container.</para>
                    <para>The agent caches in the registry the ID of the last message sent to the
                        destination server, so if the agent is not operating for a time (for example
                        it is restarted ), then it starts reading messages from the last cached
                        message ID, sending out all the new messages.</para>
                </note>
                <warning>
                    <para>If an eventlog container becomes corrupt, the agent will stop processing
                        the event source. A log message (<parameter>Eventlog file is
                            corrupt</parameter>) is sent directly to the logserver to notify about
                        the error.</para>
                </warning>
                <procedure id="windows_sources_regular_eventlog">
                    <title>Managing eventlog sources</title>
                    <figure>
                        <title>Managing eventlog sources</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-event-containers-properties.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-event-containers-properties.png" contentwidth="10cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                    
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Start the configuration interface of the syslog-ng Agent for Windows
                            application.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>syslog-ng Agent Settings > Eventlog
                                Sources</guimenu>, and double-click on <guimenu>Event
                                Containers</guimenu>.</para>
                    </step>
                    <step>
                        <itemizedlist>
                            <listitem>
                                <para>To disable sending messages from an eventlog container,
                                    unselect the checkbox before the name of the container.</para>
                            </listitem>
                            <listitem>
                                <para>To modify the log facility associated with the messages of the
                                    container, select the container, click
                                        <guimenu>Edit</guimenu>, and select the log facility to
                                    use in the <guimenu>Log Facility</guimenu> field.</para>
                            </listitem>
                            <listitem>
                                <para>To add a custom container, select <guimenu>Add</guimenu>,
                                    and enter the name if the container into the <guimenu>Event
                                        Container Name</guimenu> field. If you do not know the name
                                    of the container, see <xref
                                        linkend="windows_custom_eventlog_name"/>. </para>
                            </listitem>
                        </itemizedlist>
                    </step>
                    <step>
                        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>.
                            To activate the changes, restart the syslog-ng Agent service.</para>
                    </step>
                </procedure>
                <procedure id="windows_custom_eventlog_name">
                    <title>Determining the name of a custom eventlog container</title>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Open the Event Viewer application.</para>
                    </step>
                    <step>
                        <para>Select the custom container you are looking for (for example
                                <parameter>DNS Server</parameter>).</para>
                    </step>
                    <step>
                        <para>Right click on the container and select
                            <guimenu>Properties</guimenu>.</para>
                    </step>
                    <step>
                        <para>The name of the container is the name of the file (without the
                            extension) displayed in the <guimenu>Logname</guimenu> field (for
                            example for
                                <parameter>C:\WINDOWS\system32\config\DnsEvent.Evt</parameter> it is
                                <parameter>DnsEvent</parameter>).</para>
                    </step>
                    <step>
                        <para>Use this name as the name of the custom eventlog container during the
                            procedure described in <xref linkend="windows_sources_regular_eventlog"
                            />.</para>
                        <note>
                            <para>On Windows Vista and Server 2008, some container are not real
                                containers, but show selected messages collected from multiple
                                containers. To forward such messages to the syslog-ng server, you
                                have to find out which real containers are displayed in the
                                container, and add them to the configuration of the syslog-ng
                                Agent.</para>
                            <para>Some containers have the <parameter>%4</parameter> characters in
                                their names. When adding these to the syslog-ng Agent, replace
                                    <parameter>%4</parameter> with the <parameter>/</parameter>
                                (slash) character. For example write
                                    <parameter>microsoft-windows-bits-client/analytic</parameter>
                                instead of
                                    <parameter>microsoft-windows-bits-client%4analytic</parameter>.</para>
                            <para>If you are sending old messages to the server as well, the
                                syslog-ng Agent will not send the very first message stored in the
                                container. This is a bug in the Windows API.</para>
                        </note>
                    </step>
                </procedure>
            </section>
                <procedure id="windows_sources_file">
                    <title>Managing file sources</title>
                    <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>file sources</secondary>
                </indexterm>
                <indexterm>
                    <primary>sources</primary>
                    <secondary>windows log files</secondary>
                </indexterm>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                    <para>The &agent; application can collect log messages from text
                        files. It can process messages spanning multiple lines, and supports the use of wildcards (<parameter>*</parameter>, <parameter>?</parameter>) in filenames to be able to follow log files that are automatically rotated.
                        To configure file sources, complete the following steps:</para>
                    <figure>
                        <title>Managing file sources</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-file-source-property.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-file-source-property.png" contentwidth="10cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                    <figure>
                        <title>Sources properties</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-sources-properties.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-sources-properties.png" contentwidth="10cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Start the configuration interface of the syslog-ng Agent for Windows
                            application.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>syslog-ng Agent Settings > File Sources</guimenu>,
                            double-click on <guimenu>Sources</guimenu>, and check the
                                <guimenu>Enable</guimenu> option.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>Add > Browse</guimenu>, and select the folder containing the log files in the <guimenu>Base
                                Directory</guimenu> field. Select or enter the name and extension
                            of the log files in the <guimenu>File Name Filter</guimenu> field.
                            Wildcards may be used. The syslog-ng agent will forward log messages
                            from every file that is located in this folder and has a name that
                            matches the filter expression.</para>
                        <tip>
                            <para>When specifying the Base Directory, you can use the environment
                                variables of Windows, for example <parameter>%WINDIR%</parameter>,
                                    <parameter>%SYSTEMROOT%</parameter>,
                                    <parameter>%PROGRAMFILES%</parameter>, and so on.</para>
                        </tip>
                        <warning>
                            <para>Note that when managing members of a domain, the selected path
                                must be available on the domain members, for example
                                    <filename>C:\logs</filename> must be available on the client
                                hosts and not on the domain controller.</para>
                        </warning>
                    </step>
                    <step>
                        <itemizedlist>
                            <listitem>
                                <para>To send messages from the files located in the subfolders of
                                    the folder set as Base Directory, select the
                                        <guimenu>Recursive</guimenu> option.</para>
                            </listitem>
                            <listitem>
                                <para>To send messages only from the file that was last modified,
                                    select the <guimenu>Last Modified File Only</guimenu>
                                    option.</para>
                                <note>
                                    <para>When using the <guimenu>Last Modified File
                                            Only</guimenu> option with a file source that has
                                        wildcard in the filename (for example
                                            <parameter>*.log</parameter>), the following will
                                        happen. When started for the first time, the agent will send
                                        the contents of every matching file to the central server,
                                        and store the position of the last message in the file with
                                        the most recent modification date. When new messages are
                                        written to this file, the agent will send only the new
                                        messages. However, if an older file is modified, the agent
                                        will resend the entire contents of this newly modified file,
                                        and store the position of the last message in this file
                                        only.</para>
                                    <para>When you use wildcards together with the <guimenu>Last
                                            Modified File Only</guimenu> option, make sure that
                                        older files will not be modified.</para>
                                </note>
                                <para>If you are forwarding the logs of Internet Information Server
                                    (IIS) 5 applications, select the <guimenu>IIS 5.x
                                        Log</guimenu> option.</para>
                                <note>
                                    <para>If this option is not selected, the &agentabbrev; monitors
                                        every matching file in the folder for changes, and sends new
                                        log messages from all files.</para>
                                </note>
                            </listitem>
                            <listitem>
                                <para>To send messages only from the file that was last modified of
                                    every subfolder of the Base Directory, select both the
                                        <guimenu>Last Modified File Only</guimenu> and the
                                        <guimenu>Recursive</guimenu> options.</para>
                            </listitem>
                            <listitem>
                                <para>To change the log facility or the log severity associated to
                                    the file source, select the desired facility or priority from
                                    the <guimenu>Log Facility</guimenu> or <guimenu>Log
                                        Severity</guimenu> fields, respectively.</para>
                                <note>
                                    <para>Significant changes to the settings of a file source may
                                        cause the syslog-ng Agent to resend the entire contents of
                                        the matching files. This means that log messages already
                                        sent earlier to the syslog-ng server may be resent and thus
                                        duplicated in the server logs. Configuration changes that
                                        may result in such behavior are:</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>changing the Base Directory,</para>
                                        </listitem>
                                        <listitem>
                                            <para>changing filter options,</para>
                                        </listitem>
                                        <listitem>
                                            <para>changing recursivity and Last Modified File Only
                                                options.</para>
                                        </listitem>
                                    </itemizedlist>
                                </note>
                            </listitem>
                        </itemizedlist>
                    </step>
                    <step id="windows_sources_file_encoding">
                        <indexterm>
                            <primary>file sources</primary>
                            <secondary>encoding</secondary>
                        </indexterm>
                        <indexterm>
                            <primary>file encoding</primary>
                        </indexterm>
                        <para>By default, the &agentabbrev; application assumes that the source files are encoded using the default windows ANSI code page, specific to the locale of the host. If the files have a different encoding, select it from the <guimenu>File Encoding</guimenu> field. Unicode, UTF-16, and UTF-32 encodings are currently not supported. Note that the log messages are sent to the destinations using UTF-8 encoding.</para>
                    </step>
                    <step id="windows_sources_file_multi_line" xreflabel="Processing multi-line messages">
                        <indexterm>
                            <primary>processing multi-line messages</primary>
                        </indexterm>
                        <indexterm>
                            <primary>multi-line messages</primary>
                        </indexterm>
                        <indexterm>
                            <primary>multiline messages</primary>
                        </indexterm>
                        <para>If a log messages in the log file consists of multiple lines, that is, the log messages contain newline characters, configure &agentabbrev; to process the related lines as a single message.</para>
                        <indexterm>
                            <primary>Tomcat log messages</primary>
                        </indexterm>
                        <indexterm>
                            <primary>Catalina log messages</primary>
                        </indexterm>
                        <indexterm>
                            <primary>Apache Tomcat Catalina log messages</primary>
                        </indexterm>
                        <indexterm>
                            <primary>Oracle SQL log messages</primary>
                        </indexterm>
                        <para>The &agentabbrev; application can automatically handle Apache Tomcat Catalina and Oracle SQL log messages. To process such messages, select the name of the application from the <guimenu>Multiple Lines > Application</guimenu> field. Note that the timestamp of Tomcat log messages depends on the locale of the host.</para>
                        <para>To process multi-line log messages of a different application, complete the following steps.</para>
                        <substeps>
                            <step>
                                <para>Select <guimenu>Multiple Lines > Application > Custom</guimenu>, and set the <guimenu>Multiple Lines > Prefix</guimenu> and optionally the <guimenu>Multiple Lines > Garbage</guimenu> fields.</para>
                            </step>
                            <step>
                                <indexterm type="parameter">
                                    <primary>multi-line-prefix()</primary>
                                </indexterm>
                                <para>Specify a string or regular expression that matches the beginning of the log messages in the <guimenu>Multiple Lines > Prefix</guimenu> field. If the <guimenu>Prefix</guimenu> option is set, the &agentabbrev; ignores newline characters from the source until a line matches the regular expression again, and treats the lines between the matching lines as a single message.</para>
                                <note>
                                    <para>Use as simple regular expressions as possible, because complex regular expressions can severely reduce the rate of processing multi-line messages.</para>
                                </note>
                            </step>
                            <step>
                                <para>Use the <guimenu>Multiple Lines > Garbage</guimenu> option when processing multi-line messages that contain unneeded parts between the messages. Specify a string or regular expression that matches the beginning of the unneeded message parts. If the <guimenu>Garbage</guimenu> option is set, the &agentabbrev; ignores lines between the line matching the <guimenu>Garbage</guimenu> expression and the next line matching <guimenu>Prefix</guimenu>.</para>
                                <para>When receiving multi-line messages from a source when the <guimenu>Garbage</guimenu> option is set but no matching line is received between two lines that match <guimenu>Prefix</guimenu>, the &agentabbrev; application will continue to process the incoming lines as a single message until a line matching <guimenu>Garbage</guimenu> is received.</para>
                                <warning>
                                    <para>If the <guimenu>Garbage</guimenu> option is set, the &agentabbrev; application discards lines between the line matching the <guimenu>Garbage</guimenu> and the next line matching <guimenu>Prefix</guimenu> expressions.</para>
                                </warning>
                            </step>
                            <step>
                                <para><emphasis>Optional Step</emphasis>: After creating and testing a custom pattern, please consider sending your pattern to &vendor; so we can include it in a future version of &agentabbrev;. To share your pattern with &vendor; and other &agentabbrev; users, click <guimenu>Multiple Lines > Send custom pattern to BalaBit</guimenu>. Your e-mail application will open, with an e-mail containing the application name and the pattern.</para>
                            </step>
                        </substeps>
                    </step>
                    <step>
                        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>.
                            To activate the changes, restart the &agentabbrev; service.</para>
                    </step>
                </procedure>
                <note>
                    <para>If an application writes a message into a log file without ending the line
                        with a new-line character, saves (closes) the file, and later continues to
                        write into the same line, then this is visible in the file as a single line,
                        but the syslog-ng agent interprets them as two separate messages.</para>
                </note>
                <warning>
                    <para>If an application deletes a log file, the application must ensure that
                        &agentabbrev; had enough time to forward the messages from the file to the
                        central server to avoid losing messages.</para>
                </warning>
                <example>
                    <title>Collecting the logs of multiple applications from a single folder</title>
                    <para>If two applications log into the same folder (for example
                            <filename>C:\logs</filename>), you have to create two file sources. For
                        example, if the name of the log files is
                            <parameter>application1-*.log</parameter> and
                            <parameter>application2-*.log</parameter>, respectively, then create two
                        file sources with the <filename>C:\logs</filename> Base Directory, but with
                        different File Name Filter: <parameter>application1-*.log</parameter> and
                            <parameter>application2-*.log</parameter>, respectively.</para>
                    <para>If other applications log into the <filename>C:\logs</filename> folder,
                        add a separate expression for each application.</para>
                    <para>By default, the syslog-ng agent will send every message to the server that
                        arrives into any of the monitored log files. To send only the messages that
                        arrive into the latest file of the source, enable the <guimenu>Last
                            Modified File Only</guimenu> option.</para>
                </example>
                <procedure id="windows_global_settings">
                    <title>Configuring global settings</title>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                <para>The syslog-ng Agent for Windows application has some global settings that can
                    apply to both eventlog and file sources. To configure the global settings,
                    complete the following procedure:</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Start the configuration interface of the syslog-ng Agent for Windows
                            application.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>syslog-ng Agent Settings</guimenu> and
                            double-click on <guimenu>Global Settings</guimenu>.</para>
                    </step>
                    <step>
                        <para>Set the default log facility associated to the messages.</para>
                    </step>
                    <step>
                        <para>By default, the filters and regular expressions (see <xref
                                linkend="windows_message_filtering"/>) used in the message filters
                            are case-sensitive. To make them case-insensitive, select the
                                <guimenu>Regular Expressions Ignore Case</guimenu> or the
                                <guimenu>Filters Ignore Case</guimenu> options, or both.</para>
                        <note>
                            <para>The <guimenu>Regular Expressions Ignore Case</guimenu> option
                                makes the <parameter>Message Contents</parameter> filter
                                case-insensitive for both file and eventlog sources. The
                                    <guimenu>Filters Ignore Case</guimenu> option makes the
                                    <parameter>Computers</parameter>, <parameter>Sources and
                                    Categories</parameter>, and the <parameter>Users</parameter>
                                filter case-insensitive.</para>
                        </note>
                    </step>
                    <step>
                        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>.
                            To activate the changes, restart the syslog-ng Agent service.</para>
                    </step>
                </procedure>
                <procedure id="windows_disable_source">
                    <title>Disabling sources and filters globally</title>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>disabling sources and filters</secondary>
                    </indexterm>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                <para>Filters and sources can be disabled globally as well. Disabling filters or
                    sources means that the syslog-ng agent ignores the disabled settings: that is,
                    if the file sources are disabled, the agent does not send the messages from the
                    files to the server. For details, see the following procedure.</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Start the configuration interface of the syslog-ng Agent for Windows
                            application.</para>
                    </step>
                    <step>
                        <itemizedlist>
                            <listitem>
                                <para>To disable eventlog sources, select <guimenu>syslog-ng Agent
                                        Settings</guimenu>, right-click on <guimenu>Eventlog
                                        Sources</guimenu>, then select <guimenu>Properties >
                                        Disable</guimenu>. </para>
                            </listitem>
                            <listitem>
                                <para>To disable file sources, select <guimenu>syslog-ng Agent
                                        Settings</guimenu>, right-click on <guimenu>File
                                        Sources</guimenu>, then select <guimenu>Properties >
                                        Disable</guimenu>. </para>
                            </listitem>
                            <listitem>
                                <para>To disable eventlog filters, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, right-click on <guimenu>Global Event Filters</guimenu>, then select <guimenu>Properties > Disable</guimenu>.</para>
                            </listitem>
                            <listitem>
                                <para>To disable file filters, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, right-click on <guimenu>Global File Filters</guimenu>, then select <guimenu>Properties > Disable</guimenu>.</para>
                            </listitem>
                        </itemizedlist>
                    </step>
                    <step>
                        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>.
                            To activate the changes, restart the syslog-ng Agent service.</para>
                    </step>
                </procedure>

        </section>
        <section id="windows_ssl">
            <title>Using SSL-encrypted connections with the syslog-ng agent</title>
            <indexterm>
                <primary>authentication</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <indexterm>
                <primary>TLS</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <indexterm>
                <primary>certificates</primary>
            </indexterm>
            <para>When connecting to a syslog-ng server using an encrypted connection, the syslog-ng
                agent verifies the certificate of the server. The connection is established only if
                the Certificate Authority (CA) that issued the certificate of the server is
                available in the Certificate Store (<guimenu>MMC > Certificates > Computer Account
                    > Local Computer > Trusted Root Certificates</guimenu>) of the Windows-based
                host.</para>
            <note>
                <para>This certificate (sometimes also called the CACert of the server) is not the
                    certificate of the server: it is the certificate of the CA that signed the
                    certificate of the
                    server.<!-- (For details on how certificate-based authentication
                works, see <xref linkend="concepts_tls"/>)--></para>
            </note>
            <procedure id="windows_enable_ssl">
                <title>Enabling encrypted connections</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
            <para>To enable SSL-encrypted connections to the server, complete the following
                steps:</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click on the server that accepts encrypted connections and select
                            <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>Select the <guimenu>Use SSL</guimenu> option.</para>
                    <warning>
                        <para>The connection can be established only if the Certificate Authority
                            (CA) that issued the certificate of the server is available in the
                            Certificate Store (<guimenu>MMC > Certificates > Computer Account >
                                Local Computer > Trusted Root Certificates</guimenu>) of the
                            Windows-based host. For details
                            on importing certificates, see <xref linkend="windows_importcert"/>.</para>
                    </warning>
                    <xi:include href="chapter-encrypted-transport-tls.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude"
                        xpointer="element(cert_common_name)"/>
                </step>
                <step>
                    <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
            <section id="windows_ssl_mutual">
                <title>Using mutual authentication with syslog-ng agent</title>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>mutual authentication</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>client authentication</secondary>
                </indexterm>
                <indexterm>
                    <primary>mutual authentication</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>client authentication</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <para>When the syslog-ng server is configured to use mutual authentication, it
                    requests a certificate from the syslog-ng clients. The &agentabbrev; application
                    can automatically show the requested certificate to the server when the
                    connection is established, provided it is available in the <guimenu>Personal
                        Certificates</guimenu> store (<guimenu>MMC > Certificates > Computer
                        Account > Local Computer > Personal Certificates</guimenu>) of the Local
                    Computer. Use the <guimenu>Certificate Import Wizard</guimenu> to import
                    this certificate. For details, see <xref linkend="windows_importcert"/>.</para>
                <!--      <note>
                <para>If the syslog-ng agent cannot find a suitable certificate in the Local
                    Computer/Personal Certificates store, it also checks the Personal Certificates
                    store of the syslog-ng Agent service. If the syslog-ng agent was started
                    manually, the Personal Certificates store of the current user is also
                checked.</para>
            </note>-->
                <note>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>certificate revocation lists</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>syslog-ng agent</primary>
                        <secondary>CRL</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>certificate revocation lists</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>CRL</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <para>If a certificate revocation list (CRL) is available in the Local
                        Computer/Personal Certificates store, the syslog-ng agent verifies that the
                        certificate of the syslog-ng server is not on this list.</para>
                </note>
                <procedure id="proc_windows_ssl_mutual">
                    <title>Configuring mutual authentication with the syslog-ng Agent for
                    Windows</title>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                    <para>If the syslog-ng server requests authentication from the syslog-ng Agent,
                    complete the following steps.</para>
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Create certificates for the clients. By default, the syslog-ng agent
                            will look for a certificate that contains the hostname or IP address of
                            the central syslog-ng server in its Common Name. If you use a different
                            Common Name, do not forget to complete Step 3 to set the Common Name of
                            the certificate.</para>
                        <para>The certificate must contain the private key and must be in PKCS12
                            format.</para>
                        <tip>
                            <para>To convert a certificate and a key from PEM format to PKCS12 you
                                can use the following command:</para>
                            <synopsis>openssl pkcs12 -export -in agentcertificate.pem -inkey agentprivatekey.pem -out agentcertificatewithkey.pfx </synopsis>
                        </tip>
                    </step>
                    <step>
                        <para>Import this certificate into the <guimenu>Personal
                                Certificate</guimenu> store of the Local Computer using the
                            Certificate Import Wizard. For details, see <xref linkend="windows_importcert"/>.</para>
                    </step>
                    <step>
                        <para>By default, the syslog-ng agent will look for a certificate that
                            contains the hostname or IP address of the central syslog-ng server in
                            its Common Name. (The agent will look for the server name or address set
                            in the <guimenu>Server Name</guimenu> field of the destination.) If
                            the certificate of the client has a different Common Name, complete the
                            following steps:</para>
                        <substeps>
                            <step>
                                <para>Start the configuration interface of the syslog-ng Agent for
                                    Windows application.</para>
                            </step>
                            <step>
                                <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>.</para>
                            </step>
                            <step>
                                <para>Right-click on the server that requires mutual authentication and
                                    select <guimenu>Properties</guimenu>.</para>
                            </step>
                            <step>
                                <para>Select the <guimenu>Use SSL</guimenu> option, click
                                        <guimenu>Select</guimenu>, then select the certificate
                                    to use. You can also type the Common Name of the certificate
                                    into the <guimenu>Client Certificate Subject</guimenu>
                                    field.</para>
                                <para>If you have more than one certificates with the same Common
                                    Name, alternatively, you can type the Distinguished Name (DN) of
                                    the certificate into the <guimenu>Client Certificate
                                        Subject</guimenu> field. When using the Distinguished Name,
                                    type only the elements of the name, separated with comma,
                                    starting with the country. For example <parameter>US, Maryand,
                                        Pasadena, Example Inc, Sample Department,
                                        mycommonname</parameter>
                                </para>
                                <note>
                                    <para>A common way is to use the hostname or the IP address of
                                        the host running the &agentabbrev; as the Common Name of the
                                        certificate (for example
                                            <parameter>syslog-ng-agent1.example.com</parameter>).</para>
                                </note>
                            </step>
                        </substeps>
                    </step>
                    <step>
                        <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>.
                            To activate the changes, restart the syslog-ng Agent service.</para>
                    </step>
                </procedure>
            </section>
                <procedure id="windows_importcert">
                    <title>Importing certificates with the Microsoft Management Console</title>
                    <indexterm>
                    <primary>certificates</primary>
                    <secondary>importing on Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>importing certificates</secondary>
                </indexterm>
                <indexterm>
                    <primary>importing certificates</primary>
                </indexterm>
                    <formalpara>
                        <title>Purpose:</title>
                        <para/>
                    </formalpara>
                <para>To import a certificate, complete the following steps.</para>
                <!-- FIXME leirni, hogy a Ca es kliens certeket hogyan lehet domain controllerbol 
            letolni a kliensekre
            CA: GPO > properties > edit > Windows Settings > Publi key policies > Trusted Root Certificates > Import
            -->
                    <formalpara>
                        <title>Steps:</title>
                        <para/>
                    </formalpara>
                    <step>
                        <para>Start Microsoft Management Console by executing
                                <filename>mmc.exe</filename> (<guimenu>Start</guimenu> menu
                                <guimenu>Run application</guimenu>). </para>
                        <note>
                            <para>Running <filename>mmc.exe</filename> requires administrator
                                privileges.</para>
                        </note>
                    </step>
                    <step>
                        <para>Click on the <guimenu>Add/Remove snap-in</guimenu> item of the
                                <guimenu>File</guimenu> menu.</para>
                    </step>
                    <step>
                        <para>Click <guimenu>Add</guimenu>, select the
                                <guimenu>Certificates</guimenu> module, and click
                                <guimenu>Add</guimenu>.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>Computer account</guimenu> in the displayed window and
                            click <guimenu>Next</guimenu>.</para>
                    </step>
                    <step>
                        <para>Select <guimenu>Local computer</guimenu> and click
                                <guimenu>Close</guimenu>. </para>
                    </step>
                    <step>
                        <para>To import the certificate of the syslog-ng server, navigate to
                                <guimenu>Console Root > Certificates > Trusted Root Certificate
                                Authorities > Certificates</guimenu>.</para>
                        <para>To import a certificate for the syslog-ng agent to perform mutual
                            authentication, navigate to <guimenu>Console Root > Certificates >
                                Personal > Certificates</guimenu>.</para>
                    </step>
                    <step>
                        <para>Right-click on the <guimenu>Certificates</guimenu> folder and from
                            the appearing menu select <guimenu>All tasks > Import</guimenu>. The
                                <guimenu>Certificate Import Wizard</guimenu> will be displayed.
                            Click <guimenu>Next</guimenu>.</para>
                        <para><emphasis>Optional step</emphasis>: Certificates used to authenticate
                            the syslog-ng agent in mutual authentication include the private key.
                            Provide the password for the private key when requested.</para>
                    </step>
                    <step>
                        <para>Windows offers a suitable certificate store by default, so click
                                <guimenu>Next</guimenu>.</para>
                    </step>
                    <step>
                        <para>Click <guimenu>Finish</guimenu> on the summary window and
                                <guimenu>Yes</guimenu> on the window that marks the successful
                            importing of the certificate.</para>
                    </step>
                </procedure>

        </section>
        <section id="windows_message_filtering">
            <title>Filtering messages</title>
            <indexterm>
                <primary>message filtering</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>filtering messages</secondary>
            </indexterm>
            <para>The syslog-ng Agent for Windows application can filter log messages both in
                blacklist- and whitelist fashion. When using blacklisting, you can define filters,
                and any message that matches the filters is ignored by the agent &mdash; only
                messages that do not match the filters are sent to the central server. When using
                whitelisting, you can define filters, and the messages matching the filters are
                forwarded to the central server &mdash; other messages are ignored. By default, blacklist filtering is used.</para>
            <para>If you define multiple filters, the messages must match every filter. In other
                words, the filters are connected to each other with logical AND operations.</para>
            <para>Different filters are available for eventlog- and file sources. When the
                &agentabbrev; processes a message, it checks the relevant filters on-by-one: if it
                finds a filter that matches the message, the agent stops processing the message
                without sending it to the server.</para>
            <note>
                <para>By default, all filters are case sensitive. For details on how to change this behavior, see <xref
                        linkend="windows_global_settings"/>.</para>
            </note>
            <itemizedlist>
                <listitem>
                    <para>For details on how to filter messages received from eventlog sources, see <xref
                            linkend="filters_eventlog"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to filter messages received from file sources, see <xref
                            linkend="filters_file"/>.</para>
                </listitem>
                <listitem>
                    <para>For details on how to disable filtering globally, see <xref
                            linkend="windows_disable_source"/>.</para>
                </listitem>
            </itemizedlist>
            
            <procedure id="filters_eventlog">
                <title>Filtering eventlog messages</title>
                <indexterm>
                    <primary>message filtering</primary>
                    <secondary>eventlog messages</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>The following types of filters are available for eventlog sources:</para>
            <itemizedlist>
                <listitem>
                    <para><emphasis>Sources</emphasis>: Filter on the source
                        (application) that created the message. Corresponds with the <link linkend="EVENT_SOURCE"><parameter>EVENT_SOURCE</parameter></link> macro.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Sources and Event ID</emphasis>: Filter on the source
                        (application) that created the message, and optionally on the identification
                        number of the event. Corresponds with the <link linkend="EVENT_SOURCE"><parameter>EVENT_SOURCE</parameter></link> and <link linkend="EVENT_ID"><parameter>EVENT_ID</parameter></link>
                        macros.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Message Contents</emphasis>: Filter the text of the message,
                        that is, the contents of the <link linkend="EVENT_MESSAGE"><parameter>EVENT_MESSAGE</parameter></link> macro. In this filter you can use regular expressions.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Sources and Categories</emphasis>: Filter on the source
                        (application) that created the message, and optionally on the category of
                        the event. Corresponds with the <link linkend="EVENT_SOURCE"><parameter>EVENT_SOURCE</parameter></link> and <link linkend="EVENT_CATEGORY"><parameter>EVENT_CATEGORY</parameter></link> macros.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Users</emphasis>: Filter on the username associated with the
                        event. Corresponds with the <link linkend="EVENT_USERNAME"><parameter>EVENT_USERNAME</parameter></link> macro.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Computers</emphasis>: Filter on the name of the computer (host)
                        that created the event. Corresponds with the <link linkend="HOST"><parameter>HOST</parameter></link> macro.</para>
                </listitem>
                <listitem>
                    <para><emphasis>Event Types</emphasis>: Filter on the type of the event.
                        Corresponds with the <link linkend="EVENT_TYPE"><parameter>EVENT_TYPE</parameter></link> macro.</para>
                </listitem>
            </itemizedlist>
            <para>To modify the filters used for eventlog messages, complete the following
                procedure:</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To apply filters globally to every eventlog message, select <guimenu>syslog-ng Agent Settings > Destinations > Global Event Filters</guimenu>, and right-click <guimenu>Global Event Filters</guimenu>.</para>
                        </listitem>
                        <listitem>
                            <para>To apply filters only to a specific destination, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, select the destination server, then select <guimenu>Event Filters</guimenu>. Right-click <guimenu>Event Filters</guimenu>.</para>
                        </listitem>
                    </itemizedlist>
                    <note><para>If you want to use both global and local (server side) filtering, first global filters will be applied to the eventlog messages and then the local filters.</para></note>
                </step>
                <step>
                    <para>Select <guimenu>Properties > Enable > OK</guimenu>.</para>
                    <figure>
                    <title>Global event filters</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" align="center" fileref="win-global-event-filters-properties.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" fileref="&windowsimgroot;/win-global-event-filters-properties.png" contentwidth="10cm"/>
                        </imageobject>
                    </mediaobject>
                </figure>
                </step>
                
                <step>
                    <para>To use whitelist-filtering, select <guimenu>White List
                            Filtering</guimenu>. By default, &agentabbrev; uses blacklist
                        filtering.</para>
                </step>
                <step>
                    <para>On the right-hand pane, double-click on the type of filter you want to
                        create.</para>
                </step>
                <step>
                    <itemizedlist>
                        <!-- FIXME linkeket a makrokra -->
                        <listitem>
                            <para>To ignore messages sent by a specific application, or messages of
                                the application with a specific event ID, double-click on
                                    <guimenu>Sources and Event ID</guimenu>, select
                                    <guimenu>Add</guimenu>, and select the name of the source
                                (application) whose messages you want to ignore from the
                                    <guimenu>Source Name</guimenu> field. To ignore only specific
                                messages of the application, enter the ID of the event into the
                                    <guimenu>Event ID</guimenu> field. Select <guimenu>Add >
                                    Apply</guimenu>.</para>
                            <figure>
                                <title>Sources and Event ID</title>
                                <mediaobject>
                                    <imageobject role="html">
                                        <imagedata format="PNG" align="center" fileref="win-sources-and-event-ids-properties.png"/>
                                    </imageobject>
                                    <imageobject role="fo">
                                        <imagedata format="PNG" fileref="&windowsimgroot;/win-sources-and-event-ids-properties.png" contentwidth="10cm"/>
                                    </imageobject>
                                </mediaobject>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>To ignore messages that contain a specific string or text,
                                double-click on <guimenu>Message Contents</guimenu>, enter the
                                search term or a regular expression into the <guimenu>Regular
                                    Expression</guimenu> field, then select <guimenu>Add >
                                    Apply</guimenu>.</para>
                            <figure>
                                <title>Message Contents</title>
                                <mediaobject>
                                    <imageobject role="html">
                                        <imagedata format="PNG" align="center" fileref="win-message-contents-properties.png"/>
                                    </imageobject>
                                    <imageobject role="fo">
                                        <imagedata format="PNG" fileref="&windowsimgroot;/win-message-contents-properties.png" contentwidth="10cm"/>
                                    </imageobject>
                                </mediaobject>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>To ignore messages sent by a specific application, or messages of
                                the application that fall into a specific category, double-click on
                                    <guimenu>Sources and Categories</guimenu>, select
                                    <guimenu>Add</guimenu>, and select the name of the
                                application whose messages you want to ignore from the
                                    <guimenu>Application Name</guimenu> field. To ignore only
                                those messages of the application that fall into a specific
                                category, enter the name of the category into the
                                    <guimenu>Category</guimenu> field. Select <guimenu>Add >
                                    Apply</guimenu>.</para>
                        </listitem>
                        <listitem>
                            <para>To ignore messages sent by a specific user, double-click on
                                    <guimenu>Users</guimenu>, enter the name of the user into the
                                    <guimenu>User</guimenu> field, then select <guimenu>Add >
                                    Apply</guimenu>.</para>
                        </listitem>
                        <listitem>
                            <para>To ignore messages sent by a specific computer (host),
                                double-click on <guimenu>Computers</guimenu>, enter the name of the
                                user into the <guimenu>Computer</guimenu> field, then select
                                    <guimenu>Add > Apply</guimenu>.</para>
                        </listitem>
                        <listitem>
                            <para><emphasis>Event Types</emphasis>: To ignore messages of a specific
                                event-type, double-click on <guimenu>Event Types</guimenu>, select
                                the event types to ignore, and select <guimenu>Ok >
                                Apply</guimenu>.</para>
                            <note>
                                <para>Under Windows Vista and Server 2008, Windows labels certain
                                    messages as level 3 and the Event Viewer labels such messages as
                                    warnings. This is against the official specification: level 3
                                    should not be used; and only level 2 messages are warnings. To
                                    filter these events, you have to manually add a new event type
                                    to the registry and set its value to 3, for example
                                        <parameter>HKEY_LOCAL_MACHINE\SOFTWARE\BalaBit\syslog-ng
                                        Agent\Local
                                        Settings\EventSources\Filter\Type\Rule0\Type=3</parameter></para>
                            </note>
                        </listitem>
                    </itemizedlist>
                </step>
                <step>
                    <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
            
            <procedure id="filters_file">
                <title>Filtering file messages</title>
                <indexterm>
                    <primary>message filtering</primary>
                    <secondary>file filters</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>The following types of filters are available for file sources:</para>
            <itemizedlist>
                <!-- FIXME linkeket a makrokra -->
                <listitem>
                    <para><emphasis>Message Contents</emphasis>: Filter the text of the message,
                        that is, the contents of the <link linkend="FILE_MESSAGE"><parameter>FILE_MESSAGE</parameter></link> macro. In this filter you can use regular expressions.</para>
                </listitem>
                <listitem><para><emphasis>File Name</emphasis>: Filter on the file name. Corresponds with the <link linkend="FILE_NAME"><parameter>FILE_NAME</parameter></link> macro. In this filter you can use regular expressions. Only available for destination file filters.</para></listitem>
            </itemizedlist>
            <para>To modify the filters used for file messages, complete the following
                procedure:</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To apply filters globally to every file message, select <guimenu>syslog-ng Agent Settings > Destinations > Global File Filters</guimenu>, and right-click <guimenu>Global File Filters</guimenu>.</para>
                        </listitem>
                        <listitem>
                            <para>To apply filters only to a specific destination, select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>, select the destination server, then select <guimenu>File Filters</guimenu>. Right-click <guimenu>File Filters</guimenu>.</para>
                        </listitem>
                    </itemizedlist>
                    <note><para>If you want to use both global and local (server side) filtering, first global filters will be applied to the file messages and then the local filters.</para></note>
                </step>
                <step>
                    <para>Select <guimenu>Properties > Enable > OK</guimenu>.</para>
                    <figure>
                        <title>Global file filters</title>
                        <mediaobject>
                            <imageobject role="html">
                                <imagedata format="PNG" align="center" fileref="win-global-file-filters-properties.png"/>
                            </imageobject>
                            <imageobject role="fo">
                                <imagedata format="PNG" fileref="&windowsimgroot;/win-global-file-filters-properties.png" contentwidth="10cm"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
                <step>
                    <para>To use whitelist-filtering, select <guimenu>White List
                            Filtering</guimenu>. By default, &agentabbrev; uses blacklist
                        filtering.</para>
                </step>
                <step>
                    <para>On the right-hand pane, double-click on the type of filter you want to
                        create.</para>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To ignore messages that contain a specific string or text,
                                double-click on <guimenu>Message Contents</guimenu>, enter the
                                search term or a regular expression into the <guimenu>Regular
                                    Expression</guimenu> field, then select
                                <guimenu>Add</guimenu>.</para>
                        </listitem>
                    </itemizedlist>
                </step>
                <step>
                    <para>Select <guimenu>Apply</guimenu>, then <guimenu>OK</guimenu>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
        </section>


        <section id="windows_message_format">
            <title>Customizing the message format</title>
            <indexterm>
                <primary>message format</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>message format</secondary>
            </indexterm>
            <para>The format of the messages received from the eventlog and the file sources can be
                customized using templates. You can define separate message format for the eventlog
                and the file sources. If you have multiple destination servers configured, you can
                define separate templates for each server. When creating a template to customize the
                message format, you can use macros, all alphanumeric characters, and the following
                special characters: <parameter>&lt;&gt;,():;-+/_</parameter>.</para>
            
            <procedure id="windows_customize_messages">
                <title>Customizing messages using templates</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>To create a template, complete the following procedure:</para>
            <warning>
                <para>These macros are available only in the syslog-ng Agent for Windows. To
                    recognize Windows-specific elements of the log message (for example
                    eventlog-related macros) on the syslog-ng server, you have to use parsers on the
                    syslog-ng server. The parser must be configured to match the message format set
                    in the syslog-ng
                    Agent.<!-- See <xref
                    linkend="configuring_parsers"/> for details.--></para>
            </warning>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guimenu>syslog-ng Agent Settings > Destinations</guimenu>. Select
                        your logserver, and click <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>To change the format of messages received from eventlog sources, type the
                        message format you want to use into the <guimenu>Event Message Format >
                            Message Template</guimenu> field. </para>
                    <para>To change the format of messages received from file sources, type the
                        message format you want to use into the <guimenu>File Message Format >
                            Message Template</guimenu> field. </para>
                    <para>Do not forget to add the <parameter>$</parameter> character before macros.
                        For a complete list of the available
                        macros, see <xref linkend="windows_macros"/>.</para>
                    <para>For example, to send the messages in the <parameter>DATE HOSTNAME
                            MESSAGE</parameter> format, type <parameter>Date:$DATE Hostname:$HOST
                            Logmessage:$MESSAGE</parameter>.</para>
                    <para>Note that the $MESSAGE macro contains not only the text of the log
                        message, but also additional information received from the message source,
                        such as the name of the eventlog container, or the file, as set in the
                        eventlog-specific and file-specific templates.</para>
                    <note>
                        <para>Templates are assigned to a single destination server, so it is
                            possible to use different templates for different servers. However, a
                            server and its failover servers always receive the same message.</para>
                    </note>
                    <warning>
                        <para>If you have more than one destination servers configured (separate
                            servers, not in failover mode), and you want to use the same template
                            for every server, you must manually copy the template into the
                            configuration of each server. Template modifications are not applied
                            automatically to every server.</para>
                        <para>To use a Snare-compatible message format, select <guimenu>Message
                                Type > Snare Compatible Message Type</guimenu> and click
                                <guimenu>Reset Message Template</guimenu>.</para>
                        <indexterm>
                            <primary>snare</primary>
                        </indexterm>
                    </warning>
                </step>
                <step>
                    <para>Click <guimenu>OK</guimenu>.</para>
                </step>
                <step>
                    <para>To activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>

            <section id="windows_timestamp">
                <title>Customizing the timestamp used by the syslog-ng Agent</title>
                <indexterm>
                    <primary>timestamp</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>timestamp</secondary>
                </indexterm>
                <para>The syslog-ng agent can send the syslog messages using either the ISO or the
                    BSD timestamp format. It is recommended to use the ISO format, because it
                    contains much more information than the BSD format.</para>
                <para>Note that in the syslog-ng agent, the macros without prefix (for example
                        <parameter>DATE</parameter>) always refer to the receiving date of the
                    message (for example <parameter>R_DATE</parameter>) when it arrived into the
                    event log container, and are included only for compatibility reasons.</para>
                <warning>
                    <indexterm>
                        <primary>timezone</primary>
                        <secondary>Windows</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>eventlog</primary>
                        <secondary>remote logging</secondary>
                    </indexterm>
                    <para>If a remote host is logging into the event log of the local host that is
                        running syslog-ng Agent for Windows, both hosts should be in the same
                        timezone, because the event log message does not include the timezone
                        information of the sender host. Otherwise, the date of the messages received
                        from the remote host will be incorrect.</para>
                </warning>
            </section>
            <section id="windows_macros">
                <title>Macros available in the syslog-ng Agent</title>
                <para>The following sections list the available macros:</para>
                <warning>
                    <para>These macros are available only in the syslog-ng Agent for Windows. To
                        recognize Windows-specific elements of the log message (for example
                        eventlog-related macros) on the syslog-ng server, you have to use parsers on
                        the syslog-ng server. The parser must be configured to match the message
                        format set in the syslog-ng
                        Agent.<!-- See <xref linkend="configuring_parsers"/> for details.--></para>
                </warning>
                <itemizedlist>
                    <listitem>
                        <para>
                            <link linkend="macro_protocol_agent">Macros related to protocol
                                headers</link>
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            <link linkend="macro_time_agent">Macros related to the date and time of
                                the message</link>
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            <link linkend="macro_event_agent">Macros related to eventlog
                                sources</link>
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            <link linkend="macro_file_agent">Macros related to file sources</link>
                        </para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>Note that if you use the Syslog protocol template (meaning that messages
                        are sent using the IETF-syslog protocol), only the message part of the log
                        message can be customized, the structure of the headers and other
                        information is fixed by the protocol.</para>
                </note>
                <!-- FIXME ezt updatelni, mi van file sourcenal -->
                <para>By default, syslog-ng Agent uses the following format:
                        <parameter>&lt;${PRI}&gt;${BSDDATE} ${HOST} ${APP_NAME}[${PROCESS_ID}]:
                        ${MESSAGE}</parameter>, where <parameter>$MESSAGE</parameter> is
                        <parameter>${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}]
                        ${EVENT_MSG} (EventID ${EVENT_ID})</parameter> for eventlog messages, and
                        <parameter>$FILE_NAME: $FILE_CURRENT_POSITION/$FILE_SIZE:
                        $FILE_MESSAGE</parameter> for file messages.</para>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>default message format</secondary>
                </indexterm>
                <section id="macro_protocol_agent">
                    <title>Protocol-related macros of the syslog-ng agent</title>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>protocol</secondary>
                    </indexterm>
                    <simplesect>
                        <title>APP_NAME</title>
                        <para><guimenu>Description:</guimenu> An alias for the <link linkend="APPLICATION_NAME"><parameter>APPLICATION_NAME</parameter></link> macro.</para>
                    </simplesect>
                    <simplesect id="APPLICATION_NAME">
                        <title>APPLICATION_NAME</title>
                        <para><guimenu>Description:</guimenu>
                        <itemizedlist>
                            <listitem><para>At event container: Name of the application the message came from</para></listitem>
                            <listitem><para>At file as the name of creator (default value): syslog-ng-agent </para></listitem>
                        </itemizedlist>
                        </para>
                    </simplesect>
                    <simplesect id="HOST">
                        <title>HOST</title>
                        <para><guimenu>Description:</guimenu> Name of the host sending the message.
                            Hostnames are automatically converted to lowercase.</para>
                    </simplesect>
                    <simplesect id="MESSAGE">
                        <title>MESSAGE</title>
                        <para><guimenu>Description:</guimenu> The content of the message, including
                            the text of the message and any file- or event-specific macros that are
                            set for the source.</para>
                    </simplesect>
                    <simplesect>
                        <title>MSG</title>
                        <para><guimenu>Description:</guimenu> An alias for the
                            <link linkend="MESSAGE"><parameter>MESSAGE</parameter></link> macro.</para>
                    </simplesect>
                    <simplesect>
                        <title>PRI</title>
                        <para><guimenu>Description:</guimenu> Priority header of the message,
                            storing the facility and the level of the message.</para>
                    </simplesect>
                    <simplesect>
                        <title>PROCESS_ID</title>
                        <para><guimenu>Description:</guimenu> PID of the application the message came from.</para>
                    </simplesect>
                </section>
                <section id="macro_time_agent">
                    <title>Time-related macros of the syslog-ng agent</title>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>date and time</secondary>
                    </indexterm>
                    <simplesect id="macro_bsddate">
                        <title>BSDDATE, R_BSDDATE, S_BSDDATE</title>
                        <indexterm type="parameter">
                            <primary>BSDDATE, R_BSDDATE, S_BSDDATE</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> Date of the message in BSD timestamp
                            format (month/day/hour/minute/second, each expressed in two digits).
                            This is the original syslog time stamp without year information, for
                            example <parameter>Jun 13 15:58:00</parameter>. If possible, it is
                            recommended to use <parameter>ISODATE</parameter> for
                            timestamping.</para>
                    </simplesect>
                    <simplesect id="macro_date">
                        <title>DATE</title>
                        <indexterm type="parameter">
                            <primary>DATE</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> An alias of the ISODATE
                            macro.</para>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_day']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_fulldate']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_hour']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect id="macro_isodate">
                        <title>ISODATE, R_ISODATE, S_ISODATE</title>
                        <indexterm type="parameter">
                            <primary>ISODATE, R_ISODATE, S_ISODATE</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> Date of the message in the ISO 8601
                            compatible standard timestamp format (yyyy-mm-ddThh:mm:ss+-ZONE), for
                            example: <parameter>2006-06-13T15:58:00.123+01:00</parameter>. If
                            possible, it is recommended to use <parameter>ISODATE</parameter> for
                            timestamping. Note that the syslog-ng agent cannot produce fractions of
                            a second (for example milliseconds) in the timestamp.</para>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_min']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_month']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect id="macro_monthname">
                        <title>MONTHNAME, R_MONTHNAME, S_MONTHNAME</title>
                        <indexterm type="parameter">
                            <primary>MONTHNAME, R_MONTHNAME, S_MONTHNAME</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> The English name of the month the
                            message was sent, abbreviated to three characters (for example Jan, Feb,
                            and so on).</para>
                    </simplesect>
                    <simplesect id="macro_r_date">
                        <title>R_DATE</title>
                        <indexterm type="parameter">
                            <primary>R_DATE</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> Date when the message was recorded
                            into the eventlog container.</para>
                    </simplesect>
                    <simplesect id="macro_s_date">
                        <title>S_DATE</title>
                        <indexterm type="parameter">
                            <primary>S_DATE</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> Date when the message was
                            created.</para>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_sec']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect id="macro_tz">
                        <title>TZ, R_TZ, S_TZ</title>
                        <indexterm type="parameter">
                            <primary>TZ, R_TZ, S_TZ</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> The name of the time zone of the
                            host.</para>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_tzoffset']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_unixtime']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_year']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect>
                        <xi:include href="chapter-manipulating-messages.xml"
                            xpointer="xpointer(//simplesect[@id = 'macro_week']/node() )"
                            xmlns:xi="http://www.w3.org/2001/XInclude"/>
                    </simplesect>
                    <simplesect id="macro_weekday">
                        <title>WEEKDAY, R_WEEKDAY, S_WEEKDAY</title>
                        <indexterm type="parameter">
                            <primary>WEEKDAY, R_WEEKDAY, S_WEEKDAY</primary>
                        </indexterm>
                        <indexterm type="parameter">
                            <primary>$WEEKDAY, $R_WEEKDAY, $S_WEEKDAY</primary>
                        </indexterm>
                        <para><guimenu>Description:</guimenu> The 3-letter name of the day of week the message was sent, for example <parameter>Thu</parameter>.</para>
                    </simplesect>
                </section>
                <section id="macro_event_agent">
                    <title>Eventlog-related macros of the syslog-ng agent</title>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>eventlog sources</secondary>
                    </indexterm>
                    <simplesect id="EVENT_CATEGORY">
                        <title>EVENT_CATEGORY</title>
                        <para><guimenu>Description:</guimenu> The category of the event.</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_FACILITY</title>
                        <para><guimenu>Description:</guimenu> The facility that sent the
                            message.</para>
                    </simplesect>
                    <simplesect id="EVENT_ID">
                        <title>EVENT_ID</title>
                        <para><guimenu>Description:</guimenu> The identification number of the
                            event.</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_LEVEL</title>
                        <para><guimenu>Description:</guimenu> Importance level of the message
                            represented as a number: 6 - Success, 5 - Informational, 4- Warning, or
                            3 - Error).</para>
                    </simplesect>
                    <simplesect id="EVENT_MESSAGE">
                        <title>EVENT_MESSAGE</title>
                        <para><guimenu>Description:</guimenu> The content of the message.</para>
                    </simplesect>
                    <simplesect id="EVENT_MESSAGE_XML">
                        <title>EVENT_MESSAGE_XML</title>
                        <para><guimenu>Description:</guimenu> Contains the entire message in XML
                            format. Available only on Windows Vista and Server 2008 platforms</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_MSG</title>
                        <para><guimenu>Description:</guimenu> The content of the message. This is
                            an alias of the <link linkend="EVENT_MESSAGE"><parameter>EVENT_MESSAGE</parameter></link>.</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_MSG_XML</title>
                        <para><guimenu>Description:</guimenu> Contains the entire message in XML
                            format. This is an alias of the <link linkend="EVENT_MESSAGE_XML"><parameter>EVENT_MESSAGE_XML</parameter></link>. Available only on Windows Vista and Server 2008 platforms</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_NAME</title>
                        <para><guimenu>Description:</guimenu> Name of the Windows event log
                            container (for example Application or Security).</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_REC_NUM</title>
                        <para><guimenu>Description:</guimenu> The record number of the event in
                            the event log.</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_SID</title>
                        <para><guimenu>Description:</guimenu> The security identification number
                            of the event.</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_SID_TYPE</title>
                        <para><guimenu>Description:</guimenu> The security identification number
                            resolved into name. One of the following: <parameter>User</parameter>,
                                <parameter>Group</parameter>, <parameter>Domain</parameter>,
                                <parameter>Alias</parameter>
                            <parameter>WellKnownGroup</parameter>,
                                <parameter>DeletedAccount</parameter>,
                                <parameter>Invalid</parameter>, <parameter>Unknown</parameter>,
                                <parameter>Computer</parameter>. </para>
                    </simplesect>
                    <simplesect id="EVENT_SOURCE">
                        <title>EVENT_SOURCE</title>
                        <para><guimenu>Description:</guimenu> The application that created the
                            message.</para>
                    </simplesect>
                    <simplesect>
                        <title>EVENT_TASK</title>
                        <para><guimenu>Description:</guimenu> The task category of the event.
                            Available only on Windows Vista and Server 2008 platforms</para>
                    </simplesect>
                    <simplesect id="EVENT_TYPE">
                        <title>EVENT_TYPE</title>
                        <para><guimenu>Description:</guimenu> The importance level of the message
                            in text format.</para>
                    </simplesect>
                    <simplesect id="EVENT_USERNAME">
                        <title>EVENT_USERNAME</title>
                        <para><guimenu>Description:</guimenu> The user running the application
                            that created the message.</para>
                    </simplesect>
                </section>
                <section id="macro_file_agent">
                    <title>File-related macros of the syslog-ng agent</title>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>syslog-ng agent</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>macros</primary>
                        <secondary>file sources</secondary>
                    </indexterm>
                    <simplesect>
                        <title>FILE_CURRENT_POSITION</title>
                        <para><guimenu>Description:</guimenu> The position of the message from the
                            beginning of the file in bytes.</para>
                    </simplesect>
                    <simplesect>
                        <title>FILE_FACILITY</title>
                        <para><guimenu>Description:</guimenu> The facility that sent the
                            message.</para>
                    </simplesect>
                    <simplesect>
                        <title>FILE_LEVEL</title>
                        <para><guimenu>Description:</guimenu> Importance level of the message
                            represented as a number: 6 - Success, 5 - Informational, 4- Warning, or
                            3 - Error).</para>
                    </simplesect>
                    <simplesect id="FILE_MESSAGE">
                        <title>FILE_MESSAGE</title>
                        <para><guimenu>Description:</guimenu> The content of the message.</para>
                    </simplesect>
                    <simplesect>
                        <title>FILE_MSG</title>
                        <para><guimenu>Description:</guimenu> The content of the message. This is
                            an alias of the <link linkend="FILE_MESSAGE"><parameter>FILE_MESSAGE</parameter></link> macro.</para>
                    </simplesect>
                    <simplesect id="FILE_NAME">
                        <title>FILE_NAME</title>
                        <para><guimenu>Description:</guimenu> Name of the log file (including its
                            path) from where the syslog-ng Agent received the message.</para>
                    </simplesect>
                    <simplesect>
                        <title>FILE_SIZE</title>
                        <para><guimenu>Description:</guimenu> The current size of the file in
                            bytes.</para>
                    </simplesect>
                </section>
            </section>
        </section>
        <section id="windows_service">
            <title>Controlling the &agentabbrev; services</title>
            <para>During installation, &agentabbrev; registers the <parameter>syslog-ng
                    Agent</parameter> service that is started automatically when the host boots. To
                disable the automatic startup of the &agentabbrev;, or manually start or stop the
                service, use the <guimenu>Start Menu > Control Panel > Administrative Tools >
                    Services</guimenu> interface. The service is running with the privileges of
                the <parameter>NT AUTHORITY\SYSTEM</parameter> user.</para>
            <para>When the &agentabbrev; service is started or stopped, it sends a syslog message to
                the central log server and an eventlog message to the Application eventlog container
                of the host.</para>
            <warning>
                <indexterm>
                    <primary>timezone</primary>
                    <secondary>Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng Agent</primary>
                    <secondary>timezone</secondary>
                </indexterm>
                <para>If you change the timezone setting of the host while the syslog-ng Agent is
                    running, you have to restart the syslog-ng Agent. Otherwise, it will not receive
                    the updated timezone information and the date of the events will be
                    incorrect.</para>
            </warning>
            <section id="windows_command_line">
                <title>Command-line options</title>
                <para>The syslog-ng Agent for Windows application has the following command-line
                options:</para>
                <note><para>Command-line options are case-insensitive. The options consist of a single letter introduced by either "<parameter>-</parameter>" or "<parameter>/</parameter>".</para></note>
                <note><para>On Windows Vista or above, command line options will only work with administrator permission.</para></note>
                <variablelist>
                    <varlistentry>
                        <term>
                            <command>/c</command>
                        </term>
                        <listitem>
                            <para>Start the syslog-ng Agent using the specified XML configuration
                                file.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/d</command>
                        </term>
                        <listitem>
                            <para>Start the syslog-ng Agent in debug mode. The debug messages can be
                                displayed using the <command>dbgview</command> application
                                (<ulink
                                    url="http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx"
                                    >available here</ulink>).</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/e</command>
                        </term>
                        <listitem>
                            <para>Start the syslog-ng Agent in debug mode and send the messages to
                                the Application eventlog container.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/h</command>
                        </term>
                        <listitem>
                            <para>Display a help message about the command-line options.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/i</command>
                        </term>
                        <listitem>
                            <para>Install the syslog-ng Agent service into the services list.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/r</command>
                        </term>
                        <listitem>
                            <para>Remove the syslog-ng Agent service from the services list.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/v</command>
                        </term>
                        <listitem>
                            <para>Display version information.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>
                            <command>/x</command>
                        </term>
                        <listitem><para>Validate XML configuration file without importing it.</para></listitem>
                    </varlistentry>
                </variablelist>
                <para>To use these options, select <guimenu>Start > Run > cmd</guimenu>, navigate
                    to the directory where the syslog-ng Agent is installed (for example <command>cd
                        C:\Windows\Program Files\BalaBit\syslog-ng Agent\</command>), and execute
                    the <command>syslog-ng-agent.exe</command> file with the required option.</para>
                <example>
                    <title>Using command line options</title>
                    <para>To start &agentabbrev; in debug mode:</para>
                    <command>syslog-ng-agent.exe /d</command>
                    <para>To start syslog-ng Agent with XML configuration file:</para>
                    <command>syslog-ng-agent.exe /c C:\ConfigFiles\syslog-ng-agent-conf.xml
                    </command>
                    <para>To register syslog-ng Agent as a service using XML configuration file:
                    </para>
                    <command>syslog-ng-agent.exe /i C:\ConfigFiles\syslog-ng-agent-conf.xml
                    </command>
                </example>
            </section>
        </section>
    </chapter>
    <chapter id="chapter_windows_troubleshooting">
        <title>Troubleshooting syslog-ng Agent for Windows</title>
        <!--FIXME beindexelni az egyes bejegyzeseket -->
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>troubleshooting</secondary>
        </indexterm>
        <indexterm>
            <primary>troubleshooting</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <para>In case you experience problems with the &agent; application, the following points may
            be of help.</para>
        <note>
            <para>The followings address only problems specific to the &agentabbrev;, and assume
                that communication between the server and the client is otherwise possible (that is,
                the server is properly configured to receive messages and is available on the
                network, and name resolution is properly configured on the client).</para>
        </note>
        <itemizedlist>
            <listitem>
                <para><emphasis>Configuration changes do not take effect</emphasis>: Configuration
                    changes take effect only after restarting the syslog-ng service or rebooting the
                    system. Also restart the system after changing the timezone settings of the
                    host, or importing a certificate that you want to use to authenticate the
                    communication between the agent and the server. If the configuration of the
                    agent has changed since the last restart, the &agentabbrev; sends a message of
                    the change, including the hmac-sha-1 hash of the new configuration.</para>
                <para>Also note that if your clients are managed from a Domain Controller,
                    configuration changes are not instantly downloaded to the client hosts, only at
                    the time of the next group policy update. To update the configuration of a
                    client host earlier, open a command prompt on the client host, and issue the
                        <command>gpupdate /force</command> command.</para>
                <para>After downloading the configuration from the Domain Controller, the syslog-ng
                    Agent service is automatically restarted if the configuration has
                    changed.</para>
                <note>
                    <para>Certain domain settings that may affect the syslog-ng Agent are downloaded
                        only when the machine is rebooted. For example, moving the computer from one
                        group policy to another requires a reboot to have effect.</para>
                </note>
            </listitem>
            <listitem>
                <para><emphasis>The &agentabbrev; does not send messages to the server</emphasis>:
                    Check the Application eventlog for messages of the &agentabbrev;. In case of
                    connection errors and certificate problems, the &agentabbrev; sends error
                    messages into the eventlog. Ensure that the destination address of the server is
                    correctly set. If you use SSL encryption, verify that the certificate of the
                    Certificate Authority of the server and that the certificate of the client are
                    properly imported. If there are no error messages, check the logs on your
                    logserver: the &agentabbrev; sends a MARK message every ten minutes even if
                    there are no other messages to send.</para>
            </listitem>
            <listitem>
                <para><emphasis>The &agentabbrev; sends only MARK messages to the server</emphasis>:
                    Verify that you have configured the eventlog and file sources, and that they
                    have not been disabled globally. If these settings are correct but the server
                    still does not send any messages, temporarily disable all filters to see that
                    they are not configured to ignore every message. When using filter, it is also
                    recommended to check the global case-sensitivity settings.</para>
            </listitem>
            <listitem>
                <para><emphasis>The hostname used in the messages changes</emphasis>: If a host is
                    sometimes logged in into a domain and sometimes it is not, its hostname might
                    reflect this. To avoid this situation, select <guimenu>syslog-ng Agent >
                        Destinations > IPv4 > Properties > Edit > Force DNS Hostname</guimenu>.
                    This causes &agentabbrev; to resolve its own hostname from DNS and use the
                    resolved FQDN in the syslog messages.</para>
            </listitem>
            <listitem>
                <para><emphasis>Command-line parameters are ignored on Windows Vista and 2008
                        Server</emphasis>: Command-line parameters work only for administrators if
                    User Account Control (UAC) is enabled. To execute syslog-ng Agent with
                    command-line parameters, select <guimenu>Start > Programs >
                        Accessories</guimenu>, right-click on <guimenu>Command prompt > Run as
                        administrator</guimenu>. </para>
                <para>If you contact the BalaBit Support Team about a problem with the syslog-ng
                    Agent for Windows, execute the <command>syslog-ng-agent -V</command> command
                    from the command line and include every version and platform information it
                    displays in your support request.</para>
            </listitem>
            <listitem>
                <para><emphasis>CPU load is high</emphasis>: See <xref linkend="windows_cpu"
                    />.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>losing messages</primary>
                    <secondary>from eventlog containers</secondary>
                </indexterm>
                <para><emphasis>Losing messages from eventlog containers</emphasis>: An eventlog
                    container is a special file. The Agent reads this file, formats the messages and
                    sends them to remote log server. Note that the eventlog container can be
                    configured only to a certain size. If the container reaches that size, Windows
                    writes the next message to the beginning of the file. As a result, if the agent
                    is not running (or the destination server is unavailable) so long that the
                    eventlog container is filled up, messages can be lost.</para>
            </listitem>
        </itemizedlist>
        <section id="windows_cpu">
            <title>Sending messages and CPU load</title>
            <para>The &agentabbrev; application can send messages to the server when the Windows
                Scheduler provides resources to the &agentabbrev;. When there are many unsent log
                messages in the log sources, and there is no other significant activity on the host,
                syslog-ng will start to send the messages to the server, possibly increasing the CPU
                load to 100%. After all messages have been sent, or if another application requires
                the resources, the CPU load decreases back to normal.</para>
            <tip>
                <para>To avoid the initial large load on the CPU, limit the rate of message sending
                    temporarily. You can remove the limit after the old messages have been sent. For details, see
                        <xref linkend="windows_rate_limit"/>.</para>
            </tip>
            <para>When relaying the messages from multiple sources, the &agentabbrev; sends one
                message at a time from each source. That way a single source with a large log
                traffic does not block other log sources. </para>
        </section>
        <section id="windows_core_dumps">
            <title>Creating core and memory dumps</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>troubleshooting</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>creating core dumps</secondary>
            </indexterm>
            <para>In certain rare cases, you might have to create core dumps of the &agentabbrev; to
                investigate a particular problem. When enabled, the syslog-ng Agent for Windows
                application creates core dumps automatically when it experiences an unexpected
                shutdown.</para>
            <para>To enable core dumps, set the
                    <parameter>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                    Agent/WriteMinidump</parameter> registry key to 1.</para>
            <para>Core dumps are written into the installation folder of the syslog-ng Agent under
                the <filename>syslog-ng-agent.dmp</filename> filename. The size of a core file is
                typically about 40-50 MB.</para>
            <!-- FIXME mi a default install dir, az elejen az installhoz is! -->
        </section>
        <procedure id="debug_agent">
            <title>Enabling debug logging in &agentabbrev;</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>In case you experience problems with The &agentabbrev; the BalaBit support team
                might request you to create debug logs for the application to help troubleshoot the
                problem. Complete the following steps:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>On the client host select <guimenu>Start > Run > regedit</guimenu>.</para>
            </step>
            <step>
                <para>To send the debug logs into a file, set the
                        <guimenu>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                        Agent/AgentDbgLog</guimenu> key to <parameter>2</parameter>.</para>
                <para>To send the debug logs to the DebugView application, set the
                        <guimenu>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                        Agent/AgentDbgLog</guimenu> key to <parameter>1</parameter>.</para>
            </step>
            <step>
                <para>Reproduce the error. If you requestet file output, the
                        <filename>syslog_ng_Agent.txt</filename> file will be created in the folder
                    where the &agentabbrev; is installed (<filename>%PROGRAMFILES%\syslog-ng
                        Agent\</filename> by default).</para>
            </step>
            <step>
                <para>After solving the problem, delete the
                        <guimenu>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                        Agent/AgentDbgLog</guimenu> key from the registry, otherwise the log file
                    will grow and might consume the available hard disk space. The log file contains
                    the log messages received and processed by the &agentabbrev; as well.</para>
            </step>
        </procedure>
        <procedure id="debug_domain_update">
            <title>Logging domain update errors</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>If the domain settings are not downloaded to a domain host, the syslog-ng Agent
                (starting from version 3.0.6) can create a logfile to debug why the domain settings
                are not updated on the client. Complete the following steps:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>On the client host select <guimenu>Start > Run > regedit</guimenu>.</para>
            </step>
            <step>
                <para>To send the debug logs into a file, set the
                        <guimenu>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                        Agent/GpoDbgLog</guimenu> key to <parameter>2</parameter>.</para>
                <para>To send the debug logs to the DebugView application, set the
                        <guimenu>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                        Agent/GpoDbgLog</guimenu> key to <parameter>1</parameter>.</para>
            </step>
            <step>
                <para>Select <guimenu>Start > Run > gpupdate</guimenu> to reproduce the error. If
                    you requestet file output, the
                        <filename>%systemroot%\system32\syslog_gpext.txt</filename> file will be
                    created.</para>
            </step>
            <step>
                <para>After solving the problem, delete the
                        <guimenu>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                        Agent/GpoDbgLog</guimenu> key from the registry, otherwise the
                        <filename>%systemroot%\system32\syslog_gpext.txt</filename> file will grow
                    every time when the domain settings of the client are updated.</para>
            </step>
        </procedure>
    </chapter>
    <chapter id="chapter_auditing">
        <title>Configuring the auditing policy on Windows</title>
        <indexterm>
            <primary>auditing policy</primary>
        </indexterm>
        <indexterm>
            <primary>Windows auditing policy</primary>
        </indexterm>
        <para>This section describes how to configure the logging and auditing policy on various
            versions of Microsoft Windows. The &agentabbrev; can transfer log messages only about
            those events that are actually logged, so the audit policy has to be configured to log
            the important events.</para>
        <para>Microsoft Windows operating systems can record a range of event types, from a
            system-wide event such as a user logging on, to an attempt by a particular user to read
            a specific file. Both successful and unsuccessful attempts to perform an action can be
            recorded. The audit policy specifies the types of events to be audited. When such an
            event occurs, an entry is added to the log file of the computer.</para>
        <para>Following is a brief overview on how to configure the audit policy on various versions
            of Microsoft Windows. For details, consult the documentation of your operating system,
            or <ulink url="http://technet.microsoft.com/"
                >visit Microsoft TechNet</ulink>. For details on configuring the auditing and
            logging of various applications, like the IIS Server or the ISA Server, consult your
            product documentation. </para>
        <procedure id="windows_auditing_xp">
            <title>Turning on security logging on Windows XP</title>
                <indexterm>
                    <primary>auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <indexterm>
                    <primary>Windows auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
            <para>The following procedure describes how to enable security logging on Windows XP
                Professional hosts.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Login as an administrator.</para>
                </step>
                <step>
                    <para>Click <guimenu>Start</guimenu>, click <guimenu>Run</guimenu>, and
                        type <guimenu>mmc /a</guimenu>.</para>
                </step>
                <step>
                    <para>On the <guimenu>File</guimenu> menu, click <guimenu>Add/Remove
                            Snap-in</guimenu>, and click <guimenu>Add</guimenu>.</para>
                </step>
                <step>
                    <para>Under <guimenu>Snap-in</guimenu>, click <guimenu>Group
                            Policy</guimenu>, and click <guimenu>Add</guimenu>. </para>
                </step>
                <step>
                    <para>In <guimenu>Select Group Policy Object</guimenu>, select <guimenu>Local
                            Computer</guimenu>, then click <guimenu>Finish</guimenu>, click
                            <guimenu>Close</guimenu>, and click
                        <guimenu>OK</guimenu>.</para>
                </step>
                <step>
                    <para>In <guimenu>Console Root</guimenu>, select <guimenu>Local Computer
                            Policy</guimenu>, then click <guimenu>Audit Policy</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click the attribute or event you want to audit on the details pane.
                    </para>
                </step>
                <step>
                    <para>Set the desired options in the <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>Repeat Steps 7-8 for every other event you want to audit.</para>
                </step>
            <note>
                <para>For details on how to remotely enable security logging for workstations, member servers, and
                    domain controllers, see <xref linkend="windows_auditing_domain"/>.</para>
            </note>
        </procedure>
            <procedure id="windows_auditing_domain">
                <title>Turning on security logging for domain controllers</title>
                <indexterm>
                    <primary>auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <indexterm>
                    <primary>Windows auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
            <para>The following procedure describes how to enable security logging on a Windows XP
                Professional domain controller. </para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Login as an administrator.</para>
                </step>
                <step>
                    <para>Click <guimenu>Start</guimenu>, point to <guimenu>Programs</guimenu>,
                        point to <guimenu>Administrative Tools</guimenu>, and click <guimenu>Active
                            Directory Users and Computers</guimenu>. </para>
                </step>
                <step>
                    <para>In the console tree, click <guimenu>Domain Controllers</guimenu>.</para>
                </step>
                <step>
                    <para>Click <guimenu>Action</guimenu>, then click
                            <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>On the <guimenu>Group Policy</guimenu> tab, select the policy you want to
                        change, and click <guimenu>Edit</guimenu>.</para>
                </step>
                <step>
                    <para>In the <guimenu>Group Policy</guimenu> window, in the console tree, click
                            <guimenu>Audit Policy</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click the attribute or event you want to audit on the details pane.
                    </para>
                </step>
                <step>
                    <para>Set the desired options in the <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>Repeat Steps 7-8 for every other event you want to audit.</para>
                </step>
            </procedure>
            <procedure id="windows_auditing_2003">
                <title>Turning on auditing on Windows 2003 Server</title>
                <indexterm>
                    <primary>auditing policy</primary>
                    <secondary>configuring on Windows 2003 Server</secondary>
                </indexterm>
                <indexterm>
                    <primary>Windows auditing policy</primary>
                    <secondary>configuring on Windows 2003 Server</secondary>
                </indexterm>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
            <para>The following procedure describes how to configure auditing on a Windows 2003
                Server host. </para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Login as an administrator.</para>
                </step>
                <step>
                    <para>Click <guimenu>Start</guimenu>, point to <guimenu>Programs</guimenu>,
                        point to <guimenu>Administrative Tools</guimenu>, and click <guimenu>Domain
                            Security Policy</guimenu>.</para>
                </step>
                <step>
                    <para>In the console tree, click <guimenu>Local Policies</guimenu>, then
                            <guimenu>Audit Policy</guimenu>.</para>
                </step>
                <step>
                    <para>Double-click on an event and select the <guimenu>Define these policy
                            settings</guimenu> option.</para>
                </step>
                <step>
                    <para>Select the type of event to log: <guimenu>Success</guimenu> or
                            <guimenu>Failure</guimenu>.</para>
                </step>
                <step>
                    <para>Repeat Steps 4-5 for every other event you want to audit.</para>
                </step>
            </procedure>

    </chapter>
</book>
