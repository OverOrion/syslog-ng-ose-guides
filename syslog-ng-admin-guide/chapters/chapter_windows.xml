<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
[  
  <!ENTITY % xinclude SYSTEM "../../xml-stylesheet/pdf/dtd/xinclude.mod" >
  %xinclude;
  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
  %entities;]>
  <book>
  <bookinfo/>
  <title/>
<chapter id="chapter_intro">
    <title>Introduction</title>
    <indexterm>
        <primary>configuring syslog-ng</primary>
        <secondary>on Windows</secondary>
    </indexterm>
    <indexterm>
        <primary>&agentabbrev;</primary>
    </indexterm>
    <para>This chapter describes how to install and configure the &agentabbrev; on Microsoft
        Windows hosts.</para>
    <para>The &agent; is a log collector and forwarder application for the
        Microsoft Windows platform. It collects the log messages of the Windows-based host and
        forwards them to a syslog-ng server using regular or TLS-encrypted TCP connections.</para>
    <para>The features and restrictions of the &agentabbrev; are summarized below:</para>
    <itemizedlist>
        <listitem>
            <para>Reads messages from eventlog containers and log files.</para>
        </listitem>
        <listitem>
            <para>Transfers log messages using TCP.</para>
        </listitem>
        <listitem>
            <para>Supports TLS encryption.</para>
        </listitem>
        <listitem>
            <para>Authenticates the server using X.509 certificates. Mutual authentication is also
                supported.</para>
        </listitem>
        <listitem>
            <para>The format of eventlog messages can be customized using macros.</para>
        </listitem>
        <listitem>
            <para>Supports multiple destinations both in parallel and fail-over modes.</para>
        </listitem>
        <listitem>
            <para>Can be managed from a domain controller using group policies.</para>
        </listitem>
        <listitem>
            <para>Assigns unique message IDs.</para>
        </listitem>
        <listitem>
            <para>Only basic filtering is supported by the agent, message segmenting, parsing, and
                classification is not.</para>
        </listitem>
        <listitem>
            <indexterm>
                <primary>disk buffer</primary>
                <secondary>on Windows</secondary>
            </indexterm>
            <para>Note that the log messages on Windows come from files &mdash; either eventlog
                containers or custom logfiles &mdash; which are already stored on the harddisk,
                so the agent does not use additional disk buffering.</para>
        </listitem>
    </itemizedlist>
    <section>
    <title>Supported operating systems</title>
    <para>The &agentabbrev; supports the following operating systems:</para>
    <indexterm>
        <primary>supported operating systems</primary>
    </indexterm>
    <itemizedlist>
        <listitem>
            <para>Microsoft Windows Server 2003</para>
        </listitem>
        <listitem>
            <para>Microsoft Windows XP</para>
        </listitem>
        <listitem>
            <para>Microsoft Windows Vista</para>
        </listitem>
        <listitem>
            <para>Microsoft Windows Server 2008</para>
        </listitem>
        <listitem>
            <para>Microsoft Windows 7</para>
        </listitem>
    </itemizedlist>
    <note>
        <para>The &agent; application supports the
            XML-based eventlog used format on Microsoft Windows Vista and Microsoft Windows
            Server 2008, and Windows 7, and also offers full support for 64-bit operating systems.</para>
    </note>
    </section>
    </chapter>
    <chapter id="chapter_install">
        <title>Installing the syslog-ng agent</title>
        <indexterm>
            <primary>syslog-ng agent</primary>
            <secondary>installing</secondary>
        </indexterm>
        <indexterm>
            <primary>installing syslog-ng</primary>
            <secondary>on Windows</secondary>
        </indexterm>
        <indexterm>
            <primary>installing syslog-ng</primary>
            <secondary>syslog-ng agent on domain controllers</secondary>
        </indexterm>
        <para>The syslog-ng Agent for Windows application can be installed in standalone mode on
            independent hosts. If your hosts are members of a domain, you can install the syslog-ng
            agent on the domain controller and configure them globally.</para>
        <itemizedlist>
            <listitem>
                <para>To install the syslog-ng Agent for Windows application in standalone mode, see
                        <xref linkend="windows_install_standalone"/>.</para>
            </listitem>
            <listitem>
                <para>To install the syslog-ng Agent for Windows application on the members of a
                    domain, see <xref linkend="windows_install_domain_controller"/>.</para>
            </listitem>
        </itemizedlist>
        <note>
            <para>The syslog-ng Agent for Windows application is configured usually using its MMC
                snap-in (when managed globally from the domain controller). However, it is also
                possible to use an XML-based configuration file. See <xref
                    linkend="windows_xml_config"/> for details.</para>
        </note>
        <section id="windows_install_standalone">
            <title>Installing the &agentabbrev; in standalone mode</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>installing the agent in standalone mode</secondary>
            </indexterm>
            <para>The syslog-ng Agent for Windows application can be installed in standalone mode on
                independent hosts. If your hosts are members of a domain, install the &agentabbrev; on the domain controller, as described in <xref
                    linkend="windows_install_domain_controller"/>. The syslog-ng agent requires
                about 10 MB hard disk space.</para>
            <para>To install the &agentabbrev; in standalone mode, complete the following steps:</para>
            <note>
                <para>The syslog-ng Agent for Windows requires the Microsoft .NET Framework version
                    2.0. This package is usually already installed on most hosts. It can be
                    downloaded at:</para>
                <para>
                    <ulink
                        url="http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en"
                        >http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en</ulink>
                </para>
            </note>
            <procedure>
                <title>Installing the &agentabbrev; in standalone mode</title>
                <step>
                    <para>Start the installer. Run the
                            <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename>
                        file.</para>
                    <note>
                        <para>Installing the &agentabbrev; requires administrator
                        privileges.</para>
                    </note>
                </step>
                <step>
                    <para>Read the End User License Agreement and select <guibutton>I
                        Agree</guibutton>.</para>
                </step>
                <step>
                    <para>Select the destination folder where you want to install the syslog-ng
                        Agent for Windows application, then select
                    <guibutton>Next</guibutton>.</para>
                </step>
                <step>
                    <para>Select <guilabel>Standalone mode</guilabel>, then click
                        <guibutton>Next</guibutton>. </para>
                </step>
                <step>
                    <para>Starting from version 3.0.3, the &agentabbrev; sends only messages that
                        are created after the agent has been installed. If you want to send old log
                        messages to the syslog-ng server, enable the <guibutton>Send log messages
                            generated before the syslog-ng Agent was installed</guibutton> option
                        and click <guibutton>Install</guibutton>.</para>
                </step>
                <step>
                    <para>The installer automatically opens the configuration interface of the
                        &agentabbrev;. As a minimum, you must set the IP address of the
                        destination server, and the agent will automatically start sending eventlog
                        messages to your central logserver from the Application, Security, and
                        System eventlog containers.</para>
                    <note>
                        <para>The installation is completed only after you close the configuration
                            interface. To modify the configuration later, see <xref linkend="windows_configure_standalone"/>.</para>
                    </note>
                </step>
            </procedure>
        </section>
        <section id="windows_install_domain_controller">
            <title>Installing the &agentabbrev; on the domain controller and the hosts of a domain</title>
            <para>The syslog-ng Agent for Windows application can be installed on the domain
                controller and the members of a domain from the domain controller, and configured
                globally using group policies. The &agentabbrev; requires about 10 MB hard disk
                space.</para>
                <itemizedlist>
                    <listitem>
                        <para>To install the &agentabbrev; application in a domain, see <xref linkend="windows_install_domain"/>.</para>
                    </listitem>
                    <listitem>
                        <para>To configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows_configure_domain_hosts"/>.</para>
                    </listitem>
                    <listitem>
                        <para>To configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows_configure_domain_controllers"/>.</para>
                    </listitem>
                </itemizedlist>
            <note>
                <para>Starting from version <parameter>3.0.4</parameter>, the
                    <parameter>.msi</parameter> version of the installer does not install the MMC
                    configuration snap-in of the agent, therefore the <parameter>.msi</parameter>
                    installer does not require the .NET framework. See also <xref
                        linkend="windows_upgrade_304"/> for details.</para>
            </note>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>installing the agent from the domain controller</secondary>
            </indexterm>
            <procedure id="windows_install_domain">
                <title>Installing the &agentabbrev; on the domain controller and the hosts of a
                    domain</title>
                <note>
                    <para>Starting from version 3.0.3, the syslog-ng Agent sends only messages that
                        are created after the agent has been installed. If you want to send old log
                        messages to the syslog-ng server, download the Orca MSI editor from <ulink
                            url="http://www.technipages.com/download-orca-msi-editor.html"
                            >http://www.technipages.com/download-orca-msi-editor.html</ulink>, open
                        the .msi installer of the syslog-ng Agent, select
                        <guilabel>Property</guilabel>, and change the value of the
                            <guilabel>SENDOLDMESSAGES</guilabel> field to
                        <parameter>yes</parameter>.</para>
                    <para>Alternatively, you can also create an XML configuration file for the
                        agent, and configure it to send the old messages. For details on using an
                        XML-based configuration file for the installation, see <xref
                            linkend="windows_xml_config"/>.</para>
                </note>
                <step>
                    <para>Download both the Microsoft Installer (<parameter>.msi</parameter>)
                        version and the executable (<parameter>.exe</parameter>) version of the
                        &agentabbrev; installer to the domain controller host. Make sure to
                        download the executable that includes the MMC snap-in module. Note that
                        separate .msi intallers are available for 32-bit and 64-bit operating
                        systems.</para>
                    <note>
                        <para>Installing the &agentabbrev; requires administrator privileges, but
                            configuring the related group policies on the domain controller requires
                            domain administrator or higher (e.g., enterprise administrator)
                            privileges.</para>
                        <para/>
                    </note>
                </step>
                <step>
                    <para>Install the &agentabbrev; application to your domain controllers using
                        the <parameter>.exe</parameter> installer.</para>
                    <note>
                        <para>The syslog-ng Agent for Windows requires the Microsoft .NET Framework
                            version 2.0. This package is usually already installed on most hosts. It
                            can be downloaded at:</para>
                        <para>
                            <ulink
                                url="http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en"
                                >http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en</ulink>
                        </para>
                    </note>
                </step>
                <step>
                    <para>Select <guimenu>Start > Control Panel > Administrative Tools > Active
                            Directory Users and Computers</guimenu>, right-click on the
                        Organizational Unit of the domain whose hosts you want to install the
                        syslog-ng agent on, and select <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>Select <guibutton>Group Policy</guibutton>, and edit the Group Policy
                        object you want to add the syslog-ng agent configuration to. Alternatively,
                        you can create a new group policy object as well.</para>
                </step>
                <step>
                    <para>Select <guimenu>Computer Configuration</guimenu>, right-click on
                            <guimenu>Software Settings</guimenu>, and select <guimenu>New >
                        Package</guimenu>.</para>
                </step>
                <step>
                    <para>Navigate to the syslog-ng Agent for Windows <parameter>.msi</parameter>
                        installer and select <guibutton>Open</guibutton>. </para>
                </step>
                <step>
                    <para>Select <guibutton>Assigned</guibutton>, then
                    <guibutton>OK</guibutton>.</para>
                </step>
                <step>
                    <para>Select <guilabel>Computer Configuration > syslog-ng Agent Settings</guilabel> and configure the syslog-ng Agent. The members of the domain will use this configuration. </para>
                </step>
                <step>
                    <para>The syslog-ng Agent for Windows application will be automatically installed on the members of the domain when they are next rebooted. To perform the installation earlier, execute the <command>gpupdate</command> command on the members of the domain.</para>
                    <note><para>If you do not want to install the syslog-ng Agent automatically from the domain controller, skip Steps 5-7, complete Step 8, then install the <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file manually on the members of the domain. This method is useful if you do not want to install the syslog-ng Agent on every host of the domain.</para></note>
                </step>
            </procedure>
        </section>
        <section id="windows_install_silent">
            <title>Unattended installation</title>
            <para>The &agent; application can be installed in silent mode as well, without requiring any user interaction. The various installer options can be specified as command-line options. The following options are available:</para>
            <variablelist>
                 <varlistentry>
                 <term><command>/S</command></term>
                 <listitem>
                     <para>Start the installer in unattended mode. This option is required for the unattended installation.</para>
                 </listitem>
                 </varlistentry>
                 <varlistentry>
                 <term><command>/D=</command></term>
                 <listitem>
                     <para>Install the &agentabbrev; into the specified folder.</para>
                 </listitem>
                 </varlistentry>
                 <varlistentry>
                 <term><command>/NOMENU</command></term>
                 <listitem>
                     <para>Do not add entries about &agentabbrev; to the Start menu.</para>
                 </listitem>
                 </varlistentry>
                 <varlistentry>
                 <term><command>/LOCAL</command></term>
                 <listitem>
                     <para>Install &agentabbrev; in standalone mode. This is the default, installation mode of the &agentabbrev;.</para>
                 </listitem>
                 </varlistentry>
                 <varlistentry>
                 <term><command>/REMOTE</command></term>
                 <listitem>
                     <para>Install &agentabbrev; in domain mode.</para>
                 </listitem>
                 </varlistentry>
                 <varlistentry>
                 <term><command>/SENDOLDMSGS=</command></term>
                 <listitem>
                     <para>If set to <parameter>YES</parameter>, the &agentabbrev; 
                     will forward every message available in its message sources. By default, only new messages are forwarded.</para>
                 </listitem>
                 </varlistentry>
                 <varlistentry>
                 <term><command>/XMLCONFIG=</command></term>
                 <listitem>
                     <para>Use the specified XML configuration file for the configuration of &agentabbrev;.</para>
                 </listitem>
                 </varlistentry>
            </variablelist>
        </section>
        <section id="windows_upgrade">
            <title>Upgrading syslog-ng Agent for Windows to the latest version</title>
            <indexterm significance="preferred">
                <primary>syslog-ng agent</primary>
                <secondary>upgrading</secondary>
            </indexterm>
            <para>The exact upgrading procedure of the syslog-ng Agent for Windows application depends on how you have installed and how you manage the agent.</para>
            <warning>
                <para>When upgrading agents running in domain mode, always upgrade the agents running on the domain hosts before upgrading the agent running on the domain controllers.</para>
                <para>The hosts of a domain (including the domain controllers) should run the same version of the syslog-ng Agent, running different versions on the hosts in neither supported nor recommended.</para>
            </warning>
            <note>
            <indexterm significance="preferred">
                <primary>syslog-ng agent</primary>
                <secondary>upgrading to 3.1</secondary>
            </indexterm>
                <para>Upgrading to &agent; version 3.1 is supported only from &agentabbrev; version 3.0.7.</para>
            </note>
            <itemizedlist>
                <listitem>
                    <para>If a host is running the syslog-ng agent in standalone mode, download and execute the <filename>syslog-ng-agent-&lt;versionnumber&gt;-setup.exe</filename> installer on the host and verify that the displayed information is correct. The agent will be automatically restarted when you close the configuration window.</para>
                </listitem>
                <listitem>
                    <para>If a domain host is running the syslog-ng agent that was installed by the domain controller from the <parameter>.msi</parameter> installer package, complete the steps described in <xref linkend="windows_install_domain_controller"/>. The system will automatically recognize that the new package will update the syslog-ng Agent for Windows application.</para>
                </listitem>
                <listitem>
                    <para>If a domain host is running the syslog-ng agent that was installed manually from the <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file, run the new <filename>syslog-ng-agent-nosnapin-&lt;versionnumber&gt;-setup.exe</filename> file on the host. After the installation is complete, select <guilabel>Start > Run</guilabel> and execute the <command>gpupdate</command> command to refresh the domain settings of the agent.</para>
                </listitem>
            </itemizedlist>
        </section>
        <section id="windows_upgrade_30x">
            <title>Upgrading syslog-ng Agent for Windows 2.x to 3.0.x</title>
            <indexterm significance="preferred">
                <primary>syslog-ng agent</primary>
                <secondary>upgrading to 3.0</secondary>
            </indexterm>
            <para>To upgrade the syslog-ng agent application on hosts that are not members of a
                domain, install the executable (<parameter>.exe</parameter>) version of the
                syslog-ng Agent for Windows installer and select <guilabel>Standalone
                mode</guilabel>. The installer automatically receives and converts every setting of
                version 2.1.x and 2.2beta, and continues to send the log messages to the configured
                destination. At the end of the installation, the new configuration interface is
                displayed, where you can start using the new features of the syslog-ng agent.</para>
            <para>To upgrade the syslog-ng agent application on hosts that are members of a domain,
                install the executable (<parameter>.exe</parameter>) version of the syslog-ng Agent
                for Windows installer and select <guilabel>Manage syslog-ng Agent centrally using
                    Group Policy</guilabel>. After that, the installer asks if you want to use the
                existing configuration as a Local Policy, or as a Group Policy. (Selecting both
                options is also possible, although seldom needed.)</para>
            <para>If you decide to use it as a Group Policy, enter the unique name for the policy,
                or select it from the list of available policies. Any local settings are
                automatically added to the group policy, so these local settings will be applied to
                every computer that belongs to the selected group policy. Afterwards, the installer
                converts every setting of version 2.1.x and 2.2beta, and also automatically
                downloads any group policies that are configured on the domain controller.</para>
            <warning>
                <para>If there are any group policies for the syslog-ng agent configured on the
                    domain controller, downloading the group policies to the clients will overwrite
                    the local settings.</para>
            </warning>
            <note>
                <para>Upgrading from version 2.1 is supported for the 32-bit Windows XP and Server
                    2003 platforms.</para>
            </note>
        </section>
    </chapter>
    <chapter id="chapter_configuration">
    <title>Configuring &agent;</title>
    <section id="windows_configuring">
    <title>How to configure the &agentabbrev;</title>
    <para>This section describes how to configure the &agentabbrev; application. The exact method depends on the installation scenario and also on the configuration method (regular or XML-based) you want to use.
    The syslog-ng Agent for Windows application is configured usually using its MMC snap-in (when managed globally from the domain controller). However, it is also possible to use an XML-based configuration file. </para>
    <itemizedlist>
        <listitem>
            <para>To configure a &agentabbrev; that was installed in standalone mode, see <xref linkend="windows_configure_standalone"/>.</para></listitem>
        <listitem>
                        <para>To configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows_configure_domain_hosts"/>.</para>
                    </listitem>
                    <listitem>
                        <para>To configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows_configure_domain_controllers"/>.</para>
                    </listitem>
        <listitem>
            <para>To configure &agentabbrev; from file, see <xref linkend="windows_xml_config"/>.</para></listitem>
    </itemizedlist>
    <section id="windows_configure_standalone">
    <title>Configuring a standalone &agentabbrev;</title>
                <indexterm>
                <primary>configuring syslog-ng</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <para>In standalone mode, to configure an already installed syslog-ng Agent, select
                    <guibutton>Start Menu > Programs > syslog-ng Agent for Windows > Configure
                    syslog-ng Agent</guibutton>. Alternatively, select <guibutton>Start Menu >
                Run</guibutton>, enter <parameter>gpedit.msc</parameter>, then select
                    <guibutton>Computer configuration > syslog-ng Agent Settings</guibutton></para>
            <warning>
                <para>After modifying its configuration, you have to restart the
                        <parameter>syslog-ng Agent</parameter> service for the changes to take
                    effect. To restart the syslog-ng Agent service, select <guibutton>Start Menu >
                        Run</guibutton> enter <parameter>services.msc</parameter> and restart the
                        <guilabel>syslog-ng Agent</guilabel> service.</para>
            </warning>
    </section>
    <section id="windows_configure_domain">
    <title>Configuring the &agentabbrev;s of a domain</title>
    <para>This section describes how to configure the &agent; application in domain mode.</para>
         <itemizedlist>
                    <listitem>
                        <para>To configure the &agentabbrev;s of the domain hosts, see <xref linkend="windows_configure_domain_hosts"/>.</para>
                    </listitem>
                    <listitem>
                        <para>To configure the &agentabbrev;s of the domain controllers, see <xref linkend="windows_configure_domain_controllers"/>.</para>
                    </listitem>
            <listitem>
                <para>For details on the relationship of different group-policy levels, see <xref linkend="windows_inheritance"/>.</para>
            </listitem>
        </itemizedlist>
                    <procedure id="windows_configure_domain_hosts">
            <title>Configuring the &agentabbrev;s of the domain hosts</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>configuring domain hosts</secondary>
            </indexterm>
            <para>To configure an already installed &agentabbrev; from the domain controller,
                perform the following steps.</para>
                <step>
                    <para>On the domain controller, select <guimenu>Start >
                    Control Panel > Administrative Tools > Active Directory Users and
                Computers</guimenu>.</para>
                    </step>
                 <step>
                     <para>Right-click on the Organizational Unit, then select
                    <guimenu>Properties > syslog-ng Agent Settings</guimenu>.</para>
                 </step>
                 <step>
                     <para>Configure the &agentabbrev; as needed for the domain hosts. The changes will take affect when the domain hosts update their settings from the domain controller. 
                     By default, this happens every 90 minutes, depending on your domain settings. To download the configuration earlier, execute the <command>gpupdate</command> command on the members of the domain.</para>
                     <note>
                         <para>When the domain hosts update their settings, the syslog-ng agent will be automatically restarted to load the new settings, except when there is no difference between the old and the new settings.</para>
                     </note>
                 </step>
             </procedure>
             <procedure id="windows_configure_domain_controllers">
            <title>Configuring the &agentabbrev;s of the domain controllers</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>configuring domain controllers</secondary>
            </indexterm>
            <para>To configure the &agentabbrev; running on the domain controllers,
                perform the following steps.</para>
                <step>
                    <para>On the domain controller, select <guimenu>Start >
                    Control Panel > Administrative Tools > Active Directory Users and
                Computers</guimenu>.</para>
                    </step>
                 <step>
                     <para>Right-click on the Organizational Unit of the domain whose domain controllers you want to configure, then select <guimenu>Properties</guimenu>. By default, the domain controllers are in the Domain Controllers organizational unit.</para>
                 </step>
                 <step>
                    <para>Select <guibutton>Group Policy</guibutton>, and edit the Group Policy
                        object you want to add the syslog-ng agent configuration to. Alternatively,
                        you can create a new group policy object as well.</para>
                </step>
                <step>
                    <para>Select <guilabel>Computer Configuration > syslog-ng Agent Settings</guilabel>        and configure the syslog-ng Agent. The domain controllers of the domain will use this configuration. </para>
                </step>
                 <step>
                     <para>Configure the &agentabbrev; as needed for the domain controllers. If you have multiple domain controllers, the changes will take affect when the other domain controllers update their settings from this domain controller. 
                     By default, this happens every 5 minutes, depending on your domain settings. To download the configuration earlier, execute the <command>gpupdate</command> command on the domain controllers.</para>
                     <note>
                         <para>When the domain controllers receive the new settings, the syslog-ng agent will be automatically restarted to load the new settings, except when there is no difference between the old and the new settings.</para>
                     </note>
                 </step>
             </procedure>

        <section id="windows_inheritance">
        <title>Domain versus local settings</title>
        <indexterm>
            <primary>inheriting settings on Windows</primary>
        </indexterm>
        <indexterm>
            <primary>syslog-ng Agent</primary>
            <secondary>inheriting settings</secondary>
        </indexterm>
        <para>Group policies for the syslog-ng Agent can be specified at different levels, e.g., at
            the domain level, at the organization unit level, at the computer level, or also as a
            local policy of the computer. When evaluating its configuration settings, the syslog-ng
            Agent follows the standard policy-inheritance methods of Windows. If the configuration
            of the syslog-ng Agent is specified at multiple levels (e.g., on the domain level and
            also at the computer level), then the more specific (or lower level) setting is used
            (that is, the computer level in the above example). If a setting is not configured at a
            level, the setting of the next higher level is used (e.g., if something is not
            configured on the computer level, then the setting of the organization unit &mdash;
            or if it is not specified in the policy of organization unit, then the setting of the
            domain policy &mdash; is used). If a setting is not configured in any group policy,
            the syslog-ng Agent checks its local policy settings, and uses the local setting if
            available.</para>
    </section>
    </section>
    <section id="windows_xml_config">
        <title>Using an XML-based configuration file</title>
        <indexterm>
            <primary>syslog-ng Agent</primary>
            <secondary>configuration file</secondary>
        </indexterm>
        <indexterm>
            <primary>syslog-ng Agent</primary>
            <secondary>XML</secondary>
        </indexterm>
        <para>Starting from syslog-ng Agent for Windows version 3.0.4, it is possible to specify the
            configuration of the agent in an XML file when installing the agent, and also when
            starting the agent. The configuration file must be a valid XML file that complies to the
            XML schema supplied with the syslog-ng agent. </para>
        <note>
            <para>By default, the XML schema file is called
                <filename>syslog-ng-agent-conf.xsd</filename> is located in the installation folder
                of the syslog-ng agent, next to the <filename>syslog-ng-agent.exe</filename>
            file.</para>
        </note>
        <procedure>
            <title>Creating an XML configuration file for the syslog-ng agent</title>
            <step>
                <para>Create a new configuration file, or edit the one shown in <xref
                        linkend="windows_xml_config_sample"/>. Use a text editor that can validate
                    the file to the XML schema of the configuration file. One such editor is the
                    Microsoft XML Notepad 2007 application, which is available for free at <ulink
                        url="http://msdn.microsoft.com/en-us/xml/bb190622.aspx"/>. </para>
            </step>
            <step>
                <para>When creating the configuration file, bear in mind the following points:</para>
                <itemizedlist>
                    <listitem>
                        <para>For details on the format of the XML file, see
                            <!--<xref
                            linkend="windows_xml_config_specification"/>-->the
                            sample file at <xref linkend="windows_xml_config_sample"/> and XML
                            schema (.xsd) file installed with the agent.</para>
                    </listitem>
                    <listitem>
                        <para>File sources, event sources, servers, and filters must have a unique
                            index, that is, the definition of the first server should start as
                                <parameter> &lt;Server0 Enabled="1"</parameter>, the second
                                <parameter> &lt;Server2 Enabled="1"</parameter>, etc.</para>
                    </listitem>
                    <listitem>
                        <para>File sources must have a unique identifier (UUID). The agent does not
                            create these identifiers, you must enter them into the configuration
                            file manually.</para>
                    </listitem>
                    <listitem>
                        <para>If you do not use throttling, remove the
                            <parameter>Throttle</parameter> attribute from the destination. Setting
                            the <parameter>Throttle</parameter> attribute to
                            <parameter>0</parameter> is not accepted by the agent.</para>
                    </listitem>
                    <listitem>
                        <para>If you do not want the agent to send old (already existing) messages
                            to the logserver, use the following in the configuration file: </para>
                        <synopsis>&lt;syslog-ng_Agent SendOldMessages="0"&gt;</synopsis>
                        <para>Note that when it starts, the agent automatically removes the
                                <parameter>SendOldMessages="0"</parameter> attribute from the
                            configuration file, but it will not resend the messages after the agent
                            is restarted.</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>To start the agent and use the configuration file, open a command prompt, and
                    issue the following command: <command>syslog-ng-agent.exe -c myconfigfile.xml
                    -d</command>. This command will start the agent in debug mode, and display any
                    errors of the XML configuration file.</para>
            </step>
            <step>
                <para>If there are no errors in the configuration file, start the agent in normal
                    mode: <command>syslog-ng-agent.exe -c myconfigfile.xml</command>.</para>
                <para>To use the XML file during the installation of the agent, use the same syntax
                    with the installer: <command>syslog-ng-agent-3.0.4-setup.exe
                        /xmlconfig="fullpath\myconfigfile.xml"</command>. Note that the XML schema
                    file must be in the same folder as the installer file.</para>
                <note>
                    <itemizedlist>
                        <listitem>
                            <para>If you are using an XML-capable agent without using an XML configuration file, and you want to switch to using an XML configuration file without reinstalling the agent, execute the <command>syslog-ng-agent.exe -i "fullpath\myconfigfile.xml"</command> command. The syslog-ng Agent service will be re-registered to use the XML configuration file.</para>
                        </listitem>
                        <listitem>
                            <para>If you want to use the .msi installer with an xml file, use the
                            <command>syslog-ng-agent-3.0.4-setup.msi
                            SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</command> command, or
                        edit the installer with the Orca MSI editor (<ulink
                            url="http://www.technipages.com/download-orca-msi-editor.html"
                            >http://www.technipages.com/download-orca-msi-editor.html</ulink>), and
                        add the
                        <parameter>SLNGOPTS="/xmlconfig=fullpath\myconfigfile.xml"</parameter> to
                        the installation parameters on the <guilabel>Customization</guilabel>
                    tab.</para>
                        </listitem>
                    </itemizedlist>
                </note>
            </step>
        </procedure>
        <section id="windows_xml_config_sample">
            <title>Sample configuration files for the syslog-ng Agent</title>
            <para>The following is a sample configuration file with minimal settings for the syslog-ng Agent for Windows application.</para>
            <synopsis>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;syslog-ng-agent-configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="c:\Program Files\syslog-ng Agent\syslog-ng-agent-conf.xsd"&gt;
  &lt;SOFTWARE&gt;
    &lt;BalaBit&gt;
      &lt;syslog-ng_Agent WriteMinidump="1" SendOldMessages="1"&gt;
        &lt;Local_Settings Enabled="1"&gt;
          &lt;Destinations&gt;
            &lt;Network&gt;
              &lt;IPv4 Enabled="1" PrimaryServer="1"&gt;
                &lt;Server Index="1" Enabled="1" ServerName="yourserver" ServerPort="514" Throttle="10000" Protocol="2" ProtocolTemplate="&lt;${PRI}&gt;${BSDDATE} ${HOST} ${APP_NAME}[${PROCESS_ID}]: ${MSG}"&gt;&lt;/Server&gt;
              &lt;/IPv4&gt;
            &lt;/Network&gt;
          &lt;/Destinations&gt;
          &lt;EventSources Enabled="1" MessageTemplate="${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}] ${EVENT_MSG} (EventID ${EVENT_ID})"&gt;
            &lt;Sources Enabled="1"&gt;
              &lt;Event Index="0" Enabled="1" Name="Application" /&gt;
              &lt;Event Index="1" Enabled="1" Name="Security" /&gt;
              &lt;Event Index="2" Enabled="1" Name="System" /&gt;
            &lt;/Sources&gt;
          &lt;/EventSources&gt;
        &lt;/Local_Settings&gt;
      &lt;/syslog-ng_Agent&gt;
    &lt;/BalaBit&gt;
  &lt;/SOFTWARE&gt;
&lt;/syslog-ng-agent-configuration&gt;</synopsis>
         <para>The following is a more detailed configuration file for the syslog-ng Agent for Windows application.</para>
         <synopsis>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;syslog-ng-agent-configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="c:\Program Files\syslog-ng Agent\syslog-ng-agent-conf.xsd"&gt;
  &lt;SOFTWARE&gt;
    &lt;BalaBit&gt;
      &lt;syslog-ng_Agent WriteMinidump="1" SendOldMessages="1"&gt;
        &lt;Local_Settings Enabled="1" RegExpIgnoreCase="0" FilterIgnoreCase="0" LogFacility="13"&gt;
          &lt;Destinations&gt;
            &lt;Network&gt;
              &lt;IPv4 Enabled="1" PrimaryServer="0"&gt;
                &lt;Server Index="0" Enabled="1" ServerName="server1" ServerPort="514" Throttle="100000" Protocol="2" ProtocolTemplate="&lt;${PRI}&gt;${BSDDATE} ${HOST} ${APP_NAME}[${PROCESS_ID}]: ${MSG}" UseSSL="0" ClientCertSubject=""&gt;
                  &lt;FailoverServers FailoverServer0="failoverserver01" FailoverServer1="failoverserver02"&gt;&lt;/FailoverServers&gt;
                &lt;/Server&gt;
                &lt;Server Index="1" Enabled="1" ServerName="server1" ServerPort="514" Throttle="100000" Protocol="1" ProtocolTemplate="&lt;${PRI}&gt;${BSDDATE} ${HOST} ${MSG}" UseSSL="0" ClientCertSubject=""&gt;
                  &lt;FailoverServers FailoverServer0="failoverserver11" FailoverServer1="failoverserver12"&gt;&lt;/FailoverServers&gt;
                &lt;/Server&gt;
              &lt;/IPv4&gt;
            &lt;/Network&gt;
          &lt;/Destinations&gt;
          &lt;EventSources Enabled="1" MessageTemplate="${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}] ${EVENT_MSG} (EventID ${EVENT_ID})"&gt;
            &lt;Sources Enabled="1"&gt;
              &lt;Event Index="0" Enabled="1" Name="Application" /&gt;
              &lt;Event Index="1" Enabled="1" Name="Security" /&gt;
              &lt;Event Index="3" Enabled="1" Name="System" /&gt;
            &lt;/Sources&gt;
            &lt;Filter Enabled="1"&gt;
              &lt;Formatted_Message Enabled="1"&gt;
                &lt;Rule Index="0" Regexp="testregexp" Enabled="1" /&gt;
                &lt;Rule Index="1" Regexp="testregexp2" Enabled="1" /&gt;
              &lt;/Formatted_Message&gt;
              &lt;Computer Enabled="1"&gt;
                &lt;Rule Index="0" Computer="mycomputername1" Enabled="1" /&gt;
                &lt;Rule Index="1" Computer="mycomputername2" Enabled="1" /&gt;
              &lt;/Computer&gt;
              &lt;Type Enabled="1"&gt;
                &lt;Rule Index="0" Type="4" Enabled="1"&gt;&lt;/Rule&gt;
                &lt;Rule Index="1" Type="4" Enabled="1"&gt;&lt;/Rule&gt;
              &lt;/Type&gt;
              &lt;User Enabled="1"&gt;
                &lt;Rule Index="0" Username="TESTDOMAIN\Administrator" Enabled="1" /&gt;
                &lt;Rule Index="1" Username="NT AUTHORITY\SYSTEM" Enabled="1" /&gt;
              &lt;/User&gt;
              &lt;Source_EventId Enabled="1"&gt;
                &lt;Rule Index="0" Source="EventCreate" EventId="636" Enabled="1" /&gt;
                &lt;Rule Index="1" Source="EventCreate" EventId="637" Enabled="1" /&gt;
              &lt;/Source_EventId&gt;
              &lt;Source_Category Enabled="1"&gt;
                &lt;Rule Index="0" Source="Security" Category="Object Access" Enabled="1" /&gt;
                &lt;Rule Index="1" Source=" EventCreate" Category="" Enabled="1" /&gt;
              &lt;/Source_Category&gt;
            &lt;/Filter&gt;
          &lt;/EventSources&gt;
          &lt;FileSources MessageTemplate="$FILE_NAME: $FILE_MESSAGE" Enabled="1" LogFacility="0" LogPriority="6"&gt;
            &lt;Sources Enabled="1"&gt;
              &lt;File Index="0" Enabled="1" BaseDirectory="c:\windows" FileNameFilter="*.log" Recursive="0" LastModifiedFileOnly="0" id="a455e5ba-d4e9-4b85-8711-e8bf10141028" PeriodicFileCheck="0" LogFacility="5" LogPriority="5" /&gt;
              &lt;File Index="1" Enabled="1" BaseDirectory="c:\" FileNameFilter="*.txt" Recursive="1" LastModifiedFileOnly="1" id="b455e5ba-d4e9-4b85-8711-e8bf10141038" PeriodicFileCheck="0" /&gt;
            &lt;/Sources&gt;
            &lt;Filter Enabled="1"&gt;
              &lt;Formatted_Message&gt;
                &lt;Rule Index="0" Regexp="Verbose" Enabled="1" /&gt;
                &lt;Rule Index="1" Regexp="Info" Enabled="1" /&gt;
              &lt;/Formatted_Message&gt;
            &lt;/Filter&gt;
          &lt;/FileSources&gt;
        &lt;/Local_Settings&gt;
      &lt;/syslog-ng_Agent&gt;
    &lt;/BalaBit&gt;
  &lt;/SOFTWARE&gt;
&lt;/syslog-ng-agent-configuration&gt;</synopsis>
        </section>
        <!-- <section id="windows_xml_config_specification">
            <title>Specification of the syslog-ng agent configuration file</title>
            <indexterm>
                <primary>syslog-ng Agent</primary>
                <secondary>XML schema</secondary>
            </indexterm>
            <para>The XML schema for the configuration file of the syslog-ng Agent for Windows
                application is the following. </para>
            <itemizedlist>
                <listitem>
                    <para><guilabel>&lt;SOFTWARE&gt;&lt;BalaBit&gt;&lt;syslog-ng_Agent&gt;</guilabel>:
                        These are container elements for the configuration file.</para>
                </listitem>
                <listitem>
                    <para><guilabel>&lt;Local_Settings&gt;</guilabel>: This element stores
                        the configuration of the agent, and also specifies the global options used
                        by the agent, for example:</para>
                    <synopsis>&lt;Local_Settings Enabled="1" RegExpIgnoreCase="1" FilterIgnoreCase="0"  LogFacility="13"&gt;</synopsis>
                    <itemizedlist>                        
                        <listitem>
                            <para><emphasis/>: </para>
                        </listitem>
                        <listitem>
                            <para><emphasis/>: </para>
                        </listitem>
                        <listitem>
                            <para><emphasis/>: </para>
                        </listitem>
                        <listitem>
                            <para><emphasis/>: </para>
                        </listitem>
                        <listitem>
                            <para><guilabel>Destinations</guilabel>: A container element for
                                specifying the destination logservers.</para>
                        </listitem>
                        <listitem>
                            <para><guilabel>EventSources</guilabel>: A container element for
                                specifying the eventlog containers to monitor.</para>
                        </listitem>
                        <listitem>
                            <para><guilabel>FileSources</guilabel>: A container element for
                                specifying the logfiles to monitor.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>

        </section>-->

    </section>
    
    </section>
    <section id="windows_destinations">
        <title>Configuring destinations</title>
        <indexterm>
            <primary>syslog-ng agent</primary>
            <secondary>destinations</secondary>
        </indexterm>
        <indexterm>
            <primary>syslog-ng agent</primary>
            <secondary>configuring the logserver</secondary>
        </indexterm>
        <indexterm>
            <primary>destinations</primary>
            <secondary>syslog-ng agent</secondary>
        </indexterm>
        <para>The syslog-ng Agent for Windows application can send the log messages of the Windows
            host to a central log server or relay. It is possible to send the same messages to
            multiple servers, when each server receives the same messages; and also to configure
            failover servers, when the agent sends the messages to a primary server, or to a
            failover server if the primary becomes unavailable. If the agent loses the connection to
            a destination server and the reconnection fails, it will sends an eventlog message. The
            successful reconnection attempt is also logged. (If the server is unavailable for a long
            time, the agent sends a log message about the failed connection once in every ten
            minutes.)</para>
        <para>Similarly to the Linux version, the agent now sends MARK messages to the server to
            indicate that the client host is alive but there are no log messages to send. A MARK
            message is sent every ten minutes.</para>
        <para>To configure a new destination, complete the following steps:</para>
        <procedure>
            <title>Configuring the destination logservers</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > Destinations >
                    Network</guibutton>, and double-click on <guimenu>IPv4</guimenu>.</para>
            </step>
            <step>
                <para>Select <guibutton>Add</guibutton>, and enter the hostname or the IP address of
                    the logserver into the <guilabel>Server Name</guilabel> field. If your logserver
                    is configured to accept messages on a non-standard port, type the port number
                    into the <guilabel>Server Port</guilabel> field.</para>
            </step>
            <step>
            <!-- FIXME Ezt a templates reszt kulon helyre is ki kellene rakni, hogy konnyebb legyen megtalalni -->
                <para>Select the protocol used to transfer log messages and press
                    <guibutton>Reset</guibutton> to apply the selected template. The following
                    protocol templates are available:</para>
                <itemizedlist>
                    <listitem>
                        <para><emphasis>Legacy BSD Syslog Protocol</emphasis>: Use the legacy
                            BSD-syslog protocol specified in RFC3164. This option uses the following
                            message template: <parameter>&lt;${PRI}&gt;${BSDDATE} ${HOST}
                                ${APP_NAME}[${PROCESS_ID}]: ${MSG}</parameter>.</para>
                    </listitem>
                    <listitem>
                        <para>Syslog<emphasis/>: Uses the new IETF-syslog protocol specified in RFC
                            5424-5428 (see <ulink
                                url="http://www.ietf.org/internet-drafts/draft-ietf-syslog-protocol-23.txt"
                                >http://www.ietf.org/internet-drafts/draft-ietf-syslog-protocol-23.txt</ulink>
                            and <ulink
                                url="http://www.ietf.org/internet-drafts/draft-ietf-syslog-transport-tls-11.txt"
                                >http://www.ietf.org/internet-drafts/draft-ietf-syslog-transport-tls-11.txt</ulink>.
                            Starting from version 3.0, syslog-ng also supports the
                        IETF-protocol.</para>
                    </listitem>
                    <listitem>
                        <indexterm>
                            <primary>snare</primary>
                        </indexterm>
                        <para><emphasis>Snare compatible BSD Syslog Protocol</emphasis>: Sends log
                            messages in a format compatible with the Snare log monitoring tool,
                            using the following template:
                                <parameter>&lt;${PRI}&gt;${BSDDATE} ${HOST}
                            ${MSG}</parameter>.</para>
                    </listitem>
                </itemizedlist>
                <note>
                    <para>Selecting the <guilabel>syslog protocol</guilabel> option is identical to
                        using the <parameter>syslog</parameter> driver of syslog-ng. Similarly, selecting <guilabel>Legacy syslog</guilabel> is equivalent to the <parameter>tcp</parameter>
                        driver of syslog-ng.</para>
                     <para>Changing a protocol does not automatically change the protocol template used. 
                     To use a protocol-specific template, select <guilabel>Reset Protocol Template</guilabel> after modifying the protocol. To send Snare-compatible messages, select <guilabel>Message Type > Snare Compatible Message Type</guilabel> and click <guilabel>Reset Message Template</guilabel> as well.</para>
                </note>
            </step>
            <step>
            <indexterm>
               <primary>message template</primary>
            </indexterm>
            <indexterm>
               <primary>message format</primary>
            </indexterm>
            <indexterm>
               <primary>formatting messages</primary>
            </indexterm>
            	<para>If needed, modify the template of the messages. The format of the messages can be different for the eventlog and the file sources.</para>
            </step>
            <step>
            <indexterm>
               <primary>hostname resolution</primary>
            </indexterm>
            <indexterm>
               <primary>hostname in the messages</primary>
            </indexterm>
            	<para>If the host running &agentabbrev; is sometimes logged in into a domain, sometimes not, then its hostname might change depending on its actual domain membership. This might cause that the hostname appearing in the syslog messages depends on the domain membership of the host. To avoid this situation, enable the <guilabel>Force DNS Hostname</guilabel> option. That way &agentabbrev; resolves the name of its host from the DNS server, and uses the resolved FQDN in the syslog messages.</para>
            </step>
            <step>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>failover servers</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>client-side failover</secondary>
                </indexterm>
                <indexterm>
                    <primary>client-side failover</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <para>If you have a backup server that can accept log messages if the primary
                    logserver becomes unavailable, select the <guilabel>Failover Servers</guilabel>
                    tab, click <guibutton>Add</guibutton>, and enter the hostname or the IP address
                    of the backup logserver into the <guilabel>Server Name</guilabel> field. Repeat
                    this step if you have more than one backup servers.</para>
            </step>
            <step>
                <para>If you want to send the log messages to more than on server in parallel, so
                    that every server receives every message, repeat Steps 3-4 to add the secondary
                    servers. Secondary servers may have failover servers as well.</para>
                <note>
                    <para>The syslog-ng Agent for Windows application considers a message received
                        by the logserver if the primary server of the destination, or one of its
                        failover servers receives it. To modify which server of a destination is the
                        primary server, select <guimenu>syslog-ng Agent Settings > Destinations >
                            Network > IPv4</guimenu>, select the server you want to be primary, and
                        select <guibutton>Edit > Set Primary Server</guibutton>. </para>
                </note>
            </step>
            <step>
                <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                    activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>
        <section id="windows_rate_limit">
            <title>Limiting the rate of messages</title>
            <indexterm>
                <primary>throttle</primary>
                <secondary>on Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>message rate</primary>
                <secondary>on Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>throttle</secondary>
            </indexterm>
            <para>The syslog-ng Agent can control the rate of messages (message per second) sent to
                the central server. That way sudden message-bursts can be avoided, and the load of
                the server is decreased.</para>
            <para>To limit the number of messages sent to a destination, complete the following
                steps:</para>
            <procedure>
                <title>Limiting the number of messages</title>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guibutton>syslog-ng Agent Settings > Destinations >
                        Network</guibutton>, and double-click on <guimenu>IPv4</guimenu>.</para>
                </step>
                <step>
                    <para>Select the destination server and select <guibutton>Edit</guibutton>. To
                        limit the number of messages that the syslog-ng agent sends to the server
                        per second, enter the desired limit into the <guilabel>Throttle</guilabel>
                        field. By default (<parameter>0</parameter>), the syslog-ng agent does not
                        limit the number of messages sent.</para>
                    <note>
                        <para>The throttling parameter applies to the total number of messages sent,
                            not to every source independently. The same value applies to the
                            failover servers of the destination.</para>
                        <para>If you are sending messages to multiple servers, then the speed of the
                            primary server is important: if the primary server cannot accept the
                            messages fast enough, the syslog-ng agent will reduce the number of sent
                            messages to match the speed of the primary server, even if the secondary
                            servers could accept messages faster. If the secondary servers cannot
                            accept messages as fast as the primary server, then the secondary
                            servers will lose messages; the syslog-ng agent will not slow down to
                            wait for them.</para>
                    </note>
                </step>
                <step>
                    <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
        </section>
    </section>
    <section id="windows_sources">
        <title>Configuring message sources</title>
        <para>The syslog-ng Agent for Windows application can read messages from eventlog containers
            and text files. The following sections explain how to configure these message sources.</para>
        <itemizedlist>
            <listitem>
                <para>To forward messages from eventlog containers, see <xref
                        linkend="windows_sources_eventlog"/>.</para>
            </listitem>
            <listitem>
                <para>To forward messages from plain text log files, see <xref
                        linkend="windows_sources_file"/>.</para>
            </listitem>
            <listitem>
                <para>Some global settings can apply to both types of sources, these are described
                    in <xref linkend="windows_global_settings"/>.</para>
            </listitem>
        </itemizedlist>
        <section id="windows_sources_eventlog">
            <title>Eventlog sources</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>eventlog sources</secondary>
            </indexterm>
            <indexterm>
                <primary>sources</primary>
                <secondary>eventlog</secondary>
            </indexterm>
            <para>The syslog-ng Agent for Windows application can collect messages from the standard
                Windows eventlog containers, as well as from custom containers. The agent
                automatically forwards the messages from three standard eventlog containers
                    (<parameter>Application, Security, System</parameter>). To enable or disable
                these sources, or to add custom eventlog containers, complete the following steps:</para>
            <note>
                <para>The syslog-ng Agent for Windows sends its own log messages into the
                        <parameter>Application</parameter> eventlog container.</para>
                <para>The agent caches in the registry the ID of the last message sent to the
                    destination server, so if the agent is not operating for a time (e.g., it is
                    restarted ), then it starts reading messages from the last cached message ID,
                    sending out all the new messages.</para>
            </note>
            <warning>
                <para>If an eventlog container becomes corrupt, the agent will stop processing the
                    event source. A log message (<parameter>Eventlog file is corrupt</parameter>) is
                    sent directly to the logserver to notify about the error.</para>
            </warning>
            <procedure id="windows_sources_regular_eventlog">
                <title>Managing eventlog sources</title>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guibutton>syslog-ng Agent Settings > Eventlog Sources</guibutton>,
                        and double-click on <guimenu>Event Containers</guimenu>.</para>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To disable sending messages from an eventlog container, unselect
                                the checkbox before the name of the container.</para>
                        </listitem>
                        <listitem>
                            <para>To modify the log facility associated with the messages of the
                                container, select the container, click <guibutton>Edit</guibutton>,
                                and select the log facility to use in the <guilabel>Log
                                Facility</guilabel> field.</para>
                        </listitem>
                        <listitem>
                            <para>To add a custom container, select <guibutton>Add</guibutton>, and
                                enter the name if the container into the <guilabel>Event Container
                                    Name</guilabel> field. If you do not know the name of the
                                container, see <xref linkend="windows_custom_eventlog_name"/>.
                            </para>
                        </listitem>
                    </itemizedlist>
                </step>
                <step>
                    <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
            <procedure id="windows_custom_eventlog_name">
                <title>Determining the name of a custom eventlog container</title>
                <step>
                    <para>Open the Event Viewer application.</para>
                </step>
                <step>
                    <para>Select the custom container you are looking for (e.g., <parameter>DNS
                            Server</parameter>).</para>
                </step>
                <step>
                    <para>Right click on the container and select
                    <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>The name of the container is the name of the file (without the extension)
                        displayed in the <guilabel>Logname</guilabel> field (e.g., for
                            <parameter>C:\WINDOWS\system32\config\DnsEvent.Evt</parameter> it is
                            <parameter>DnsEvent</parameter>).</para>
                </step>
                <step>
                    <para>Use this name as the name of the custom eventlog container during the
                        procedure described in <xref linkend="windows_sources_regular_eventlog"/>.</para>
                    <note>
                        <para>On Windows Vista and Server 2008, some container are not real
                            containers, but show selected messages collected from multiple
                            containers. To forward such messages to the syslog-ng server, you have
                            to find out which real containers are displayed in the container, and
                            add them to the configuration of the syslog-ng Agent.</para>
                        <para>Some containers have the <parameter>%4</parameter> characters in their
                            names. When adding these to the syslog-ng Agent, replace
                            <parameter>%4</parameter> with the <parameter>/</parameter> (slash)
                            character. E.g., write
                            <parameter>microsoft-windows-bits-client/analytic</parameter> instead of
                                <parameter>microsoft-windows-bits-client%4analyctic</parameter>.</para>
                        <para>If you are sending old messages to the server as well, the syslog-ng
                            Agent will not send the very first message stored in the container. This
                            is a bug in the Windows API.</para>
                    </note>
                </step>
            </procedure>
        </section>
        <section id="windows_sources_file">
            <title>File sources and logrotation</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>file sources</secondary>
            </indexterm>
            <indexterm>
                <primary>sources</primary>
                <secondary>windows log files</secondary>
            </indexterm>
            <para>The syslog-ng Agent for Windows application can collect log messages from text
                files, and supports the use of wildcards (<parameter>*</parameter>) in filenames and
                foldernames to be able to follow log files that are automatically rotated. To
                configure file sources, complete the following steps:</para>
            <procedure>
                <title>Managing file sources</title>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guibutton>syslog-ng Agent Settings > File Sources</guibutton>,
                        double-click on <guimenu>Sources</guimenu>, and check the
                        <guilabel>Enable</guilabel> option.</para>
                </step>
                <step>
                    <para>Select <guibutton>Add > Browse</guibutton>, and select the log file or the
                        folder containing the log files in the <guilabel>Base Directory</guilabel>
                        field. Select or enter the name and extension of the log files in the
                            <guilabel>File Name Filter</guilabel> field. Wildcards may be used. The
                        syslog-ng agent will forward log messages from every file that is located in
                        this folder and has a name that matches the filter expression.</para>
                    <tip>
                        <para>When specifying the Base Directory, you can use the environment
                            variables of Windows, e.g., <parameter>%WINDIR%</parameter>,
                                <parameter>%SYSTEMROOT%</parameter>,
                            <parameter>%PROGRAMFILES%</parameter>, etc.</para>
                    </tip>
                    <warning>
                        <para>Note that when managing members of a domain, the selected path must be
                            available on the domain members, e.g., <filename>C:\logs</filename> must
                            be available on the client hosts and not on the domain
                        controller.</para>
                    </warning>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To send messages from the files located in the subfolders of the
                                folder set as Base Directory, select the
                                <guilabel>Recursive</guilabel> option.</para>
                        </listitem>
                        <listitem>
                            <para>To send messages only from the file that was last modified, select
                                the <guilabel>Last Modified File Only</guilabel> option.</para>
                                <note>
                                    <para>When using the <guilabel>Last Modified File Only</guilabel> option with a file source that has wildcard in the filename (e.g., <parameter>*.log</parameter>), the following will happen. When started for the first time, the agent will send the contents of every matching file to the central server, and store the position of the last message in the file with the most recent modification date. When new messages are written to this file, the agent will send only the new messages. However, if an older file is modified, the agent will resend the entire contents of this newly modified file, and store the position of the last message in this file only.</para>
                                    <para>When you use wildcards together with the <guilabel>Last Modified File Only</guilabel> option, make sure that older files will not be modified.</para>
                                </note>
                            <para>If you are forwarding the logs of Internet Information Server
                                (IIS) 5 applications, select the <guilabel>IIS 5.x Log</guilabel>
                                option.</para>
                            <note>
                                <para>If this option is not selected, the &agentabbrev; monitors
                                    every matching file in the folder for changes, and sends new log
                                    messages from all files.</para>
                            </note>
                        </listitem>
                        <listitem>
                            <para>To send messages only from the file that was last modified of
                                every subfolder of the Base Directory, select both the
                                    <guilabel>Last Modified File Only</guilabel> and the
                                    <guilabel>Recursive</guilabel> options.</para>
                        </listitem>
                        <listitem>
                            <para>To change the log facility or the log priority associated to the
                                file source, select the desired facility or priority from the
                                    <guilabel>Log Facility</guilabel> or <guilabel>Log
                                Priority</guilabel> fields, respectively.</para>
                            <note>
                                <para>Significant changes to the settings of a file source may cause
                                    the syslog-ng Agent to resend the entire contents of the
                                    matching files. This means that log messages already sent
                                    earlier to the syslog-ng server may be resent and thus
                                    duplicated in the server logs. Configuration changes that may
                                    result in such behavior are:</para>
                                <itemizedlist>
                                    <listitem>
                                        <para>changing the Base Directory,</para>
                                    </listitem>
                                    <listitem>
                                        <para>changing filter options,</para>
                                    </listitem>
                                    <listitem>
                                        <para>changing recursivity and Last Modified File Only
                                            options.</para>
                                    </listitem>
                                </itemizedlist>
                            </note>
                        </listitem>
                    </itemizedlist>
                </step>
                <step>
                    <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
            <note>
                <para>If an application writes a message into a log file without ending the line
                    with a new-line character, saves (closes) the file, and later continues to write
                    into the same line, then this is visible in the file as a single line, but the
                    syslog-ng agent interprets them as two separate messages.</para>
            </note>
            <warning>
            	<para>If an application deletes a log file, the application must ensure that &agentabbrev; had enough time to forward the messages from the file to the central server to avoid losing messages.</para>
            </warning>
            <example>
                <title>Collecting the logs of multiple applications from a single folder</title>
                <para>If two applications log into the same folder (e.g.,
                    <filename>C:\logs</filename>), you have to create two file sources. For example,
                    if the name of the log files is <parameter>application1-*.log</parameter> and
                        <parameter>application2-*.log</parameter>, respectively, then create two
                    file sources with the <filename>C:\logs</filename> Base Directory, but with
                    different File Name Filter: <parameter>application1-*.log</parameter> and
                        <parameter>application2-*.log</parameter>, respectively.</para>
                <para>If other applications log into the <filename>C:\logs</filename> folder, add a
                    separate expression for each application.</para>
                <para>By default, the syslog-ng agent will send every message to the server that
                    arrives into any of the monitored log files. To send only the messages that
                    arrive into the latest file of the source, enable the <guilabel>Last Modified
                        File Only</guilabel> option.</para>
            </example>
        </section>
        <section id="windows_global_settings">
            <title>Global settings of the &agentabbrev;</title>
            <para>The syslog-ng Agent for Windows application has some global settings that can
                apply to both eventlog and file sources. To configure the global settings, complete
                the following procedure:</para>
            <procedure>
                <title>Configuring global settings</title>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <para>Select <guibutton>syslog-ng Agent Settings</guibutton> and double-click on
                            <guimenu>Global Settings</guimenu>.</para>
                </step>
                <step>
                    <para>Set the default log facility associated to the messages.</para>
                </step>
                <step>
                    <para>By default, the filters and regular expressions (see <xref
                            linkend="windows_message_filtering"/>) used in the message filters are
                        case-sensitive. To make them case-insensitive, select the <guilabel>Regular
                            Expressions Ignore Case</guilabel> or the <guilabel>Filters Ignore
                        Case</guilabel> options, or both.</para>
                    <note>
                        <para>The <guilabel>Regular Expressions Ignore Case</guilabel> option makes
                            the <parameter>Message Contents</parameter> filter case-insensitive for
                            both file and eventlog sources. The <guilabel>Filters Ignore
                            Case</guilabel> option makes the <parameter>Computers</parameter>,
                                <parameter>Sources and Categories</parameter>, and the
                                <parameter>Users</parameter> filter case-insensitive.</para>
                    </note>
                </step>
                <step>
                    <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
            <para>Filters and sources can be disabled globally as well. Disabling filters or sources
                means that the syslog-ng agent ignores the disabled settings: i.e., if the file
                sources are disabled, the agent does not send the messages from the files to the
                server. See the following procedure for details.</para>
            <procedure>
                <title>Disabling sources and filters globally</title>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>disabling sources and filters</secondary>
                </indexterm>
                <step>
                    <para>Start the configuration interface of the syslog-ng Agent for Windows
                        application.</para>
                </step>
                <step>
                    <itemizedlist>
                        <listitem>
                            <para>To disable file sources, select <guibutton>syslog-ng Agent
                                    Settings</guibutton>, right-click on <guimenu>File
                                Sources</guimenu>, then select <guibutton>Properties >
                                Disable</guibutton>. </para>
                        </listitem>
                        <listitem>
                            <para>To disable eventlog sources, select <guibutton>syslog-ng Agent
                                    Settings</guibutton>, right-click on <guimenu>Eventlog
                                Sources</guimenu>, then select <guibutton>Properties >
                                Disable</guibutton>. </para>
                        </listitem>
                        <listitem>
                            <para>To disable file filters, select <guibutton>syslog-ng Agent
                                    Settings > File Sources</guibutton>, right-click on
                                    <guimenu>Filters</guimenu>, then select <guibutton>Properties >
                                    Disable</guibutton>. </para>
                        </listitem>
                        <listitem>
                            <para>To disable eventlog filters, select <guibutton>syslog-ng Agent
                                    Settings > Eventlog Sources</guibutton>, right-click on
                                    <guimenu>Filters</guimenu>, then select <guibutton>Properties >
                                    Disable</guibutton>. </para>
                        </listitem>
                    </itemizedlist>
                </step>
                <step>
                    <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
        </section>

    </section>
    <section id="windows_ssl">
        <title>Using SSL-encrypted connections with the syslog-ng agent</title>
        <indexterm>
            <primary>authentication</primary>
            <secondary>syslog-ng agent</secondary>
        </indexterm>
        <indexterm>
            <primary>TLS</primary>
            <secondary>syslog-ng agent</secondary>
        </indexterm>
        <indexterm>
            <primary>certificates</primary>
        </indexterm>
        <para>When connecting to a syslog-ng server using an encrypted connection, the syslog-ng
            agent verifies the certificate of the server. The connection is established only if the
            Certificate Authority (CA) that issued the certificate of the server is available in the
            Certificate Store (<guilabel>MMC > Certificates > Computer Account > Local Computer >
                Trusted Root Certificates</guilabel>) of the Windows-based host.</para>
        <note>
            <para>This certificate (sometimes also called the CACert of the server) is not the
                certificate of the server: it is the certificate of the CA that signed the
                certificate of the server.<!-- (For details on how certificate-based authentication
                works, see <xref linkend="concepts_tls"/>)--></para>
        </note>
        <para>To enable SSL-encrypted connections to the server, complete the following steps:</para>
        <procedure>
            <title>Enabling encrypted connections</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > Destinations >
                    Network</guibutton>, and double-click on <guimenu>IPv4</guimenu>.</para>
            </step>
            <step>
                <para>Select the server that accepts encrypted connections and click
                    <guibutton>Edit</guibutton>.</para>
            </step>
            <step>
                <para>Select the <guibutton>Use SSL</guibutton> option.</para>
                <warning>
                    <para>The connection can be established only if the Certificate Authority (CA)
                        that issued the certificate of the server is available in the Certificate
                        Store (<guilabel>MMC > Certificates > Computer Account > Local Computer >
                            Trusted Root Certificates</guilabel>) of the Windows-based host. See
                            <xref linkend="windows_importcert"/> for details on importing
                        certificates.</para>
                </warning>
                <xi:include href="chapter_configuration.xml"
                    xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(cert_common_name)"
                />
            </step>
            <step>
                <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                    activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>
        <section id="windows_ssl_mutual">
            <title>Using mutual authentication with syslog-ng agent</title>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>mutual authentication</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>client authentication</secondary>
            </indexterm>
            <indexterm>
                <primary>mutual authentication</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <indexterm>
                <primary>client authentication</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <para>When the syslog-ng server is configured to use mutual authentication, it requests
                a certificate from the syslog-ng clients. The &agentabbrev; application can automatically show
                the requested certificate to the server when the connection is established, provided it is
                available in the <guilabel>Personal Certificates</guilabel> store (<guilabel>MMC >
                    Certificates > Computer Account > Local Computer > Personal
                Certificates</guilabel>) of the Local Computer. Use the <guibutton>Certificate
                    Import Wizard</guibutton> to import this certificate. See <xref
                    linkend="windows_importcert"/> for details.</para>
            <!--      <note>
                <para>If the syslog-ng agent cannot find a suitable certificate in the Local
                    Computer/Personal Certificates store, it also checks the Personal Certificates
                    store of the syslog-ng Agent service. If the syslog-ng agent was started
                    manually, the Personal Certificates store of the current user is also
                checked.</para>
            </note>-->
            <note>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>certificate revocation lists</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent</primary>
                    <secondary>CRL</secondary>
                </indexterm>
                <indexterm>
                    <primary>certificate revocation lists</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>CRL</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <para>If a certificate revocation list (CRL) is available in the Local
                    Computer/Personal Certificates store, the syslog-ng agent verifies that the
                    certificate of the syslog-ng server is not on this list.</para>
            </note>
            <procedure id="proc_windows_ssl_mutual">
                <title>Configuring mutual authentication with the syslog-ng Agent for Windows</title>
                <para>If the syslog-ng server requests authentication from the syslog-ng Agent,
                    complete the following steps.</para>
                <step>
                    <para>Create certificates for the clients. By default, the syslog-ng agent will
                        look for a certificate that contains the hostname or IP address of the
                        central syslog-ng server in its Common Name. If you use a different Common
                        Name, do not forget to complete Step 3 to set the Common Name of the
                        certificate.</para>
                    <para>The certificate must contain the private key and must be in PKCS12 format.</para>
                    <tip>
                        <para>To convert a certificate and a key from PEM format to PKCS12 you can
                            use the following command:</para>
                        <synopsis>openssl pkcs12 -export -in agentcertificate.pem -inkey agentprivatekey.pem -out agentcertificatewithkey.pfx </synopsis>
                    </tip>
                </step>
                <step>
                    <para>Import this certificate into the <guilabel>Personal Certificate</guilabel>
                        store of the Local Computer using the Certificate Import Wizard. See <xref
                            linkend="windows_importcert"/> for details.</para>
                </step>
                <step>
                    <para>By default, the syslog-ng agent will look for a certificate that contains
                        the hostname or IP address of the central syslog-ng server in its Common
                        Name. (The agent will look for the server name or address set in the
                            <guilabel>Server Name</guilabel> field of the destination.) If the
                        certificate of the client has a different Common Name, complete the
                        following steps:</para>
                    <substeps>
                        <step>
                            <para>Start the configuration interface of the syslog-ng Agent for
                                Windows application.</para>
                        </step>
                        <step>
                            <para>Select <guibutton>syslog-ng Agent Settings > Destinations >
                                    Network</guibutton>, and double-click on
                                <guimenu>IPv4</guimenu>.</para>
                        </step>
                        <step>
                            <para>Select the server that requires mutual authentication and click
                                    <guibutton>Edit</guibutton>.</para>
                        </step>
                        <step>
                            <para>Select the <guibutton>Use SSL</guibutton> option, click
                                    <guibutton>Select</guibutton>, then select the certificate to
                                use. You can also type the Common Name of the certificate into the 
                                <guilabel>Client Certificate Subject</guilabel> field.</para>
                            <para>If you have more than one certificates with the same Common Name, alternatively, you can type the Distinguished Name (DN) of the certificate into the <guilabel>Client Certificate Subject</guilabel> field. When using the Distinguished Name, type only the elements of the name, separated with comma, starting with the country. E.g., <parameter>US, Maryand, Pasadena, Example Inc,
                Sample Department, mycommonname</parameter> </para>
                            <note>
                                <para>A common way is to use the hostname or the IP address of the
                                    host running the &agentabbrev; as the Common Name of the certificate (e.g.,
                                        <parameter>syslog-ng-agent1.example.com</parameter>).</para>
                            </note>
                        </step>
                    </substeps>
                </step>
                <step>
                    <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                        activate the changes, restart the syslog-ng Agent service.</para>
                </step>
            </procedure>
        </section>
        <section id="windows_importcert">
            <title>Importing certificates with the Microsoft Management Console</title>
            <indexterm>
                <primary>certificates</primary>
                <secondary>importing on Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>importing certificates</secondary>
            </indexterm>
            <indexterm>
                <primary>importing certificates</primary>
            </indexterm>
            <para>To import a certificate, complete the following steps.</para>
            <!-- FIXME leirni, hogy a Ca es kliens certeket hogyan lehet domain controllerbol 
            letolni a kliensekre
            CA: GPO > properties > edit > Windows Settings > Publi key policies > Trusted Root Certificates > Import
            -->
            <procedure>
                <title>Importing certificates with MMC</title>
                <step>
                    <para>Start Microsoft Management Console by executing
                        <filename>mmc.exe</filename> (<guimenu>Start</guimenu> menu <guimenu>Run
                            application</guimenu>). </para>
                    <note>
                        <para>Running <filename>mmc.exe</filename> requires administrator
                            privileges.</para>
                    </note>
                </step>
                <step>
                    <para>Click on the <guimenu>Add/Remove snap-in</guimenu> item of the
                            <guimenu>File</guimenu> menu.</para>
                </step>
                <step>
                    <para>Click <guimenu>Add</guimenu>, select the <guimenu>Certificates</guimenu>
                        module, and click <guimenu>Add</guimenu>.</para>
                </step>
                <step>
                    <para>Select <guimenu>Computer account</guimenu> in the displayed window and
                        click <guimenu>Next</guimenu>.</para>
                </step>
                <step>
                    <para>Select <guimenu>Local computer</guimenu> and click
                        <guimenu>Close</guimenu>. </para>
                </step>
                <step>
                    <para>To import the certificate of the syslog-ng server, navigate to
                            <guimenu>Console Root > Certificates > Trusted Root Certificate
                            Authorities > Certificates</guimenu>.</para>
                    <para>To import a certificate for the syslog-ng agent to perform mutual
                        authentication, navigate to <guimenu>Console Root > Certificates > Personal
                            > Certificates</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click on the <guibutton>Certificates</guibutton> folder and from the
                        appearing menu select <guibutton>All tasks > Import</guibutton>. The
                            <guibutton>Certificate Import Wizard</guibutton> will be displayed.
                        Click <guibutton>Next</guibutton>.</para>
                    <para><emphasis>Optional step</emphasis>: Certificates used to authenticate the
                        syslog-ng agent in mutual authentication include the private key. Provide
                        the password for the private key when requested.</para>
                </step>
                <step>
                    <para>Windows offers a suitable certificate store by default, so click
                            <guibutton>Next</guibutton>.</para>
                </step>
                <step>
                    <para>Click <guibutton>Finish</guibutton> on the summary window and
                            <guibutton>Yes</guibutton> on the window that marks the successful
                        importing of the certificate.</para>
                </step>
            </procedure>
        </section>

    </section>
    <section id="windows_message_filtering">
        <title>Filtering messages</title>
        <indexterm>
            <primary>message filtering</primary>
            <secondary>syslog-ng agent</secondary>
        </indexterm>
        <indexterm>
            <primary>syslog-ng agent</primary>
            <secondary>filtering messages</secondary>
        </indexterm>
        <para>The syslog-ng Agent for Windows application can filter log messages both in 
            blacklist- and whitelist fashion. When using blacklisting, you can define filters, and any message that matches the filters is
            ignored by the agent &mdash; only messages that do not match the filters are sent to
            the central server. When using whitelisting, you can define filters, and the messages matching the filters are forwarded to the central server &mdash; other messages are ignored.</para>
            <para>If you define multiple filters, the messages must match every filter. In other words, the filters are connected to each other with logical
            OR operations.</para>
        <para>Different filters are available for eventlog- and file sources. When the &agentabbrev;
            processes a message, it checks the relevant filters on-by-one: if it finds a
            filter that matches the message, the agent stops processing the message without sending
            it to the server.</para>
        <note>
            <para>By default, all filters are case sensitive. To change this behavior, see <xref
                    linkend="windows_global_settings"/>.</para>
        </note>
        <itemizedlist>
        	<listitem>
        		<para>To filter messages received from eventlog sources, see <xref linkend="filters_eventlog"/>.</para>
        	</listitem>
        	<listitem>
        		<para>To filter messages received from file sources, see <xref linkend="filters_file"/>.</para>
        	</listitem>
        </itemizedlist>
        <para>The following types of filters are available for eventlog sources:</para>
        <itemizedlist>
            <!-- FIXME linkeket a makrokra -->
            <listitem>
                <para><emphasis>Sources and Event ID</emphasis>: Filter on the source (application)
                    that created the message, and optionally on the identification number of the
                    event. Corresponds with the EVENT_SOURCE and EVENT_ID macros.</para>
            </listitem>
            <listitem>
                <para><emphasis>Message Contents</emphasis>: Filter the text of the message, i.e.,
                    the contents of the EVENT_MESSAGE macro.</para>
            </listitem>
            <listitem>
                <para><emphasis>Sources and Categories</emphasis>: Filter on the source
                    (application) that created the message, and optionally on the category of the
                    event. Corresponds with the EVENT_SOURCE and EVENT_CATEGORY macros. Note that
                    leaving the category field empty equals with the <parameter>none</parameter>
                    category of the Event Viewer.</para>
            </listitem>
            <listitem>
                <para><emphasis>Users</emphasis>: Filter on the username associated with the event.
                    Corresponds with the EVENT_USERNAME macro.</para>
            </listitem>
            <listitem>
                <para><emphasis>Computers</emphasis>: Filter on the name of the computer (host) that
                    created the event. Corresponds with the HOST macro.</para>
            </listitem>
            <listitem>
                <para><emphasis>Event Types</emphasis>: Filter on the type of the event. Corresponds
                    with the EVENT_TYPE macro.</para>
            </listitem>
        </itemizedlist>
        <para>To modify the filters used for eventlog messages, complete the following procedure:</para>
        <procedure id="filters_eventlog">
            <title>Filtering eventlog messages</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > Eventlog Sources</guibutton>.</para>
            </step>
            <step>
                <para>On the right-hand pane right-click on <guibutton>Filters</guibutton>, then select <guilabel>Properties > Enable > OK</guilabel>.</para>
            </step>
            <step>
            	<para>To use whitelist-filtering, select <guilabel>White List Filtering</guilabel>. By default, &agentabbrev; uses blacklist filtering.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > Eventlog Sources >
                    Filters</guibutton>, and double-click on the type of filter you want to
                create.</para>
            </step>
            <step>
                <itemizedlist>
                    <!-- FIXME linkeket a makrokra -->
                    <listitem>
                        <para>To ignore messages sent by a specific application, or messages of the
                            application with a specific event ID, double-click on <guibutton>Sources
                                and Event ID</guibutton>, select <guibutton>Add</guibutton>, and
                            select the name of the source (application) whose messages you want to
                            ignore from the <guilabel>Source Name</guilabel> field. To ignore only
                            specific messages of the application, enter the ID of the event into the
                                <guilabel>Event ID</guilabel> field. Select <guimenu>Add >
                            Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To ignore messages that contain a specific string or text,
                            double-click on <guimenu>Message Contents</guimenu>, enter the search
                            term or a regular expression into the <guimenu>Regular
                            Expression</guimenu> field, then select <guimenu>Add >
                        Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To ignore messages sent by a specific application, or messages of the
                            application that fall into a specific category, double-click on
                                <guibutton>Sources and Categories</guibutton>, select
                            <guibutton>Add</guibutton>, and select the name of the application whose
                            messages you want to ignore from the <guilabel>Application
                            Name</guilabel> field. To ignore only those messages of the application
                            that fall into a specific category, enter the name of the category into
                            the <guilabel>Category</guilabel> field. Select <guimenu>Add >
                            Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To ignore messages sent by a specific user, double-click on
                                <guimenu>Users</guimenu>, enter the name of the user into the
                                <guimenu>User</guimenu> field, then select <guimenu>Add >
                            Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para>To ignore messages sent by a specific computer (host), double-click on
                                <guimenu>Computers</guimenu>, enter the name of the user into the
                                <guimenu>Computer</guimenu> field, then select <guimenu>Add >
                            Apply</guimenu>.</para>
                    </listitem>
                    <listitem>
                        <para><emphasis>Event Types</emphasis>: To ignore messages of a specific
                            event-type, double-click on <guimenu>Event Types</guimenu>, select the
                            event types to ignore, and select <guimenu>Ok > Apply</guimenu>.</para>
                        <note>
                            <para>Under Windows Vista and Server 2008, Windows labels certain
                                messages as level 3 and the Event Viewer labels such messages as
                                warnings. This is against the official specification: level 3 should
                                not be used; and only level 2 messages are warnings. To filter these
                                events, you have to manually add a new event type to the registry
                                and set its value to 3, e.g.,
                                    <parameter>HKEY_LOCAL_MACHINE\SOFTWARE\BalaBit\syslog-ng
                                    Agent\Local
                                Settings\EventSources\Filter\Type\Rule0\Type=3</parameter></para>
                        </note>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                    activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>
        <para>The following types of filters are available for file sources:</para>
        <itemizedlist>
            <!-- FIXME linkeket a makrokra -->
            <listitem>
                <para><emphasis>Message Contents</emphasis>: Filter the text of the message, i.e.,
                    the contents of the FILE_MESSAGE macro.</para>
            </listitem>
        </itemizedlist>
        <para>To modify the filters used for file messages, complete the following procedure:</para>
        <procedure id="filters_file">
            <title>Filtering file messages</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > File Sources</guibutton>.</para>
            </step>
            <step>
                <para>On the right-hand pane right-click on <guibutton>Filters</guibutton>, then select <guilabel>Properties > Enable</guilabel>.</para>
            </step>
            <step>
            	<para>To use whitelist-filtering, select <guilabel>White List Filtering</guilabel>. By default, &agentabbrev; uses blacklist filtering.</para></step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > File Sources >
                    Filters</guibutton>, and double-click on the type of filter you want to
                create.</para>
            </step>
            <step>
                <itemizedlist>
                    <listitem>
                        <para>To ignore messages that contain a specific string or text,
                            double-click on <guimenu>Message Contents</guimenu>, enter the search
                            term or a regular expression into the <guimenu>Regular
                            Expression</guimenu> field, then select <guimenu>Add</guimenu>.</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                    activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>
    </section>


    <section id="windows_message_format">
        <title>Customizing the message format</title>
        <indexterm>
            <primary>message format</primary>
            <secondary>syslog-ng agent</secondary>
        </indexterm>
        <indexterm>
            <primary>syslog-ng agent</primary>
            <secondary>message format</secondary>
        </indexterm>
        <para>The format of the messages received from the eventlog and the file sources can be
            customized using templates. You can define separate message format for the eventlog and
            the file sources. If you have multiple destination servers configured, you can define separate templates for each server. When creating a template to customize the message format, you can use
            macros, all alphanumeric characters, and the following special characters:
                <parameter>&lt;&gt;,():;-+/_</parameter>.</para>
        <para>To create a template, complete the following procedure:</para>
        <warning>
            <para>These macros are available only in the syslog-ng Agent for Windows. To recognize
                Windows-specific elements of the log message (e.g., eventlog-related macros) on the
                syslog-ng server, you have to use parsers on the syslog-ng server. The parser must
                be configured to match the message format set in the syslog-ng Agent.<!-- See <xref
                    linkend="configuring_parsers"/> for details.--></para>
        </warning>
        <procedure>
            <title>Customizing messages using templates</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings > Destinations >
                    Network</guibutton>, and double-click on <guimenu>IPv4</guimenu>. Select your
                    logserver, and click <guibutton>Edit</guibutton>.</para>
            </step>
            <step>
                <para>To change the format of messages received from eventlog sources, type the message format you want to use into the <guilabel>Event Message Format > Message Template</guilabel>
                    field. </para>
                    <para>To change the format of messages received from file sources, type the message format you want to use into the <guilabel>File Message Format > Message Template</guilabel>
                    field. </para>
                    <para>Do not forget to add the <parameter>$</parameter> character before
                    macros. See <xref linkend="windows_macros"/> for a complete list of the
                    available macros.</para>
                <para>For example, to send the messages in the <parameter>DATE HOSTNAME
                    MESSAGE</parameter> format, type <parameter>Date:$DATE Hostname:$HOST
                        Logmessage:$MESSAGE</parameter>.</para>
                <para>Note that the $MESSAGE macro contains not only the text of the log message,
                    but also additional information received from the message source, such as the
                    name of the eventlog container, or the file, as set in the eventlog-specific and
                    file-specific templates. See <xref linkend="windows_macros_eventlog"/> and <xref
                        linkend="windows_macros_eventlog"/> for details on modifying the
                    eventlog-specific and file-specific templates.</para>
                <note>
                    <para>Templates are assigned to a single destination server, so it is possible
                        to use different templates for different servers. However, a server and its
                        failover servers always receive the same message.</para>
                </note>
                <warning>
                    <para>If you have more than one destination servers configured (separate
                        servers, not in failover mode), and you want to use the same template for
                        every server, you must manually copy the template into the configuration of
                        each server. Template modifications are not applied automatically to every
                        server.</para>
                     <para>To use a Snare-compatible message format, select <guilabel>Message Type > Snare Compatible Message Type</guilabel> and click <guilabel>Reset Message Template</guilabel>.</para>
                     <indexterm>
                            <primary>snare</primary>
                        </indexterm>
                </warning>
            </step>
            <step>
                <para>Click <guibutton>OK</guibutton>.</para>
            </step>
            <step>
                <para>To activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>
        <para>To customize the format of eventlog messages, complete the following procedure. This
            template is applied by the $MESSAGE macro to format messages received from the eventlog.</para>
        <procedure id="windows_macros_eventlog">
            <title>Customizing eventlog messages</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings</guibutton>, right-click on
                        <guimenu>Eventlog Sources</guimenu> and select
                    <guimenu>Properties</guimenu>.</para>
            </step>
            <step>
                <para>Type the message format into the <guilabel>Message Template</guilabel> field.
                    You can use date- and eventlog-related macros (see <xref
                        linkend="windows_macros"/> for a list of macros).The message customized here
                    is included in the server-specific templates using the
                    <parameter>MESSAGE</parameter> macro.</para>
                <!-- FIXME link -->
                <para>By default, the following is sent about file messages:
                        <parameter>${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}]
                        ${EVENT_MSG} (EventID ${EVENT_ID})</parameter>.</para>
            </step>
            <step>
                <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                    activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>
        <para>To customize the format of file messages, complete the following procedure. This
            template is applied by the $MESSAGE macro to format messages received from the log
            files.</para>
        <procedure id="windows_macros_file">
            <title>Customizing file messages</title>
            <step>
                <para>Start the configuration interface of the syslog-ng Agent for Windows
                    application.</para>
            </step>
            <step>
                <para>Select <guibutton>syslog-ng Agent Settings</guibutton>, right-click on
                        <guimenu>File Sources</guimenu> and select
                <guimenu>Properties</guimenu>.</para>
            </step>
            <step>
                <para>Type the message format into the <guilabel>Message Template</guilabel> field.
                    You can use date- and file-related macros (see <xref linkend="windows_macros"/>
                    for a list of macros). The message customized here is included in the
                    server-specific templates using the <parameter>MESSAGE</parameter> macro.</para>
                <!-- FIXME link -->
                <para>By default, the following is sent about file messages: <parameter>$FILE_NAME:
                        $FILE_MESSAGE</parameter>.</para>
            </step>
            <step>
                <para>Select <guibutton>Apply</guibutton>, then <guibutton>OK</guibutton>. To
                    activate the changes, restart the syslog-ng Agent service.</para>
            </step>
        </procedure>

        <section id="windows_timestamp">
            <title>Customizing the timestamp used by the syslog-ng Agent</title>
            <indexterm>
                <primary>timestamp</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>timestamp</secondary>
            </indexterm>
            <para>The syslog-ng agent can send the syslog messages using either the ISO or the BSD
                timestamp format. It is recommended to use the ISO format, because it contains much
                more information than the BSD format.</para>
            <para>Note that in the syslog-ng agent, the macros without prefix (e.g.,
                <parameter>DATE</parameter>) always refer to the receiving date of the message
                (e.g., <parameter>R_DATE</parameter>) when it arrived into the event log container,
                and are included only for compatibility reasons.</para>
            <warning>
                <indexterm>
                    <primary>timezone</primary>
                    <secondary>Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>eventlog</primary>
                    <secondary>remote logging</secondary>
                </indexterm>
                <para>If a remote host is logging into the event log of the local host that is
                    running syslog-ng Agent for Windows, both hosts should be in the same timezone,
                    because the event log message does not include the timezone information of the
                    sender host. Otherwise, the date of the messages received from the remote host
                    will be incorrect.</para>
            </warning>
        </section>
        <section id="windows_macros">
            <title>Macros available in the syslog-ng Agent</title>
            <para>The following tables list the available macros:</para>
            <warning>
                <para>These macros are available only in the syslog-ng Agent for Windows. To
                    recognize Windows-specific elements of the log message (e.g., eventlog-related
                    macros) on the syslog-ng server, you have to use parsers on the syslog-ng
                    server. The parser must be configured to match the message format set in the
                    syslog-ng Agent.<!-- See <xref linkend="configuring_parsers"/> for details.--></para>
            </warning>
            <itemizedlist>
                <listitem>
                    <para>
                        <link linkend="macro_protocol_agent">Macros related to protocol
                        headers</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="macro_time_agent">Macros related to the date and time of the
                            message</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="macro_event_agent">Macros related to eventlog sources</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="macro_file_agent">Macros related to file sources</link>
                    </para>
                </listitem>
                <note>
                    <para>Note that if you use the Syslog protocol template (meaning that messages
                        are sent using the IETF-syslog protocol), only the message part of the log
                        message can be customized, the structure of the headers and other
                        information is fixed by the protocol.</para>
                </note>
            </itemizedlist>
            <!-- FIXME ezt updatelni, mi van file sourcenal -->
            <para>By default, syslog-ng Agent uses the following format:
                    <parameter>&lt;${PRI}&gt;${BSDDATE} ${HOST} ${APP_NAME}[${PROCESS_ID}]:
                    ${MESSAGE}</parameter>, where <parameter>$MESSAGE</parameter> is
                    <parameter>${EVENT_USERNAME}: ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}]
                    ${EVENT_MSG} (EventID ${EVENT_ID})</parameter> for eventlog messages, and
                    <parameter>$FILE_NAME: $FILE_CURRENT_POSITION/$FILE_SIZE:
                $FILE_MESSAGE</parameter> for file messages.</para>
            <indexterm>
                <primary>syslog-ng agent</primary>
                <secondary>default message format</secondary>
            </indexterm>
            <table id="macro_protocol_agent">
                <title>Protocol-related macros of the syslog-ng agent</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>protocol</secondary>
                </indexterm>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Macro</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>HOST</entry>
                            <entry>Name of the host sending the message. Hostnames are automatically
                                converted to lowercase.</entry>
                        </row>
                        <row>
                            <entry>MESSAGE</entry>
                            <entry>The content of the message, including the text of the message and
                                any file- or event-specific macros that are set for the
                            source.</entry>
                        </row>
                        <row>
                            <entry>MSG</entry>
                            <entry>An alias for the <parameter>MESSAGE</parameter> macro.</entry>                           
                        </row>
                        <row>
                            <entry>PRI</entry>
                            <entry>Priority header of the message, storing the facility and the
                                level of the message.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <table id="macro_time_agent">
                <title>Time-related macros of the syslog-ng agent</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>date and time</secondary>
                </indexterm>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Macro</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>BSDDATE, R_BSDDATE, S_BSDDATE</entry>
                            <entry>Date of the message in BSD timestamp format
                                (month/day/hour/minute/second, each expressed in two digits). This
                                is the original syslog time stamp without year information, e.g.,
                                    <parameter>Jun 13 15:58:00</parameter>. If possible, it is
                                recommended to use <parameter>ISODATE</parameter> for
                            timestamping.</entry>
                        </row>
                        <row>
                            <entry>DATE</entry>
                            <entry>An alias of the ISODATE macro. </entry>
                        </row>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_day)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_fulldate)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_hour)"/>
                        <row>
                            <entry>ISODATE, R_ISODATE, S_ISODATE</entry>
                            <entry>Date of the message in the ISO 8601 compatible standard timestamp
                                format (yyyy-mm-ddThh:mm:ss+-ZONE), e.g.:
                                    <parameter>2006-06-13T15:58:00.123+01:00</parameter>. If
                                possible, it is recommended to use <parameter>ISODATE</parameter>
                                for timestamping. Note that the syslog-ng agent cannot produce
                                fractions of a second (e.g., milliseconds) in the timestamp.</entry>
                        </row>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_min)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_month)"/>
                        <row id="macro_monthname">
                            <entry>MONTHNAME, R_MONTHNAME, S_MONTHNAME</entry>
                            <entry>The English name of the month the message was sent, abbreviated
                                to three characters (e.g., Jan, Feb, etc.). </entry>
                        </row>
                        <row>
                            <entry>R_DATE</entry>
                            <entry>Date when the message was recorded into the eventlog container.
                            </entry>
                        </row>
                        <row>
                            <entry>S_DATE</entry>
                            <entry>Date when the message was created.</entry>
                        </row>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_sec)"/>
                        <row>
                            <entry>TZ, R_TZ, S_TZ</entry>
                            <entry>The name of the time zone of the host. </entry>
                        </row>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_tzoffset)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_unixtime)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_year)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_week)"/>
                        <xi:include href="chapter_reference.xml"
                            xmlns:xi="http://www.w3.org/2001/XInclude"
                            xpointer="element(macro_weekday)"/>
                    </tbody>
                </tgroup>
            </table>
            <table id="macro_event_agent">
                <title>Eventlog-related macros of the syslog-ng agent</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>eventlog sources</secondary>
                </indexterm>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Macro</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>EVENT_CATEGORY</entry>
                            <entry>The category of the event.</entry>
                        </row>
                        <row>
                            <entry>EVENT_FACILITY</entry>
                            <entry>The facility that sent the message.</entry>
                        </row>
                        <row>
                            <entry>EVENT_ID</entry>
                            <entry>The identification number of the event.</entry>
                        </row>
                        <row>
                            <entry>EVENT_LEVEL</entry>
                            <entry>Importance level of the message represented as a number: 6 -
                                Success, 5 - Informational, 4- Warning, or 3 - Error).</entry>
                        </row>
                        <row>
                            <entry>EVENT_MESSAGE</entry>
                            <entry>The content of the message.</entry>
                        </row>
                        <row>
                            <entry>EVENT_MESSAGE_XML</entry>
                            <entry>Contains the entire message in XML format. Available only on
                                Windows Vista and Server 2008 platforms</entry>
                        </row>
                        <row>
                            <entry>EVENT_MSG</entry>
                            <entry>The content of the message. This is an alias of the
                                    <parameter>EVENT_MESSAGE</parameter>.</entry>
                        </row>
                        <row>
                            <entry>EVENT_NAME</entry>
                            <entry>Name of the Windows event log container (e.g., Application or
                                Security).</entry>
                        </row>
                        <row>
                            <entry>EVENT_REC_NUM</entry>
                            <entry>The record number of the event in the event log.</entry>
                        </row>
                        <row>
                            <entry>EVENT_SID</entry>
                            <entry>The security identification number of the event.</entry>
                        </row>
                        <row>
                            <entry>EVENT_SID_TYPE</entry>
                            <entry>The security identification number resolved into name. One of the
                                following: <parameter>User</parameter>,
                                <parameter>Group</parameter>, <parameter>Domain</parameter>,
                                    <parameter>Alias</parameter>
                                <parameter>WellKnownGroup</parameter>,
                                <parameter>DeletedAccount</parameter>,
                                <parameter>Invalid</parameter>, <parameter>Unknown</parameter>,
                                    <parameter>Computer</parameter>. </entry>
                        </row>
                        <row>
                            <entry>EVENT_SOURCE</entry>
                            <entry>The application that created the message.</entry>
                        </row>
                        <row>
                            <entry>EVENT_TASK</entry>
                            <entry>The task category of the event. Available only on Windows Vista
                                and Server 2008 platforms</entry>
                        </row>
                        <row>
                            <entry>EVENT_TYPE</entry>
                            <entry>The importance level of the message in text format.</entry>
                        </row>
                        <row>
                            <entry>EVENT_USERNAME</entry>
                            <entry>The user running the application that created the
                            message.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <table id="macro_file_agent">
                <title>File-related macros of the syslog-ng agent</title>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>syslog-ng agent</secondary>
                </indexterm>
                <indexterm>
                    <primary>macros</primary>
                    <secondary>file sources</secondary>
                </indexterm>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Macro</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>FILE_CURRENT_POSITION</entry>
                            <entry>The position of the message from the beginning of the file in
                                bytes.</entry>
                        </row>
                        <row>
                            <entry>FILE_FACILITY</entry>
                            <entry>The facility that sent the message.</entry>
                        </row>
                        <row>
                            <entry>FILE_LEVEL</entry>
                            <entry>Importance level of the message represented as a number: 6 -
                                Success, 5 - Informational, 4- Warning, or 3 - Error).</entry>
                        </row>
                        <row>
                            <entry>FILE_MESSAGE</entry>
                            <entry>The content of the message.</entry>
                        </row>
                        <row>
                            <entry>FILE_MSG</entry>
                            <entry>The content of the message. This is an alias of the
                                    <parameter>FILE_MESSAGE</parameter> macro.</entry>
                        </row>
                        <row>
                            <entry>FILE_NAME</entry>
                            <entry>Name of the log file (including its path) from where the
                                syslog-ng Agent received the message.</entry>
                        </row>
                        <row>
                            <entry>FILE_SIZE</entry>
                            <entry>The current size of the file in bytes.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
    <section id="windows_service">
        <title>Controlling the &agentabbrev; services</title>
        <para>During installation, &agentabbrev; registers the <parameter>syslog-ng
            Agent</parameter> service that is started automatically when the host boots. To disable
            the automatic startup of the &agentabbrev;, or manually start or stop the service, use
            the <guibutton>Start Menu > Control Panel > Administrative Tools > Services</guibutton>
            interface. The service is running with the privileges of the <parameter>NT
                AUTHORITY\SYSTEM</parameter> user.</para>
        <para>When the &agentabbrev; service is started or stopped, it sends a syslog message to
            the central log server and an eventlog message to the Application eventlog container of
            the host.</para>
        <warning>
            <indexterm>
                <primary>timezone</primary>
                <secondary>Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng Agent</primary>
                <secondary>timezone</secondary>
            </indexterm>
            <para>If you change the timezone setting of the host while the syslog-ng Agent is
                running, you have to restart the syslog-ng Agent. Otherwise, it will not receive the
                updated timezone information and the date of the events will be incorrect.</para>
        </warning>
        <section id="windows_command_line">
            <title>Command-line options</title>
            <para>The syslog-ng Agent for Windows application has the following command-line options:</para>
            <variablelist>
                 <varlistentry>
                     <term>
                     <command>-e</command>
                     </term>
                     <listitem>
                         <para>Start the syslog-ng Agent in debug mode and send the messages to the Application eventlog container.</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-d</command>
                     </term>
                     <listitem>
                         <para>Start the syslog-ng Agent in debug mode. The debug messages can be displayed using the <command>dbgview</command> application (available at <ulink url="http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx">http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx</ulink>).</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-i</command>
                     </term>
                     <listitem>
                         <para>Install the syslog-ng Agent service into the services list.</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-r</command>
                     </term>
                     <listitem>
                         <para>Remove the syslog-ng Agent service from the services list.</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-h</command>
                     </term>
                     <listitem>
                         <para>Display a help message about the command-line options.</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-v</command>
                     </term>
                     <listitem>
                         <para>Display version information.</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-t</command>
                     </term>
                     <listitem>
                         <para>Terminate the currently running syslog-ng Agent.</para>
                     </listitem>
                 </varlistentry>
                 <varlistentry>
                     <term>
                     <command>-c</command>
                     </term>
                     <listitem>
                         <para>Start the syslog-ng Agent using the specified XML configuration file.</para>
                     </listitem>
                 </varlistentry>
            </variablelist>
            <para>To use these options, select <guilabel>Start > Run > cmd</guilabel>, navigate to the directory where the syslog-ng Agent is installed (e.g., <command>cd C:\Windows\Program Files\BalaBit\syslog-ng Agent\</command>), and execute the <command>syslog-ng-agent.exe</command> file with the required option.</para>
        </section>
    </section>
    </chapter>
    <chapter id="chapter_troubleshooting">
        <title>Troubleshooting syslog-ng Agent for Windows</title>
        <!--FIXME beindexelni az egyes bejegyzeseket -->
        <indexterm>
            <primary>&agentabbrev;</primary>
            <secondary>troubleshooting</secondary>
        </indexterm>
        <indexterm>
            <primary>troubleshooting</primary>
            <secondary>&agentabbrev;</secondary>
        </indexterm>
        <para>In case you experience problems with the &agent; application, the following points may be of help.</para>
        <note>
            <para>The followings address only problems specific to the &agentabbrev;, and assume
                that communication between the server and the client is otherwise possible (that is,
                the server is properly configured to receive messages and is available on the
                network, and name resolution is properly configured on the client).</para>
        </note>
        <itemizedlist>
            <listitem>
                <para><emphasis>Configuration changes do not take effect</emphasis>: Configuration
                    changes take effect only after restarting the syslog-ng service or rebooting the
                    system. Also restart the system after changing the timezone settings of the
                    host, or importing a certificate that you want to use to authenticate the
                    communication between the agent and the server. If the configuration of the
                    agent has changed since the last restart, the &agentabbrev; sends a message of
                    the change, including the hmac-sha-1 hash of the new configuration.</para>
                <para>Also note that if your clients are managed from a Domain Controller,
                    configuration changes are not instantly downloaded to the client hosts, only at
                    the time of the next group policy update. To update the configuration of a
                    client host earlier, open a command prompt on the client host, and issue the
                        <command>gpupdate /force</command> command.</para>
                <para>After downloading the configuration from the Domain Controller, the syslog-ng
                    Agent service is automatically restarted if the configuration has changed.</para>
                <note>
                    <para>Certain domain settings that may affect the syslog-ng Agent are downloaded
                        only when the machine is rebooted. For example, moving the computer from one
                        group policy to another requires a reboot to have effect.</para>
                </note>
            </listitem>
            <listitem>
                <para><emphasis>The &agentabbrev; does not send messages to the server</emphasis>:
                    Check the Application eventlog for messages of the &agentabbrev;. In case of
                    connection errors and certificate problems, the &agentabbrev; sends error
                    messages into the eventlog. Ensure that the destination address of the server is
                    correctly set. If you use SSL encryption, verify that the certificate of the
                    Certificate Authority of the server and that the certificate of the client are
                    properly imported. If there are no error messages, check the logs on your
                    logserver: the &agentabbrev; sends a MARK message every ten minutes even if
                    there are no other messages to send.</para>
            </listitem>
            <listitem>
                <para><emphasis>The &agentabbrev; sends only MARK messages to the
                    server</emphasis>: Verify that you have configured the eventlog and file
                    sources, and that they have not been disabled globally. If these settings are
                    correct but the server still does not send any messages, temporarily disable all
                    filters to see that they are not configured to ignore every message. When using
                    filter, it is also recommended to check the global case-sensitivity
                settings.</para>
            </listitem>
            <listitem>
            	<para><emphasis>The hostname used in the messages changes</emphasis>: If a host is sometimes logged in into a domain and sometimes it is not, its hostname might reflect this. To avoid this situation, select <guilabel>syslog-ng Agent > Destinations > IPv4 > Properties > Edit > Force DNS Hostname</guilabel>. This causes &agentabbrev; to resolve its own hostname from DNS and use the resolved FQDN in the syslog messages.</para>
            </listitem>
            <listitem>
                <para><emphasis>Command-line parameters are ignored on Windows Vista and 2008
                    Server</emphasis>: Command-line parameters work only for administrators if User
                    Account Control (UAC) is enabled. To execute syslog-ng Agent with command-line
                    parameters, select <guibutton>Start > Programs > Accessories</guibutton>,
                    right-click on <guibutton>Command prompt > Run as administrator</guibutton>. </para>
                <para>If you contact the BalaBit Support Team about a problem with the syslog-ng
                    Agent for Windows, execute the <command>syslog-ng-agent -V</command> command
                    from the command line and include every version and platform information it
                    displays in your support request.</para>
            </listitem>
            <listitem>
                <para><emphasis>CPU load is high</emphasis>: See <xref linkend="windows_cpu"
                />.</para>
            </listitem>
            <listitem>
                <indexterm>
                    <primary>losing messages</primary>
                    <secondary>from eventlog containers</secondary>
                </indexterm>
                <para><emphasis>Losing messages from eventlog containers</emphasis>: An eventlog
                    container is a special file. The Agent reads this file, formats the messages and
                    sends them to remote log server. Note that the eventlog container can be
                    configured only to a certain size. If the container reaches that size, Windows
                    writes the next message to the beginning of the file. As a result, if the agent
                    is not running (or the destination server is unavailable) so long that the
                    eventlog container is filled up, messages can be lost.</para>
            </listitem>
        </itemizedlist>
        <section id="windows_cpu">
            <title>Sending messages and CPU load</title>
            <para>The &agentabbrev; application can send messages to the server when the Windows
                Scheduler provides resources to the &agentabbrev;. When there are many unsent log
                messages in the log sources, and there is no other significant activity on the host,
                syslog-ng will start to send the messages to the server, possibly increasing the CPU
                load to 100%. After all messages have been sent, or if another application requires
                the resources, the CPU load decreases back to normal.</para>
            <tip>
                <para>To avoid the initial large load on the CPU, limit the rate of message sending
                    temporarily. You can remove the limit after the old messages have been sent. See
                        <xref linkend="windows_rate_limit"/> for details.</para>
            </tip>
            <para>When relaying the messages from multiple sources, the &agentabbrev; sends one
                message at a time from each source. That way a single source with a large log
                traffic does not block other log sources. </para>
        </section>
        <section id="windows_core_dumps">
            <title>Creating core and memory dumps</title>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>troubleshooting</secondary>
            </indexterm>
            <indexterm>
                <primary>&agentabbrev;</primary>
                <secondary>creating core dumps</secondary>
            </indexterm>
            <para>In certain rare cases, you might have to create core dumps of the &agentabbrev;
                to investigate a particular problem. When enabled, the syslog-ng Agent for Windows
                application creates core dumps automatically when it experiences an unexpected
                shutdown.</para>
            <para>To enable core dumps, set the
                    <parameter>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng
                Agent/WriteMinidump</parameter> registry key to 1.</para>
            <para>Core dumps are written into the installation folder of the syslog-ng Agent under
                the <filename>syslog-ng-agent.dmp</filename> filename. The size of a core file is
                typically about 40-50 MB.</para>
            <!-- FIXME mi a default install dir, az elejen az installhoz is! -->
        </section>
        <section id="debug_agent">
                <title>Enabling debug logging in &agentabbrev;</title>
                <para>In case you experience problems with The &agentabbrev; the BalaBit support team might request you to create debug logs for the application to help troubleshoot the problem. Complete the following steps:</para>
                <procedure>
                    <title></title>
                    <step>
                        <para>On the client host select <guilabel>Start > Run > regedit</guilabel>.</para>
                    </step>
                    <step>
                        <para>To send the debug logs into a file, set the <guilabel>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng Agent/AgentDbgLog</guilabel> key to <parameter>2</parameter>.</para>
                        <para>To send the debug logs to the DebugView application, set the <guilabel>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng Agent/AgentDbgLog</guilabel> key to <parameter>1</parameter>.</para>
                    </step> 
                    <step>
                        <para>Reproduce the error. If you requestet file output, the <filename>syslog_ng_Agent.txt</filename> file will be created in the folder where the &agentabbrev; is installed (<filename>%PROGRAMFILES%\syslog-ng Agent\</filename> by default).</para>
                    </step>
                    <step>
                        <para>After solving the problem, delete the <guilabel>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng Agent/AgentDbgLog</guilabel> key from the registry, otherwise the log file will grow and might consume the available hard disk space. The log file contains the log messages received and processed by the &agentabbrev; as well.</para>
                    </step>
                </procedure>
            </section>

        <section id="debug_domain_update">
                <title>Logging domain update errors</title>
                <para>If the domain settings are not downloaded to a domain host, the syslog-ng Agent (starting from version 3.0.6) can create a logfile to debug why the domain settings are not updated on the client. Complete the following steps:</para>
                <procedure>
                    <title></title>
                    <step>
                        <para>On the client host select <guilabel>Start > Run > regedit</guilabel>.</para>
                    </step>
                    <step>
                        <para>To send the debug logs into a file, set the <guilabel>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng Agent/GpoDbgLog</guilabel> key to <parameter>2</parameter>.</para>
                        <para>To send the debug logs to the DebugView application, set the <guilabel>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng Agent/GpoDbgLog</guilabel> key to <parameter>1</parameter>.</para>
                    </step> 
                    <step>
                        <para>Select <guilabel>Start > Run > gpupdate</guilabel> to reproduce the error. If you requestet file output, the <filename>%systemroot%\system32\syslog_gpext.txt</filename> file will be created.</para>
                    </step>
                    <step>
                        <para>After solving the problem, delete the <guilabel>HKEY_LOCAL_MACHINE/Software/Balabit/syslog-ng Agent/GpoDbgLog</guilabel> key from the registry, otherwise the <filename>%systemroot%\system32\syslog_gpext.txt</filename> file will grow every time when the domain settings of the client are updated.</para>
                    </step>
                </procedure>
            </section>
    </chapter>
    <chapter id="chapter_auditing">
        <title>Configuring the auditing policy on Windows</title>
        <indexterm>
            <primary>auditing policy</primary>
        </indexterm>
        <indexterm>
            <primary>Windows auditing policy</primary>
        </indexterm>
        <para>This section describes how to configure the logging and auditing policy on various
            versions of Microsoft Windows. The &agentabbrev; can transfer log messages only about
            those events that are actually logged, so the audit policy has to be configured to log
            the important events.</para>
        <para>Microsoft Windows operating systems can record a range of event types, from a
            system-wide event such as a user logging on, to an attempt by a particular user to read
            a specific file. Both successful and unsuccessful attempts to perform an action can be
            recorded. The audit policy specifies the types of events to be audited. When such an
            event occurs, an entry is added to the log file of the computer.</para>
        <para>Following is a brief overview on how to configure the audit policy on various versions
            of Microsoft Windows. For details, consult the documentation of your operating system,
            or visit Microsoft TechNet at <ulink url="http://technet.microsoft.com/"
                >http://technet.microsoft.com/</ulink>. For details on configuring the auditing and
            logging of various applications, like the IIS Server or the ISA Server, consult your
            product documentation. </para>
        <section id="windows_auditing_xp">
            <title>Turning on security logging on Windows XP</title>
            <para>The following procedure describes how to enable security logging on Windows XP
                Professional hosts.</para>
            <procedure>
                <title>Turning on security logging on Windows XP</title>
                <indexterm>
                    <primary>auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <indexterm>
                    <primary>Windows auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <step>
                    <para>Login as an administrator.</para>
                </step>
                <step>
                    <para>Click <guibutton>Start</guibutton>, click <guibutton>Run</guibutton>, and
                        type <guibutton>mmc /a</guibutton>.</para>
                </step>
                <step>
                    <para>On the <guimenu>File</guimenu> menu, click <guimenu>Add/Remove
                        Snap-in</guimenu>, and click <guimenu>Add</guimenu>.</para>
                </step>
                <step>
                    <para>Under <guimenu>Snap-in</guimenu>, click <guibutton>Group
                        Policy</guibutton>, and click <guimenu>Add</guimenu>. </para>
                </step>
                <step>
                    <para>In <guimenu>Select Group Policy Object</guimenu>, select <guimenu>Local
                            Computer</guimenu>, then click <guibutton>Finish</guibutton>, click
                            <guibutton>Close</guibutton>, and click
                    <guibutton>OK</guibutton>.</para>
                </step>
                <step>
                    <para>In <guimenu>Console Root</guimenu>, select <guimenu>Local Computer
                        Policy</guimenu>, then click <guibutton>Audit Policy</guibutton>.</para>
                </step>
                <step>
                    <para>Right-click the attribute or event you want to audit on the details pane.
                    </para>
                </step>
                <step>
                    <para>Set the desired options in the <guibutton>Properties</guibutton>.</para>
                </step>
                <step>
                    <para>Repeat Steps 7-8 for every other event you want to audit.</para>
                </step>
            </procedure>
            <note>
                <para>To remotely enable security logging for workstations, member servers, and
                    domain controllers, see <xref linkend="windows_auditing_domain"/>.</para>
            </note>
        </section>
        <section id="windows_auditing_domain">
            <title>Turning on security logging for domain controllers</title>
            <para>The following procedure describes how to enable security logging on a Windows XP
                Professional domain controller. </para>
            <procedure>
                <title>Turning on security logging for domain controllers</title>
                <indexterm>
                    <primary>auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <indexterm>
                    <primary>Windows auditing policy</primary>
                    <secondary>configuring on Windows XP</secondary>
                </indexterm>
                <step>
                    <para>Login as an administrator.</para>
                </step>
                <step>
                    <para>Click <guibutton>Start</guibutton>, point to <guimenu>Programs</guimenu>,
                        point to <guimenu>Administrative Tools</guimenu>, and click <guimenu>Active
                            Directory Users and Computers</guimenu>. </para>
                </step>
                <step>
                    <para>In the console tree, click <guimenu>Domain Controllers</guimenu>.</para>
                </step>
                <step>
                    <para>Click <guibutton>Action</guibutton>, then click
                        <guimenu>Properties</guimenu>.</para>
                </step>
                <step>
                    <para>On the <guimenu>Group Policy</guimenu> tab, select the policy you want to
                        change, and click <guibutton>Edit</guibutton>.</para>
                </step>
                <step>
                    <para>In the <guimenu>Group Policy</guimenu> window, in the console tree, click
                            <guimenu>Audit Policy</guimenu>.</para>
                </step>
                <step>
                    <para>Right-click the attribute or event you want to audit on the details pane.
                    </para>
                </step>
                <step>
                    <para>Set the desired options in the <guibutton>Properties</guibutton>.</para>
                </step>
                <step>
                    <para>Repeat Steps 7-8 for every other event you want to audit.</para>
                </step>
            </procedure>
        </section>
        <section id="windows_auditing_2003">
            <title>Turning on auditing on Windows 2003 Server</title>
            <para>The following procedure describes how to configure auditing on a Windows 2003
                Server host. </para>
            <procedure>
                <title>Turning on auditing on Windows 2003 Server</title>
                <indexterm>
                    <primary>auditing policy</primary>
                    <secondary>configuring on Windows 2003 Server</secondary>
                </indexterm>
                <indexterm>
                    <primary>Windows auditing policy</primary>
                    <secondary>configuring on Windows 2003 Server</secondary>
                </indexterm>
                <step>
                    <para>Login as an administrator.</para>
                </step>
                <step>
                    <para>Click <guibutton>Start</guibutton>, point to <guimenu>Programs</guimenu>,
                        point to <guimenu>Administrative Tools</guimenu>, and click <guimenu>Domain
                            Security Policy</guimenu>.</para>
                </step>
                <step>
                    <para>In the console tree, click <guimenu>Local Policies</guimenu>, then
                            <guimenu>Audit Policy</guimenu>.</para>
                </step>
                <step>
                    <para>Double-click on an event and select the <guilabel>Define these policy
                            settings</guilabel> option.</para>
                </step>
                <step>
                    <para>Select the type of event to log: <guilabel>Success</guilabel> or
                            <guilabel>Failure</guilabel>.</para>
                </step>
                <step>
                    <para>Repeat Steps 4-5 for every other event you want to audit.</para>
                </step>
            </procedure>
        </section>

    </chapter>
</book>
